WovenWebApp – Architecture OverviewPure Next.js Edition – November 2025This document is the canonical, high-level description of the WovenWebApp architecture. It defines the complete, end-to-end flow of data within the "Pure Next.js" standard.This document describes the system flow. For a file-by-file breakdown, see WOVENWEB_CODEMAP.md.1. Architectural Philosophy: Pure Next.jsThe entire application—frontend UI, backend logic, API routes, and narrative generation—runs inside a single Next.js App Router application.No Netlify Functions.No multi-port development (e.g., no port 8888 proxy).One Server, One Endpoint: All backend computation is initiated by a single API route.This architecture strictly enforces the "Two Brains" separation:Astro Brain: The local, deterministic data pipeline.Poetic Brain: The external, generative narrative engine.2. Authoritative Ingress PointAll backend processing begins at one and only one location:File: app/api/astrology-mathbrain/route.tsFunction: This Next.js Route Handler receives the user's POST request. It is the orchestrator for the entire "System Spine."3. The "System Spine" (End-to-End Flow)This is the complete, sequential flow of data from request to response, all happening server-side within the route.ts handler.1. route.ts (Ingress)Receives the POST request.Validates the user's input data.2. Astro Brain: Transit EngineFile: src/math-brain/api-client.jsAction: Fetches raw geometry (planet positions) for the requested date range.Links: See WOVENWEB_CODEMAP.md for "Transit Loop" guardrails.3. Astro Brain: FIELD LayerAction: Organizes raw geometry into the field_map.4. Astro Brain: MAP Layer (Seismograph)File: src/math-brain/seismograph-engine.jsAction: Calculates all deterministic metrics: Magnitude, Directional Bias, Volatility.5. Astro Brain: Interpretation LayerFile: src/math-brain/interpretation/Action: Programmatically tags data with keywords (e.g., "Strain," "Support"). No narrative is generated.6. Astro Brain: OrchestratorFile: src/math_brain/main.jsAction: Collects all calculated data into the final, structured JSON object.Contract: The output object must adhere to the API_REFERENCE.md (ACC Spec v2).7. VOICE Layer (The Handoff)File: src/math-brain/voice/Action: The route.ts handler passes the final JSON to the VOICE layer. This layer acts as an API client, sending the JSON and a corpus prompt to the external LLM (Poetic Brain).Links: This process is defined in NARRATIVE_LAYER_INTEGRATION.md.8. route.ts (Egress)The VOICE layer returns the final narrative markdown string.The Route Handler combines the JSON (from step 6) and the markdown (from step 7) into a single response object.This complete object is sent to the client.4. Key Architectural CovenantsThe API Route is the Orchestrator: The route.ts file owns the entire flow.The Astro Brain is Local: Steps 2-6 are 100% deterministic, local calculations.The Poetic Brain is External: Step 7 is the only part of the flow that makes an external network call to a generative API.The Contract is Immutable: The JSON object passed from Step 6 to Step 7 must be valid against the API_REFERENCE.md.This architecture supersedes all "hybrid beast" and multi-port/Netlify Function diagrams. This is the authoritative system flow.