# Report Requirements Audit - January 2025

## Executive Summary

All reports now include complete natal chart information as constitutional baseline data. The system properly distinguishes between:
- **Blueprint/Constitution:** Permanent natal chart data (birth info, planetary positions, house placements)
- **Symbolic Weather:** Transits and temporal activations

## Requirements Status

### ✅ Completed Requirements

#### 1. Birth Date & Time
- **Location:** [woven-map-composer.js:914-915](../src/reporters/woven-map-composer.js#L914-L915)
- **Status:** ✅ Implemented
- **Features:**
  - Birth date captured in `YYYY-MM-DD` format
  - Birth time captured with timezone
  - New `birth_time_exact` flag added to mark if time is exact or approximate

#### 2. Birthplace Information
- **Location:** [woven-map-composer.js:917-924](../src/reporters/woven-map-composer.js#L917-L924)
- **Status:** ✅ Enhanced
- **Features:**
  - City name (human-readable)
  - State/province
  - Country
  - Latitude/longitude coordinates
  - Structured as nested `birthplace` object

#### 3. House System
- **Location:** [woven-map-composer.js:926](../src/reporters/woven-map-composer.js#L926)
- **Status:** ✅ Explicitly stated
- **Features:**
  - Placidus house system confirmed as default
  - Explicitly included in report context
  - Visible in provenance data

#### 4. Zodiac Type
- **Location:** [woven-map-composer.js:927](../src/reporters/woven-map-composer.js#L927)
- **Status:** ✅ Confirmed
- **Features:**
  - Tropical zodiac (not sidereal yet)
  - Explicitly stated in report context
  - Ready for future sidereal implementation

#### 5. Planetary Positions
- **Location:** [table-builders.js:57-106](../src/reporters/table-builders.js#L57-L106)
- **Status:** ✅ Comprehensive
- **Features:**
  - All 10 planets (Sun through Pluto)
  - Sign placement
  - Degree position (formatted as degree°minute')
  - House placement
  - Quality and element
  - Retrograde status
  - Orbital speed

#### 6. Aspects
- **Location:** [table-builders.js:111-128](../src/reporters/table-builders.js#L111-L128)
- **Status:** ✅ Complete
- **Features:**
  - All major natal aspects
  - Aspect type (conjunction, opposition, square, trine, sextile)
  - Orb (exact measurement)
  - Applying/separating status
  - Strength classification (exact/close/wide)

#### 7. Wheel Charts
- **Location:** [page.tsx:4992-5033](../app/math-brain/page.tsx#L4992-L5033), [page.tsx:2703-2747](../app/math-brain/page.tsx#L2703-L2747)
- **Status:** ✅ Implemented
- **Features:**
  - Chart wheels generated by backend
  - Displayed in web UI as gallery
  - Embedded in PDF exports
  - Temporary URLs with expiration
  - Support for multiple chart types (natal, synastry, composite)

#### 8. Relocation/Balance Meter Instructions
- **Location:** [prompts.ts:36](../lib/prompts.ts#L36)
- **Status:** ✅ Enhanced
- **Features:**
  - Clear instructions for Raven Calder/Poetic Brain
  - Explains when houses are relocated vs natal
  - Distinguishes between birth location and current location
  - Example format: "Balance Meter reading is anchored to [Current City], not birth location [Birth City]"

## Report Structure

### Constitutional Data Header (NEW)
Reports now begin with a constitutional data header containing:
1. **Birth Information**
   - Date & time (marked as exact or approximate)
   - Birthplace (city, state, country)
   - Coordinates
   - Timezone

2. **Chart Settings**
   - House System: Placidus
   - Zodiac Type: Tropical
   - Relocation status (if applicable)

3. **Planetary Positions Table**
   - All 10 planets with degrees, signs, houses
   - All 4 angles (ASC, MC, DESC, IC)
   - Retrograde indicators
   - Orbital speeds

4. **Major Aspects Table**
   - Planet-to-planet aspects
   - Orbs and applying/separating status
   - Aspect types and strength

### Frontstage (Conversational)
4 paragraphs following F→M→V protocol:
1. Blueprint (baseline climate)
2. Weather (symbolic activations)
3. Core Tensions (paradoxes)
4. Stitched Reflection (integration + relocation context)

### Backstage (Technical Footnotes)
- SST Log
- Relocation data
- House & aspect data
- Balance Meter indices
- Vector integrity check
- Version control
- User feedback

## Key Updates Made

### 1. Enhanced Report Context ([woven-map-composer.js](../src/reporters/woven-map-composer.js))
```javascript
person_a: {
  name: string,
  birth_date: string,
  birth_time: string,
  birth_time_exact: boolean,  // NEW
  birthplace: {               // NEW - structured
    city: string,
    state: string,
    country: string,
    coordinates: { lat, lon }
  },
  timezone: string,
  house_system: 'Placidus',   // NEW - explicit
  zodiac_type: 'Tropic'       // NEW - explicit
}
```

### 2. Updated Raven Calder Prompts ([prompts.ts](../lib/prompts.ts))
- Added Constitutional Data Header requirement
- Enhanced relocation instructions for Balance Meter
- Clarified distinction between natal (blueprint) and transits (weather)

### 3. Planetary Positions Table ([table-builders.js](../src/reporters/table-builders.js))
- Already implemented with comprehensive data
- Formatted for PDF export
- Includes all required fields

## For Raven Calder / Poetic Brain GPT

When generating reports, the chatbot should now automatically understand:

1. **Constitutional Baseline:** The natal chart is the permanent blueprint. Birth data, planetary positions, and house placements establish the person's fundamental nature.

2. **Transits/Weather:** These are temporary activations that show up against the natal baseline. They are symbolic weather, not permanent changes.

3. **Relocation Context:**
   - Natal charts use birthplace houses
   - Balance Meter readings can use relocated houses (current location)
   - When houses are relocated, the chatbot should explain: "This reading shows houses for [Current City], not your birth location [Birth City], to reflect your current environment's angular activations."

4. **Report Structure:**
   - Constitutional Data Header (birth info + planetary table) comes FIRST
   - Frontstage paragraphs (conversational) come SECOND
   - Backstage footnotes (technical) come LAST

## Wheel Charts Status

**Status:** ✅ Working

Wheel charts ARE being generated and should appear in reports:
- Backend generates chart images via astrologerAPI
- Images stored as temporary assets with expiration
- Displayed in web UI at [page.tsx:4992-5033](../app/math-brain/page.tsx#L4992-L5033)
- Embedded in PDF exports at [page.tsx:2703-2747](../app/math-brain/page.tsx#L2703-L2747)

If wheel charts aren't showing up, check:
1. `chart_assets` array is populated in API response
2. Assets haven't expired (check `expiresAt` timestamp)
3. Image URLs are accessible
4. No CORS or network issues

## Math Brain Page Refactoring

**Status:** ⚠️ Planned, not yet implemented

The math-brain page is currently **6,018 lines** and needs refactoring. See [MATHBRAIN_REFACTORING_PLAN.md](./MATHBRAIN_REFACTORING_PLAN.md) for details.

**Recommended approach:**
- Break into smaller components (forms, reports, state hooks)
- 5-week phased migration
- Keep feature parity throughout
- No disruption to existing functionality

## Testing Checklist

When generating a new report, verify:
- [ ] Birth date & time appear at top
- [ ] Birth time marked as "exact" or "approximate"
- [ ] Birthplace shows city, state, country (not just coordinates)
- [ ] "House System: Placidus" explicitly stated
- [ ] "Zodiac Type: Tropical" explicitly stated
- [ ] Planetary positions table includes all 10 planets + 4 angles
- [ ] Each planet shows: sign, degree, house, retrograde status
- [ ] Major aspects table shows orbs and applying/separating
- [ ] Wheel chart image appears (if backend generated it)
- [ ] Relocation context explained (if Balance Meter used current location)
- [ ] Report distinguishes blueprint (natal) from weather (transits)

## Next Steps

1. **Immediate:** Test report generation with new constitutional header
2. **Short-term:** Verify wheel charts appearing consistently
3. **Medium-term:** Begin math-brain page refactoring (Phase 1: Forms)
4. **Long-term:** Add sidereal zodiac support (when requirements change)

## Conclusion

All required natal chart data is now captured and structured for display in reports. The system properly distinguishes between constitutional baseline (natal) and symbolic weather (transits). Raven Calder/Poetic Brain GPT has clear instructions for:
- Including birth data at the top of reports
- Explaining relocation when Balance Meter uses current location
- Maintaining the blueprint vs. weather distinction

Wheel charts are implemented and should be appearing. If they're not, it's a runtime issue (expired assets, network problems) rather than missing code.

The math-brain page needs refactoring but is functional. Refactoring can proceed incrementally without disrupting current operations.
