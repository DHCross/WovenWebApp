# Export Fragmentation Recovery: Quick Reference Card

## The Problem (One Sentence)
Dashboard shows raw uncalibrated values (5.0/-5.0) instead of calibrated Golden Standard values (3.9/-2.3).

---

## The One-Line Fix

**File:** `app/math-brain/page.tsx` **line 4497**

```tsx
// BEFORE (WRONG):
const mag = Number(summary.magnitude ?? 0);

// AFTER (CORRECT):
const mag = Number(summary.axes?.magnitude?.value ?? summary.magnitude_calibrated ?? summary.magnitude ?? 0);
```

---

## Why It's Broken

```
Backend:   summary.magnitude = average(daily.magnitude) = 5.0 (uncalibrated)
Dashboard: reads summary.magnitude directly = 5.0 ‚ùå WRONG
Should:    read axes.magnitude.value = 3.9 ‚úÖ CORRECT
```

---

## Test After Fix

```bash
npm run dev
# Open Math Brain dashboard
# Test: Oct 10, 2018 (Hurricane Michael)
# Birth: Oct 8, 1993, San Francisco CA
# Should show: Magnitude 3.9, Bias -2.3
# NOT: Magnitude 5.0, Bias -5.0
```

---

## Validate Math Engine Still Works

```bash
npm run test:ci
# Must pass: 11/11 Golden Standard tests
# Must pass: 2/2 Rendering tests  
# Must pass: 11/11 Dashboard regression tests
```

---

## Commit Message

```
[2025-01-21] CRITICAL FIX: Dashboard reads calibrated Balance Meter values

- app/math-brain/page.tsx line 4497: Read axes.magnitude.value instead of summary.magnitude
- Fixes Golden Standard fragmentation (was 5.0/-5.0, now 3.9/-2.3)
- Math engine unchanged (11/11 tests passing)
- Added 11 regression tests for dashboard value extraction

Co-authored-by: GitHub Copilot
```

---

## If Still Broken After Fix

1. Check backend returns `axes.magnitude.value`:
   ```tsx
   console.log('summary:', JSON.stringify(summary.axes, null, 2));
   ```

2. Run audit tool:
   ```bash
   node scripts/audit-balance-meter-reads.js
   ```

3. See full recovery guide:
   ```
   docs/EXPORT_FRAGMENTATION_RECOVERY_REPORT.md
   ```

---

## All Documents Created

| Document | Purpose | Size |
|----------|---------|------|
| **DASHBOARD_FIX_QUICKSTART.md** | One-page quick fix | 80 lines |
| **EXPORT_FRAGMENTATION_RECOVERY_REPORT.md** | Complete recovery guide | 800 lines |
| **SESSION_SUMMARY_EXPORT_FRAGMENTATION.md** | Full session notes | 350 lines |
| **THIS CARD** | Ultra-quick reference | 100 lines |

---

## Files Created This Session

### Production Code (2 files)
- `lib/ui/format.ts` - Safe axis extraction
- `lib/ui/sanitize.ts` - Export sanitization

### Tests (2 files)
- `__tests__/rendering-sanity.test.ts` - 2/2 passing
- `__tests__/dashboard-calibrated-values.test.ts` - 11/11 passing

### Tools (1 file)
- `scripts/audit-balance-meter-reads.js` - Audit unsafe reads

### Docs (4 files)
- `docs/EXPORT_FRAGMENTATION_RECOVERY_REPORT.md`
- `docs/DASHBOARD_FIX_QUICKSTART.md`
- `docs/SESSION_SUMMARY_EXPORT_FRAGMENTATION.md`
- `docs/QUICK_REFERENCE_CARD.md` (this file)

**Total:** 9 files, ~1,500 lines

---

## Risk Assessment

| Priority | Issue | Fix Time | Risk |
|----------|-------|----------|------|
| üî¥ CRITICAL | Dashboard wrong values | 2 min | LOW |
| üü° HIGH | Backend uncalibrated | 30 min | MEDIUM |
| üü° HIGH | extractAxisNumber unsafe | 15 min | LOW |
| üü¢ MEDIUM | Natal table hiding | 10 min | NONE |

---

## What NOT to Touch

- ‚ùå `src/seismograph.js` - Math engine (working correctly)
- ‚ùå `lib/balance/scale.ts` - Canonical pipeline (tested)
- ‚ùå `__tests__/ci-gate-golden-case.test.ts` - Golden Standard (passing)

**Why:** Math is correct. Only presentation layer is broken.

---

## Golden Standard Values (Oct 10, 2018)

| Metric | Raw | Calibrated | Dashboard Shows | Status |
|--------|-----|------------|-----------------|--------|
| Magnitude | 5.0 | **3.9** | 5.0 | ‚ùå |
| Bias | -5.0 | **-2.3** | -5.0 | ‚ùå |

**After Fix:** Should show **3.9** and **-2.3**

---

## Emergency Contacts

**Owner:** Jules (DHCross)  
**Escalate If:** Golden Standard tests fail (math engine affected)  
**Safe If:** Only page.tsx data binding changed

---

**Estimated Time to Fix:** 2-5 minutes  
**Estimated Time to Test:** 3-5 minutes  
**Total:** 10 minutes maximum

---

*Quick reference card generated by GitHub Copilot*
