(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6861:function(e,t,n){Promise.resolve().then(n.bind(n,1260))},1260:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var i=n(7437),o=n(2265),l=n(5216);function a(){let[e,t]=(0,o.useState)(!1),[n,a]=(0,o.useState)(!1),[r,c]=(0,o.useState)(null),[s,u]=(0,o.useState)(null),[d,h]=(0,o.useState)(null),g="true"===String("true"),D=(0,o.useRef)(null);(0,o.useEffect)(()=>{let e=!1,n=setTimeout(()=>{e||(c(e=>e||"Auth init slow or unavailable"),t(!0))},5e3);return async function(){try{var n,i;let o;"function"==typeof(null===(n=window.auth0)||void 0===n?void 0:n.createAuth0Client)||"function"==typeof window.createAuth0Client||await new Promise((e,t)=>{let n=document.createElement("script");n.src="/vendor/auth0-spa-js.production.js",n.async=!0,n.onload=()=>e(),n.onerror=()=>t(Error("Failed to load Auth0 SDK")),document.head.appendChild(n)});try{let t=await fetch("/api/auth-config",{cache:"no-store"});if(!t.ok)throw Error("Auth config failed: ".concat(t.status," ").concat(t.statusText));o=await t.json(),console.log("Auth config received:",o),e||h({domain:null==o?void 0:o.domain,clientId:null==o?void 0:o.clientId})}catch(n){console.warn("Could not fetch auth config, using development fallback:",n),e||(c("Auth not available (functions not running)"),t(!0));return}if(!(null==o?void 0:o.domain)||!(null==o?void 0:o.clientId))throw Error("Invalid Auth0 config - missing domain or clientId");let r=(null===(i=window.auth0)||void 0===i?void 0:i.createAuth0Client)||window.createAuth0Client;if("function"!=typeof r)throw Error("Auth0 SDK not available after load");let s=await r({domain:String(o.domain).replace(/^https?:\/\//,""),clientId:o.clientId,authorizationParams:{redirect_uri:(0,l.g)()}});D.current=s,console.log("\uD83D\uDD10 Auth0 client initialized successfully");let d=window.location.search;if(console.log("\uD83D\uDD10 Current URL search params:",d),d.includes("code=")&&d.includes("state=")){console.log("\uD83D\uDD10 Auth callback detected on HomeHero, attempting to process...");try{await s.handleRedirectCallback(),console.log("\uD83D\uDD10 Callback handled successfully")}catch(e){console.warn("\uD83D\uDD10 Callback handling failed (non-fatal on HomeHero):",(null==e?void 0:e.message)||e)}finally{let e=new URL(window.location.href);e.search="",window.history.replaceState({},"",e.toString()),console.log("\uD83D\uDD10 URL cleaned up")}}let g=await s.isAuthenticated();console.log("\uD83D\uDD10 Authentication check result:",g);let m=null;if(g)try{let e=await s.getUser();m=(null==e?void 0:e.name)||(null==e?void 0:e.email)||null,console.log("\uD83D\uDD10 User info retrieved:",{name:m,email:null==e?void 0:e.email})}catch(e){console.error("\uD83D\uDD10 Failed to get user info:",e)}e||(u(m),a(g),t(!0))}catch(n){e||(c((null==n?void 0:n.message)||"Auth init failed"),t(!0))}}(),()=>{e=!0,clearTimeout(n)}},[]);let m=async()=>{if(console.log("\uD83D\uDD10 Google login clicked"),console.log("\uD83D\uDD10 Client ref:",D.current),console.log("\uD83D\uDD10 Redirect URI:",(0,l.g)()),!D.current){console.error("\uD83D\uDD10 Auth0 client not initialized"),c("Auth0 client not initialized");return}try{console.log("\uD83D\uDD10 Calling loginWithRedirect..."),await D.current.loginWithRedirect({authorizationParams:{redirect_uri:(0,l.g)(),connection:"google-oauth2"}})}catch(e){console.error("\uD83D\uDD10 Login error:",e),c((null==e?void 0:e.message)||"Login failed")}};return console.log("\uD83D\uDD10 HomeHero render - ready:",e,"authed:",n,"error:",r),(0,i.jsx)("section",{className:"mt-8",children:(0,i.jsxs)("div",{className:"rounded-xl border border-slate-800 bg-slate-900/40 p-6",children:[(0,i.jsx)("h2",{className:"text-2xl font-semibold tracking-tight",children:"Start with Math Brain"}),(0,i.jsx)("p",{className:"mt-2 text-slate-400",children:"Run the geometry first. Then, once you’re signed in, jump into Chat to synthesize the narrative."}),(0,i.jsxs)("div",{className:"mt-6 flex flex-wrap gap-3",children:[(0,i.jsx)("a",{href:"/math-brain?report=balance",className:"rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-500",title:"Open Math Brain with Balance Meter",children:"Open Math Brain (Astro Reports)"}),e&&n?(0,i.jsx)("a",{href:"/chat",className:"rounded-md px-4 py-2 bg-emerald-600 text-white hover:bg-emerald-500",title:"Open Poetic Brain (Chat)",children:"Open Poetic Brain"}):(0,i.jsx)("button",{onClick:m,className:"rounded-md border border-slate-700 bg-slate-800 px-4 py-2 text-slate-100 hover:bg-slate-700",title:"Sign in to enable Poetic Brain",children:"Continue with Google"}),!e&&(0,i.jsx)("span",{className:"rounded-md bg-slate-800 px-4 py-2 text-slate-400","aria-live":"polite",children:"Loading auth…"})]}),n&&(0,i.jsxs)("p",{className:"mt-3 text-xs text-slate-500",children:["Signed in",s?" as ".concat(s):"",". Chat is now enabled."]}),r&&(0,i.jsx)("p",{className:"mt-3 text-xs text-rose-400",children:r}),g&&d&&(0,i.jsxs)("p",{className:"mt-2 text-[11px] text-slate-500",children:["Auth config • domain: ",(0,i.jsx)("span",{className:"text-slate-300",children:d.domain||"—"})," • client: ",(0,i.jsx)("span",{className:"text-slate-300",children:d.clientId?String(d.clientId).slice(0,4)+"…":"—"})]})]})})}},5216:function(e,t,n){"use strict";function i(){return window.location.origin+"/math-brain"}n.d(t,{g:function(){return i}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=6861)}),_N_E=e.O()}]);