(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6861:function(t,e,n){Promise.resolve().then(n.bind(n,1260))},1260:function(t,e,n){"use strict";n.d(e,{default:function(){return o}});var i=n(7437),a=n(2265),l=n(5216);function o(){let[t,e]=(0,a.useState)(!1),[n,o]=(0,a.useState)(!1),[r,s]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[u,h]=(0,a.useState)(null),m="true"===String("true"),f=(0,a.useRef)(null);(0,a.useEffect)(()=>{let t=!1,n=setTimeout(()=>{t||(s(t=>t||"Auth init slow or unavailable"),e(!0))},5e3);return async function(){try{var n,i;let a;"function"==typeof(null===(n=window.auth0)||void 0===n?void 0:n.createAuth0Client)||"function"==typeof window.createAuth0Client||await new Promise((t,e)=>{let n=document.createElement("script");n.src="/vendor/auth0-spa-js.production.js",n.async=!0,n.onload=()=>t(),n.onerror=()=>e(Error("Failed to load Auth0 SDK")),document.head.appendChild(n)});try{let e=await fetch("/api/auth-config",{cache:"no-store"});if(!e.ok)throw Error("Auth config failed: ".concat(e.status," ").concat(e.statusText));a=await e.json(),console.log("Auth config received:",a),t||h({domain:null==a?void 0:a.domain,clientId:null==a?void 0:a.clientId})}catch(n){console.warn("Could not fetch auth config, using development fallback:",n),t||(s("Auth not available (functions not running)"),e(!0));return}if(!(null==a?void 0:a.domain)||!(null==a?void 0:a.clientId))throw Error("Invalid Auth0 config - missing domain or clientId");let r=(null===(i=window.auth0)||void 0===i?void 0:i.createAuth0Client)||window.createAuth0Client;if("function"!=typeof r)throw Error("Auth0 SDK not available after load");let c=await r({domain:String(a.domain).replace(/^https?:\/\//,""),clientId:a.clientId,authorizationParams:{redirect_uri:(0,l.g)()}});f.current=c;let u=window.location.search;if(u.includes("code=")&&u.includes("state=")){await c.handleRedirectCallback();let t=new URL(window.location.href);t.search="",window.history.replaceState({},"",t.toString())}let m=await c.isAuthenticated(),g=null;if(m)try{let t=await c.getUser();g=(null==t?void 0:t.name)||(null==t?void 0:t.email)||null}catch(t){}t||(d(g),o(m),e(!0))}catch(n){t||(s((null==n?void 0:n.message)||"Auth init failed"),e(!0))}}(),()=>{t=!0,clearTimeout(n)}},[]);let g=async()=>{try{var t;await (null===(t=f.current)||void 0===t?void 0:t.loginWithRedirect({authorizationParams:{redirect_uri:(0,l.g)(),connection:"google-oauth2"}}))}catch(t){s((null==t?void 0:t.message)||"Login failed")}};return(0,i.jsx)("section",{className:"mt-8",children:(0,i.jsxs)("div",{className:"rounded-xl border border-slate-800 bg-slate-900/40 p-6",children:[(0,i.jsx)("h2",{className:"text-2xl font-semibold tracking-tight",children:"Start with Math Brain"}),(0,i.jsx)("p",{className:"mt-2 text-slate-400",children:"Run the geometry first. Then, once you’re signed in, jump into Chat to synthesize the narrative."}),(0,i.jsxs)("div",{className:"mt-6 flex flex-wrap gap-3",children:[(0,i.jsx)("a",{href:"/math-brain?report=balance",className:"rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-500",title:"Open Math Brain with Balance Meter",children:"Open Math Brain (Astro Reports)"}),t&&n?(0,i.jsx)("a",{href:"/chat",className:"rounded-md px-4 py-2 bg-emerald-600 text-white hover:bg-emerald-500",title:"Open Poetic Brain (Chat)",children:"Open Poetic Brain"}):(0,i.jsx)("button",{onClick:g,className:"rounded-md border border-slate-700 bg-slate-800 px-4 py-2 text-slate-100 hover:bg-slate-700",title:"Sign in to enable Poetic Brain",children:"Continue with Google"}),!t&&(0,i.jsx)("span",{className:"rounded-md bg-slate-800 px-4 py-2 text-slate-400","aria-live":"polite",children:"Loading auth…"})]}),n&&(0,i.jsxs)("p",{className:"mt-3 text-xs text-slate-500",children:["Signed in",c?" as ".concat(c):"",". Chat is now enabled."]}),r&&(0,i.jsx)("p",{className:"mt-3 text-xs text-rose-400",children:r}),m&&u&&(0,i.jsxs)("p",{className:"mt-2 text-[11px] text-slate-500",children:["Auth config • domain: ",(0,i.jsx)("span",{className:"text-slate-300",children:u.domain||"—"})," • client: ",(0,i.jsx)("span",{className:"text-slate-300",children:u.clientId?String(u.clientId).slice(0,4)+"…":"—"})]})]})})}},5216:function(t,e,n){"use strict";function i(){return window.location.origin+"/math-brain"}n.d(e,{g:function(){return i}})}},function(t){t.O(0,[971,23,744],function(){return t(t.s=6861)}),_N_E=t.O()}]);