(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[176],{327:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m,dynamic:()=>c});var l=s(5155),a=s(2115);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return null;let s=e.trim(),l=s.match(/^\s*(-?\d+(?:\.\d+)?)\s*[,\s]+\s*(-?\d+(?:\.\d+)?)\s*$/);if(l){let e=Number(l[1]),s=Number(l[2]);return!Number.isFinite(e)||!Number.isFinite(s)||Math.abs(e)>90||Math.abs(s)>180||t.rejectZeroZero&&0===e&&0===s?null:{lat:e,lon:s}}let a=s.replace(/[°º]/g,"\xb0").replace(/'/g,"′").replace(/"/g,"″").replace(/\s+/g," ").trim(),i=a.split(",").map(e=>e.trim()).filter(Boolean);if(2!==i.length){let e=a.split(" "),t=e.findIndex(e=>/[NS]$/i.test(e));if(t>-1&&t<e.length-1&&(i=[e.slice(0,t+1).join(" "),e.slice(t+1).join(" ")]),2!==i.length)return null}let r=n(i[0],["N","S"]),o=n(i[1],["E","W"]);return null==r||null==o||Math.abs(r)>90||Math.abs(o)>180||t.rejectZeroZero&&0===r&&0===o?null:{lat:r,lon:o}}function n(e,t){let s=e.toUpperCase().replace(/[°º]/g,"\xb0").replace(/'/g,"′").replace(/"/g,"″").replace(/[^0-9NSEW°′″\s\.\-]/g," ").replace(/\s+/g," ").trim(),l=s.match(/([NSEW])$/),a=l?l[1]:void 0,i=s.replace(/[NSEW]$/,"").trim().split(/[°′″\s]+/).filter(Boolean).map(Number);if(!i.length)return null;let n=i[0],r=i[1]||0,o=i[2]||0;if([n,r,o].some(e=>Number.isNaN(e))||r<0||r>=60||o<0||o>=60)return null;let d=Math.abs(n)+Math.abs(r)/60+Math.abs(o)/3600;return a?("S"===a||"W"===a)&&(d=-d):n<0&&(d=-d),d}function r(e,t){return Number.isFinite(e)&&Number.isFinite(t)?"".concat(e.toFixed(6),", ").concat(t.toFixed(6)):""}var o=s(9413),d=s(5704);let c="force-dynamic";function u(e){let{title:t,children:s,className:a=""}=e;return(0,l.jsxs)("section",{className:"rounded-lg border border-slate-700 bg-slate-800/60 p-4 ".concat(a),children:[(0,l.jsx)("h2",{className:"text-lg font-medium text-slate-100",children:t}),(0,l.jsx)("div",{className:"mt-3",children:s})]})}function m(){var e,t;let n="true"===d.env.NEXT_PUBLIC_ENABLE_LEGACY_LINK,c=(0,a.useMemo)(()=>new Date,[]),m=e=>e.toISOString().slice(0,10),x=m(c),p=m(new Date(c.getTime()+5184e5)),[h,b]=(0,a.useState)({name:"Dan",year:1973,month:7,day:24,hour:14,minute:30,city:"Bryn Mawr",state:"PA",latitude:40.0167,longitude:-75.3,timezone:"America/New_York",zodiac_type:"Tropic"}),[g,v]=(0,a.useState)("40\xb01'N, 75\xb018'W"),[N,j]=(0,a.useState)(null),[y,f]=(0,a.useState)(!0),[S,w]=(0,a.useState)(x),[_,A]=(0,a.useState)(p),[T,k]=(0,a.useState)("NATAL_ONLY"),[C,M]=(0,a.useState)("daily"),[R,F]=(0,a.useState)(!1),[P,O]=(0,a.useState)(null),[B,L]=(0,a.useState)(null),[D,I]=(0,a.useState)(!1),[E,z]=(0,a.useState)({name:"",year:"",month:"",day:"",hour:"",minute:"",city:"",state:"",latitude:"",longitude:"",timezone:"",zodiac_type:"Tropic"}),[Y,U]=(0,a.useState)(""),[H,W]=(0,a.useState)(null),[q,Z]=(0,a.useState)(!0),[J,V]=(0,a.useState)("PARTNER"),[G,$]=(0,a.useState)(""),[X,K]=(0,a.useState)(""),[Q,ee]=(0,a.useState)(!1),[et,es]=(0,a.useState)(""),el=(0,a.useMemo)(()=>(0,o.S5)(h),[h]),[ea,ei]=(0,a.useState)(()=>(0,o.S5)(h)?"planetary_only":"user_provided"),en=(0,a.useMemo)(()=>(0,o.S5)(E),[E]),er=(0,a.useMemo)(()=>el&&"user_provided"!==ea,[el,ea]);(0,a.useMemo)(()=>en&&"user_provided"!==ea,[en,ea]),(0,a.useEffect)(()=>{el||"user_provided"===ea?el&&"user_provided"===ea&&ei("planetary_only"):ei("user_provided")},[el]);let eo=(0,a.useMemo)(()=>["GMT","UTC","US/Eastern","US/Central","US/Mountain","US/Pacific","US/Alaska","US/Hawaii","America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Phoenix","America/Anchorage"],[]),ed=(e,t)=>e.replace(/\D+/g,"").slice(0,t),ec=e=>{let t=String(null!=e?e:"");if(!t)return"";let s=ed(t,2);return s?1===s.length?"0"+s:s:""},eu=(e,t,s)=>{let l=Number(e);return Number.isNaN(l)?NaN:Math.min(s,Math.max(t,l))},[em,ex]=(0,a.useState)("A_LOCAL"),[ep,eh]=(0,a.useState)("30\xb010'N, 85\xb040'W"),[eb,eg]=(0,a.useState)(null),[ev,eN]=(0,a.useState)(()=>i("30\xb010'N, 85\xb040'W")),[ej,ey]=(0,a.useState)("Panama City, FL"),[ef,eS]=(0,a.useState)("US/Central");(0,a.useRef)(null);let ew=(0,a.useRef)(null),e_=(0,a.useRef)(null),eA=(0,a.useRef)(0),[eT,ek]=(0,a.useState)(null),[eC,eM]=(0,a.useState)(()=>{try{let e=window.localStorage.getItem("mb.reportType");return"mirror"===e||"balance"===e?e:"mirror"}catch(e){return"mirror"}});(0,a.useEffect)(()=>{try{let e=new URL(window.location.href).searchParams.get("report");("mirror"===e||"balance"===e)&&eM(e)}catch(e){}},[]),(0,a.useEffect)(()=>{try{window.localStorage.setItem("mb.reportType",eC)}catch(e){}},[eC]);let[eR,eF]=(0,a.useState)(!1),[eP,eO]=(0,a.useState)(!0),[eB,eL]=(0,a.useState)(null),eD=(0,a.useRef)(null),[eI,eE]=(0,a.useState)(()=>{let e=window.localStorage.getItem("weeklyAgg");return"max"===e||"mean"===e?e:"mean"});(0,a.useEffect)(()=>{try{window.localStorage.setItem("weeklyAgg",eI)}catch(e){}},[eI]),(0,a.useEffect)(()=>{try{let e=window.localStorage.getItem("mb.lastInputs");eF(!!e)}catch(e){eF(!1)}},[]);let ez=(0,a.useMemo)(()=>["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"],[]);async function eY(){try{let e=ew.current||document.body,t=(await Promise.all([s.e(33),s.e(930),s.e(628),s.e(316),s.e(241)]).then(s.t.bind(s,9589,23))).default,l=new Date().toISOString().slice(0,10);await t().from(e).set({margin:.5,filename:"math-brain-report-".concat(l,".pdf"),image:{type:"jpeg",quality:.95},html2canvas:{scale:2,useCORS:!0,backgroundColor:"#0f1115"},jsPDF:{unit:"in",format:"letter",orientation:"portrait"}}).save()}catch(e){ek("Could not generate PDF"),setTimeout(()=>ek(null),2e3)}}function eU(){var e,t,s,l;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"AUTO";try{let t={schema:"mb-1",mode:T,step:C,startDate:S,endDate:_,includePersonB:D,translocation:em,personA:h,personB:E,relationshipType:J,relationshipTier:G,relationshipRole:X,exEstranged:Q,relationshipNotes:et},s=!!(D&&E&&((null==(e=E.name)?void 0:e.toString().trim())||null!=E.latitude||null!=E.longitude||E.timezone||E.year||E.month||E.day||E.hour||E.minute)),l="A_B"===a?D:s;"A_ONLY"!==a&&l||(delete t.personB,t.includePersonB=!1);let i=JSON.stringify(t,null,2),n=new Blob([i],{type:"application/json"}),r=new Date().toISOString().replace(/[-:]/g,"").replace(/\..+$/,""),o="A_ONLY"===a?"math_brain_setup_A_".concat(r,".json"):"math_brain_setup_".concat(r,".json"),d=window;if("function"==typeof d.showSaveFilePicker)return void(async()=>{try{let e=await d.showSaveFilePicker({suggestedName:o,types:[{description:"JSON files",accept:{"application/json":[".json"]}}]}),t=await e.createWritable();await t.write(n),await t.close();try{ek("Saved setup JSON"),setTimeout(()=>ek(null),1800)}catch(e){}}catch(s){let e=URL.createObjectURL(n),t=document.createElement("a");t.href=e,t.download=o,document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),URL.revokeObjectURL(e);try{ek("Saved setup JSON"),setTimeout(()=>ek(null),1800)}catch(e){}},150)}})();let c=URL.createObjectURL(n),u=document.createElement("a");u.href=c,u.download=o,document.body.appendChild(u),"download"in HTMLAnchorElement.prototype?u.click():window.open(c,"_blank","noopener"),setTimeout(()=>{try{document.body.removeChild(u)}catch(e){}try{URL.revokeObjectURL(c)}catch(e){}try{ek("Saved setup JSON"),setTimeout(()=>ek(null),1800)}catch(e){}},300)}catch(e){console.error("Save setup failed:",e);try{null==(l=navigator)||null==(s=l.clipboard)||null==(t=s.writeText)||t.call(s,JSON.stringify({mode:T,step:C,startDate:S,endDate:_,includePersonB:D,translocation:em,personA:h,personB:E},null,2)).then(()=>{ek("Saved to clipboard (download blocked)"),setTimeout(()=>ek(null),2200)}).catch(()=>{ek("Save setup failed"),setTimeout(()=>ek(null),2200)})}catch(e){}}}async function eH(e){var t,s,l,a,n;let o=null==(t=e.target.files)?void 0:t[0];if(o){try{let e=await o.text(),t=JSON.parse(e);eL(null);let d="object"==typeof t&&!!t&&(t.personA||t.period||t.relocation),c="object"==typeof t&&!!t&&t.personA&&(null!=t.personA.latitude||t.personA.coords),u="string"==typeof(null==t?void 0:t.schema);if(!d&&!c&&!u)throw Error("Invalid setup shape: expected .math_brain.json minimal schema or internal export.");if((d||u)&&!c){let e=t.personA||{},s=e.coords||"",l=s?i(String(s),{rejectZeroZero:!0}):null,[a,n,o]=String(e.date||"").split("-").map(e=>Number(e)),[d,c]=String(e.time||"").split(":").map(e=>Number(e));if(s&&!l)throw Error("Invalid personA.coords");let u={...h};if(e.name&&(u.name=String(e.name)),Number.isFinite(a)&&(u.year=a),Number.isFinite(n)&&(u.month=n),Number.isFinite(o)&&(u.day=o),Number.isFinite(d)&&(u.hour=d),Number.isFinite(c)&&(u.minute=c),e.timezone&&(u.timezone=String(e.timezone)),l&&(u.latitude=l.lat,u.longitude=l.lon,v(r(l.lat,l.lon)),j(null),f(!0)),t.zodiacType&&(u.zodiac_type=String(t.zodiacType)),b(u),t.personB){let e=t.personB,s=e.coords?i(String(e.coords),{rejectZeroZero:!0}):null,l={...E};e.name&&(l.name=String(e.name)),s&&(l.latitude=String(s.lat),l.longitude=String(s.lon),U(r(s.lat,s.lon)),W(null),Z(!0)),e.timezone&&(l.timezone=String(e.timezone)),z(l),I(!0)}if(t.relationship_context){let e=t.relationship_context;e.type&&V(String(e.type).toUpperCase()),e.intimacy_tier&&$(String(e.intimacy_tier))}if(t.period){let e=t.period;e.start&&w(String(e.start)),e.end&&A(String(e.end)),e.step&&M(String(e.step).toLowerCase())}if(t.relocation){let e=t.relocation;if(e.mode&&ex(String(e.mode)),e.coords){let t=i(String(e.coords),{rejectZeroZero:!0});t&&(eN(t),eh(String(e.coords)))}}}else t.personA&&b(t.personA),t.personB&&z(t.personB),"boolean"==typeof t.includePersonB&&I(t.includePersonB),t.mode&&k(t.mode),t.step&&M(t.step),t.startDate&&w(t.startDate),t.endDate&&A(t.endDate),"boolean"==typeof t.exEstranged&&ee(t.exEstranged),"string"==typeof t.relationshipNotes&&es(t.relationshipNotes),"string"==typeof t.relationshipTier&&$(t.relationshipTier),"string"==typeof t.relationshipRole&&K(t.relationshipRole),t.translocation&&ex(t.translocation),(null==(s=t.personA)?void 0:s.latitude)!=null&&(null==(l=t.personA)?void 0:l.longitude)!=null&&(v(r(Number(t.personA.latitude),Number(t.personA.longitude))),j(null),f(!0)),(null==(a=t.personB)?void 0:a.latitude)!=null&&(null==(n=t.personB)?void 0:n.longitude)!=null&&(U(r(Number(t.personB.latitude),Number(t.personB.longitude))),W(null),Z(!0))}catch(e){}e.currentTarget&&(e.currentTarget.value="")}}(0,a.useEffect)(()=>{!D&&ez.includes(T)&&k("NATAL_TRANSITS")},[D,T,ez]),(0,a.useEffect)(()=>{if(D){var e;null==(e=e_.current)||e.focus()}},[D]);let eW=(0,a.useMemo)(()=>{let e=[h.name,h.city,h.state,h.timezone,h.zodiac_type],t=el&&"user_provided"!==ea,s="balance"===eC,l=[Number(h.year),Number(h.month),Number(h.day),...t?[]:[Number(h.hour),Number(h.minute)],...s?[Number(h.latitude),Number(h.longitude)]:[]],a=e.every(Boolean)&&l.every(e=>!Number.isNaN(e))&&y;if(!["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"].includes(T))return"mirror"===eC?a:a&&!!S&&!!_;if(!D)return!1;let i=[E.name,E.city,E.state,E.timezone,E.zodiac_type],n=en&&"user_provided"!==ea,r=[Number(E.year),Number(E.month),Number(E.day),...n?[]:[Number(E.hour),Number(E.minute)],Number(E.latitude),Number(E.longitude)],o=i.every(Boolean)&&r.every(e=>!Number.isNaN(e))&&q,d=!0;return"PARTNER"===J&&(d=!!G),"FAMILY"===J&&(d=!!X),a&&o&&d&&!!S&&!!_},[h,E,D,J,G,X,T,S,_,y,q,el,en,ea]),eq=(0,a.useMemo)(()=>{let e=(0,o.Vs)(eC,!1,h);return"balance"===eC&&!e.hasLoc||!eW||!!R},[eW,R,h,eC]),eZ=(0,a.useMemo)(()=>{try{return"1"===new URL(window.location.href).searchParams.get("debug")}catch(e){return!1}},[]),eJ=(0,a.useMemo)(()=>({reportType:eC,needsLocation:(0,o.Vs)(eC,!1,h),canSubmit:eW,submitDisabled:eq,aCoordsValid:y,bCoordsValid:q,includePersonB:D,timeUnknown:el,timeUnknownB:en,timePolicy:ea,personA_lat_type:typeof h.latitude,personA_lon_type:typeof h.longitude}),[eC,eW,eq,y,q,D,el,en,ea,h]);async function eV(e){e.preventDefault();let t=(0,o.Vs)(eC,!1,h);if("balance"===eC&&!t.hasLoc){ek("Transits need current location to place houses correctly. Add a location or switch to Mirror (no transits)."),setTimeout(()=>ek(null),2500);return}if(!eW)return;let s=Date.now();if(!(s-eA.current<800)){eA.current=s,"undefined"!=typeof performance&&performance.now(),F(!0),O(null),L(null);try{let e={mode:T,personA:{...h,nation:"US",year:Number(h.year),month:Number(h.month),day:Number(h.day),hour:Number(h.hour),minute:Number(h.minute),latitude:Number(h.latitude),longitude:Number(h.longitude)},time_policy:el?ea:"user_provided",transitStartDate:S,transitEndDate:_,transitStep:C,context:{mode:"balance"===eC?"balance_meter":"mirror"},translocation:"A_LOCAL"===em||"B_LOCAL"===em||"MIDPOINT"===em?{applies:!0,method:"A_LOCAL"===em?"A_local":"B_LOCAL"===em?"B_local":"Midpoint",coords:ev?{latitude:ev.lat,longitude:ev.lon}:void 0,current_location:ej||void 0,tz:ef||void 0}:{applies:!1,method:"Natal"}};try{eP&&(window.localStorage.setItem("mb.lastInputs",JSON.stringify({mode:T,step:C,startDate:S,endDate:_,includePersonB:D,translocation:em,relationshipType:J,relationshipTier:G,relationshipRole:X,exEstranged:Q,relationshipNotes:et,personA:h,personB:E})),eF(!0))}catch(e){}["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"].includes(T)&&D&&(e.personB={...E,nation:"US",year:Number(E.year),month:Number(E.month),day:Number(E.day),hour:Number(E.hour),minute:Number(E.minute),latitude:Number(E.latitude),longitude:Number(E.longitude)},e.relationship_context={type:J,intimacy_tier:"PARTNER"===J?G:void 0,role:"PARTNER"!==J?X:void 0,ex_estranged:"FRIEND"===J?void 0:Q,notes:et||void 0});let t=await fetch("/api/astrology-mathbrain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();if(!t.ok||(null==s?void 0:s.success)===!1){let e=(null==s?void 0:s.error)||"Request failed (".concat(t.status,")");throw"mirror"===eC&&(ek("Mirror preparation failed"),setTimeout(()=>ek(null),2500)),Error(e)}L(s);try{var l,a;(null==s||null==(l=s.person_a)?void 0:l.meta)||null==s||null==(a=s.provenance)||a.time_meta_a}catch(e){}}catch(e){"mirror"===eC&&(ek("Mirror preparation failed"),setTimeout(()=>ek(null),2500)),O((null==e?void 0:e.message)||"Unexpected error")}finally{F(!1)}}}return(0,l.jsxs)("main",{className:"mx-auto max-w-6xl px-6 py-12",children:[(0,l.jsxs)("header",{className:"text-center print:hidden",children:[(0,l.jsx)("h1",{className:"text-4xl md:text-5xl font-bold tracking-tight text-slate-100",children:"Math Brain"}),(0,l.jsx)("p",{className:"mt-4 text-base md:text-lg text-slate-300",children:"Run the geometry first. Then jump into Chat to synthesize the narrative."}),(0,l.jsxs)("div",{className:"mt-6 flex items-center justify-center gap-4 text-sm text-slate-400",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"rounded bg-amber-600 px-2 py-1 text-xs font-medium text-slate-100",children:"FIELD"}),(0,l.jsx)("span",{className:"text-xs",children:"Geometric calculation engine"})]}),(0,l.jsx)("span",{className:"text-slate-600",children:"→"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 opacity-50",children:[(0,l.jsx)("span",{className:"rounded bg-slate-700 px-2 py-1 text-xs font-medium text-slate-400",children:"MAP"}),(0,l.jsx)("span",{className:"text-xs",children:"Raven handles"})]}),(0,l.jsx)("span",{className:"text-slate-600",children:"→"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 opacity-50",children:[(0,l.jsx)("span",{className:"rounded bg-slate-700 px-2 py-1 text-xs font-medium text-slate-400",children:"VOICE"}),(0,l.jsx)("span",{className:"text-xs",children:"Raven handles"})]})]})]}),(0,l.jsxs)("div",{className:"mt-8 flex flex-wrap gap-3 justify-center print:hidden",children:[(0,l.jsx)("a",{href:"/",className:"rounded-md border border-slate-700 bg-slate-800 px-4 py-2 text-slate-100 hover:bg-slate-700",children:"Back Home"}),n&&(0,l.jsx)("a",{href:"/index.html",className:"rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-500",target:"_blank",rel:"noopener noreferrer",children:"Open Legacy Math Brain"}),(0,l.jsx)("a",{href:"/chat",className:"rounded-md bg-emerald-600 px-4 py-2 text-white hover:bg-emerald-500",children:"Go to Poetic Brain"})]}),eR&&(0,l.jsxs)("div",{className:"mt-6 flex items-center justify-center gap-3 print:hidden",children:[(0,l.jsx)("div",{className:"rounded-md border border-slate-700 bg-slate-800/60 px-3 py-2 text-slate-200 text-sm",children:"A previous session was found."}),(0,l.jsx)("button",{type:"button",onClick:function(){try{let e=window.localStorage.getItem("mb.lastInputs");if(!e)return;let t=JSON.parse(e);t.personA&&b(t.personA),t.personB&&z(t.personB),"boolean"==typeof t.includePersonB&&I(t.includePersonB),t.mode&&k(t.mode),t.step&&M(t.step),t.startDate&&w(t.startDate),t.endDate&&A(t.endDate),t.relationshipType&&V(t.relationshipType),"boolean"==typeof t.exEstranged&&ee(t.exEstranged),"string"==typeof t.relationshipNotes&&es(t.relationshipNotes),"string"==typeof t.relationshipTier&&$(t.relationshipTier),"string"==typeof t.relationshipRole&&K(t.relationshipRole),t.translocation&&ex(t.translocation)}catch(e){}},className:"rounded-md bg-indigo-600 px-3 py-2 text-white hover:bg-indigo-500 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",children:"Resume inputs"}),(0,l.jsx)("button",{type:"button",onClick:function(){try{window.localStorage.removeItem("mb.lastInputs"),eF(!1),eO(!0)}catch(e){}},className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-2 text-slate-100 hover:bg-slate-700 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400",children:"Reset"})]}),(0,l.jsxs)("form",{onSubmit:eV,className:"mt-10 print:hidden",children:[eZ&&(0,l.jsxs)("div",{className:"mb-4 rounded-md border border-slate-600 bg-slate-900/60 p-3 text-xs text-slate-200",children:[(0,l.jsx)("div",{className:"font-medium mb-2",children:"Debug — gating state"}),(0,l.jsx)("pre",{className:"whitespace-pre-wrap break-words text-[12px]",children:JSON.stringify(eJ,null,2)})]}),(0,l.jsxs)("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-3 rounded-md border border-slate-700 bg-slate-900/50 p-3",children:[(0,l.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm text-slate-200",children:[(0,l.jsx)("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-600 bg-slate-900 text-indigo-600 focus:ring-indigo-500",checked:eP,onChange:e=>eO(e.target.checked)}),"Save for next session"]}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,l.jsxs)("div",{className:"inline-flex overflow-hidden rounded-md border border-slate-700 bg-slate-800",children:[(0,l.jsx)("button",{type:"button",onClick:()=>eU("A_ONLY"),className:"px-3 py-1.5 text-slate-100 hover:bg-slate-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400",title:"Save only Person A’s setup to JSON","aria-label":"Save only Person A setup",children:"Save A"}),(0,l.jsx)("div",{className:"h-6 w-px bg-slate-700 my-1"}),(0,l.jsx)("button",{type:"button",onClick:()=>eU("A_B"),className:"px-3 py-1.5 text-slate-100 hover:bg-slate-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400",title:"Save Person A + B (if included)","aria-label":"Save Person A and B setup",children:"Save A+B"})]}),(0,l.jsx)("button",{type:"button",onClick:()=>{var e;return null==(e=eD.current)?void 0:e.click()},className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-1.5 text-slate-100 hover:bg-slate-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400","aria-label":"Load a setup from a JSON file",children:"Load setup…"}),(0,l.jsx)("input",{ref:eD,type:"file",accept:"application/json",onChange:eH,className:"hidden","aria-label":"Upload setup JSON file"})]}),eB&&(0,l.jsx)("div",{className:"mt-2 text-xs text-red-400",children:eB})]}),(0,l.jsxs)("section",{"aria-labelledby":"report-type-heading",className:"mb-6 rounded-lg border border-slate-700 bg-slate-800/60 p-4",children:[(0,l.jsx)("h3",{id:"report-type-heading",className:"text-sm font-medium text-slate-200",children:"Report Type"}),(0,l.jsxs)("div",{className:"mt-3 flex items-center justify-between gap-3",children:[(0,l.jsxs)("fieldset",{className:"inline-flex overflow-hidden rounded-md border border-slate-700 bg-slate-800 px-0 py-0",children:[(0,l.jsx)("legend",{className:"sr-only",children:"Choose report type"}),(0,l.jsxs)("label",{className:"px-3 py-1.5 text-sm cursor-pointer ".concat("mirror"===eC?"bg-indigo-600 text-white":"text-slate-200 hover:bg-slate-700"),title:"Send to Poetic Brain",onClick:()=>eM("mirror"),children:[(0,l.jsx)("input",{type:"radio",name:"reportType",value:"mirror",className:"sr-only",checked:"mirror"===eC,onChange:()=>eM("mirror")}),"Mirror",(0,l.jsx)("span",{className:"ml-1 text-[11px] text-slate-300/80",children:"(send to Poetic Brain)"})]}),(0,l.jsxs)("label",{className:"px-3 py-1.5 text-sm cursor-pointer ".concat("balance"===eC?"bg-indigo-600 text-white":"text-slate-200 hover:bg-slate-700"),title:"Show gauges on screen",onClick:()=>eM("balance"),children:[(0,l.jsx)("input",{type:"radio",name:"reportType",value:"balance",className:"sr-only",checked:"balance"===eC,onChange:()=>eM("balance")}),"Balance Meter",(0,l.jsx)("span",{className:"ml-1 text-[11px] text-slate-300/80",children:"(gauges on screen)"})]})]}),"mirror"===eC&&(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Handoff only — no on-screen gauges"})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 items-start",children:[(0,l.jsx)(u,{title:"Person A (required)",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"a-name",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Name"}),(0,l.jsx)("input",{id:"a-name",placeholder:"Your Name",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-center text-slate-100 placeholder:text-slate-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:h.name,onChange:e=>b({...h,name:e.target.value}),required:!0})]}),(0,l.jsxs)("div",{className:"grid grid-cols-5 gap-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"a-year",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Year"}),(0,l.jsx)("input",{id:"a-year",type:"text",inputMode:"numeric",className:"mt-1 w-full min-w-[80px] h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:String(h.year),onChange:e=>b({...h,year:ed(e.target.value,4)}),placeholder:"YYYY",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"a-month",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Month"}),(0,l.jsx)("input",{id:"a-month",type:"text",inputMode:"numeric",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-center text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:String(h.month),onChange:e=>{let t=eu(ed(e.target.value,2),1,12);b({...h,month:Number.isNaN(t)?"":String(t)})},placeholder:"MM",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"a-day",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Day"}),(0,l.jsx)("input",{id:"a-day",type:"text",inputMode:"numeric",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-center text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ec(h.day),onChange:e=>{let t=eu(ec(e.target.value),1,31);b({...h,day:Number.isNaN(t)?"":String(t).padStart(2,"0")})},placeholder:"DD",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"a-hour",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Hour"}),(0,l.jsx)("input",{id:"a-hour",type:"text",inputMode:"numeric",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ec(h.hour),onChange:e=>{let t=eu(ec(e.target.value),0,23);b({...h,hour:Number.isNaN(t)?"":String(t).padStart(2,"0")})},placeholder:"HH",required:!er})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"a-minute",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Minute"}),(0,l.jsx)("input",{id:"a-minute",type:"text",inputMode:"numeric",className:"mt-1 w-full min-w-[60px] h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ec(h.minute),onChange:e=>{let t=eu(ec(e.target.value),0,59);b({...h,minute:Number.isNaN(t)?"":String(t).padStart(2,"0")})},placeholder:"MM",required:!er})]})]}),"            ",(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"a-city",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"City"}),(0,l.jsx)("input",{id:"a-city",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:h.city,onChange:e=>b({...h,city:e.target.value}),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"a-state",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"State / Province"}),(0,l.jsx)("input",{id:"a-state",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:h.state,onChange:e=>b({...h,state:e.target.value}),required:!0}),(0,l.jsx)("p",{className:"mt-1 text-[11px] text-slate-500",children:"Nation assumed “US” for API compatibility."})]}),(0,l.jsxs)("div",{className:"sm:col-span-2",children:[(0,l.jsx)("label",{htmlFor:"a-coords",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Birth Coordinates"}),(0,l.jsx)("input",{id:"a-coords",type:"text",className:"mt-1 w-full rounded-md border bg-slate-900 px-3 py-2 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 ".concat(N?"border-red-600":"border-slate-600"),value:g,onChange:e=>{let t=e.target.value;v(t);let s=i(t,{rejectZeroZero:!0});s?(b({...h,latitude:s.lat,longitude:s.lon}),j(null),f(!0)):(j('Invalid coordinates. Try "40\xb042′N, 74\xb00′W" or "40.7128, -74.006".'),f(!1))},"aria-describedby":"a-coords-help",placeholder:"e.g., 40\xb042′N, 74\xb00′W or 40.7128, -74.006",required:!0}),(0,l.jsx)("p",{id:"a-coords-help",className:"mt-1 text-xs text-slate-400",children:"Examples: 40\xb042′N, 74\xb00′W \xb7 34\xb03′S, 18\xb025′E \xb7 40.7128, -74.006"}),N?(0,l.jsx)("p",{className:"mt-1 text-xs text-red-400",children:N}):(0,l.jsxs)("p",{className:"mt-1 text-xs text-slate-400",children:["Normalized: ",r(Number(h.latitude),Number(h.longitude))]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"a-tz",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Timezone"}),(0,l.jsx)("select",{id:"a-tz",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:h.timezone,onChange:e=>b({...h,timezone:e.target.value}),required:!0,children:eo.map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"a-zodiac",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Zodiac Type"}),(0,l.jsxs)("select",{id:"a-zodiac",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100",value:h.zodiac_type,onChange:e=>b({...h,zodiac_type:e.target.value}),children:[(0,l.jsx)("option",{value:"Tropic",children:"Tropic"}),(0,l.jsx)("option",{value:"Sidereal",children:"Sidereal"})]})]}),el&&(0,l.jsx)("div",{className:"sm:col-span-2",children:(0,l.jsxs)("fieldset",{className:"rounded-md border border-slate-700 bg-slate-900/50 p-3",children:[(0,l.jsx)("legend",{className:"px-1 text-xs font-medium text-slate-200",children:"Birth time policy"}),(0,l.jsxs)("div",{className:"mt-2 grid grid-cols-1 gap-2 sm:grid-cols-3",children:[(0,l.jsxs)("label",{className:"flex cursor-pointer items-start gap-2 rounded-md border px-3 py-2 text-xs ".concat("planetary_only"===ea?"border-indigo-600 bg-indigo-900/20 text-slate-100":"border-slate-700 bg-slate-800/50 text-slate-300 hover:bg-slate-800"),children:[(0,l.jsx)("input",{type:"radio",name:"time-policy",className:"mt-0.5",checked:"planetary_only"===ea,onChange:()=>ei("planetary_only")}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-medium",children:"Planetary-only"}),(0,l.jsx)("div",{className:"text-slate-400",children:"No houses/angles; tightest, falsifiable geometry"})]})]}),(0,l.jsxs)("label",{className:"flex cursor-pointer items-start gap-2 rounded-md border px-3 py-2 text-xs ".concat("whole_sign"===ea?"border-indigo-600 bg-indigo-900/20 text-slate-100":"border-slate-700 bg-slate-800/50 text-slate-300 hover:bg-slate-800"),children:[(0,l.jsx)("input",{type:"radio",name:"time-policy",className:"mt-0.5",checked:"whole_sign"===ea,onChange:()=>ei("whole_sign")}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-medium",children:"Whole-sign houses"}),(0,l.jsx)("div",{className:"text-slate-400",children:"House semantics without exact time; angles still suppressed"})]})]}),(0,l.jsxs)("label",{className:"flex cursor-pointer items-start gap-2 rounded-md border px-3 py-2 text-xs ".concat("sensitivity_scan"===ea?"border-indigo-600 bg-indigo-900/20 text-slate-100":"border-slate-700 bg-slate-800/50 text-slate-300 hover:bg-slate-800"),children:[(0,l.jsx)("input",{type:"radio",name:"time-policy",className:"mt-0.5",checked:"sensitivity_scan"===ea,onChange:()=>ei("sensitivity_scan")}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-medium",children:"Sensitivity scan"}),(0,l.jsx)("div",{className:"text-slate-400",children:"Test a window of possible times; house-dependent insights flagged"})]})]})]})]})})]})}),(0,l.jsxs)(u,{title:"Person B (optional for relational)",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,l.jsx)("p",{className:"text-xs text-slate-400",children:"Add a second person for synastry/composite modes."}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsxs)("div",{className:"inline-flex rounded-md border border-slate-700 bg-slate-800 p-1",children:[(0,l.jsx)("button",{type:"button",onClick:function(){D&&z(e=>({...e,year:String(h.year),month:String(h.month),day:String(h.day),hour:String(h.hour),minute:String(h.minute),city:h.city,state:h.state,latitude:String(h.latitude),longitude:String(h.longitude),timezone:h.timezone,zodiac_type:h.zodiac_type}))},disabled:!D,className:"px-2 py-1 text-xs text-slate-100 hover:bg-slate-700 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",title:"Copy Person A details to Person B (keeps B name)",children:"Copy A→B"}),(0,l.jsx)("div",{className:"mx-1 h-5 w-px bg-slate-700"}),(0,l.jsx)("button",{type:"button",onClick:function(){D&&(b(e=>{var t,s,l,a,i,n,r;return{...e,name:E.name||e.name,year:null!=(t=E.year)?t:e.year,month:null!=(s=E.month)?s:e.month,day:null!=(l=E.day)?l:e.day,hour:null!=(a=E.hour)?a:e.hour,minute:null!=(i=E.minute)?i:e.minute,city:E.city||e.city,state:E.state||e.state,latitude:null!=(n=E.latitude)?n:e.latitude,longitude:null!=(r=E.longitude)?r:e.longitude,timezone:E.timezone||e.timezone,zodiac_type:E.zodiac_type||e.zodiac_type}}),z(e=>({...e,year:String(h.year),month:String(h.month),day:String(h.day),hour:String(h.hour),minute:String(h.minute),city:h.city,state:h.state,latitude:String(h.latitude),longitude:String(h.longitude),timezone:h.timezone,zodiac_type:h.zodiac_type})))},disabled:!D,className:"px-2 py-1 text-xs text-slate-100 hover:bg-slate-700 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",title:"Swap A/B (relationship settings unchanged)",children:"Swap A/B"}),(0,l.jsx)("div",{className:"mx-1 h-5 w-px bg-slate-700"}),(0,l.jsx)("button",{type:"button",onClick:function(){D&&z({name:"",year:"",month:"",day:"",hour:"",minute:"",city:"",state:"",latitude:"",longitude:"",timezone:"",zodiac_type:"Tropic"})},disabled:!D,className:"px-2 py-1 text-xs text-slate-100 hover:bg-slate-700 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",title:"Clear all Person B fields",children:"Clear B"}),(0,l.jsx)("div",{className:"mx-1 h-5 w-px bg-slate-700"}),(0,l.jsx)("button",{type:"button",onClick:function(){if(!D)return;let e=new Date;z(t=>({...t,year:String(e.getUTCFullYear()),month:String(e.getUTCMonth()+1),day:String(e.getUTCDate()),hour:String(e.getUTCHours()),minute:String(e.getUTCMinutes()),timezone:"UTC",city:t.city||"",state:t.state||"",latitude:t.latitude||"",longitude:t.longitude||""}))},disabled:!D,className:"px-2 py-1 text-xs text-slate-100 hover:bg-slate-700 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",title:"Set Person B date/time to now (UTC)",children:"Set B = Now (UTC)"})]}),(0,l.jsxs)("label",{htmlFor:"toggle-include-b-a",className:"inline-flex items-center gap-2 text-sm text-slate-200 cursor-pointer",children:[(0,l.jsx)("input",{id:"toggle-include-b-a",type:"checkbox",className:"h-4 w-4 rounded border-slate-600 bg-slate-900 text-indigo-600 focus:ring-indigo-500",checked:D,onChange:e=>I(e.target.checked)}),"Include Person B"]})]})]}),(0,l.jsx)("div",{className:"mt-4 ".concat(D?"":"opacity-50"),children:(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"b-name",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Name"}),(0,l.jsx)("input",{id:"b-name",ref:e_,placeholder:"Their Name",disabled:!D,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-center text-slate-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:opacity-50",value:E.name,onChange:e=>z({...E,name:e.target.value})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-5 gap-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"b-year",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Year"}),(0,l.jsx)("input",{id:"b-year",type:"text",inputMode:"numeric",disabled:!D,className:"mt-1 w-full min-w-[80px] h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:String(E.year),onChange:e=>z({...E,year:ed(e.target.value,4)}),placeholder:"YYYY"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"b-month",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Month"}),(0,l.jsx)("input",{id:"b-month",type:"text",inputMode:"numeric",disabled:!D,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-center text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:String(E.month),onChange:e=>{let t=eu(ed(e.target.value,2),1,12);z({...E,month:Number.isNaN(t)?"":String(t)})},placeholder:"MM"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"b-day",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Day"}),(0,l.jsx)("input",{id:"b-day",type:"text",inputMode:"numeric",disabled:!D,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ec(E.day),onChange:e=>{let t=eu(ec(e.target.value),1,31);z({...E,day:Number.isNaN(t)?"":String(t).padStart(2,"0")})},placeholder:"DD"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"b-hour",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Hour"}),(0,l.jsx)("input",{id:"b-hour",type:"text",inputMode:"numeric",disabled:!D,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ec(E.hour),onChange:e=>{let t=eu(ec(e.target.value),0,23);z({...E,hour:Number.isNaN(t)?"":String(t).padStart(2,"0")})},placeholder:"HH"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"b-minute",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Minute"}),(0,l.jsx)("input",{id:"b-minute",type:"text",inputMode:"numeric",disabled:!D,className:"mt-1 w-full min-w-[60px] h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ec(E.minute),onChange:e=>{let t=eu(ec(e.target.value),0,59);z({...E,minute:Number.isNaN(t)?"":String(t).padStart(2,"0")})},placeholder:"MM"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"b-city",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"City"}),(0,l.jsx)("input",{id:"b-city",disabled:!D,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:E.city,onChange:e=>z({...E,city:e.target.value})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"b-state",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"State / Province"}),(0,l.jsx)("input",{id:"b-state",disabled:!D,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:E.state,onChange:e=>z({...E,state:e.target.value})}),(0,l.jsx)("p",{className:"mt-1 text-[11px] text-slate-500",children:"Nation assumed “US” for API compatibility."})]}),(0,l.jsxs)("div",{className:"sm:col-span-2",children:[(0,l.jsx)("label",{htmlFor:"b-coords",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Birth Coordinates (B)"}),(0,l.jsx)("input",{id:"b-coords",type:"text",disabled:!D,className:"mt-1 w-full rounded-md border bg-slate-900 px-3 py-2 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 ".concat(H?"border-red-600":"border-slate-600"),value:Y,onChange:e=>{let t=e.target.value;if(U(t),!D)return;let s=i(t,{rejectZeroZero:!0});s?(z({...E,latitude:s.lat,longitude:s.lon}),W(null),Z(!0)):(W("Invalid coordinates"),Z(!1))},placeholder:"e.g., 34\xb003′S, 18\xb025′E or -34.0500, 18.4167"}),(0,l.jsx)("p",{className:"mt-1 text-xs text-slate-400",children:"Examples: 40\xb042′N, 74\xb00′W \xb7 34\xb03′S, 18\xb025′E \xb7 40.7128, -74.006"}),(0,l.jsxs)("p",{className:"mt-1 text-xs text-slate-400",children:["Normalized: ",Number(E.latitude)||Number(E.longitude)?r(Number(E.latitude),Number(E.longitude)):"—"]}),H&&(0,l.jsx)("p",{className:"mt-1 text-xs text-red-400",children:H})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"b-tz",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Timezone"}),(0,l.jsx)("select",{id:"b-tz",disabled:!D,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:E.timezone,onChange:e=>z({...E,timezone:e.target.value}),children:eo.map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"b-zodiac",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Zodiac Type"}),(0,l.jsxs)("select",{id:"b-zodiac",disabled:!D,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50",value:E.zodiac_type,onChange:e=>z({...E,zodiac_type:e.target.value}),children:[(0,l.jsx)("option",{value:"Tropic",children:"Tropic"}),(0,l.jsx)("option",{value:"Sidereal",children:"Sidereal"})]})]})]})})]}),(0,l.jsxs)(u,{title:"Relationship Context",children:[(0,l.jsx)("div",{className:"mb-2 flex items-center justify-between",children:(0,l.jsx)("p",{className:"text-xs text-slate-400",children:"These fields unlock when Person B is included."})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 ".concat(D?"":"opacity-50"),children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"rel-type",className:"block text-sm text-slate-300",children:"Type"}),(0,l.jsxs)("select",{id:"rel-type",disabled:!D,className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100",value:J,onChange:e=>{V(e.target.value),$(""),K("")},children:[(0,l.jsx)("option",{value:"PARTNER",children:"Partner"}),(0,l.jsx)("option",{value:"FRIEND",children:"Friend / Colleague"}),(0,l.jsx)("option",{value:"FAMILY",children:"Family"})]}),(0,l.jsxs)("div",{className:"mt-2 text-[11px] text-slate-400",children:[(0,l.jsx)("div",{className:"font-medium text-slate-300",children:"Primary Relational Tiers (scope):"}),(0,l.jsx)("div",{children:"• Partner — full map access, including intimacy arcs & legacy patterns."}),(0,l.jsx)("div",{children:"• Friend / Colleague — emotional, behavioral, social dynamics; intimacy overlays de-emphasized."}),(0,l.jsx)("div",{children:"• Family — legacy patterns and behavioral overlays; sexual resonance suppressed."}),(0,l.jsx)("div",{children:"• Acquaintance — light pattern echoes only; intimacy dynamics locked."})]})]}),"PARTNER"===J&&(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"rel-tier",className:"block text-sm text-slate-300",children:"Intimacy Tier"}),(0,l.jsxs)("select",{id:"rel-tier",disabled:!D,className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100",value:G,onChange:e=>$(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select…"}),(0,l.jsx)("option",{value:"P1",children:"P1 — Platonic partners"}),(0,l.jsx)("option",{value:"P2",children:"P2 — Friends-with-benefits"}),(0,l.jsx)("option",{value:"P3",children:"P3 — Situationship (unclear/unstable)"}),(0,l.jsx)("option",{value:"P4",children:"P4 — Low-commitment romantic or sexual"}),(0,l.jsx)("option",{value:"P5a",children:"P5a — Committed romantic + sexual"}),(0,l.jsx)("option",{value:"P5b",children:"P5b — Committed romantic, non-sexual"})]}),D&&["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"].includes(T)&&!G&&(0,l.jsx)("p",{className:"mt-1 text-xs text-amber-400",children:"Partner relationships require an intimacy tier."})]}),"FAMILY"===J&&(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"rel-role",className:"block text-sm text-slate-300",children:"Role"}),(0,l.jsxs)("select",{id:"rel-role",disabled:!D,className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100",value:X,onChange:e=>K(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select…"}),(0,l.jsx)("option",{value:"Parent",children:"Parent"}),(0,l.jsx)("option",{value:"Offspring",children:"Offspring"}),(0,l.jsx)("option",{value:"Sibling",children:"Sibling"}),(0,l.jsx)("option",{value:"Cousin",children:"Cousin"}),(0,l.jsx)("option",{value:"Extended",children:"Extended"}),(0,l.jsx)("option",{value:"Guardian",children:"Guardian"}),(0,l.jsx)("option",{value:"Mentor",children:"Mentor"}),(0,l.jsx)("option",{value:"Other",children:"Other"}),(0,l.jsx)("option",{value:"Custom",children:"Custom"})]}),D&&["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"].includes(T)&&!G&&(0,l.jsx)("p",{className:"mt-1 text-xs text-amber-400",children:"Partner relationships require an intimacy tier."})]}),"FRIEND"===J&&(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"rel-role-f",className:"block text-sm text-slate-300",children:"Role (optional)"}),(0,l.jsxs)("select",{id:"rel-role-f",className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100",value:X,onChange:e=>K(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"—"}),(0,l.jsx)("option",{value:"Acquaintance",children:"Acquaintance"}),(0,l.jsx)("option",{value:"Mentor",children:"Mentor"}),(0,l.jsx)("option",{value:"Other",children:"Other"}),(0,l.jsx)("option",{value:"Custom",children:"Custom"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{id:"rel-ex",type:"checkbox",className:"h-4 w-4 rounded border-slate-600 bg-slate-900 text-indigo-600 focus:ring-indigo-500",checked:Q,onChange:e=>ee(e.target.checked),disabled:!D||"FRIEND"===J}),(0,l.jsx)("label",{htmlFor:"rel-ex",className:"text-sm text-slate-300",children:"Ex / Estranged"})]}),(0,l.jsxs)("div",{className:"sm:col-span-2",children:[(0,l.jsx)("label",{htmlFor:"rel-notes",className:"block text-sm text-slate-300",children:"Notes"}),(0,l.jsx)("textarea",{id:"rel-notes",disabled:!D,className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",rows:3,placeholder:"Optional context (max 500 chars)",value:et,onChange:e=>es(e.target.value.slice(0,500))})]})]})]}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)(u,{title:"Transits",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"t-start",className:"block text-sm text-slate-300",children:"Start Date"}),(0,l.jsx)("input",{id:"t-start",type:"date",className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:S,onChange:e=>w(e.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"t-end",className:"block text-sm text-slate-300",children:"End Date"}),(0,l.jsx)("input",{id:"t-end",type:"date",className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:_,onChange:e=>A(e.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"t-step",className:"block text-sm text-slate-300",children:"Step"}),(0,l.jsxs)("select",{id:"t-step",className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:C,onChange:e=>M(e.target.value),children:[(0,l.jsx)("option",{value:"daily",children:"Daily"}),(0,l.jsx)("option",{value:"weekly",children:"Weekly"}),(0,l.jsx)("option",{value:"monthly",children:"Monthly"})]})]})]}),(0,l.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"t-mode",className:"block text-sm text-slate-300",children:"Mode"}),(0,l.jsxs)("select",{id:"t-mode",className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:T,onChange:e=>{let t=e.target.value;k(t),["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"].includes(t)&&I(!0)},children:[(0,l.jsx)("option",{value:"NATAL_ONLY",children:"Natal only"}),(0,l.jsx)("option",{value:"NATAL_TRANSITS",children:"Natal + Transits"}),(0,l.jsx)("option",{value:"DUAL_NATAL_TRANSITS",children:"Dual Natal + Transits (A & B, no synastry)"}),(0,l.jsx)("option",{value:"SYNASTRY",children:"Synastry (A ↔ B)"}),(0,l.jsx)("option",{value:"SYNASTRY_TRANSITS",children:"Synastry + Transits"}),(0,l.jsx)("option",{value:"COMPOSITE",children:"Composite (midpoint) + Relational Mirror"})]}),!D&&(0,l.jsx)("p",{className:"mt-1 text-xs text-amber-400",children:"Selecting a relational mode will enable “Include Person B”."})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"t-reloc",className:"block text-sm text-slate-300",children:"Relocation (angles/houses)"}),(0,l.jsxs)("select",{id:"t-reloc",className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:em,onChange:e=>ex(e.target.value),children:[(0,l.jsx)("option",{value:"NONE",children:"None (Natal Base)"}),(0,l.jsx)("option",{value:"A_LOCAL",children:"Person A"}),(0,l.jsx)("option",{value:"B_LOCAL",disabled:!D,children:"Person B"}),(0,l.jsx)("option",{value:"MIDPOINT",disabled:!D,children:"Midpoint (A + B)"})]}),(0,l.jsx)("p",{className:"mt-1 text-xs text-slate-400",children:"Clinical toggle only; no narrative. If not applied, angles/houses remain natal."}),(0,l.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:"Note: Midpoint here relocates houses to the geographic midpoint; Composite mode above creates the midpoint chart."}),"NONE"===em?null:(0,l.jsxs)("div",{className:"mt-4 inline-flex items-center gap-2 rounded-full border border-emerald-700 bg-emerald-900/30 px-3 py-1 text-xs text-emerald-200",children:[(0,l.jsx)("span",{className:"inline-block h-1.5 w-1.5 rounded-full bg-emerald-400","aria-hidden":!0}),(0,l.jsx)("span",{className:"font-medium",children:"Relocated to:"}),(0,l.jsx)("span",{className:"text-emerald-100",children:ej||"Custom"}),(0,l.jsxs)("span",{className:"text-emerald-300",children:["(",ef||h.timezone||"—",")"]})]})]})]}),"NONE"!==em&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("label",{htmlFor:"t-reloc-coords",className:"block text-sm text-slate-300",children:"Relocation Coordinates"}),(0,l.jsx)("input",{id:"t-reloc-coords",type:"text",className:"mt-1 w-full h-10 rounded-md border bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 ".concat(eb?"border-red-600":"border-slate-600"),value:ep,onChange:e=>{let t=e.target.value;eh(t);let s=i(t,{rejectZeroZero:!0});s?(eN(s),eg(null)):(eN(null),eg("Invalid coordinates"))},placeholder:"e.g., 30\xb010′N, 85\xb040′W"}),(0,l.jsxs)("p",{className:"mt-1 text-xs text-slate-400",children:["Default: 30\xb010′N, 85\xb040′W \xb7 Normalized: ",ev?r(ev.lat,ev.lon):"—"]}),eb&&(0,l.jsx)("p",{className:"mt-1 text-xs text-red-400",children:eb}),(0,l.jsxs)("div",{className:"mt-3 grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"t-reloc-label",className:"block text-sm text-slate-300",children:"Relocation Label"}),(0,l.jsx)("input",{id:"t-reloc-label",type:"text",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ej,onChange:e=>ey(e.target.value),placeholder:"e.g., Panama City, FL"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"t-reloc-tz",className:"block text-sm text-slate-300",children:"Relocation Timezone"}),(0,l.jsx)("select",{id:"t-reloc-tz",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ef,onChange:e=>eS(e.target.value),children:eo.map(e=>(0,l.jsx)("option",{value:e,children:e},e))})]})]})]}),"weekly"===C&&(0,l.jsxs)("div",{className:"mt-2 flex items-center gap-3",children:[(0,l.jsx)("span",{className:"text-xs text-slate-400",children:"Weekly aggregation"}),(0,l.jsx)("button",{type:"button",className:"h-5 w-5 rounded-full border border-slate-600 text-[11px] text-slate-300 hover:bg-slate-700/60 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",title:"Mean = average of daily values per week; Max = highest daily value per week","aria-label":"Help: Weekly aggregation semantics",children:"?"}),(0,l.jsxs)("div",{role:"group","aria-label":"Weekly aggregation",className:"inline-flex overflow-hidden rounded-md border border-slate-700 bg-slate-800",children:[(0,l.jsx)("button",{type:"button",onClick:()=>eE("mean"),className:"px-3 py-1 text-xs ".concat("mean"===eI?"bg-indigo-600 text-white":"text-slate-200 hover:bg-slate-700"," focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500"),children:"Mean"}),(0,l.jsx)("button",{type:"button",onClick:()=>eE("max"),className:"px-3 py-1 text-xs ".concat("max"===eI?"bg-indigo-600 text-white":"text-slate-200 hover:bg-slate-700"," focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500"),children:"Max"})]})]}),"NONE"!==em&&(0,l.jsxs)("div",{className:"mt-3 inline-flex items-center gap-2 rounded-full border border-emerald-700 bg-emerald-900/30 px-3 py-1 text-xs text-emerald-200",children:[(0,l.jsx)("span",{className:"inline-block h-1.5 w-1.5 rounded-full bg-emerald-400","aria-hidden":!0}),(0,l.jsx)("span",{className:"font-medium",children:"Relocated to:"}),(0,l.jsx)("span",{className:"text-emerald-100",children:ej||"—"}),(0,l.jsx)("span",{className:"text-emerald-300",children:ef||h.timezone||"—"})]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("p",{className:"text-xs text-slate-500",children:"All processing is geometry-first and non-deterministic. Your data isn’t stored."}),(0,l.jsxs)("div",{className:"mr-2 hidden sm:flex items-center gap-2 text-[11px] text-slate-400",children:[(0,l.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-800 px-2 py-0.5",children:[(0,l.jsx)("span",{className:"text-slate-300",children:"Mode:"}),(0,l.jsx)("span",{className:"text-slate-100",children:T.replace(/_/g," ")})]}),(0,l.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-800 px-2 py-0.5",children:[(0,l.jsx)("span",{className:"text-slate-300",children:"Report:"}),(0,l.jsx)("span",{className:"text-slate-100 capitalize",children:eC})]})]}),(0,l.jsx)("button",{type:"submit",disabled:eq,className:"inline-flex items-center rounded-md px-4 py-2 text-white disabled:opacity-50 bg-indigo-600 hover:bg-indigo-500",children:R?"Mapping geometry…":"balance"===eC?"Generate Report":"Prepare Mirror"})]}),["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"].includes(T)&&!D&&(0,l.jsx)("p",{className:"mt-2 text-xs text-amber-400",children:"Hint: Toggle “Include Person B” and fill in required fields to enable relational modes."})]})]})]}),P&&(0,l.jsxs)("div",{className:"mt-6 rounded-md border border-red-700 bg-red-900/30 p-4 text-red-200",children:[(0,l.jsx)("p",{className:"font-medium",children:"Error"}),(0,l.jsx)("p",{className:"mt-1 text-sm",children:P})]}),R&&(0,l.jsxs)("div",{className:"mt-8 grid grid-cols-1 gap-6 print:hidden",children:[(0,l.jsxs)("section",{className:"rounded-lg border border-slate-700 bg-slate-800/60 p-4",children:[(0,l.jsx)("div",{className:"h-5 w-40 rounded bg-slate-700 animate-pulse"}),(0,l.jsxs)("div",{className:"mt-4 grid grid-cols-3 gap-3",children:[(0,l.jsx)("div",{className:"h-16 rounded bg-slate-700/70 animate-pulse"}),(0,l.jsx)("div",{className:"h-16 rounded bg-slate-700/70 animate-pulse"}),(0,l.jsx)("div",{className:"h-16 rounded bg-slate-700/70 animate-pulse"})]})]}),(0,l.jsxs)("section",{className:"rounded-lg border border-slate-700 bg-slate-800/60 p-4",children:[(0,l.jsx)("div",{className:"h-5 w-56 rounded bg-slate-700 animate-pulse"}),(0,l.jsx)("div",{className:"mt-4 h-24 rounded bg-slate-700/60 animate-pulse"})]})]}),B&&(0,l.jsxs)("div",{className:"mt-8 grid grid-cols-1 gap-6",children:[(()=>{var e,t;let s=(null==B||null==(e=B.person_a)?void 0:e.meta)||(null==B||null==(t=B.provenance)?void 0:t.time_meta_a);if(!s)return null;let a=!!s.houses_suppressed,i=String(s.time_precision||""),n=s.effective_time_used;return(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[a&&(0,l.jsx)("div",{className:"rounded-md border border-slate-700 bg-slate-800/70 px-3 py-1 text-xs text-slate-200",children:"Angles unavailable without birth time; houses suppressed."}),n&&(0,l.jsxs)("div",{className:"inline-flex items-center gap-2 rounded-full border border-emerald-700 bg-emerald-900/30 px-3 py-1 text-xs text-emerald-200",children:[(0,l.jsx)("span",{className:"inline-block h-1.5 w-1.5 rounded-full bg-emerald-400","aria-hidden":!0}),(0,l.jsx)("span",{className:"font-medium",children:"Effective time"}),(0,l.jsx)("span",{className:"text-emerald-100",children:n})]}),"unknown"===i&&"planetary_only"===ea&&(0,l.jsx)("div",{className:"rounded-md border border-amber-700 bg-amber-900/30 px-3 py-1 text-xs text-amber-200",children:"Using planetary-only mode. You can run a sensitivity scan for house-dependent work."})]})})(),(0,l.jsxs)("div",{className:"flex items-center justify-between gap-4 print:hidden",children:[(0,l.jsx)("div",{className:"text-sm text-slate-400",children:(0,l.jsxs)("span",{children:["Download your report, then visit ",(0,l.jsx)("a",{href:"/chat",className:"text-emerald-400 hover:text-emerald-300 underline",children:"Poetic Brain"})," to upload it for interpretation."]})}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:function(){if(B)try{let e=new Blob([JSON.stringify(B,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a"),l=new Date().toISOString().slice(0,10).replace(/-/g,"");s.href=t,s.download="math-brain-result-".concat(l,".json"),document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(t);try{ek("Downloading result JSON"),setTimeout(()=>ek(null),1400)}catch(e){}}catch(e){}},className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-1.5 text-slate-100 hover:bg-slate-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400","aria-label":"Download result JSON",children:"Download JSON"}),(0,l.jsx)("button",{type:"button",onClick:eY,className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-1.5 text-slate-100 hover:bg-slate-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400","aria-label":"Download PDF",children:"Download PDF"})]})]}),"balance"===eC&&(0,l.jsxs)(l.Fragment,{children:[Object.keys((null==B||null==(t=B.person_a)||null==(e=t.chart)?void 0:e.transitsByDate)||{}).length>0?null:(0,l.jsx)("div",{className:"rounded-md border border-amber-700 bg-amber-900/30 p-3 text-amber-200",children:(0,l.jsx)("p",{className:"text-sm",children:"No daily series data returned. Double-check your dates, step, and inputs, then try again. If this persists, view the Raw Result (debug) below."})}),(()=>{var e,t;let s=null==B?void 0:B.woven_map;if(!(null==s||null==(t=s.hook_stack)||null==(e=t.hooks)?void 0:e.length))return null;let a=s.hook_stack.hooks||[];return(0,l.jsxs)(u,{title:"Hook Stack — Recognition Gateway",children:[(0,l.jsxs)("div",{className:"mb-3 text-sm text-slate-400",children:["Front-door UX: ",a.length," high-charge patterns from tightest aspects",s.hook_stack.tier_1_orbs>0&&" \xb7 ".concat(s.hook_stack.tier_1_orbs," Tier-1 (≤1\xb0)"),"\xb7 Coverage: ",s.hook_stack.coverage]}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:a.map((e,t)=>{var s,a;return(0,l.jsxs)("div",{className:"rounded-md border border-amber-600/30 bg-amber-900/20 p-4",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,l.jsx)("div",{className:"text-amber-100 font-medium leading-tight",children:e.title}),e.is_tier_1&&(0,l.jsx)("span",{className:"ml-2 inline-flex items-center rounded bg-amber-600 px-1.5 py-0.5 text-xs font-medium text-amber-100",children:"T1"})]}),(0,l.jsxs)("div",{className:"text-xs text-amber-200/70 space-y-1",children:[(0,l.jsxs)("div",{children:["Orb: ",null==(s=e.orb)?void 0:s.toFixed(1),"\xb0 \xb7 Intensity: ",Math.round(e.intensity)]}),(0,l.jsxs)("div",{children:[(null==(a=e.planets)?void 0:a.join(" "))||""," ",e.aspect_type]})]})]},t)})}),(0,l.jsx)("div",{className:"mt-3 text-xs text-slate-400",children:'Purpose: Bypass analysis → trigger "that\'s me" recognition → open depth work'})]})})(),(()=>{var e,t,s,a,i;let n=null==B?void 0:B.woven_map;if(!n)return null;let r=n.integration_factors||{},o=Array.isArray(n.time_series)?n.time_series:[],d=null==(e=o[0])?void 0:e.date,c=null==(t=o[o.length-1])?void 0:t.date;return(0,l.jsxs)(u,{title:"Woven Map (data-only)",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm text-slate-300",children:"Integration Factors"}),(0,l.jsx)("div",{className:"mt-2 space-y-2",children:[{key:"fertile_field",label:"Fertile Field"},{key:"harmonic_resonance",label:"Harmonic Resonance"},{key:"expansion_lift",label:"Expansion Lift"},{key:"combustion_clarity",label:"Combustion Clarity"},{key:"liberation_release",label:"Liberation / Release"},{key:"integration",label:"Integration"}].map(e=>{var t;let{key:s,label:a}=e,i=Math.max(0,Math.min(100,Number(null!=(t=r[s])?t:0)));return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-400",children:[(0,l.jsx)("span",{children:a}),(0,l.jsxs)("span",{children:[i,"%"]})]}),(0,l.jsxs)("svg",{viewBox:"0 0 100 6",className:"h-1.5 w-full",children:[(0,l.jsx)("rect",{x:"0",y:"0",width:"100",height:"6",className:"fill-slate-700"}),(0,l.jsx)("rect",{x:"0",y:"0",width:i,height:"6",className:"fill-emerald-500"})]})]},String(s))})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm text-slate-300",children:"Time Series"}),(0,l.jsxs)("div",{className:"mt-2 text-xs text-slate-400",children:["Entries: ",o.length||0,d&&c?" \xb7 ".concat(d," → ").concat(c):""]}),(0,l.jsx)("div",{className:"mt-2 max-h-40 overflow-auto rounded border border-slate-700 bg-slate-900/40 p-2",children:(0,l.jsxs)("table",{className:"w-full text-xs text-slate-300",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"text-slate-400",children:[(0,l.jsx)("th",{className:"text-left font-medium",children:"Date"}),(0,l.jsx)("th",{className:"text-right font-medium",children:"Mag"}),(0,l.jsx)("th",{className:"text-right font-medium",children:"Val"}),(0,l.jsx)("th",{className:"text-right font-medium",children:"Vol"})]})}),(0,l.jsx)("tbody",{children:o.slice(-10).map((e,t)=>{var s,a,i;return(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"py-0.5 pr-2",children:e.date}),(0,l.jsx)("td",{className:"py-0.5 text-right",children:Number(null!=(s=e.magnitude)?s:0).toFixed(2)}),(0,l.jsx)("td",{className:"py-0.5 text-right",children:Number(null!=(a=e.valence)?a:0).toFixed(2)}),(0,l.jsx)("td",{className:"py-0.5 text-right",children:Number(null!=(i=e.volatility)?i:0).toFixed(2)})]},t)})})]})})]})]}),(0,l.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-3 sm:grid-cols-4",children:[(0,l.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Natal aspects (A)"}),(0,l.jsx)("div",{className:"text-lg text-slate-100",children:null!=(i=null==(a=n.natal_summary)||null==(s=a.major_aspects)?void 0:s.length)?i:0})]}),(0,l.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Polarity cards (hooks)"}),(0,l.jsx)("div",{className:"text-lg text-slate-100",children:Array.isArray(n.polarity_cards)?n.polarity_cards.length:0})]}),(0,l.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Report type"}),(0,l.jsx)("div",{className:"text-lg text-slate-100 capitalize",children:n.type||"solo"})]}),(0,l.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Schema"}),(0,l.jsx)("div",{className:"text-xs text-slate-100",children:n.schema})]})]})]})})(),(()=>{let e=null==B?void 0:B.context;if(!(null==e?void 0:e.translocation))return null;let t=e.translocation;return(0,l.jsx)(u,{title:"Translocation Context",className:"print:hidden",children:(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4 text-sm text-slate-300",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Applies"}),(0,l.jsx)("div",{className:"text-slate-100",children:t.applies?"Yes":"No"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Method"}),(0,l.jsx)("div",{className:"text-slate-100",children:(()=>{let e=String(t.method||"Natal");return/^A[_ ]?local$/i.test(e)||"A_local"===e?"Person A":/^B[_ ]?local$/i.test(e)||"B_local"===e?"Person B":/^midpoint$/i.test(e)?"Person A + B":/^natal$/i.test(e)?"None (Natal Base)":e})()})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"House System"}),(0,l.jsx)("div",{className:"text-slate-100",children:t.house_system||"Placidus"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"TZ"}),(0,l.jsx)("div",{className:"text-slate-100",children:t.tz||(null==h?void 0:h.timezone)||"—"})]})]})})})(),(()=>{var e,t,s,a,i,n,r,o;let d=null==B||null==(t=B.person_a)||null==(e=t.derived)?void 0:e.seismograph_summary;if(!d)return null;let c=Number(null!=(i=d.magnitude)?i:0),m=Number(null!=(n=d.valence)?n:0),x=Number(null!=(r=d.volatility)?r:0),p=c>=3?"Surge":c>=1?"Active":"Calm",h=m>.5?"Supportive":m<-.5?"Challenging":"Mixed",b=x>=3?"Scattered":x>=1?"Variable":"Stable";return(0,l.jsxs)(u,{title:"Balance Meter",children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[(0,l.jsxs)("span",{className:"inline-flex items-center gap-2 rounded bg-slate-700/60 px-3 py-1 text-slate-100",children:[(0,l.jsx)("span",{children:"⚡"}),(0,l.jsx)("span",{children:"Magnitude"}),(0,l.jsxs)("span",{className:"text-slate-300",children:["\xb7 ",p]})]}),(0,l.jsxs)("span",{className:"inline-flex items-center gap-2 rounded bg-slate-700/60 px-3 py-1 text-slate-100",children:[(0,l.jsx)("span",{children:"\uD83C\uDF13"}),(0,l.jsx)("span",{children:"Valence"}),(0,l.jsxs)("span",{className:"text-slate-300",children:["\xb7 ",h]})]}),(0,l.jsxs)("span",{className:"inline-flex items-center gap-2 rounded bg-slate-700/60 px-3 py-1 text-slate-100",children:[(0,l.jsx)("span",{children:"\uD83D\uDD37"}),(0,l.jsx)("span",{children:"Volatility"}),(0,l.jsxs)("span",{className:"text-slate-300",children:["\xb7 ",b]})]})]}),(()=>{var e,t;let s=(null==B||null==(t=B.person_a)||null==(e=t.chart)?void 0:e.transitsByDate)||{},a=Object.keys(s).sort();if(!a.length)return null;let i=a.map(e=>{var t,l,a,i,n,r,o,d,c;return{date:e,magnitude:Number(null!=(o=null==(l=s[e])||null==(t=l.seismograph)?void 0:t.magnitude)?o:0),valence:Number(null!=(d=null==(i=s[e])||null==(a=i.seismograph)?void 0:a.valence)?d:0),volatility:Number(null!=(c=null==(r=s[e])||null==(n=r.seismograph)?void 0:n.volatility)?c:0)}}),n="weekly"===C?(()=>{let e=[];for(let t=0;t<i.length;t+=7){let s=i.slice(t,t+7);if(!s.length)continue;let l=e=>e.reduce((e,t)=>e+t,0)/e.length,a=e=>e.reduce((e,t)=>Math.max(e,t),-1/0),n="max"===eI?a:l;e.push([{date:s[0].date,magnitude:Number(n(s.map(e=>e.magnitude)).toFixed(2)),valence:Number(n(s.map(e=>e.valence)).toFixed(2)),volatility:Number(n(s.map(e=>e.volatility)).toFixed(2))}])}return e.map(e=>e[0])})():i,r=Math.min(28,n.length),o=n.slice(-r);return(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("div",{className:"mb-1 text-[11px] text-slate-400",children:"Legend: ⚡ Magnitude \xb7 \uD83C\uDF13 Valence \xb7 \uD83D\uDD37 Volatility"}),(0,l.jsxs)("div",{className:"mb-1 flex justify-between text-[10px] text-slate-500",children:[(0,l.jsx)("span",{children:"Top ≈ 5"}),(0,l.jsx)("span",{children:"Date labels show MM-DD"})]}),(()=>{var e,t;let s=null==(e=o[0])?void 0:e.date,a=null==(t=o[o.length-1])?void 0:t.date;return s&&a?(0,l.jsxs)("div",{className:"mb-1 text-[10px] text-slate-500",children:[s," | ",a]}):null})(),(0,l.jsx)("div",{className:"flex items-end gap-2 overflow-x-auto rounded border border-slate-700 bg-slate-900/40 p-2",children:o.map((e,t)=>{let s=Math.max(0,Math.min(96,Math.round(e.magnitude/5*96))),a=Math.max(0,Math.min(96,Math.round(Math.min(5,Math.abs(e.valence))/5*96))),i=Math.max(0,Math.min(96,Math.round(e.volatility/5*96)));return(0,l.jsxs)("div",{className:"flex w-6 flex-col items-center justify-end gap-0.5",children:[(0,l.jsxs)("svg",{width:"16",height:"96",viewBox:"0 0 16 96",className:"block",children:[(0,l.jsx)("rect",{x:"0",y:96-s,width:"5",height:s,className:"fill-indigo-500 opacity-80"}),(0,l.jsx)("rect",{x:"6",y:96-a,width:"4",height:a,className:"fill-emerald-500 opacity-70"}),(0,l.jsx)("rect",{x:"11",y:96-i,width:"5",height:i,className:"fill-sky-500 opacity-70"})]}),(0,l.jsx)("div",{className:"text-[10px] text-center text-slate-400 truncate w-full",title:e.date,children:e.date.slice(5)})]},t)})})]})})(),(0,l.jsx)("div",{className:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-3",children:(()=>{let e=Math.min(1,Math.max(0,c/5)),t=Math.min(1,Math.max(0,x/5)),s=(Math.max(-2,Math.min(2,m))+2)/4;return[{name:"Fertile Field",hint:"Growth-friendly openings",score:.7*s+(1-t)*.3},{name:"Harmonic Resonance",hint:"Easier flow and alignment",score:.6*s+(1-t)*.4},{name:"Expansion Lift",hint:"Momentum and reach",score:.6*e+.4*s},{name:"Combustion Clarity",hint:"Honest frictions surface",score:.5*e+.5*t},{name:"Liberation / Release",hint:"Letting go, reset",score:.7*t+(1-s)*.3},{name:"Integration",hint:"Synthesis and grounding",score:(1-t)*.6+.4*s}].map((e,t)=>{let s=Math.round(100*e.score);return(0,l.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-800/50 p-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-slate-100 font-medium",children:e.name}),(0,l.jsxs)("div",{className:"text-xs text-slate-400",children:[s,"%"]})]}),(0,l.jsxs)("svg",{viewBox:"0 0 100 8",className:"mt-2 h-2 w-full",children:[(0,l.jsx)("rect",{x:"0",y:"0",width:"100",height:"8",className:"fill-slate-700"}),(0,l.jsx)("rect",{x:"0",y:"0",width:s,height:"8",className:"fill-emerald-500"})]}),(0,l.jsx)("p",{className:"mt-2 text-xs text-slate-400",children:e.hint})]},t)})})()}),(0,l.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-3 sm:grid-cols-4",children:[(0,l.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Magnitude"}),(0,l.jsx)("div",{className:"text-lg text-slate-100",children:c.toFixed(2)})]}),(0,l.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Valence"}),(0,l.jsx)("div",{className:"text-lg text-slate-100",children:m.toFixed(2)})]}),(0,l.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Volatility"}),(0,l.jsx)("div",{className:"text-lg text-slate-100",children:x.toFixed(2)})]}),(0,l.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"SFD"}),(0,l.jsx)("div",{className:"text-lg text-slate-100",children:null!=(o=null==B||null==(a=B.person_a)||null==(s=a.sfd)?void 0:s.sfd)?o:"—"})]})]})]})})()]})]})]})}},4944:(e,t,s)=>{Promise.resolve().then(s.bind(s,327))},9413:(e,t,s)=>{"use strict";function l(e,t,s){let l="balance"===e||"mirror"===e&&t,a=null==s?void 0:s.latitude,i=null==s?void 0:s.longitude,n="number"==typeof a||"string"==typeof a&&""!==a.trim()&&Number.isFinite(Number(a)),r="number"==typeof i||"string"==typeof i&&""!==i.trim()&&Number.isFinite(Number(i)),o=!!(null==s?void 0:s.timezone),d=!!s&&n&&r&&o,c="number"==typeof(null==s?void 0:s.hour)||"string"==typeof(null==s?void 0:s.hour)&&""!==s.hour,u="number"==typeof(null==s?void 0:s.minute)||"string"==typeof(null==s?void 0:s.minute)&&""!==s.minute;return{needsLoc:l,hasLoc:d,hasBirthTime:c&&u,canSubmit:!l||l&&d}}function a(e){let t=e.translocation;return t&&t.applies?{active:!0,lens:"".concat(t.current_location).concat(t.house_system?" ("+t.house_system+")":""),disclosure:"Relocation ON – Houses remapped to ".concat(t.current_location),invariants:"Planetary geometry identical; only arena (House channels) shifted"}:{active:!1,lens:(null==t?void 0:t.current_location)||"Natal Base",disclosure:"Relocation OFF – natal House mapping in effect",invariants:"Planets, signs, aspects as computed from natal coordinates"}}function i(e){if(!e)return!0;let t="number"==typeof e.hour||"string"==typeof e.hour&&""!==e.hour,s="number"==typeof e.minute||"string"==typeof e.minute&&""!==e.minute;return!(t&&s)}s.d(t,{Et:()=>a,S5:()=>i,Vs:()=>l})}},e=>{e.O(0,[441,255,358],()=>e(e.s=4944)),_N_E=e.O()}]);