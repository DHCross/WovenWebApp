(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{2030:function(e,t,a){Promise.resolve().then(a.bind(a,2759)),Promise.resolve().then(a.bind(a,8778))},2759:function(e,t,a){"use strict";a.d(t,{default:function(){return B}});var r=a(7437),n=a(2265),i=a(920);function s(){if("undefined"!=typeof crypto){try{if("function"==typeof crypto.randomUUID)return crypto.randomUUID()}catch(e){}try{if("function"==typeof crypto.getRandomValues){let e=new Uint8Array(16);crypto.getRandomValues(e),e[6]=15&e[6]|64,e[8]=63&e[8]|128;let t=[];for(let a=0;a<e.length;a++)t.push(e[a].toString(16).padStart(2,"0"));return"".concat(t.slice(0,4).join(""),"-").concat(t.slice(4,6).join(""),"-").concat(t.slice(6,8).join(""),"-").concat(t.slice(8,10).join(""),"-").concat(t.slice(10,16).join(""))}}catch(e){}}return(0,i.Z)()}let o=[{level:-5,anchor:"Collapse",emojis:["\uD83C\uDF0B","\uD83E\uDDE9","⬇️"],description:"Maximum restrictive tilt; compression/failure points"},{level:-4,anchor:"Grind",emojis:["\uD83D\uDD70","⚔","\uD83C\uDF2A"],description:"Sustained resistance; heavy duty load"},{level:-3,anchor:"Friction",emojis:["⚔","\uD83C\uDF0A","\uD83C\uDF2B"],description:"Conflicts or cross-purposes slow motion"},{level:-2,anchor:"Contraction",emojis:["\uD83C\uDF2B","\uD83E\uDDE9","⬇️"],description:"Narrowing options; ambiguity or energy drain"},{level:-1,anchor:"Drag",emojis:["\uD83C\uDF2A","\uD83C\uDF2B"],description:"Subtle headwind; minor loops or haze"},{level:0,anchor:"Equilibrium",emojis:["⚖️"],description:"Net-neutral tilt; forces cancel or diffuse"},{level:1,anchor:"Lift",emojis:["\uD83C\uDF31","✨"],description:"Gentle tailwind; beginnings sprout"},{level:2,anchor:"Flow",emojis:["\uD83C\uDF0A","\uD83E\uDDD8"],description:"Smooth adaptability; things click"},{level:3,anchor:"Harmony",emojis:["\uD83E\uDDD8","✨","\uD83C\uDF0A"],description:"Coherent progress; both/and solutions"},{level:4,anchor:"Expansion",emojis:["\uD83D\uDC8E","\uD83D\uDD25","\uD83E\uDD8B"],description:"Widening opportunities; clear insight fuels growth"},{level:5,anchor:"Liberation",emojis:["\uD83E\uDD8B","\uD83C\uDF08","\uD83D\uDD25"],description:"Peak openness; breakthroughs/big-sky view"}];function l(e){let t=Math.max(-5,Math.min(5,Math.round(e)));return o.find(e=>e.level===t)||o[5]}function c(e){let{compact:t=!1,className:a=""}=e,[i,s]=(0,n.useState)(null),[o,l]=(0,n.useState)(!1);async function c(){try{let e=await fetch("/api/usage");if(e.ok){let t=await e.json();s(t)}}catch(e){}}if((0,n.useEffect)(()=>{c();let e=setInterval(c,3e4);return()=>clearInterval(e)},[]),!i)return null;let p=e=>e>=90?"#f87171":e>=70?"#facc15":"var(--good)",u=e=>({background:p(e)}),b=e=>({color:p(e)});return t&&!o?(0,r.jsxs)("button",{onClick:()=>l(!0),className:"flex items-center gap-2 px-3 py-1 rounded-lg hover:bg-gray-700 transition-colors ".concat(a),style:{background:"var(--soft)",border:"1px solid var(--line)"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full",style:{background:"var(--good)"}}),(0,r.jsxs)("span",{className:"text-xs",style:{color:"var(--muted)"},children:[i.requestsToday,"/",i.limits.requestsPerDay]})]}),(0,r.jsx)("span",{className:"text-xs",style:{color:"var(--muted)"},children:"API"})]}):(0,r.jsxs)("div",{className:"rounded-lg p-4 ".concat(a),style:{background:"var(--panel)",border:"1px solid var(--line)"},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("h3",{className:"text-sm font-medium",style:{color:"var(--text)"},children:"Gemini API Usage"}),t&&(0,r.jsx)("button",{onClick:()=>l(!1),className:"text-xs",style:{color:"var(--muted)"},children:"✕"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(d,{label:"Daily Requests",value:"".concat(i.requestsToday,"/").concat(i.limits.requestsPerDay),pct:i.percentages.dailyRequests,txt:b,bar:u}),(0,r.jsx)(d,{label:"Daily Tokens",value:"".concat(i.tokensToday.toLocaleString(),"/").concat(i.limits.tokensPerDay.toLocaleString()),pct:i.percentages.dailyTokens,txt:b,bar:u}),(0,r.jsx)(d,{label:"Requests/Minute",value:"".concat(i.requestsThisMinute,"/").concat(i.limits.requestsPerMinute),pct:i.percentages.minuteRequests,txt:b,bar:u})]}),(0,r.jsx)("div",{className:"mt-3 pt-2",style:{borderTop:"1px solid var(--line)"},children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs",style:{color:"var(--muted)"},children:[(0,r.jsx)("div",{className:"w-1.5 h-1.5 rounded-full",style:{background:"var(--good)"}}),(0,r.jsx)("span",{children:"Free tier limits • Resets daily"})]})})]})}function d(e){let{label:t,value:a,pct:n,txt:i,bar:s}=e;return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,r.jsx)("span",{className:"text-xs",style:{color:"var(--muted)"},children:t}),(0,r.jsxs)("span",{className:"text-xs",style:i(n),children:[a," (",n,"%)"]})]}),(0,r.jsx)("div",{className:"w-full h-1.5 rounded-full",style:{background:"var(--soft)"},children:(0,r.jsx)("div",{className:"h-1.5 rounded-full transition-all duration-300",style:{width:"".concat(Math.min(n,100),"%"),...s(n)}})})]})}let p={mars:{background:"linear-gradient(135deg, #ff6b35 0%, #f7931e 100%)",textColor:"#ffffff",accentColor:"#ffed4e"},sun:{background:"linear-gradient(135deg, #ff8a00 0%, #e52e71 100%)",textColor:"#ffffff",accentColor:"#ffd700"},moon:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",textColor:"#ffffff",accentColor:"#e0e7ff"},neptune:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",textColor:"#ffffff",accentColor:"#b3e5fc"},saturn:{background:"linear-gradient(135deg, #6c7b7f 0%, #99a9b5 100%)",textColor:"#ffffff",accentColor:"#e8eaf6"},chiron:{background:"linear-gradient(135deg, #8360c3 0%, #2ebf91 100%)",textColor:"#ffffff",accentColor:"#f3e5f5"},jupiter:{background:"linear-gradient(135deg, #2c3e50 0%, #4a6741 100%)",textColor:"#ffffff",accentColor:"#81c784"},venus:{background:"linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)",textColor:"#2c3e50",accentColor:"#ff8a80"},mercury:{background:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)",textColor:"#2c3e50",accentColor:"#4fc3f7"},uranus:{background:"linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)",textColor:"#2c3e50",accentColor:"#ab47bc"},pluto:{background:"linear-gradient(135deg, #232526 0%, #414345 100%)",textColor:"#ffffff",accentColor:"#ff6b6b"}},u={mars:"♂",sun:"☉",moon:"☽",neptune:"♆",saturn:"♄",chiron:"⚷",jupiter:"♃",venus:"♀",mercury:"☿",uranus:"♅",pluto:"♇"};function b(e){return({mars:"♂",sun:"☉",moon:"☽",neptune:"♆",saturn:"♄",chiron:"⚷",jupiter:"♃",venus:"♀",mercury:"☿",uranus:"♅",pluto:"♇"})[e]||"✦"}var m=a(8059),h=a.n(m),x=e=>{let{messageId:t,onFeedback:a,disabled:i=!1,checkpointType:s="general"}=e,[o,l]=(0,n.useState)(null),[c,d]=(0,n.useState)(""),[p,u]=(0,n.useState)(!1),b=e=>{l(e),a(t,e,c||void 0),("no"===e||"unclear"===e)&&u(!0)};return i?(0,r.jsx)("div",{className:"ping-feedback-disabled",children:(0,r.jsx)("span",{className:"feedback-label",children:"✓ Feedback recorded"})}):(0,r.jsxs)("div",{className:"jsx-bec06b549f34e812 ping-feedback",children:[(0,r.jsx)("div",{className:"jsx-bec06b549f34e812 feedback-header",children:(0,r.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-label",children:(e=>{switch(e){case"hook":return"Does this Hook Stack recognition resonate?";case"vector":return"Does this hidden push/counterweight feel accurate?";case"aspect":return"Does this high-voltage pattern ring true?";case"repair":return"Does this repair feel true to your experience?";default:return"Does any of this feel familiar?"}})(s)})}),(0,r.jsxs)("div",{className:"jsx-bec06b549f34e812 feedback-options",children:[(0,r.jsxs)("button",{onClick:()=>b("yes"),disabled:!!o,className:"jsx-bec06b549f34e812 "+"feedback-btn yes ".concat("yes"===o?"selected":""),children:[(0,r.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-icon",children:"✓"}),(0,r.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-text",children:"Yes, resonates"})]}),(0,r.jsxs)("button",{onClick:()=>b("maybe"),disabled:!!o,className:"jsx-bec06b549f34e812 "+"feedback-btn maybe ".concat("maybe"===o?"selected":""),children:[(0,r.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-icon",children:"~"}),(0,r.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-text",children:"Partly/Maybe"})]}),(0,r.jsxs)("button",{onClick:()=>b("no"),disabled:!!o,className:"jsx-bec06b549f34e812 "+"feedback-btn no ".concat("no"===o?"selected":""),children:[(0,r.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-icon",children:"✗"}),(0,r.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-text",children:"No, doesn't fit"})]}),(0,r.jsxs)("button",{onClick:()=>b("unclear"),disabled:!!o,className:"jsx-bec06b549f34e812 "+"feedback-btn unclear ".concat("unclear"===o?"selected":""),children:[(0,r.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-icon",children:"?"}),(0,r.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-text",children:"Unclear/Confusing"})]})]}),p&&(0,r.jsxs)("div",{className:"jsx-bec06b549f34e812 feedback-note",children:[(0,r.jsx)("textarea",{value:c,onChange:e=>d(e.target.value),placeholder:"Optional: What specifically didn't resonate or was unclear?",rows:2,className:"jsx-bec06b549f34e812 note-input"}),(0,r.jsx)("button",{onClick:()=>{o&&(a(t,o,c||void 0),u(!1))},className:"jsx-bec06b549f34e812 note-submit",children:"Submit feedback"})]}),(0,r.jsx)(h(),{id:"bec06b549f34e812",children:'.ping-feedback.jsx-bec06b549f34e812{margin:16px 0;padding:16px;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.1);-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;font-family:"Inter",sans-serif}.ping-feedback-disabled.jsx-bec06b549f34e812{margin:8px 0;padding:8px 12px;background:rgba(0,255,0,.1);border:1px solid rgba(0,255,0,.2);-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;font-size:12px;color:#4ade80}.feedback-header.jsx-bec06b549f34e812{margin-bottom:12px}.feedback-label.jsx-bec06b549f34e812{font-size:14px;font-weight:500;color:#e5e7eb;font-style:italic}.feedback-options.jsx-bec06b549f34e812{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:8px;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap}.feedback-btn.jsx-bec06b549f34e812{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:6px;padding:8px 12px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;color:#d1d5db;font-size:12px;cursor:pointer;-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease;min-width:100px}.feedback-btn.jsx-bec06b549f34e812:hover:not(:disabled){background:rgba(255,255,255,.1);border-color:rgba(255,255,255,.2)}.feedback-btn.jsx-bec06b549f34e812:disabled{opacity:.5;cursor:not-allowed}.feedback-btn.selected.jsx-bec06b549f34e812{background:rgba(59,130,246,.2);border-color:#3b82f6;color:#93c5fd}.feedback-btn.yes.selected.jsx-bec06b549f34e812{background:rgba(34,197,94,.2);border-color:#22c55e;color:#86efac}.feedback-btn.no.selected.jsx-bec06b549f34e812{background:rgba(239,68,68,.2);border-color:#ef4444;color:#fca5a5}.feedback-btn.maybe.selected.jsx-bec06b549f34e812{background:rgba(245,158,11,.2);border-color:#f59e0b;color:#fcd34d}.feedback-btn.unclear.selected.jsx-bec06b549f34e812{background:rgba(139,92,246,.2);border-color:#8b5cf6;color:#c4b5fd}.feedback-icon.jsx-bec06b549f34e812{font-weight:bold;font-size:14px}.feedback-text.jsx-bec06b549f34e812{font-weight:400}.feedback-note.jsx-bec06b549f34e812{margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,.1)}.note-input.jsx-bec06b549f34e812{width:100%;padding:8px 12px;background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.1);-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;color:#e5e7eb;font-size:12px;font-family:"Inter",sans-serif;resize:vertical;margin-bottom:8px}.note-input.jsx-bec06b549f34e812:focus{outline:none;border-color:#3b82f6}.note-input.jsx-bec06b549f34e812::-webkit-input-placeholder{color:#6b7280}.note-input.jsx-bec06b549f34e812:-moz-placeholder{color:#6b7280}.note-input.jsx-bec06b549f34e812::-moz-placeholder{color:#6b7280}.note-input.jsx-bec06b549f34e812:-ms-input-placeholder{color:#6b7280}.note-input.jsx-bec06b549f34e812::-ms-input-placeholder{color:#6b7280}.note-input.jsx-bec06b549f34e812::placeholder{color:#6b7280}.note-submit.jsx-bec06b549f34e812{padding:6px 12px;background:#3b82f6;border:none;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;color:white;font-size:11px;cursor:pointer;font-family:"Inter",sans-serif}.note-submit.jsx-bec06b549f34e812:hover{background:#2563eb}'})]})};class f{generateSessionId(){return"session_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}loadFromStorage(){try{let e=localStorage.getItem("raven_ping_feedback");e&&(this.feedbackData=JSON.parse(e))}catch(e){console.warn("Failed to load ping feedback data:",e)}}saveToStorage(){try{localStorage.setItem("raven_ping_feedback",JSON.stringify(this.feedbackData))}catch(e){console.warn("Failed to save ping feedback data:",e)}}getCurrentSessionId(){return this.sessionId}sealSession(e){let t=e||this.sessionId;this.sealedSessions.add(t),e&&e!==this.sessionId||(this.sessionId=this.generateSessionId())}isSessionSealed(e){let t=e||this.sessionId;return this.sealedSessions.has(t)}registerPending(e,t,a){if(this.isSessionSealed(),this.feedbackData.find(t=>t.messageId===e))return;let r=new Date().toISOString(),n={messageId:e,response:"pending",timestamp:r,sessionId:this.sessionId,checkpointType:t,messageContent:a,createdAt:r,firstSessionId:this.sessionId};this.feedbackData.push(n),this.saveToStorage()}recordFeedback(e,t,a,r,n){let i;i="yes"===t?"WB":"maybe"===t?"ABE":"no"===t||"unclear"===t?"OSR":void 0;let s={messageId:e,response:t,note:a,timestamp:new Date().toISOString(),sessionId:this.sessionId,checkpointType:r,messageContent:n,sstCategory:i};this.feedbackData=this.feedbackData.filter(t=>t.messageId!==e),this.feedbackData.push(s),this.saveToStorage()}getFeedback(e){return this.feedbackData.find(t=>t.messageId===e)}getHitRateStats(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?this.feedbackData.filter(e=>e.sessionId===this.sessionId):this.feedbackData,a=Date.now(),r=e=>"pending"===e.response&&e.createdAt&&a-new Date(e.createdAt).getTime()>6048e5,n=t.filter(e=>!r(e)),i=n.filter(e=>"pending"!==e.response),s=i.length,o=i.filter(e=>"yes"===e.response).length,l=i.filter(e=>"no"===e.response).length,c=i.filter(e=>"maybe"===e.response).length,d=i.filter(e=>"unclear"===e.response).length,p=n.filter(e=>"pending"===e.response).length,u={};return["hook","vector","aspect","general","repair"].forEach(e=>{let t=i.filter(t=>t.checkpointType===e),a=t.length;if(a>0){let r=t.filter(e=>"yes"===e.response).length,n=t.filter(e=>"maybe"===e.response).length,i=t.filter(e=>"unclear"===e.response).length;u[e]={total:a,accuracyRate:Math.round((r+.5*n)/a*1e3)/10,clarityRate:Math.round((a-i)/a*1e3)/10}}}),{total:s,accuracyRate:Math.round(10*(s>0?(o+.5*c)/s*100:0))/10,clarityRate:Math.round(10*(s>0?(s-d)/s*100:0))/10,breakdown:{yes:o,no:l,maybe:c,unclear:d,pending:p},byCheckpointType:u}}getAllFeedback(){return[...this.feedbackData]}clearData(){this.feedbackData=[],this.saveToStorage()}getSessionPatterns(e){let t=e||this.sessionId,a=this.feedbackData.filter(e=>e.sessionId===t).filter(e=>"pending"!==e.response),r=a.filter(e=>"WB"===e.sstCategory&&e.messageContent).map(e=>e.messageContent);return{wbPatterns:r,abePatterns:a.filter(e=>"ABE"===e.sstCategory&&e.messageContent).map(e=>e.messageContent),osrPatterns:a.filter(e=>"OSR"===e.sstCategory&&e.messageContent&&!e.probe).map(e=>({content:e.messageContent,response:e.response,note:e.note})),osrProbes:a.filter(e=>"OSR"===e.sstCategory&&e.probe).map(e=>({mirrorId:e.messageId,probe:e.probe.type,mappedTo:e.probe.mappedTo||"INCONCLUSIVE",area:e.probe.area,text:e.probe.userText}))}}getPendingItems(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?this.feedbackData.filter(e=>e.sessionId===this.sessionId):this.feedbackData,a=Date.now(),r=e=>"pending"===e.response&&e.createdAt&&a-new Date(e.createdAt).getTime()>6048e5;return t.filter(e=>"pending"===e.response&&!r(e)).map(e=>{let t=e.createdAt?new Date(e.createdAt).getTime():new Date(e.timestamp).getTime(),r="hook"===e.checkpointType?3:"aspect"===e.checkpointType?2:"vector"===e.checkpointType?1:0;return{messageId:e.messageId,checkpointType:e.checkpointType,messageContent:e.messageContent,createdAt:e.createdAt,ageDays:Math.floor((a-t)/864e5),priority:r}}).sort((e,t)=>t.priority-e.priority||t.ageDays-e.ageDays)}getPendingCount(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?this.feedbackData.filter(e=>e.sessionId===this.sessionId):this.feedbackData,a=Date.now(),r=e=>"pending"===e.response&&e.createdAt&&a-new Date(e.createdAt).getTime()>6048e5;return t.filter(e=>"pending"===e.response&&!r(e)).length}getOSRPatterns(e){return this.getSessionPatterns(e).osrPatterns}exportSessionDiagnostics(e){let t=e||this.sessionId;return{sessionId:t,patterns:this.getSessionPatterns(t),stats:this.getHitRateStats(!0)}}exportData(){return JSON.stringify({sessionId:this.sessionId,exportDate:new Date().toISOString(),feedbackData:this.feedbackData,stats:this.getHitRateStats()},null,2)}constructor(){this.feedbackData=[],this.sealedSessions=new Set,this.sessionId=this.generateSessionId(),this.loadFromStorage()}}let g=new f;var y=e=>{var t;let{className:a=""}=e,[i,s]=(0,n.useState)(null),[o,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)(!0),p=()=>{s(g.getHitRateStats(c))};if((0,n.useEffect)(()=>{p();let e=()=>p();window.addEventListener("storage",e);let t=setInterval(p,2e3);return()=>{window.removeEventListener("storage",e),clearInterval(t)}},[c]),!i||0===i.total)return(0,r.jsxs)("div",{className:"jsx-18fb32cf3300aa84 "+"hit-rate-display empty ".concat(a),children:[(0,r.jsx)("span",{className:"jsx-18fb32cf3300aa84 hit-rate-label",children:"\uD83C\uDFAF Accuracy Tracking"}),(0,r.jsx)("span",{className:"jsx-18fb32cf3300aa84 hit-rate-value",children:"No feedback yet"}),(0,r.jsx)(h(),{id:"18fb32cf3300aa84",children:'.hit-rate-display.jsx-18fb32cf3300aa84{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;padding:6px 10px;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.1);-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;font-size:11px;color:#9ca3af;font-family:"Inter",sans-serif}.hit-rate-label.jsx-18fb32cf3300aa84{font-weight:500}.hit-rate-value.jsx-18fb32cf3300aa84{font-weight:300;opacity:.7}'})]});let u=e=>e>=75?"#22c55e":e>=50?"#f59e0b":"#ef4444";return(0,r.jsxs)("div",{className:"jsx-dcda58115d68571d "+"hit-rate-display ".concat(a),children:[(0,r.jsxs)("div",{onClick:()=>l(!o),className:"jsx-dcda58115d68571d hit-rate-main",children:[(0,r.jsx)("span",{className:"jsx-dcda58115d68571d hit-rate-label",children:"\uD83C\uDFAF Accuracy"}),(0,r.jsxs)("span",{style:{color:u(i.accuracyRate)},className:"jsx-dcda58115d68571d hit-rate-value accuracy",children:[i.accuracyRate.toFixed(1),"%"]}),(0,r.jsxs)("span",{className:"jsx-dcda58115d68571d hit-rate-count",children:["(",i.total,")"]}),(0,r.jsx)("span",{className:"jsx-dcda58115d68571d toggle-icon",children:o?"▼":"▶"})]}),o&&(0,r.jsxs)("div",{className:"jsx-dcda58115d68571d hit-rate-details",children:[(0,r.jsx)("div",{className:"jsx-dcda58115d68571d stats-row",children:(0,r.jsxs)("div",{className:"jsx-dcda58115d68571d scope-toggle",children:[(0,r.jsx)("button",{onClick:()=>d(!0),className:"jsx-dcda58115d68571d "+((c?"active":"")||""),children:"This Session"}),(0,r.jsx)("button",{onClick:()=>d(!1),className:"jsx-dcda58115d68571d "+((c?"":"active")||""),children:"All Time"})]})}),(0,r.jsxs)("div",{className:"jsx-dcda58115d68571d stats-row",children:[(0,r.jsx)("span",{className:"jsx-dcda58115d68571d stat-label",children:"Clarity Rate:"}),(0,r.jsxs)("span",{style:{color:(t=i.clarityRate)>=80?"#22c55e":t>=60?"#f59e0b":"#ef4444"},className:"jsx-dcda58115d68571d stat-value",children:[i.clarityRate.toFixed(1),"%"]})]}),(0,r.jsxs)("div",{className:"jsx-dcda58115d68571d stats-breakdown",children:[(0,r.jsxs)("div",{className:"jsx-dcda58115d68571d breakdown-item yes",children:[(0,r.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-icon",children:"✓"}),(0,r.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-label",children:"Yes"}),(0,r.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-count",children:i.breakdown.yes})]}),(0,r.jsxs)("div",{className:"jsx-dcda58115d68571d breakdown-item maybe",children:[(0,r.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-icon",children:"~"}),(0,r.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-label",children:"Maybe"}),(0,r.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-count",children:i.breakdown.maybe})]}),(0,r.jsxs)("div",{className:"jsx-dcda58115d68571d breakdown-item no",children:[(0,r.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-icon",children:"✗"}),(0,r.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-label",children:"No"}),(0,r.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-count",children:i.breakdown.no})]}),(0,r.jsxs)("div",{className:"jsx-dcda58115d68571d breakdown-item unclear",children:[(0,r.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-icon",children:"?"}),(0,r.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-label",children:"Unclear"}),(0,r.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-count",children:i.breakdown.unclear})]})]}),Object.keys(i.byCheckpointType).length>0&&(0,r.jsxs)("div",{className:"jsx-dcda58115d68571d checkpoint-breakdown",children:[(0,r.jsx)("div",{className:"jsx-dcda58115d68571d breakdown-header",children:"By Checkpoint Type:"}),Object.entries(i.byCheckpointType).map(e=>{let[t,a]=e;return(0,r.jsxs)("div",{className:"jsx-dcda58115d68571d checkpoint-item",children:[(0,r.jsxs)("span",{className:"jsx-dcda58115d68571d checkpoint-type",children:[t,":"]}),(0,r.jsxs)("span",{style:{color:u(a.accuracyRate)},className:"jsx-dcda58115d68571d checkpoint-accuracy",children:[a.accuracyRate.toFixed(1),"%"]}),(0,r.jsxs)("span",{className:"jsx-dcda58115d68571d checkpoint-count",children:["(",a.total,")"]})]},t)})]})]}),(0,r.jsx)(h(),{id:"dcda58115d68571d",children:'.hit-rate-display.jsx-dcda58115d68571d{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.1);-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;font-family:"Inter",sans-serif;overflow:hidden}.hit-rate-main.jsx-dcda58115d68571d{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;padding:8px 12px;cursor:pointer;-webkit-transition:background.2s ease;-moz-transition:background.2s ease;-o-transition:background.2s ease;transition:background.2s ease}.hit-rate-main.jsx-dcda58115d68571d:hover{background:rgba(255,255,255,.05)}.hit-rate-label.jsx-dcda58115d68571d{font-size:11px;font-weight:500;color:#e5e7eb}.hit-rate-value.accuracy.jsx-dcda58115d68571d{font-size:12px;font-weight:600}.hit-rate-count.jsx-dcda58115d68571d{font-size:10px;color:#9ca3af;font-weight:300}.toggle-icon.jsx-dcda58115d68571d{margin-left:auto;font-size:10px;color:#6b7280}.hit-rate-details.jsx-dcda58115d68571d{padding:8px 12px;border-top:1px solid rgba(255,255,255,.1);background:rgba(0,0,0,.2)}.stats-row.jsx-dcda58115d68571d{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:8px;font-size:10px}.stats-row.jsx-dcda58115d68571d:last-child{margin-bottom:0}.scope-toggle.jsx-dcda58115d68571d{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:4px}.scope-toggle.jsx-dcda58115d68571d button.jsx-dcda58115d68571d{padding:3px 6px;font-size:9px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.05);color:#9ca3af;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;cursor:pointer;-webkit-transition:all.2s ease;-moz-transition:all.2s ease;-o-transition:all.2s ease;transition:all.2s ease}.scope-toggle.jsx-dcda58115d68571d button.active.jsx-dcda58115d68571d{background:#3b82f6;border-color:#3b82f6;color:white}.stat-label.jsx-dcda58115d68571d{color:#d1d5db}.stat-value.jsx-dcda58115d68571d{font-weight:600}.stats-breakdown.jsx-dcda58115d68571d{display:grid;grid-template-columns:1fr 1fr;gap:4px;margin-top:8px}.breakdown-item.jsx-dcda58115d68571d{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:4px;padding:3px 6px;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;background:rgba(255,255,255,.03);font-size:9px}.breakdown-item.yes.jsx-dcda58115d68571d .breakdown-icon.jsx-dcda58115d68571d{color:#22c55e}.breakdown-item.maybe.jsx-dcda58115d68571d .breakdown-icon.jsx-dcda58115d68571d{color:#f59e0b}.breakdown-item.no.jsx-dcda58115d68571d .breakdown-icon.jsx-dcda58115d68571d{color:#ef4444}.breakdown-item.unclear.jsx-dcda58115d68571d .breakdown-icon.jsx-dcda58115d68571d{color:#8b5cf6}.breakdown-icon.jsx-dcda58115d68571d{font-weight:bold;font-size:10px}.breakdown-label.jsx-dcda58115d68571d{color:#d1d5db;-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1}.breakdown-count.jsx-dcda58115d68571d{color:#9ca3af;font-weight:500}.checkpoint-breakdown.jsx-dcda58115d68571d{margin-top:12px;padding-top:8px;border-top:1px solid rgba(255,255,255,.1)}.breakdown-header.jsx-dcda58115d68571d{font-size:9px;color:#d1d5db;font-weight:500;margin-bottom:6px}.checkpoint-item.jsx-dcda58115d68571d{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:6px;padding:2px 0;font-size:9px}.checkpoint-type.jsx-dcda58115d68571d{color:#9ca3af;text-transform:capitalize;min-width:40px}.checkpoint-accuracy.jsx-dcda58115d68571d{font-weight:600;min-width:35px}.checkpoint-count.jsx-dcda58115d68571d{color:#6b7280;font-size:8px}'})]})};let v={Initiator:{signs:["Aries"],keywords:["ignite","spark","drive","action","catalyst","start","begin"],tonality:["bold","urgent","direct","fast"],behaviors:["fears stagnation","needs action","initiates","leads"]},Stabilizer:{signs:["Taurus"],keywords:["anchor","endure","stable","steady","persist","build"],tonality:["calm","grounded","solid","reliable"],behaviors:["fears chaos","needs security","preserves","maintains"]},Connector:{signs:["Gemini"],keywords:["connect","share","communicate","link","exchange","network"],tonality:["quick","witty","verbal","fluid"],behaviors:["fears isolation","needs interaction","bridges","translates"]},Nurturer:{signs:["Cancer"],keywords:["care","protect","nurture","shield","support","tend"],tonality:["warm","caring","emotional","gentle"],behaviors:["fears neglect","needs connection","protects","provides"]},Validator:{signs:["Leo"],keywords:["shine","validate","recognize","celebrate","honor","appreciate"],tonality:["vibrant","confident","expressive","warm"],behaviors:["fears obscurity","needs recognition","affirms","celebrates"]},Optimizer:{signs:["Virgo"],keywords:["perfect","refine","fix","improve","analyze","correct"],tonality:["precise","analytical","detailed","careful"],behaviors:["fears error","needs accuracy","refines","perfects"]},Harmonizer:{signs:["Libra"],keywords:["balance","harmonize","mediate","fair","equalize","diplomatic"],tonality:["polished","fair","balanced","gracious"],behaviors:["fears conflict","needs harmony","mediates","balances"]},Investigator:{signs:["Scorpio"],keywords:["probe","uncover","investigate","penetrate","reveal","transform"],tonality:["intense","probing","deep","private"],behaviors:["fears deception","needs truth","investigates","transforms"]},Visionary:{signs:["Sagittarius"],keywords:["inspire","expand","explore","teach","guide","envision"],tonality:["expansive","candid","bold","open"],behaviors:["fears ignorance","needs meaning","explores","teaches"]},Architect:{signs:["Capricorn"],keywords:["build","structure","organize","plan","achieve","master"],tonality:["authoritative","structured","formal","disciplined"],behaviors:["fears failure","needs control","builds","achieves"]},Reformer:{signs:["Aquarius"],keywords:["reform","innovate","revolutionize","liberate","progress","change"],tonality:["innovative","detached","radical","abstract"],behaviors:["fears conformity","needs freedom","reforms","innovates"]},Empath:{signs:["Pisces"],keywords:["feel","empathize","flow","merge","dissolve","transcend"],tonality:["fluid","evasive","gentle","impressionistic"],behaviors:["fears disconnection","needs unity","flows","transcends"]}},j={"Direct & Fast":{signs:["Aries"],keywords:["direct","immediate","urgent","quick","decisive"],tonality:["bold","urgent","fast"],behaviors:["acts quickly","speaks directly","moves fast"]},"Deliberate & Grounded":{signs:["Taurus"],keywords:["deliberate","slow","steady","methodical","patient"],tonality:["calm","grounded","steady"],behaviors:["moves slowly","thinks carefully","stays stable"]},"Verbal & Multi-threaded":{signs:["Gemini"],keywords:["talkative","quick","multiple","varied","changeable"],tonality:["witty","rapid","verbal"],behaviors:["talks much","changes topics","multitasks"]},"Emotionally Coded":{signs:["Cancer"],keywords:["emotional","feeling","sensitive","moody","caring"],tonality:["emotional","warm","caring"],behaviors:["shows emotion","cares deeply","protective"]},"Expressive & Central":{signs:["Leo"],keywords:["expressive","dramatic","central","performative","vibrant"],tonality:["confident","vibrant","expressive"],behaviors:["performs","takes center","expresses boldly"]},"Precise & Critical":{signs:["Virgo"],keywords:["precise","critical","analytical","detailed","exact"],tonality:["precise","analytical","detailed"],behaviors:["analyzes","criticizes","perfects"]},"Diplomatic & Relational":{signs:["Libra"],keywords:["diplomatic","relational","social","balanced","harmonious"],tonality:["polished","fair","diplomatic"],behaviors:["mediates","socializes","seeks balance"]},"Penetrating & Private":{signs:["Scorpio"],keywords:["penetrating","private","intense","secretive","probing"],tonality:["intense","private","probing"],behaviors:["penetrates","keeps secrets","investigates"]},"Candid & Expansive":{signs:["Sagittarius"],keywords:["candid","expansive","open","honest","broad"],tonality:["candid","expansive","open"],behaviors:["speaks truth","expands","explores"]},"Formal & Structured":{signs:["Capricorn"],keywords:["formal","structured","organized","disciplined","authoritative"],tonality:["formal","structured","authoritative"],behaviors:["organizes","disciplines","structures"]},"Detached & Conceptual":{signs:["Aquarius"],keywords:["detached","conceptual","abstract","innovative","unique"],tonality:["detached","innovative","abstract"],behaviors:["detaches","conceptualizes","innovates"]},"Impressionistic & Evasive":{signs:["Pisces"],keywords:["impressionistic","evasive","fluid","vague","dreamy"],tonality:["fluid","evasive","impressionistic"],behaviors:["evades","flows","dreams"]}},w={Initiator:{"Direct & Fast":"Pure Catalyst","Deliberate & Grounded":"Slow Burn","Verbal & Multi-threaded":"Brainstormer","Emotionally Coded":"Impulsive Heart","Expressive & Central":"Star Player","Precise & Critical":"Pointed Spear","Diplomatic & Relational":"Charming Leader","Penetrating & Private":"Covert Operator","Candid & Expansive":"Adventurous Leader","Formal & Structured":"Disciplined Leader","Detached & Conceptual":"Rebel Leader","Impressionistic & Evasive":"Elusive Spark"},Stabilizer:{"Direct & Fast":"Unmovable Force","Deliberate & Grounded":"Bedrock","Verbal & Multi-threaded":"Resourceful Voice","Emotionally Coded":"Quiet Feeler","Expressive & Central":"Generous Host","Precise & Critical":"Practical Critic","Diplomatic & Relational":"Gracious Host","Penetrating & Private":"Silent Power","Candid & Expansive":"Honest Broker","Formal & Structured":"Master Builder","Detached & Conceptual":"Principled Investor","Impressionistic & Evasive":"Gentle Giant"},Connector:{"Direct & Fast":"Fast Talker","Deliberate & Grounded":"Patient Storyteller","Verbal & Multi-threaded":"Idea Machine","Emotionally Coded":"Sensitive Wit","Expressive & Central":"Magnetic Speaker","Precise & Critical":"Fact-Checker","Diplomatic & Relational":"Smooth Talker","Penetrating & Private":"Secret Keeper","Candid & Expansive":"Enthusiastic Debater","Formal & Structured":"Clear Communicator","Detached & Conceptual":"Genius Thinker","Impressionistic & Evasive":"Poetic Storyteller"},Investigator:{"Direct & Fast":"Cutting Truth","Deliberate & Grounded":"Deep Root","Verbal & Multi-threaded":"Information Broker","Emotionally Coded":"Hidden Current","Expressive & Central":"Charismatic Leader","Precise & Critical":"Forensic Analyst","Diplomatic & Relational":"Strategic Advisor","Penetrating & Private":"Silent Oracle","Candid & Expansive":"Truth-Teller","Formal & Structured":"Strategic Planner","Detached & Conceptual":"Strategic Futurist","Impressionistic & Evasive":"Psychic Investigator"},Visionary:{"Direct & Fast":"Blunt Prophet","Deliberate & Grounded":"Enduring Wisdom","Verbal & Multi-threaded":"Enthusiastic Teacher","Emotionally Coded":"Protective Guide","Expressive & Central":"Inspiring Preacher","Precise & Critical":"Moral Compass","Diplomatic & Relational":"Fair-Minded Guru","Penetrating & Private":"Truth Seeker","Candid & Expansive":"Pure Visionary","Formal & Structured":"Ambitious Teacher","Detached & Conceptual":"Radical Philosopher","Impressionistic & Evasive":"Spiritual Wanderer"},Nurturer:{"Direct & Fast":"Protective First Responder","Deliberate & Grounded":"Hearth Keeper","Verbal & Multi-threaded":"Story Weaver","Emotionally Coded":"Tidal Heart","Expressive & Central":"Radiant Caregiver","Precise & Critical":"Attentive Steward","Diplomatic & Relational":"Gentle Mediator","Penetrating & Private":"Hidden Well","Candid & Expansive":"Encouraging Guide","Formal & Structured":"Guardian of Boundaries","Detached & Conceptual":"Archetypal Care","Impressionistic & Evasive":"Moonlit Shelter"},Validator:{"Direct & Fast":"Spotlight Sprinter","Deliberate & Grounded":"Steady Beacon","Verbal & Multi-threaded":"Golden Voice","Emotionally Coded":"Warm Center","Expressive & Central":"Solar Heart","Precise & Critical":"Exacting Muse","Diplomatic & Relational":"Gracious Host","Penetrating & Private":"Hidden Flame","Candid & Expansive":"Generous Leader","Formal & Structured":"Regal Architect","Detached & Conceptual":"Iconoclast Star","Impressionistic & Evasive":"Dramatic Mirage"},Optimizer:{"Direct & Fast":"Surgical Fixer","Deliberate & Grounded":"Patient Refiner","Verbal & Multi-threaded":"Systems Analyst","Emotionally Coded":"Careful Helper","Expressive & Central":"Pointed Critic","Precise & Critical":"Pure Analyst","Diplomatic & Relational":"Tactful Editor","Penetrating & Private":"Forensic Healer","Candid & Expansive":"Ethical Improver","Formal & Structured":"Method Architect","Detached & Conceptual":"Abstract Optimizer","Impressionistic & Evasive":"Whispered Correction"},Harmonizer:{"Direct & Fast":"Grace Under Pressure","Deliberate & Grounded":"Elegant Anchor","Verbal & Multi-threaded":"Silver Mediator","Emotionally Coded":"Soft Balancer","Expressive & Central":"Charming Diplomat","Precise & Critical":"Fair Arbiter","Diplomatic & Relational":"Pure Harmonist","Penetrating & Private":"Subtle Broker","Candid & Expansive":"Open Negotiator","Formal & Structured":"Equity Architect","Detached & Conceptual":"Idealist Reconciler","Impressionistic & Evasive":"Velvet Balance"},Architect:{"Direct & Fast":"Command Builder","Deliberate & Grounded":"Stone Mason","Verbal & Multi-threaded":"Executive Communicator","Emotionally Coded":"Steeled Guardian","Expressive & Central":"Dignified Leader","Precise & Critical":"Master Planner","Diplomatic & Relational":"Statesman","Penetrating & Private":"Silent Strategist","Candid & Expansive":"Ambitious Captain","Formal & Structured":"Pure Architect","Detached & Conceptual":"Systemic Builder","Impressionistic & Evasive":"Sober Dreamer"},Reformer:{"Direct & Fast":"Shock Innovator","Deliberate & Grounded":"Principled Reformer","Verbal & Multi-threaded":"Signal Splitter","Emotionally Coded":"Detached Advocate","Expressive & Central":"Iconoclast Performer","Precise & Critical":"Analytical Maverick","Diplomatic & Relational":"Civic Futurist","Penetrating & Private":"Underground Radical","Candid & Expansive":"Visionary Reformer","Formal & Structured":"Policy Architect","Detached & Conceptual":"Pure Innovator","Impressionistic & Evasive":"Electric Phantom"},Empath:{"Direct & Fast":"Soft Surge","Deliberate & Grounded":"Kind Anchor","Verbal & Multi-threaded":"Dream Messenger","Emotionally Coded":"Oceanic Heart","Expressive & Central":"Mystic Performer","Precise & Critical":"Discerning Mystic","Diplomatic & Relational":"Porous Bridge","Penetrating & Private":"Psychic Diver","Candid & Expansive":"Pilgrim Poet","Formal & Structured":"Vessel Maker","Detached & Conceptual":"Neptunian Thinker","Impressionistic & Evasive":"Pure Dreamer"}};class k{static getInstance(){return k.instance||(k.instance=new k),k.instance}analyzeContent(e){let t=e.normalize("NFKD").replace(/[\u2010-\u2015\-]/g," ").replace(/[“”‘’]/g," ").toLowerCase().replace(RegExp("\\p{M}+","gu"),"").replace(/[^a-z\s]/g," ").split(/\s+/).filter(Boolean),a=new Set(["no","not","never","rarely","hardly","seldom","without"]),r=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;for(let n=1;n<=r;n++){let r=t[e-n];if(!r)break;if(a.has(r))return!0}return!1},n=new Set(["bold","urgent","direct","fast","expansive","precise"]),i=e=>{let a=e.toLowerCase().split(/\s+/).filter(Boolean);if(0===a.length)return 0;if(1===a.length){let e=a[0];for(let a=0;a<t.length;a++)if(t[a]===e)return r(a)?.5:1;return 0}for(let e=0;e<t.length;e++){if(t[e]!==a[0])continue;let n=e,i=!0;for(let e=1;e<a.length;e++){let r=!1;for(let i=n+1;i<=n+4&&i<t.length;i++)if(t[i]===a[e]){r=!0,n=i;break}if(!r){i=!1;break}}if(i)return r(e)?.5:1}return 0},s=e=>{let a=0,s=new Set;for(let n=0;n<t.length;n++){let i=t[n];for(let t of e.keywords){let e=t.toLowerCase();i!==e||s.has(e)||(s.add(e),a+=r(n)?.5:1)}}let o=0,l=new Set;for(let i=0;i<t.length;i++){let s=t[i];for(let t of e.tonality){let e=t.toLowerCase();if(s===e&&!l.has(e)){l.add(e);let t=a>0||n.has(e)?1:.25;o+=r(i)?.5*t:t}}}let c=0;if(e.behaviors&&e.behaviors.length){let t=new Set;e.behaviors.forEach(e=>{let a=i(e);a>0&&!t.has(e)&&(t.add(e),c+=a)})}return(2*a+1*o+.5*c)/(2*e.keywords.length+1*e.tonality.length+.5*e.behaviors.length||1)},o="Unknown",l=0;Object.entries(v).forEach(e=>{let[t,a]=e,r=s(a);r>l&&(l=r,o=t)});let c="Unknown",d=0;return Object.entries(j).forEach(e=>{let[t,a]=e,r=s(a);r>d&&(d=r,c=t)}),{actor:o,role:c,actorScore:l,roleScore:d}}computeDriftIndex(e){let t=e.filter(e=>"DRIVER"===e.mappedTo||"ROLE"===e.mappedTo),a=t.length,r=t.filter(e=>"DRIVER"===e.mappedTo).length,n=r+t.filter(e=>"ROLE"===e.mappedTo).length,i=n>0?r/n:0,s=new Set(["agency","boundaries","communication","energy","relationships","work","home","identity"]),o=new Set;e.forEach(e=>{if(!e.area)return;let t=(e.area||"").toLowerCase();s.has(t)&&o.add(t)});let l=Array.from(o),c="NONE";a>=4&&l.length>=2&&i>=.7?c="STRONG":a>=3&&i>=.5&&(c="POSSIBLE");let d=l.length<2&&"NONE"!==c;return{driftIndex:i,band:d?"NONE":c,evidenceN:a,areasSpanned:l,stateDependent:d}}generateComposite(e,t){var a,r,n,i,s,o,l,c,d,p,u,b,m,h;let x,f,g,y,k;let C={},D={},S={},N={},I=(e,t,a)=>{e[t]=(e[t]||0)+a},z=(e,t,a,r)=>{e[t]=e[t]||{wb:0,abe:0,osr:0},e[t][a]+=r},E=(e,t,a)=>{let r=this.analyzeContent(e);"Unknown"!==r.actor&&(I(C,r.actor,r.actorScore*t),z(S,r.actor,a,r.actorScore*t)),"Unknown"!==r.role&&(I(D,r.role,r.roleScore*t),z(N,r.role,a,r.roleScore*t))};e.wbPatterns.forEach(e=>E(e,1,"wb")),e.abePatterns.forEach(e=>E(e,.5,"abe")),e.osrProbes&&e.osrProbes.length&&e.osrProbes.forEach(e=>{if(e.text){let t=this.analyzeContent(e.text);"Unknown"!==t.actor&&(I(C,t.actor,.75*t.actorScore),z(S,t.actor,"osr",.75*t.actorScore))}}),(null==t?void 0:t.actorBonus)&&Object.keys(C).forEach(e=>{C[e]+=t.actorBonus}),(null==t?void 0:t.roleBonus)&&Object.keys(D).forEach(e=>{D[e]+=t.roleBonus}),(null==t?void 0:t.aspectNotes)&&t.aspectNotes.length&&(Object.keys(C).forEach(e=>{C[e]+=.05}),Object.keys(D).forEach(e=>{D[e]+=.05}));let R=Object.entries(C).sort((e,t)=>t[1]-e[1]),T=Object.entries(D).sort((e,t)=>t[1]-e[1]),P=R[0]?{k:R[0][0],v:R[0][1]}:{k:"Unknown",v:0},F=T[0]?{k:T[0][0],v:T[0][1]}:{k:"Unknown",v:0};if(R.length>1&&.02>=Math.abs(R[0][1]-R[1][1])){let e=R[0][0],t=R[1][0],a=(null===(s=S[e])||void 0===s?void 0:s.wb)||0,r=(null===(o=S[t])||void 0===o?void 0:o.wb)||0,n=(null===(l=S[e])||void 0===l?void 0:l.abe)||0,i=(null===(c=S[t])||void 0===c?void 0:c.abe)||0,u=(null===(d=S[e])||void 0===d?void 0:d.osr)||0,b=(null===(p=S[t])||void 0===p?void 0:p.osr)||0;a!==r?(P.k=a>r?e:t,x="WB"):n!==i?(P.k=n>i?e:t,x=x||"ABE"):u!==b&&(P.k=u>b?e:t,x=x||"OSR")}if(T.length>1&&.02>=Math.abs(T[0][1]-T[1][1])){let e=T[0][0],t=T[1][0],a=(null===(u=N[e])||void 0===u?void 0:u.wb)||0,r=(null===(b=N[t])||void 0===b?void 0:b.wb)||0,n=(null===(m=N[e])||void 0===m?void 0:m.abe)||0,i=(null===(h=N[t])||void 0===h?void 0:h.abe)||0;a!==r?(F.k=a>r?e:t,x=x||"WB"):n!==i&&(F.k=n>i?e:t,x=x||"ABE")}let M=P.k,A=F.k,B=e.wbPatterns.length+e.abePatterns.length+((null===(a=e.osrProbes)||void 0===a?void 0:a.length)||0),O=0;B>0&&(O=Math.min((P.v+F.v)/Math.max(B,1),1),B<3?O=Math.min(O,.4):B<6&&(O=Math.min(O,.7)));let W=O>.65?"HIGH":O>=.35?"MODERATE":"LOW",H=!1;if(e.osrProbes&&e.osrProbes.length){let t=this.computeDriftIndex(e.osrProbes.map(e=>({mappedTo:e.mappedTo,area:e.area})));f=t.driftIndex,g=t.band,y=t.evidenceN,k=t.stateDependent,H="POSSIBLE"===t.band||"STRONG"===t.band}let L=P.v>=.15?M:"Unknown",G=F.v>=.15?A:"Unknown",_=(null===(r=w[L])||void 0===r?void 0:r[G])||"".concat(L," / ").concat(G),U=null===(n=v[L])||void 0===n?void 0:n.signs,V=null===(i=j[G])||void 0===i?void 0:i.signs;return{actor:L,role:G,composite:_,confidence:O,confidenceBand:W,sampleSize:B,siderealDrift:H,driftIndex:f,driftBand:g,evidenceN:y,actorSigns:U,roleSigns:V,stateDependent:k,tieBreak:x,aspectNotes:(null==t?void 0:t.aspectNotes)||[]}}}var C=e=>{var t,a,i;let{sessionId:s,onClose:o,onSealed:l}=e,[c,d]=(0,n.useState)(null),[p,u]=(0,n.useState)(null),[b,m]=(0,n.useState)(!1),[x,f]=(0,n.useState)(null),[y,v]=(0,n.useState)(null),[j,w]=(0,n.useState)(!1),[C,D]=(0,n.useState)({pressure:0,outlet:0,conflict:0,tone:0,surprise:0}),[S,N]=(0,n.useState)({pressure:!1,outlet:!1,conflict:!1,tone:!1,surprise:!1}),[I,z]=(0,n.useState)(null),[E,R]=(0,n.useState)(0),T=async()=>{m(!0);try{let e=g.exportSessionDiagnostics(s);u(e.stats);let t=k.getInstance().generateComposite(e.patterns);d(t)}catch(e){console.error("Error generating Actor/Role reveal:",e)}finally{m(!1)}};n.useEffect(()=>{T()},[s]);let P=C.pressure+C.outlet+C.conflict+C.tone+C.surprise,F=P>=13?"Strong signal":P>=10?"Some clear hits":P>=6?"Mild resonance":"Didn’t land";function M(e){let{label:t,helper:a,keyName:n}=e,i=C[n],s=S[n];return(0,r.jsxs)("div",{className:"rubric-row",children:[(0,r.jsxs)("div",{className:"rubric-label",children:[(0,r.jsx)("div",{children:t}),a&&(0,r.jsx)("div",{className:"rubric-helper",children:a})]}),(0,r.jsx)("input",{type:"range",min:0,max:3,step:1,value:i,onChange:e=>D(t=>({...t,[n]:Number(e.target.value)})),disabled:!!I}),(0,r.jsx)("div",{className:"rubric-value",children:i}),(0,r.jsxs)("label",{className:"rubric-null",children:[(0,r.jsx)("input",{type:"checkbox",checked:!!s,onChange:e=>N(t=>({...t,[n]:e.target.checked})),disabled:!!I})," Mark as off-base (Null/Miss)"]})]})}function A(e,t){try{console.log("[analytics] ".concat(e),t)}catch(e){}}if(b)return(0,r.jsxs)("div",{className:"jsx-f141627c340aaa10 wrap-up-card generating",children:[(0,r.jsx)("div",{className:"jsx-f141627c340aaa10 card-header",children:(0,r.jsx)("h3",{className:"jsx-f141627c340aaa10",children:"\uD83C\uDFAD Generating Actor / Role Reveal..."})}),(0,r.jsxs)("div",{className:"jsx-f141627c340aaa10 generating-content",children:[(0,r.jsxs)("div",{className:"jsx-f141627c340aaa10 dots",children:[(0,r.jsx)("span",{className:"jsx-f141627c340aaa10"}),(0,r.jsx)("span",{className:"jsx-f141627c340aaa10"}),(0,r.jsx)("span",{className:"jsx-f141627c340aaa10"})]}),(0,r.jsx)("p",{className:"jsx-f141627c340aaa10",children:"Mapping your resonance pattern..."})]}),(0,r.jsx)(h(),{id:"f141627c340aaa10",children:".wrap-up-card.jsx-f141627c340aaa10{background:-webkit-linear-gradient(315deg,#1e293b 0%,#0f172a 100%);background:-moz-linear-gradient(315deg,#1e293b 0%,#0f172a 100%);background:-o-linear-gradient(315deg,#1e293b 0%,#0f172a 100%);background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);border:1px solid rgba(148,163,184,.2);-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;padding:24px;margin:16px 0;max-width:600px;-webkit-box-shadow:0 8px 32px rgba(0,0,0,.3);-moz-box-shadow:0 8px 32px rgba(0,0,0,.3);box-shadow:0 8px 32px rgba(0,0,0,.3)}.card-header.jsx-f141627c340aaa10 h3.jsx-f141627c340aaa10{color:#f1f5f9;margin:0 0 16px 0;font-size:18px;font-weight:600}.generating-content.jsx-f141627c340aaa10{text-align:center;padding:20px 0}.dots.jsx-f141627c340aaa10{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;gap:8px;margin-bottom:16px}.dots.jsx-f141627c340aaa10 span.jsx-f141627c340aaa10{width:8px;height:8px;background:#3b82f6;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-animation:pulse 1.4s ease-in-out infinite both;-moz-animation:pulse 1.4s ease-in-out infinite both;-o-animation:pulse 1.4s ease-in-out infinite both;animation:pulse 1.4s ease-in-out infinite both}.dots.jsx-f141627c340aaa10 span.jsx-f141627c340aaa10:nth-child(1){-webkit-animation-delay:-.32s;-moz-animation-delay:-.32s;-o-animation-delay:-.32s;animation-delay:-.32s}.dots.jsx-f141627c340aaa10 span.jsx-f141627c340aaa10:nth-child(2){-webkit-animation-delay:-.16s;-moz-animation-delay:-.16s;-o-animation-delay:-.16s;animation-delay:-.16s}@-webkit-keyframes pulse{0%,80%,100%{-webkit-transform:scale(0);transform:scale(0);opacity:.5}40%{-webkit-transform:scale(1);transform:scale(1);opacity:1}}@-moz-keyframes pulse{0%,80%,100%{-moz-transform:scale(0);transform:scale(0);opacity:.5}40%{-moz-transform:scale(1);transform:scale(1);opacity:1}}@-o-keyframes pulse{0%,80%,100%{-o-transform:scale(0);transform:scale(0);opacity:.5}40%{-o-transform:scale(1);transform:scale(1);opacity:1}}@keyframes pulse{0%,80%,100%{-webkit-transform:scale(0);-moz-transform:scale(0);-o-transform:scale(0);transform:scale(0);opacity:.5}40%{-webkit-transform:scale(1);-moz-transform:scale(1);-o-transform:scale(1);transform:scale(1);opacity:1}}.generating-content.jsx-f141627c340aaa10 p.jsx-f141627c340aaa10{color:#94a3b8;margin:0}"})]});if(!c||!p)return(0,r.jsxs)("div",{className:"jsx-fdb1a8e49ca28ed8 wrap-up-card no-data",children:[(0,r.jsx)("div",{className:"jsx-fdb1a8e49ca28ed8 card-header",children:(0,r.jsx)("h3",{className:"jsx-fdb1a8e49ca28ed8",children:"\uD83C\uDFAD Actor / Role Reveal"})}),(0,r.jsx)("p",{className:"jsx-fdb1a8e49ca28ed8",children:"Not enough session data for diagnostic analysis."}),(0,r.jsx)("p",{className:"jsx-fdb1a8e49ca28ed8",children:"Try giving feedback on a few more of Raven's mirrors."}),(0,r.jsx)(h(),{id:"fdb1a8e49ca28ed8",children:".wrap-up-card.jsx-fdb1a8e49ca28ed8{background:-webkit-linear-gradient(315deg,#1e293b 0%,#0f172a 100%);background:-moz-linear-gradient(315deg,#1e293b 0%,#0f172a 100%);background:-o-linear-gradient(315deg,#1e293b 0%,#0f172a 100%);background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);border:1px solid rgba(148,163,184,.2);-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;padding:24px;margin:16px 0;max-width:600px;-webkit-box-shadow:0 8px 32px rgba(0,0,0,.3);-moz-box-shadow:0 8px 32px rgba(0,0,0,.3);box-shadow:0 8px 32px rgba(0,0,0,.3)}.card-header.jsx-fdb1a8e49ca28ed8 h3.jsx-fdb1a8e49ca28ed8{color:#f1f5f9;margin:0 0 16px 0;font-size:18px;font-weight:600}p.jsx-fdb1a8e49ca28ed8{color:#94a3b8;margin:8px 0}"})]});let B=e=>({Aries:"♈",Taurus:"♉",Gemini:"♊",Cancer:"♋",Leo:"♌",Virgo:"♍",Libra:"♎",Scorpio:"♏",Sagittarius:"♐",Capricorn:"♑",Aquarius:"♒",Pisces:"♓"})[e]||"●";return(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 wrap-up-card",children:[o&&(0,r.jsx)("button",{onClick:o,className:"jsx-dc45d79f15c9b6a9 close-button",children:"\xd7"}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 card-header",children:[(0,r.jsx)("h3",{className:"jsx-dc45d79f15c9b6a9",children:"\uD83C\uDFAD Actor / Role Reveal"}),(0,r.jsx)("p",{className:"jsx-dc45d79f15c9b6a9 subtitle",children:"Raven's diagnostic guess, derived from your resonance pattern"})]}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 composite-reveal",children:[(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 composite-name",children:["Unknown"!==c.actor&&(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 actor",children:c.actor}),("Unknown"!==c.actor||"Unknown"!==c.role)&&(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 separator",children:"/"}),"Unknown"!==c.role&&(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 role",children:c.role})]}),("Unknown"!==c.actor||"Unknown"!==c.role)&&(c.sampleSize||0)>0?(0,r.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 composite-title",children:c.composite}):(0,r.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 composite-title muted",children:"Not enough data for a composite"}),(c.sampleSize||0)>0&&(0,r.jsx)("div",{style:{background:"linear-gradient(90deg, ".concat("HIGH"===(i=c.confidenceBand)?"#22c55e":"MODERATE"===i?"#f59e0b":"#ef4444"," ").concat(Math.round(100*(c.confidence||0)),"%, rgba(255,255,255,0.1) ").concat(Math.round(100*(c.confidence||0)),"%)")},className:"jsx-dc45d79f15c9b6a9 confidence-bar",children:(0,r.jsxs)("span",{className:"jsx-dc45d79f15c9b6a9 confidence-text",children:[(c.confidenceBand||"LOW").toLowerCase()," confidence"]})})]}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 explanation",children:[(0,r.jsxs)("p",{className:"jsx-dc45d79f15c9b6a9",children:["This blend comes from what landed (✅) and how your clarifications shaped the misses (❌). Raven tests patterns; you’re the validator.",c.driftBand&&"NONE"!==c.driftBand&&(0,r.jsxs)(r.Fragment,{children:["POSSIBLE"===c.driftBand&&(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 sidereal-note",children:" Some ❌ clarifications leaned Driver-first (sidereal). Raven notes a sidereal lean; future mirrors will weight it lightly."}),"STRONG"===c.driftBand&&(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 sidereal-note",children:" Your clarifications strongly aligned with sidereal Drivers. Raven will prioritize Driver language while still showing Role for visibility."}),"number"==typeof c.driftIndex&&(0,r.jsxs)("span",{className:"jsx-dc45d79f15c9b6a9 di",children:[" (DI: ",Math.round(100*c.driftIndex),"% • n=",c.evidenceN,")"]})]})]}),(0,r.jsxs)("p",{style:{color:"#94a3b8",fontSize:12,marginTop:8},className:"jsx-dc45d79f15c9b6a9",children:["Method: weighted by what landed (WB) and probe clarifications on misses (OSR). Confidence: ",(c.confidenceBand||"LOW").toLowerCase(),".",c.tieBreak&&(0,r.jsxs)("span",{className:"jsx-dc45d79f15c9b6a9",children:[" Tie-break favored ",c.tieBreak," evidence."]})]})]}),!I&&(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-cta",children:[(0,r.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-cta-title",children:"Score this reflection?"}),(0,r.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-cta-body",children:"Optional. Your marks help Raven calibrate. These scores apply to this session only."}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-cta-actions",children:[(0,r.jsx)("button",{onClick:function(){w(!0),v(Date.now()),A("rubric_opened",{sessionId:g.getCurrentSessionId()})},className:"jsx-dc45d79f15c9b6a9 btn primary",children:"Open rubric"}),(0,r.jsx)("button",{onClick:function(){w(!1),v(null),A("rubric_skipped",{sessionId:g.getCurrentSessionId()})},className:"jsx-dc45d79f15c9b6a9 btn",children:"Skip"})]})]}),j&&(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric",children:[(0,r.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-title",children:"Reading Rubric"}),(0,r.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-micro",children:"Not sure on a slider? Leave it. Only what you mark counts."}),(0,r.jsx)(M,{label:"Pressure Mirror",helper:"How I respond under stress.",keyName:"pressure",className:"jsx-dc45d79f15c9b6a9"}),(0,r.jsx)(M,{label:"Outlet Type",helper:"What restores clarity or relief.",keyName:"outlet",className:"jsx-dc45d79f15c9b6a9"}),(0,r.jsx)(M,{label:"Internal Conflict",helper:"Recurring push–pull I recognize.",keyName:"conflict",className:"jsx-dc45d79f15c9b6a9"}),(0,r.jsx)(M,{label:"Emotional Tone",helper:"Feels personal, not generic.",keyName:"tone",className:"jsx-dc45d79f15c9b6a9"}),(0,r.jsx)(M,{label:"Surprise Signal",helper:"True angle I hadn’t named before.",keyName:"surprise",className:"jsx-dc45d79f15c9b6a9"}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-summary",children:[E>0&&(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-pending-note",children:[E," mirrors unscored. They don’t affect your result."]}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9",children:["Aggregate: ",(0,r.jsx)("b",{className:"jsx-dc45d79f15c9b6a9",children:P})," / 15 — ",F]}),(0,r.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-note",children:"These scores apply to this session only."}),Object.values(S).filter(Boolean).length>0&&(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-null-note",children:[Object.values(S).filter(Boolean).length," items marked off-base — these are important for calibration."]}),(0,r.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-footer-note",children:"Marking misses is useful. It tunes the map."})]}),!I&&(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-actions",children:[(0,r.jsx)("button",{onClick:function(){if(I){f("This reading is already sealed."),setTimeout(()=>f(null),2500);return}if(!function(){let e=Object.values(C).every(e=>0===e),t=Object.values(S).some(Boolean);return e&&!t}()||window.confirm("Submit with no scores? You can still seal the reading."))try{let e=g.getCurrentSessionId(),t=g.getPendingCount(!0);R(t);let a=y||Date.now(),r=Object.entries(S).filter(e=>{let[,t]=e;return t}).map(e=>{let[t]=e;return t});g.sealSession(e);let n=g.getCurrentSessionId();z(e),f("Reading sealed. New messages start a fresh reading."),setTimeout(()=>f(null),2500),A("rubric_submitted",{sessionId:e,scores:C,nulls:r,aggregate:P,timeToCompleteMs:Date.now()-a}),A("session_sealed",{sealedSessionId:e,nextSessionId:n}),null==l||l(e,n)}catch(e){A("rubric_submit_failed",{sessionId:g.getCurrentSessionId(),error:String(e)}),f("Couldn't save scores. Your reading isn't sealed. Try again?")}},className:"jsx-dc45d79f15c9b6a9 btn primary",children:"Submit rubric & close reading"}),(0,r.jsx)("button",{onClick:function(){w(!1),f("No scores saved. You can open the rubric again before we close."),setTimeout(()=>f(null),2500)},className:"jsx-dc45d79f15c9b6a9 btn",children:"Cancel"})]})]}),I&&(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-results",children:[(0,r.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-results-title",children:"Your marks"}),(0,r.jsx)("ul",{className:"jsx-dc45d79f15c9b6a9 rubric-results-list",children:[["Pressure Mirror","pressure"],["Outlet Type","outlet"],["Internal Conflict","conflict"],["Emotional Tone","tone"],["Surprise Signal","surprise"]].map(e=>{let[t,a]=e;return(0,r.jsxs)("li",{className:"jsx-dc45d79f15c9b6a9",children:[(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 label",children:t}),(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 value",children:C[a]}),S[a]&&(0,r.jsx)("span",{title:"Marked off-base",className:"jsx-dc45d79f15c9b6a9 flag",children:"⚑"})]},a)})}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-results-agg",children:[P," / 15 — ",F]}),(0,r.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-note",children:"These scores apply to this session only."})]}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 glyph-trace",children:[(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 glyph-item",children:[(0,r.jsxs)("span",{className:"jsx-dc45d79f15c9b6a9 glyph",children:["☉",B((null===(t=c.actorSigns)||void 0===t?void 0:t[0])||"Sagittarius")]}),(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 glyph-label",children:"Actor (sidereal)"})]}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 glyph-item",children:[(0,r.jsxs)("span",{className:"jsx-dc45d79f15c9b6a9 glyph",children:["☿",B((null===(a=c.roleSigns)||void 0===a?void 0:a[0])||"Scorpio")]}),(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 glyph-label",children:"Role (tropical)"})]})]}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 resonance-scorecard",children:[(0,r.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 scorecard-header",children:"Resonance Scorecard"}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 score-grid",children:[(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 score-item wb",children:[(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-icon",children:"✅"}),(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-label",children:"WB mirrors"}),(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-count",children:p.breakdown.yes})]}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 score-item abe",children:[(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-icon",children:"\uD83D\uDFE1"}),(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-label",children:"ABE mirrors"}),(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-count",children:p.breakdown.maybe})]}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 score-item osr",children:[(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-icon",children:"❌"}),(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-label",children:"OSR mirrors"}),(0,r.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-count",children:p.breakdown.no+p.breakdown.unclear})]})]}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 scorecard-footer",children:["WB ",p.breakdown.yes," \xb7 ABE ",p.breakdown.maybe," \xb7 OSR ",p.breakdown.no+p.breakdown.unclear,"number"==typeof p.breakdown.pending&&(0,r.jsxs)("span",{className:"jsx-dc45d79f15c9b6a9",children:[" \xb7 PENDING ",p.breakdown.pending]})]})]}),(0,r.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 closing-note",children:[(0,r.jsx)("p",{className:"jsx-dc45d79f15c9b6a9",children:(0,r.jsx)("em",{className:"jsx-dc45d79f15c9b6a9",children:"This is a mirror, not a label. It may shift as future sessions add more data. You are the validator."})}),I&&(0,r.jsx)("p",{className:"jsx-dc45d79f15c9b6a9 session-note",children:"This reading is sealed. New messages start a fresh reading container."})]}),(0,r.jsx)(h(),{id:"dc45d79f15c9b6a9",children:'.wrap-up-card.jsx-dc45d79f15c9b6a9{background:-webkit-linear-gradient(315deg,#1e293b 0%,#0f172a 100%);background:-moz-linear-gradient(315deg,#1e293b 0%,#0f172a 100%);background:-o-linear-gradient(315deg,#1e293b 0%,#0f172a 100%);background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);border:1px solid rgba(148,163,184,.2);-webkit-border-radius:12px;-moz-border-radius:12px;border-radius:12px;padding:24px;margin:16px 0;max-width:600px;position:relative;-webkit-box-shadow:0 8px 32px rgba(0,0,0,.3);-moz-box-shadow:0 8px 32px rgba(0,0,0,.3);box-shadow:0 8px 32px rgba(0,0,0,.3);font-family:"Inter",sans-serif}.close-button.jsx-dc45d79f15c9b6a9{position:absolute;top:12px;right:12px;background:none;border:none;color:#94a3b8;font-size:24px;cursor:pointer;padding:4px;line-height:1}.close-button.jsx-dc45d79f15c9b6a9:hover{color:#f1f5f9}.card-header.jsx-dc45d79f15c9b6a9 h3.jsx-dc45d79f15c9b6a9{color:#f1f5f9;margin:0 0 8px 0;font-size:20px;font-weight:600}.subtitle.jsx-dc45d79f15c9b6a9{color:#94a3b8;margin:0 0 20px 0;font-size:14px;font-style:italic}.composite-reveal.jsx-dc45d79f15c9b6a9{text-align:center;margin:24px 0;padding:20px;background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.2);-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px}.composite-name.jsx-dc45d79f15c9b6a9{font-size:24px;font-weight:700;margin-bottom:8px;color:#f1f5f9}.actor.jsx-dc45d79f15c9b6a9{color:#3b82f6}.separator.jsx-dc45d79f15c9b6a9{color:#64748b;margin:0 8px}.role.jsx-dc45d79f15c9b6a9{color:#10b981}.composite-title.jsx-dc45d79f15c9b6a9{font-size:18px;color:#e2e8f0;margin-bottom:16px;font-weight:500}.composite-title.muted.jsx-dc45d79f15c9b6a9{color:#94a3b8;font-style:italic}.confidence-bar.jsx-dc45d79f15c9b6a9{height:6px;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;position:relative;overflow:hidden}.confidence-text.jsx-dc45d79f15c9b6a9{position:absolute;top:-24px;right:0;font-size:12px;color:#94a3b8}.explanation.jsx-dc45d79f15c9b6a9{margin:24px 0;padding:16px;background:rgba(0,0,0,.3);-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;border-left:4px solid#3b82f6}.explanation.jsx-dc45d79f15c9b6a9 p.jsx-dc45d79f15c9b6a9{color:#e2e8f0;line-height:1.6;margin:0;font-size:14px}.sidereal-note.jsx-dc45d79f15c9b6a9{color:#f59e0b;font-weight:500}.di.jsx-dc45d79f15c9b6a9{color:#94a3b8;margin-left:6px}.glyph-trace.jsx-dc45d79f15c9b6a9{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center;gap:32px;margin:20px 0;padding:16px;background:rgba(0,0,0,.2);-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px}.glyph-item.jsx-dc45d79f15c9b6a9{text-align:center}.glyph.jsx-dc45d79f15c9b6a9{display:block;font-size:24px;color:#94a3b8;margin-bottom:4px}.glyph-label.jsx-dc45d79f15c9b6a9{font-size:11px;color:#64748b}.resonance-scorecard.jsx-dc45d79f15c9b6a9{margin:20px 0;padding:16px;background:rgba(0,0,0,.2);-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px}.scorecard-header.jsx-dc45d79f15c9b6a9{font-size:14px;font-weight:600;color:#f1f5f9;margin-bottom:12px;text-align:center}.score-grid.jsx-dc45d79f15c9b6a9{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:12px}.score-item.jsx-dc45d79f15c9b6a9{text-align:center;padding:8px;-webkit-border-radius:6px;-moz-border-radius:6px;border-radius:6px;background:rgba(255,255,255,.03)}.score-item.wb.jsx-dc45d79f15c9b6a9{border:1px solid rgba(34,197,94,.3)}.score-item.abe.jsx-dc45d79f15c9b6a9{border:1px solid rgba(245,158,11,.3)}.score-item.osr.jsx-dc45d79f15c9b6a9{border:1px solid rgba(239,68,68,.3)}.score-icon.jsx-dc45d79f15c9b6a9{display:block;font-size:16px;margin-bottom:4px}.score-label.jsx-dc45d79f15c9b6a9{display:block;font-size:11px;color:#94a3b8;margin-bottom:2px}.score-count.jsx-dc45d79f15c9b6a9{display:block;font-size:14px;font-weight:600;color:#f1f5f9}.scorecard-footer.jsx-dc45d79f15c9b6a9{font-size:11px;color:#64748b;text-align:center;font-style:italic}.closing-note.jsx-dc45d79f15c9b6a9{margin-top:20px;padding-top:16px;border-top:1px solid rgba(148,163,184,.2)}.closing-note.jsx-dc45d79f15c9b6a9 p.jsx-dc45d79f15c9b6a9{color:#94a3b8;font-size:13px;text-align:center;margin:0}.rubric-cta.jsx-dc45d79f15c9b6a9{margin:18px 0;text-align:center}.rubric-cta-title.jsx-dc45d79f15c9b6a9{color:#f1f5f9;font-weight:600;margin-bottom:4px}.rubric-cta-body.jsx-dc45d79f15c9b6a9{color:#e2e8f0;margin:0 0 10px 0;font-size:13px}.rubric-cta-actions.jsx-dc45d79f15c9b6a9{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;gap:8px;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center}.btn.jsx-dc45d79f15c9b6a9{background:rgba(255,255,255,.06);border:1px solid rgba(148,163,184,.3);color:#e2e8f0;padding:8px 12px;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;cursor:pointer}.btn.primary.jsx-dc45d79f15c9b6a9{background:#3b82f6;border-color:#2563eb}.rubric.jsx-dc45d79f15c9b6a9{margin:16px 0;padding:12px;background:rgba(0,0,0,.25);border:1px solid rgba(148,163,184,.2);-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px}.rubric-title.jsx-dc45d79f15c9b6a9{color:#f1f5f9;font-weight:600;text-align:center;margin-bottom:6px}.rubric-micro.jsx-dc45d79f15c9b6a9{color:#94a3b8;font-size:12px;text-align:center;margin-bottom:8px}.rubric-row.jsx-dc45d79f15c9b6a9{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;margin:8px 0}.rubric-label.jsx-dc45d79f15c9b6a9{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-ms-flex:1;flex:1;color:#e2e8f0;font-size:13px}.rubric-helper.jsx-dc45d79f15c9b6a9{color:#94a3b8;font-size:11px}.rubric-value.jsx-dc45d79f15c9b6a9{width:24px;text-align:right;color:#e2e8f0}.rubric-null.jsx-dc45d79f15c9b6a9{font-size:12px;color:#94a3b8}.rubric-summary.jsx-dc45d79f15c9b6a9{margin-top:10px;color:#e2e8f0;font-size:13px}.rubric-note.jsx-dc45d79f15c9b6a9{color:#94a3b8;font-size:12px}.rubric-null-note.jsx-dc45d79f15c9b6a9{color:#f59e0b;font-size:12px;margin-top:4px}.rubric-pending-note.jsx-dc45d79f15c9b6a9{color:#94a3b8;font-size:12px;margin-bottom:6px;font-style:italic}.rubric-actions.jsx-dc45d79f15c9b6a9{margin-top:12px;text-align:center}.rubric-results.jsx-dc45d79f15c9b6a9{margin:14px 0;padding:12px;background:rgba(0,0,0,.2);border:1px solid rgba(148,163,184,.2);-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px}.rubric-results-title.jsx-dc45d79f15c9b6a9{color:#f1f5f9;font-weight:600;margin-bottom:8px;text-align:center}.rubric-results-list.jsx-dc45d79f15c9b6a9{list-style:none;padding:0;margin:0 0 8px 0}.rubric-results-list.jsx-dc45d79f15c9b6a9 li.jsx-dc45d79f15c9b6a9{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-moz-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;padding:6px 8px;border-bottom:1px dashed rgba(148,163,184,.2)}.rubric-results-list.jsx-dc45d79f15c9b6a9 li.jsx-dc45d79f15c9b6a9:last-child{border-bottom:none}.rubric-results-list.jsx-dc45d79f15c9b6a9 .label.jsx-dc45d79f15c9b6a9{color:#e2e8f0;font-size:13px}.rubric-results-list.jsx-dc45d79f15c9b6a9 .value.jsx-dc45d79f15c9b6a9{color:#f1f5f9;font-weight:600}.rubric-results-list.jsx-dc45d79f15c9b6a9 .flag.jsx-dc45d79f15c9b6a9{margin-left:6px;color:#f59e0b}.rubric-results-agg.jsx-dc45d79f15c9b6a9{color:#e2e8f0;text-align:center;font-weight:600}.toast.jsx-dc45d79f15c9b6a9{position:absolute;top:8px;right:8px;background:#0b1220;border:1px solid rgba(148,163,184,.3);color:#e2e8f0;padding:8px 10px;-webkit-border-radius:8px;-moz-border-radius:8px;border-radius:8px;font-size:13px;-webkit-box-shadow:0 8px 24px rgba(0,0,0,.4);-moz-box-shadow:0 8px 24px rgba(0,0,0,.4);box-shadow:0 8px 24px rgba(0,0,0,.4)}'}),x&&(0,r.jsx)("div",{role:"status",className:"jsx-dc45d79f15c9b6a9 toast",children:x})]})};function D(e){let t,{data:a,onClose:i,onGenerateJournal:s,onStartNewReading:o}=e,[l,c]=(0,n.useState)(!1),[d,p]=(0,n.useState)(null),[u,b]=(0,n.useState)(!1),m=async()=>{if(s){b(!0);try{let e=await s();p(e),c(!0)}catch(e){console.error("Failed to generate journal:",e)}finally{b(!1)}}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-gradient-to-br from-white to-slate-50 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-[0_20px_70px_rgba(0,0,0,0.35)] border border-slate-200/70",children:[a.poemLine&&(0,r.jsxs)("div",{className:"relative bg-gradient-to-r from-indigo-600 via-violet-600 to-purple-600 text-white p-7 rounded-t-2xl",children:[(0,r.jsx)("div",{className:"absolute inset-0 opacity-30 bg-[radial-gradient(40%_60%_at_70%_0%,rgba(255,255,255,0.3),transparent)]"}),(0,r.jsxs)("div",{className:"relative text-center italic text-lg leading-relaxed",children:['"',a.poemLine,'"']})]}),(0,r.jsxs)("div",{className:"p-7 space-y-7",children:[a.bigVectors.length>0&&(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-[11px] uppercase tracking-[0.2em] text-slate-500 mb-3",children:"ACTOR / ROLE COMPOSITE"}),(0,r.jsx)("div",{className:"text-[28px] font-serif font-bold text-slate-800 mb-1",children:a.bigVectors[0].polarity}),(0,r.jsxs)("div",{className:"flex justify-center gap-3 text-2xl opacity-70",children:[(0,r.jsx)("span",{title:"Sidereal emphasis",children:"☽"}),(0,r.jsx)("span",{title:"Tropical emphasis",children:"☿"})]})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h3",{className:"text-[11px] uppercase tracking-[0.2em] text-slate-500 mb-3",children:"RESONANCE FIDELITY"}),(0,r.jsxs)("div",{className:"text-3xl font-bold text-slate-800 mb-1",children:[a.resonanceFidelity.percentage,"%—"]}),(0,r.jsx)("div",{className:"text-base text-slate-600 mb-4",children:a.resonanceFidelity.label}),(0,r.jsx)("div",{className:"flex justify-center gap-4 mb-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-green-600 text-xl",children:"✅"}),(0,r.jsx)("span",{className:"text-green-600 text-xl",children:"✅"}),(0,r.jsx)("span",{className:"text-red-600 text-xl",children:"❌"})]})})]}),(0,r.jsx)("div",{className:"bg-white rounded-xl p-5 border border-slate-200 shadow-sm",children:(0,r.jsx)("p",{className:"text-slate-700 leading-relaxed text-center",children:a.explanation})}),(0,r.jsxs)("div",{className:"border-t border-slate-200 pt-5",children:[(0,r.jsx)("h4",{className:"text-[11px] uppercase tracking-[0.2em] text-slate-500 mb-3 text-center",children:"BALANCE METER"}),(0,r.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-slate-200 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-2",children:[(0,r.jsx)("span",{title:"Magnitude ".concat(a.balanceMeterClimate.magnitude),children:(t=a.balanceMeterClimate.magnitude,"⚡".repeat(Math.min(t,5)))}),(0,r.jsx)("span",{title:"Valence: ".concat(a.balanceMeterClimate.valence),children:(e=>{switch(e){case"bright":return"\uD83C\uDF1E";case"drag":return"\uD83C\uDF11";default:return"\uD83C\uDF24️"}})(a.balanceMeterClimate.valence)}),(0,r.jsx)("span",{title:"Volatility: ".concat(a.balanceMeterClimate.volatility),children:(e=>{switch(e){case"chaotic":return"\uD83C\uDF00";case"mixed":return"\uD83D\uDD00";default:return"➡️"}})(a.balanceMeterClimate.volatility)})]}),(0,r.jsx)("p",{className:"text-slate-700 text-center text-[13px] leading-relaxed",children:a.balanceMeterClimate.narrative}),a.balanceMeterClimate.housePlacement&&(0,r.jsxs)("p",{className:"text-slate-500 text-center text-[11px] mt-2",children:["...felt in the ",a.balanceMeterClimate.housePlacement]})]})]}),(0,r.jsx)("div",{className:"text-center text-[11px] text-slate-500 border-t border-slate-200 pt-4 italic",children:"\"Here's what resonated, here's what didn't, here's what pattern Raven is tentatively guessing — but you remain the validator.\""}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)("button",{onClick:o,className:"flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-4 rounded-xl transition-colors shadow-sm",children:"Start New Reading"}),(0,r.jsx)("button",{onClick:m,disabled:u,className:"flex-1 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-300 text-white font-medium py-3 px-4 rounded-xl transition-colors flex items-center justify-center gap-2 shadow-sm",children:u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),"Generating..."]}):(0,r.jsx)(r.Fragment,{children:"\uD83D\uDCD6 Generate Journal"})}),(0,r.jsx)("button",{onClick:i,className:"px-4 py-3 border border-slate-300 text-slate-600 hover:text-slate-800 hover:border-slate-400 rounded-xl transition-colors",children:"Continue Session"})]})]}),l&&d&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-60",children:(0,r.jsxs)("div",{className:"bg-white rounded-2xl max-w-3xl w-full max-h-[80vh] overflow-hidden flex flex-col shadow-xl",children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-serif font-bold",children:d.title}),(0,r.jsx)("p",{className:"text-purple-100 text-sm mt-1",children:d.metadata.sessionDate})]}),(0,r.jsx)("button",{onClick:()=>c(!1),className:"text-white hover:text-purple-200 text-2xl font-bold",children:"\xd7"})]})}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,r.jsx)("div",{className:"prose prose-slate max-w-none",children:(0,r.jsx)("div",{className:"whitespace-pre-wrap text-slate-700 leading-relaxed",children:d.narrative})}),(0,r.jsxs)("div",{className:"mt-6 p-4 bg-slate-50 rounded-lg border",children:[(0,r.jsx)("h3",{className:"font-semibold text-slate-800 mb-3",children:"Session Details"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-slate-600",children:"Total Interactions:"}),(0,r.jsx)("span",{className:"ml-2 font-medium",children:d.metadata.totalInteractions})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-slate-600",children:"Resonance Fidelity:"}),(0,r.jsxs)("span",{className:"ml-2 font-medium",children:[d.metadata.resonanceFidelity,"%"]})]})]}),d.metadata.primaryPatterns.length>0&&(0,r.jsxs)("div",{className:"mt-3",children:[(0,r.jsx)("span",{className:"text-slate-600 text-sm",children:"Primary Patterns:"}),(0,r.jsx)("div",{className:"mt-1",children:d.metadata.primaryPatterns.map((e,t)=>(0,r.jsx)("span",{className:"inline-block bg-white px-2 py-1 rounded text-xs text-slate-700 mr-2 mb-1 border",children:e},t))})]})]})]}),(0,r.jsxs)("div",{className:"bg-slate-50 px-6 py-4 border-t flex justify-end gap-3",children:[(0,r.jsx)("button",{onClick:()=>c(!1),className:"px-4 py-2 text-slate-600 hover:text-slate-800 transition-colors",children:"Close"}),(0,r.jsx)("button",{onClick:()=>{if(!d)return;let e="".concat(d.title,"\n\n").concat(d.narrative,"\n\n---\nSession Details:\nDate: ").concat(d.metadata.sessionDate,"\nTotal Interactions: ").concat(d.metadata.totalInteractions,"\nResonance Fidelity: ").concat(d.metadata.resonanceFidelity,"%\nPrimary Patterns: ").concat(d.metadata.primaryPatterns.join(", "));navigator.clipboard.writeText(e).then(()=>{alert("Journal entry copied to clipboard!")})},className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-xl transition-colors",children:"\uD83D\uDCCB Copy to Clipboard"})]})]})})]})})}class S{generateFollowUp(e,t){switch(e.type){case"AFFIRM":return this.generateZoomIn(e,t);case"OSR":return this.generateOSRProbe(e,t);case"UNCLEAR":return this.generateClarification(e,t);default:return this.generateGenericFollowUp()}}generateZoomIn(e,t){let a=["Which line carried the weight for you — and how does it show up in your day?","What part of that landed — and how do you feel it when it's live in your field?","Which piece resonated — and how do you act when that pattern is active?","What line hit — and where do you notice that pressure in your daily life?","Which part felt true — and how does it move through you when it's present?"];return{stage:"ZOOM_IN",question:a[Math.floor(Math.random()*a.length)],purpose:"Isolate specific pressure and gather behavioral context",expectedResponse:"WB"}}generateOSRProbe(e,t){let a=["That one missed. Was it more the opposite, the wrong flavor, or just not in your field at all?","Didn't land. Was it backwards, off-tone, or simply not you?","That felt off. More like the inverse, wrong style, or completely outside your range?","Missed the mark. Was it flipped around, wrong energy, or not in your territory?","That didn't fit. Was it contrary, mismatched tone, or just not your pattern?"];return{stage:"OSR_PROBE",question:a[Math.floor(Math.random()*a.length)],purpose:"Convert OSR miss into diagnostic data for Actor/Role weighting",expectedResponse:"CLARIFICATION"}}generateClarification(e,t){let a=["Help me understand — what felt unclear about that reflection?","What part felt muddy or hard to pin down?","Where did that lose you — the description or how it applies?","What made that feel uncertain for you?"];return{stage:"CLASSIFICATION",question:a[Math.floor(Math.random()*a.length)],purpose:"Gather more context to properly classify the response",expectedResponse:"WB"}}generateGenericFollowUp(){return{stage:"CLASSIFICATION",question:"How does that land with you?",purpose:"General resonance check",expectedResponse:"WB"}}classifyResponse(e,t){let a=e.toLowerCase();if("OSR_PROBE"===t){let e="not-in-field";return a.includes("opposite")||a.includes("backwards")||a.includes("flipped")||a.includes("inverse")?e="opposite":(a.includes("flavor")||a.includes("tone")||a.includes("style")||a.includes("energy"))&&(e="wrong-flavor"),{classification:"OSR",weight:0,targetWeighting:"actor",probeType:e}}if("ZOOM_IN"===t){let t=["when i","i tend to","i usually","i feel","i notice","shows up as","happens when","looks like","feels like"].some(e=>a.includes(e));return t&&e.length>50?{classification:"WB",weight:1,targetWeighting:"both"}:t?{classification:"ABE",weight:.5,targetWeighting:"role"}:{classification:"OSR",weight:0,targetWeighting:"actor"}}return a.includes("yes")||a.includes("exactly")||a.includes("that's me")?{classification:"WB",weight:1,targetWeighting:"both"}:a.includes("somewhat")||a.includes("partially")||a.includes("kind of")?{classification:"ABE",weight:.5,targetWeighting:"role"}:{classification:"OSR",weight:0,targetWeighting:"actor"}}updateSessionContext(e,t,a){let r={...e};switch(a.classification){case"WB":r.wbHits.push({content:t});break;case"ABE":r.abeHits.push({content:t,tone:"off-tone"});break;case"OSR":r.osrMisses.push({content:t,probeType:a.probeType})}switch(a.targetWeighting){case"actor":r.actorWeighting+=a.weight;break;case"role":r.roleWeighting+=a.weight;break;case"both":r.actorWeighting+=.6*a.weight,r.roleWeighting+=.4*a.weight}let n=r.actorWeighting+r.roleWeighting;return r.driftIndex=n>0?r.actorWeighting/n:0,r}generateWrapUpCard(e){let t=this.calculateResonanceFidelity(e);return{hookStack:[],resonantLines:e.wbHits.map(e=>e.content),scoreStrip:{wb:e.wbHits.length,abe:e.abeHits.length,osr:e.osrMisses.length},resonanceFidelity:t,actorRoleComposite:e.currentComposite,driftFlag:e.driftIndex>.6,climateRibbon:void 0}}calculateResonanceFidelity(e){let t,a;let r=e.wbHits.length,n=e.abeHits.length,i=r+n+e.osrMisses.length;if(0===i)return{percentage:0,band:"LOW",label:"No Responses Yet"};let s=Math.round((r+.5*n)/i*100);return s>70?(t="HIGH",a="High Alignment"):s>=40?(t="MIXED",a="Mixed Resonance"):(t="LOW",a="Low Alignment"),{percentage:s,band:t,label:a}}generateSessionClosure(){return{resetPrompt:"Are you going to upload a new report or are we to speak of something else in your pattern?",continuationOptions:["Upload new report","Explore another area","Generate poetic card","Review session patterns"]}}generatePoeticCard(e){var t;return{title:"Resonance Pattern Card",resonantLine:(null===(t=e.wbHits[0])||void 0===t?void 0:t.content)||"No clear resonance yet",scoreIndicator:"✅ ".concat(e.wbHits.length," WB / \uD83D\uDFE1 ").concat(e.abeHits.length," ABE / ❌ ").concat(e.osrMisses.length," OSR"),resonanceFidelity:this.calculateResonanceFidelity(e),compositeGuess:e.currentComposite||"Pattern emerging...",driftFlag:e.driftIndex>.6?"\uD83C\uDF00 Sidereal drift detected":void 0}}generateJournalSummary(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"the user",a=this.calculateResonanceFidelity(e),r=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),n=e.wbHits.slice(0,3).map(e=>this.extractKeyPhrase(e.content)).filter(e=>e.length>0),i=this.generateNarrativeSummary(e,t,a);return{title:"Raven Reading Session - ".concat(t),narrative:i,metadata:{sessionDate:r,totalInteractions:e.wbHits.length+e.abeHits.length+e.osrMisses.length,resonanceFidelity:a.percentage,primaryPatterns:n}}}extractKeyPhrase(e){var t;let a=e.split(/[.!?]+/).filter(e=>e.trim().length>0),r=["when i","i tend to","i usually","i feel","shows up as"];for(let e of a){let t=e.toLowerCase().trim();if(r.some(e=>t.includes(e))&&e.length<100)return e.trim()}return(null===(t=a[0])||void 0===t?void 0:t.trim())||e.substring(0,50)+"..."}generateNarrativeSummary(e,t,a){let r=e.wbHits.length+e.abeHits.length+e.osrMisses.length;if(0===r)return"".concat(t," began a session with Raven but had not yet explored any patterns deeply enough for resonance tracking.");let n="On this session, ".concat(t," sat with Raven to explore the patterns written in their chart. ");if("HIGH"===a.band?n+="The conversation flowed with remarkable alignment—Raven's mirrors consistently landed true, with ".concat(t," recognizing themselves clearly in ").concat(a.percentage,"% of the reflections offered. "):"MIXED"===a.band?n+="The dialogue wove between recognition and clarification, with ".concat(t," finding ").concat(a.percentage,"% resonance as they and Raven navigated the more complex territories of their pattern. "):n+="This session required careful excavation, with only ".concat(a.percentage,"% initial resonance as ").concat(t," and Raven worked together to find the precise language for their inner architecture. "),e.wbHits.length>0){n+="What rang most true were insights around ";let t=e.wbHits.slice(0,2).map(e=>this.extractKeyPhrase(e.content));1===t.length?n+="".concat(t[0].toLowerCase(),". "):n+="".concat(t.slice(0,-1).join(", ").toLowerCase(),", and ").concat(t[t.length-1].toLowerCase(),". ")}return e.driftIndex>.6&&(n+="Throughout the exchange, Raven detected signs that ".concat(t,"'s core drives might operate from a different seasonal rhythm than their outward presentation suggests—a pattern sometimes called sidereal drift. ")),e.osrMisses.length>0&&e.osrMisses.length/r>.3&&(n+="Several of Raven's initial offerings missed the mark entirely, requiring gentle probing to understand whether the patterns were inverted, off-tone, or simply outside ".concat(t,"'s field altogether. ")),e.currentComposite?n+="By session's end, the tentative pattern emerging was \"".concat(e.currentComposite,'"—though ').concat(t,", as always, remained the final validator of what felt true."):n+="The session concluded with patterns still crystallizing, leaving space for ".concat(t," to continue the exploration when ready."),n}}let N=new S,I=e=>e.replace(/[&<>]/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;"})[e]||e),z=["Did any of this feel true?","Does this fit your experience today?","Did this land at all?","Anything here feel off?"],E=0,R=0;function T(e){if(!e)return"";let t=e;if(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\{I've received.*?\}[\s\S]*?(?=\n\n|$)/gi,"")).replace(/The Balance Meter shows.*?(?=\n|$)/gi,"")).replace(/.*magnitude.*?valence.*?volatility.*?(?=\n|$)/gi,"")).replace(/.*glyphs are.*?(?=\n|$)/gi,"")).replace(/.*report already contains.*?(?=\n|$)/gi,"")).replace(/^\s*\*\*Symbolic Weather Header:\*\*.*?(?=\n|$)/gmi,"")).replace(/(##\s*SST[_\s-]*Clause[\s\S]*?$)|(^.*SST[_\s-]*Prompt.*$)|(^.*Resonance[_\s-]*Rule.*$)|(^.*Conditional[_\s-]*Language.*$)/gim,"")).replace(/\bSST\b/g,"").replace(/\bWB\s*\/\s*ABE\s*\/\s*OSR\b/gi,"").replace(/\b(magnitude|valence)\s*[-:]?\s*\d+\.?\d*/gi,"").replace(/\[[^\]]*operator[^\]]*\]/gi,"").replace(/\[Operator.*?\]/gi,"").replace(/[\u260d\u2642\u263d\u26a1\ud83c\udf11\ud83c\udf1e]\s*and\s*[\u260d\u2642\u263d\u26a1\ud83c\udf11\ud83c\udf1e]/g,"").replace(/The glyphs are [^.]*\./gi,""),/Outside\s+Symbolic\s+Range\b/i.test(e)||/\bOSR\b/.test(e)){let e="If none of this felt familiar, treat it as valid null data—your experience sets the boundary.";t.trim().endsWith(e)||(t=t.trim()+(/[.!?]$/.test(t.trim())?" ":". ")+e),t=t.replace(/\bOSR\b/g,"null data")}return(t=(t=t.replace(/Did this land\?\s*Mark\.?/gi,"Does any of this feel familiar?")).replace(/Mark\s*(WB|ABE|OSR)\.?/gi,"")).replace(/\s{2,}/g," ").replace(/^\s*[-*]\s*$/gm,"").trim()}function P(e){return!F(e)&&[/does any of this feel familiar/i,/did this land/i,/does this fit your experience/i,/feel true to you/i,/resonate with you/i,/ring true/i,/sound right/i,/feel accurate/i].some(t=>t.test(e))}function F(e){return[/does this repair feel true/i,/is this a more accurate description/i,/is that a more accurate description/i,/does this feel more accurate/i,/is this closer to your experience/i,/does this better capture/i,/probe missed.*describing/i,/that missed.*you're actually/i,/i'm logging that probe as osr/i].some(t=>t.test(e))}function M(e){return F(e)?"repair":/hook stack|paradox.*tags|rock.*spark/i.test(e)?"hook":/hidden push|counterweight|vector signature/i.test(e)?"vector":/mars.*saturn|personal.*outer|hard aspect/i.test(e)?"aspect":"general"}function A(e){let{onClose:t}=e;return(0,r.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:(0,r.jsxs)("div",{style:{background:"#181c24",borderRadius:12,padding:"32px 28px",boxShadow:"0 8px 32px #0008",maxWidth:420,width:"100%",position:"relative",color:"#e0e6f0"},children:[(0,r.jsx)("button",{onClick:t,style:{position:"absolute",top:12,right:12,background:"none",border:"none",color:"#94a3b8",fontSize:24,cursor:"pointer"},children:"\xd7"}),(0,r.jsx)("h2",{style:{marginTop:0,fontSize:20,color:"#f1f5f9"},children:"Help & Button Guide"}),(0,r.jsxs)("ul",{style:{fontSize:15,lineHeight:1.7,paddingLeft:0,listStyle:"none"},children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("b",{children:"\uD83E\uDE9E Mirror"}),": Upload a Mirror report (personal reflection data) for analysis."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("b",{children:"\uD83C\uDF21️ Balance"}),": Upload a Balance Meter report (energetic state snapshot)."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("b",{children:"\uD83D\uDCD4 Journal"}),": Upload a Journal entry (narrative or notes for context)."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("b",{children:"\uD83C\uDFAD Poetic"}),": Generate a poetic interpretation of your Mirror data (unlocked after uploading a Mirror)."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("b",{children:"\uD83C\uDFB4 Card"}),": Create a visual Poetic Index Card from your Mirror data (unlocked after uploading a Mirror)."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("b",{children:"\uD83C\uDFB4 Demo"}),": Preview a sample Poetic Index Card (no data required)."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("b",{children:"\uD83C\uDFAD Reveal"}),": Generate your Actor/Role composite from session feedback (shows after enough pings)."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("b",{children:"ℹ️ About"}),": Learn about Raven Calder and the project’s philosophy."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("b",{children:"❓ Help"}),": Show this help dialog."]})]}),(0,r.jsxs)("div",{style:{fontSize:13,color:"#94a3b8",marginTop:16},children:[(0,r.jsx)("b",{children:"Tip:"})," Hover on any button for a tooltip. For best results, give feedback on several mirrors before using ",(0,r.jsx)("b",{children:"Reveal"}),"."]})]})})}function B(){let[e,t]=(0,n.useState)(!1),[i,o]=(0,n.useState)([{id:"init",role:"raven",html:"I’m a clean mirror. I put what you share next to the pattern I see and speak it back in plain language. No fate talk, no certainty—just useful reflections you can test.",climate:function(e){let t=0,a=1,r=0;if(e){let n=e.toLowerCase();/(crisis|break|fail|crash|end|stuck|impossible|collapse|destroy|catastrophe)/i.test(n)?t=-5:/(difficult|struggle|resist|fight|hard|burden|exhaust|grind|strain|wear)/i.test(n)?t=-4:/(conflict|disagree|argue|oppose|clash|tension|friction|dispute|against)/i.test(n)?t=-3:/(narrow|limit|reduce|shrink|constrain|block|contract|restrict|close)/i.test(n)?t=-2:/(slow|delay|hesitate|doubt|unclear|minor|slight|drag|hinder|small)/i.test(n)?t=-1:/(breakthrough|freedom|achieve|transform|unlimited|liberate|soar|transcend)/i.test(n)?t=5:/(growth|opportunity|develop|advance|expand|progress|flourish|thrive)/i.test(n)?t=4:/(balance|align|connect|unite|coherent|synergy|harmony|integrate|blend)/i.test(n)?t=3:/(smooth|adapt|flexible|easy|natural|fluid|flow|graceful|effortless)/i.test(n)?t=2:/(begin|start|improve|hope|gentle|positive|lift|rise|encourage)/i.test(n)&&(t=1),/(major|significant|huge|massive|complete|total|full)/i.test(n)?a=5:/(strong|important|serious|considerable|notable)/i.test(n)?a=4:/(moderate|medium|some|partial|decent)/i.test(n)?a=3:/(small|minor|little|slight|modest)/i.test(n)&&(a=2),/(chaos|random|wild|unpredictable|turbulent|erratic)/i.test(n)?r=5:/(changing|shifting|variable|dynamic|fluctuating)/i.test(n)?r=3:/(stable|steady|consistent|predictable|calm)/i.test(n)&&(r=0),a=Math.max(0,Math.min(5,a)),r=Math.max(0,Math.min(5,r)),t=Math.max(-5,Math.min(5,t))}return function(e,t){let a=function(e,t){let a=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let{magnitude:t,valence:a}=e,r=l(a);if(0===r.level)return[{emoji:"⚖️",label:r.anchor,score:1,type:"valence"}];let n=1;return t<=2?n=Math.min(2,r.emojis.length):t>=3&&(n=Math.min(3,r.emojis.length)),[...r.emojis].sort(()=>Math.random()-.5).slice(0,n).map(e=>({emoji:e,label:r.anchor,score:1,type:"valence"}))}(e,t),r=l(e.valence);if(0===a.length)return"⚡ ".concat(e.magnitude," \xb7 ⚖️ Neutral");let n=a.map(e=>e.emoji).join("");return"⚡ ".concat(e.magnitude," \xb7 ").concat(n," ").concat(r.anchor)}(e,void 0),r=["➿","\uD83D\uDD04","\uD83D\uDD00","\uD83E\uDDE9","\uD83C\uDF00"][Math.min(Math.floor(e.volatility),4)]||"➿";return"".concat(a," \xb7 ").concat(r," ").concat(e.volatility)}({magnitude:a,valence:t,volatility:r})}("supportive clear mirror"),hook:"Atmosphere \xb7 Creator ∠ Mirror"}]),[c,d]=(0,n.useState)(""),[m,h]=(0,n.useState)(!1),x=(0,n.useRef)(null),f=(0,n.useRef)(null),y=(0,n.useRef)(null),v=(0,n.useRef)(0),[j,w]=(0,n.useState)(null),[k,S]=(0,n.useState)(!1),[F,B]=(0,n.useState)(!1),H=(0,n.useRef)(null),[G,_]=(0,n.useState)(null),[U,V]=(0,n.useState)([]),[q,$]=(0,n.useState)(!1),[Q,X]=(0,n.useState)(!1),[ee,et]=(0,n.useState)(!1),[ea,er]=(0,n.useState)(!1),[en,ei]=(0,n.useState)([]),[es,eo]=(0,n.useState)(()=>({sessionStart:Date.now(),actorProfile:null,wbHits:[],abeHits:[],osrMisses:[],actorWeighting:0,roleWeighting:0,driftIndex:0,currentComposite:void 0,sessionActive:!0})),[el,ec]=(0,n.useState)(0);(0,n.useEffect)(()=>{let e=sessionStorage.getItem("woven_report_for_raven");if(e)try{var t,a,r,n,i,l,c,p,u,b,m,h;let x=JSON.parse(e);sessionStorage.removeItem("woven_report_for_raven");let f={id:s(),role:"user",html:"Hi Raven! I've generated a chart analysis and would love your interpretation. Here's my information: ".concat((null===(a=x.meta)||void 0===a?void 0:null===(t=a.person)||void 0===t?void 0:t.name)||"Name not provided",", born ").concat((null===(n=x.meta)||void 0===n?void 0:null===(r=n.person)||void 0===r?void 0:r.birthDate)||"unknown date"," at ").concat((null===(l=x.meta)||void 0===l?void 0:null===(i=l.person)||void 0===i?void 0:i.birthTime)||"unknown time"," in ").concat((null===(p=x.meta)||void 0===p?void 0:null===(c=p.person)||void 0===c?void 0:c.birthLocation)||"unknown location",". Context: ").concat((null===(u=x.meta)||void 0===u?void 0:u.context)||"general reading","."),isReport:!0,reportType:"mirror",reportName:"Chart Analysis - ".concat((null===(m=x.meta)||void 0===m?void 0:null===(b=m.person)||void 0===b?void 0:b.name)||"Unknown"),reportSummary:"Math Brain report from ".concat((null===(h=x.meta)||void 0===h?void 0:h.timestamp)?new Date(x.meta.timestamp).toLocaleDateString():"today"),fullContent:JSON.stringify(x.reportData,null,2)};o(e=>[...e,f]),setTimeout(()=>{d("Please provide your interpretation of this chart data. I'm particularly interested in understanding the key patterns and what they might reveal about my current life dynamics."),setTimeout(()=>{var e;let t=new Event("submit",{bubbles:!0,cancelable:!0});null===(e=document.querySelector("form"))||void 0===e||e.dispatchEvent(t)},1e3)},500)}catch(e){console.error("Failed to parse report data from sessionStorage:",e)}},[]);let ed=e=>e.replace(/<[^>]*>/g," ").replace(/\s{2,}/g," ").trim(),ep=e=>{var t;return((null===(t=e.match(/[^.!?]+[.!?]?/))||void 0===t?void 0:t[0])||e).trim()},eu=async()=>{var e;let t=(null===(e=i.filter(e=>"user"===e.role&&!e.isReport)[0])||void 0===e?void 0:e.html)||"",a=t.match(/my name is (\w+)/i)||t.match(/i'm (\w+)/i)||t.match(/i am (\w+)/i),r=a?a[1]:"the user",n=await N.generateJournalSummary(es,r),s=i.slice(-12),o=s.filter(e=>"user"===e.role&&!e.isReport).map(e=>ed(e.html)).filter(Boolean),l=s.filter(e=>"raven"===e.role).map(e=>ed(e.html)).filter(Boolean),c=l[0]?ep(l[0]):"",d=o.length>0?"They brought ".concat(1===o.length?"one note":o.length+" notes",' of focus, including: "').concat(ep(o[0]),'"'):"",p=l.length>1?'Raven mirrored with lines like: "'.concat(ep(l[1]),'"'):"",u=l[l.length-1]?'We closed on: "'.concat(ep(l[l.length-1]),'"'):"",b=[c&&"Opening read: ".concat(c),d,p,u].filter(Boolean).join(" \n\n"),m=b?"Conversation Thread (Paraphrase)\n\n".concat(b):"";return m&&(n.narrative="".concat(n.narrative,"\n\n---\n").concat(m).trim()),n};(0,n.useEffect)(()=>{i.forEach(e=>{"raven"===e.role&&P(e.html)&&!g.getFeedback(e.id)&&g.registerPending(e.id,M(e.html),e.html)})},[i]);let eb=i.filter(e=>"raven"===e.role);(0,n.useEffect)(()=>{let e=i[i.length-1];if(e&&"raven"===e.role){let t=eb.findIndex(t=>t.id===e.id);-1!==t&&ec(t)}},[i,eb.length]);let em=e=>{let t=H.current;if(t){let a=e.offsetTop-120;t.scrollTo({top:a<0?0:a,behavior:"smooth"})}else e.scrollIntoView({behavior:"smooth",block:"start"})},eh=()=>{var e;null===(e=f.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),B(!1)};async function ex(e){if(m)return;h(!0);let t=new AbortController;x.current=t;let a=s();o(e=>[...e,{id:a,role:"raven",html:"",climate:"",hook:""}]);try{let r,n;let s=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...i.slice(-5),{role:"user",content:e.content}],reportContexts:U.map(e=>({id:e.id,type:e.type,name:e.name,summary:e.summary,content:e.content}))}),signal:t.signal});if(!s.body)throw Error("No stream");let o=s.body.getReader(),l=new TextDecoder,c="";for(;;){let{done:e,value:t}=await o.read();if(e){ek(a,c,r,n,!0);break}for(let e of l.decode(t,{stream:!0}).split("\n").filter(Boolean))try{let t=JSON.parse(e);t.delta&&(c+=t.delta,r=t.climate||r,n=t.hook||n,ek(a,c,r,n,!1))}catch(e){}}}catch(e){"AbortError"!==e.name&&ek(a,"<i>Analysis error. Try again.</i>",void 0,void 0)}finally{h(!1),x.current=null}}async function ef(e){if(!e.trim())return;if(x.current)try{x.current.abort()}catch(e){}let t={id:s(),role:"user",html:I(e)};o(e=>[...e,t]),h(!0);let a=new AbortController;x.current=a;let r=s();o(e=>[...e,{id:r,role:"raven",html:"",climate:"",hook:""}]);try{let t=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...i,{role:"user",content:e}]}),signal:a.signal});if(!t.ok)throw Error("HTTP ".concat(t.status));if(!t.body)throw Error("No response body");let n=t.body.getReader(),s=new TextDecoder,l="";for(;;){let{done:e,value:t}=await n.read();if(e)break;let a=(l+=s.decode(t,{stream:!0})).split("\n");for(let e of(l=a.pop()||"",a))if(e.trim())try{let t=JSON.parse(e);o(e=>e.map(e=>e.id===r?{...e,html:e.html+(t.delta||""),climate:t.climate||e.climate,hook:t.hook||e.hook}:e))}catch(e){console.warn("Failed to parse streaming chunk:",e)}}}catch(e){"AbortError"!==e.name&&(console.error("Stream error:",e),o(e=>e.map(e=>e.id===r?{...e,html:"Error: Failed to get response from Raven."}:e)))}finally{h(!1),x.current=null}}async function eg(){let e=c.trim();if(!e)return;if(ea){let t=e.toLowerCase().replace(/<[^>]*>/g,""),a=(()=>{let a=t.split(/\s+/).filter(Boolean),r=0,n=new Set(en);for(let e of a)if(n.has(e)&&++r>=2)break;return r>=2||/(same|continue|resume|again|back to|still on|pick up|that topic|previous)/i.test(e)})()?"We can open a fresh reading on the same thread—say the word and I’ll start a new mirror.":"Got it—starting a new reading for this.",r=s();o(e=>[...e,{id:r,role:"raven",html:a,climate:"",hook:""}]),er(!1)}if(x.current)try{x.current.abort()}catch(e){}let t={id:s(),role:"user",html:I(e)};o(e=>[...e,t]),d(""),h(!0);let a=new AbortController;x.current=a;let r=s();o(e=>[...e,{id:r,role:"raven",html:"",climate:"",hook:""}]);try{let t,n;let s=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[...i,{role:"user",content:e}],reportContexts:U.map(e=>({id:e.id,type:e.type,name:e.name,summary:e.summary,content:e.content}))}),signal:a.signal});if(!s.body)throw Error("No stream");let o=s.body.getReader(),l=new TextDecoder,c="";for(;;){let{value:e,done:a}=await o.read();if(a){ek(r,c,t,n,!0);break}for(let a of l.decode(e,{stream:!0}).split(/\n+/).filter(Boolean))try{let e=JSON.parse(a);e.delta&&(c+=e.delta,t=e.climate||t,n=e.hook||n,ek(r,c,t,n,!1))}catch(e){}}}catch(e){"AbortError"!==e.name&&ek(r,"<i>Stream error. Try again.</i>",void 0,void 0)}finally{h(!1),x.current=null}}(0,n.useEffect)(()=>{if(!m){var e;if(1===i.length&&(null===(e=i[0])||void 0===e?void 0:e.id)==="init")return;let t=i[i.length-1];if((null==t?void 0:t.role)==="raven"){let e=document.getElementById("message-".concat(t.id));e&&em(e)}}},[m,i]),(0,n.useEffect)(()=>{let e=i[i.length-1];if((null==e?void 0:e.role)==="user"){var t;null===(t=f.current)||void 0===t||t.scrollIntoView({behavior:"smooth"})}},[i.length]),(0,n.useEffect)(()=>{let e=i[i.length-1];(null==e?void 0:e.role)==="raven"&&""===e.html&&setTimeout(()=>{let t=document.getElementById("message-".concat(e.id));t&&em(t)},100)},[i.length]),(0,n.useEffect)(()=>{if(!H.current)return;let e=H.current,t=()=>{m&&B(e.scrollTop+e.clientHeight<e.scrollHeight-200)};return e.addEventListener("scroll",t),m||B(!1),()=>e.removeEventListener("scroll",t)},[m]);let ey=e=>{let t=e;if(!t){let e=i.filter(e=>"raven"===e.role).pop();if(e){let a=function(e){try{let t=e.split("\n"),a=[],r="Untitled",n="",i="moon";for(let e=0;e<t.length;e++){let s=t[e].trim();if((s.includes("Title:")||s.startsWith("# "))&&(r=s.replace(/^(Title:|#)\s*/,"").trim()),s.includes("**1. Poem")||s.includes("### Poem"))for(let r=e+1;r<t.length;r++){let e=t[r].trim();if(""===e||e.includes("**2.")||e.includes("###"))break;!(e.length>0)||e.includes("*")||e.includes("#")||a.push(e)}s.includes("?")&&s.length>20&&s.length<150&&(n=s);let o=s.match(/(mars|venus|mercury|moon|neptune|saturn|chiron|jupiter|uranus|pluto|sun)/i);o&&(i=o[1].toLowerCase())}if(0===a.length)return null;return{title:r,poeticPhrase:"A reflection in symbolic weather",poem:a.slice(0,6),mirrorPrompt:n||"What does this reveal about your current path?",blockTimeNote:"echoes may land past, present, or future",dominantPlanet:i,colorTheme:i,talismancGlyph:b(i),date:new Date().toISOString().slice(0,10),astroGlyphs:[b(i)],talismancSketch:"*",symbolDrivers:["\uD83D\uDFE2"]}}catch(e){return console.error("Error parsing card data:",e),null}}(ed(e.html));a&&(t=a)}}t||(t={title:"The Current Beneath Still Waters",poeticPhrase:"where depth moves unseen",poem:["You carry the ocean in small gestures,","a tide that others feel but cannot name.","What looks like stillness","is actually patience,","the kind that reshapes shores","one grain at a time."],mirrorPrompt:"Where does your quiet power move most freely?",blockTimeNote:"echoes may land past, present, or future",dominantPlanet:"moon",colorTheme:"moon",talismancGlyph:"☽",astroGlyphs:["☽","♆","♀"],transitKey:"MOON-NEPTUNE CONJUNCTION: Intuitive flow through emotional depths",talismancSketch:"~",symbolDrivers:["\uD83D\uDD35","⚪","\uD83D\uDFE2"],date:new Date().toISOString().slice(0,10)});let a=function(e){let t=p[e.dominantPlanet]||p.moon,a=u[e.dominantPlanet]||"✦";return'\n<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Poetic Index Card - '.concat(e.title,"</title>\n    <style>\n        @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500&display=swap');\n        \n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            background: #f0f0f0;\n            padding: 40px;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            min-height: 100vh;\n            font-family: 'Inter', sans-serif;\n        }\n        \n        .card {\n            width: 400px;\n            height: 600px;\n            background: ").concat(t.background,";\n            border-radius: 12px;\n            padding: 40px;\n            display: flex;\n            flex-direction: column;\n            justify-content: space-between;\n            color: ").concat(t.textColor,";\n            position: relative;\n            box-shadow: 0 20px 40px rgba(0,0,0,0.3);\n            overflow: hidden;\n        }\n        \n        .corner-glyph {\n            position: absolute;\n            top: 20px;\n            right: 20px;\n            font-size: 18px;\n            opacity: 0.4;\n            font-family: serif;\n            z-index: 3;\n        }\n        \n        .side-glyphs {\n            position: absolute;\n            left: 15px;\n            top: 50%;\n            transform: translateY(-50%);\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n            font-size: 12px;\n            opacity: 0.3;\n            font-family: serif;\n            z-index: 2;\n        }\n        \n        .talisman-watermark {\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            font-size: 120px;\n            opacity: 0.08;\n            font-family: serif;\n            z-index: 1;\n            pointer-events: none;\n        }\n        \n        .top-zone {\n            text-align: center;\n            margin-bottom: 30px;\n            position: relative;\n            z-index: 4;\n        }\n        \n        .title {\n            font-family: 'Crimson Text', serif;\n            font-size: 22px;\n            font-weight: 600;\n            letter-spacing: 1px;\n            text-transform: uppercase;\n            margin-bottom: 12px;\n            line-height: 1.2;\n        }\n        \n        .poetic-phrase {\n            font-family: 'Crimson Text', serif;\n            font-size: 16px;\n            font-style: italic;\n            opacity: 0.9;\n            letter-spacing: 0.5px;\n        }\n        \n        .middle-zone {\n            flex: 1;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            text-align: center;\n            position: relative;\n            z-index: 4;\n        }\n        \n        .poem {\n            font-family: 'Crimson Text', serif;\n            font-size: 18px;\n            line-height: 1.8;\n            letter-spacing: 0.3px;\n        }\n        \n        .poem-line {\n            margin-bottom: 8px;\n        }\n        \n        .bottom-zone {\n            text-align: center;\n            margin-top: 30px;\n            position: relative;\n            z-index: 4;\n        }\n        \n        .mirror-prompt {\n            font-family: 'Crimson Text', serif;\n            font-size: 15px;\n            font-style: italic;\n            margin-bottom: 12px;\n            color: ").concat(t.accentColor,';\n            line-height: 1.4;\n        }\n        \n        .block-time-note {\n            font-family: \'Inter\', sans-serif;\n            font-size: 11px;\n            font-weight: 300;\n            opacity: 0.7;\n            letter-spacing: 0.5px;\n            margin-bottom: 16px;\n        }\n        \n        .transit-key {\n            font-family: \'Inter\', sans-serif;\n            font-size: 10px;\n            opacity: 0.6;\n            margin-bottom: 8px;\n            letter-spacing: 0.5px;\n        }\n        \n        .archive-identity {\n            font-family: \'Inter\', sans-serif;\n            font-size: 10px;\n            font-weight: 300;\n            opacity: 0.6;\n            letter-spacing: 1px;\n            text-transform: uppercase;\n        }\n        \n        .grain-texture {\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background-image: \n                radial-gradient(circle at 20% 80%, rgba(255,255,255,0.1) 0%, transparent 50%),\n                radial-gradient(circle at 80% 20%, rgba(255,255,255,0.05) 0%, transparent 50%);\n            border-radius: 12px;\n            pointer-events: none;\n            z-index: 1;\n        }\n\n        .download-controls {\n            position: fixed;\n            top: 20px;\n            left: 20px;\n            display: flex;\n            gap: 10px;\n            z-index: 1000;\n        }\n\n        .control-btn {\n            background: rgba(0,0,0,0.8);\n            color: white;\n            border: none;\n            padding: 8px 12px;\n            border-radius: 6px;\n            font-size: 12px;\n            cursor: pointer;\n            font-family: \'Inter\', sans-serif;\n        }\n\n        .control-btn:hover {\n            background: rgba(0,0,0,0.9);\n        }\n\n        @media print {\n            body { background: white; padding: 0; }\n            .download-controls { display: none; }\n        }\n    </style>\n</head>\n<body>\n    <div class="download-controls">\n        <button class="control-btn" onclick="downloadAsImage()">\uD83D\uDCE5 Download as Image</button>\n        <button class="control-btn" onclick="copyToClipboard()">\uD83D\uDCCB Copy to Clipboard</button>\n    </div>\n\n    <div class="card" id="poeticCard">\n        <div class="grain-texture"></div>\n        <div class="corner-glyph">').concat(a,'</div>\n        \n        <div class="side-glyphs">\n            ').concat(e.astroGlyphs.map(e=>"<div>".concat(e,"</div>")).join(""),'\n        </div>\n        \n        <div class="talisman-watermark">').concat(e.talismancSketch,'</div>\n        \n        <div class="top-zone">\n            <div class="title">').concat(e.title,'</div>\n            <div class="poetic-phrase">').concat(e.poeticPhrase,'</div>\n        </div>\n        \n        <div class="middle-zone">\n            <div class="poem">\n                ').concat(e.poem.map(e=>'<div class="poem-line">'.concat(e,"</div>")).join(""),'\n            </div>\n        </div>\n        \n        <div class="bottom-zone">\n            <div class="mirror-prompt">').concat(e.mirrorPrompt,'</div>\n            <div class="block-time-note">').concat(e.blockTimeNote,"</div>\n            ").concat(e.transitKey?'<div class="transit-key">'.concat(e.transitKey,"</div>"):"",'\n            <div class="archive-identity">Poetic Index \xb7 Raven Calder \xb7 ').concat(e.date,"</div>\n        </div>\n    </div>\n\n    <script src=\"https://html2canvas.hertzen.com/dist/html2canvas.min.js\"></script>\n    <script>\n        async function downloadAsImage() {\n            const card = document.getElementById('poeticCard');\n            const canvas = await html2canvas(card, {\n                backgroundColor: null,\n                scale: 2,\n                useCORS: true\n            });\n            \n            const link = document.createElement('a');\n            link.download = 'poetic-index-card-").concat(e.title.toLowerCase().replace(/[^a-z0-9]/g,"_"),"-").concat(e.date,".png';\n            link.href = canvas.toDataURL();\n            link.click();\n        }\n\n        async function copyToClipboard() {\n            const card = document.getElementById('poeticCard');\n            const canvas = await html2canvas(card, {\n                backgroundColor: null,\n                scale: 2,\n                useCORS: true\n            });\n            \n            canvas.toBlob(async (blob) => {\n                try {\n                    await navigator.clipboard.write([\n                        new ClipboardItem({ 'image/png': blob })\n                    ]);\n                    alert('Card copied to clipboard!');\n                } catch (err) {\n                    console.error('Failed to copy: ', err);\n                    alert('Copy failed. Try the download option instead.');\n                }\n            });\n        }\n    </script>\n</body>\n</html>")}(t),r=window.open("","_blank");r?(r.document.write(a),r.document.close()):ev(a)},ev=e=>{let t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0,0,0,0.8);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      z-index: 10000;\n    ";let a=document.createElement("div");a.style.cssText="\n      max-width: 90%;\n      max-height: 90%;\n      overflow: auto;\n      background: white;\n      border-radius: 12px;\n      position: relative;\n    ";let r=document.createElement("button");r.innerHTML="✕",r.style.cssText="\n      position: absolute;\n      top: 10px;\n      right: 10px;\n      background: rgba(0,0,0,0.8);\n      color: white;\n      border: none;\n      border-radius: 50%;\n      width: 30px;\n      height: 30px;\n      cursor: pointer;\n      z-index: 10001;\n      font-size: 16px;\n    ";let n=document.createElement("iframe");n.style.cssText="\n      width: 480px;\n      height: 680px;\n      border: none;\n      border-radius: 12px;\n    ",n.srcdoc=e,a.appendChild(r),a.appendChild(n),t.appendChild(a),document.body.appendChild(t);let i=()=>document.body.removeChild(t);r.onclick=i,t.onclick=e=>{e.target===t&&i()}},ej=()=>{ey({title:"Threshold Keeper",poeticPhrase:"where endings birth beginnings",poem:["At the edge of known territory","symbols scatter like leaves,","each one a door","that opens only once.","","What calls you forward","is already waiting inside—","the question dissolves","as you become the answer."],mirrorPrompt:"What threshold are you crossing that requires you to become someone new?",blockTimeNote:"SYMBOLIC WEATHER: Transition patterns indicating boundary dissolution",date:new Date().toLocaleDateString(),dominantPlanet:"pluto",colorTheme:"pluto",talismancGlyph:"♇",astroGlyphs:["♇","♄","♆"],transitKey:"PLUTO-SATURN TRINE: Structured transformation through symbolic dissolution",talismancSketch:"⚡",symbolDrivers:["\uD83D\uDFE3","⚫","\uD83D\uDD34"]})},ew=async e=>{var t,r,n,i,o,l,c,d;let p;let u=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!u)return;let b=null;if("application/pdf"===u.type||u.name.toLowerCase().endsWith(".pdf"))try{let e=await Promise.all([a.e(980),a.e(300)]).then(a.bind(a,971));e.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";let t=await u.arrayBuffer(),r=await e.getDocument(t).promise,n="";for(let e=1;e<=r.numPages;e++){let t=await r.getPage(e),a=(await t.getTextContent()).items.filter(e=>"str"in e).map(e=>e.str).join(" ");n+=a+"\n\n"}p=n.trim()}catch(e){console.error("Error extracting PDF text:",e),alert("Failed to extract text from PDF. Please try a different file.");return}else p=await new Promise((e,t)=>{let a=new FileReader;a.onload=t=>{var a;return e(null===(a=t.target)||void 0===a?void 0:a.result)},a.onerror=t,a.readAsText(u)});let m=p,h="",x=null;try{let e=JSON.parse(p);if(e.context&&e.balance_meter){let{context:t,balance_meter:a}=e;try{(null==t?void 0:t.translocation)?(b=function(e){let t=e.translocation;return t&&t.applies?{active:!0,lens:"".concat(t.current_location).concat(t.house_system?" ("+t.house_system+")":""),disclosure:"Relocation ON – Houses remapped to ".concat(t.current_location),invariants:"Planetary geometry identical; only arena (House channels) shifted"}:{active:!1,lens:(null==t?void 0:t.current_location)||"Natal Base",disclosure:"Relocation OFF – natal House mapping in effect",invariants:"Planets, signs, aspects as computed from natal coordinates"}}({type:e.type||"balance",natal:t.natal||{name:"",birth_date:"",birth_time:"",birth_place:""},translocation:{applies:!!t.translocation.applies,current_location:t.translocation.current_location||"Natal Base",house_system:t.translocation.house_system,tz:t.translocation.tz}}),_(b)):_(null)}catch(e){_(null)}h="JSON Report for ".concat((null===(r=t.natal)||void 0===r?void 0:r.name)||"Unknown"," | Magnitude: ").concat(null===(n=a.magnitude)||void 0===n?void 0:n.value," (").concat(null===(i=a.magnitude)||void 0===i?void 0:i.term,") | Valence: ").concat(null===(o=a.valence)||void 0===o?void 0:o.emoji," ").concat(null===(l=a.valence)||void 0===l?void 0:l.term),m=JSON.stringify(e,null,2),x=(null===(d=e.reports)||void 0===d?void 0:null===(c=d.templates)||void 0===c?void 0:c.solo_mirror)||/solo mirror/i.test(p)?"mirror":"balance"}}catch(e){_(null)}m.trim().startsWith("{")&&m.trim().endsWith("}")||T(m);let f=j||x||"balance",g={id:s(),type:f,name:h?h.split("|")[0].trim():"".concat(j||"Balance"," Report"),summary:[h,(null==b?void 0:b.disclosure)||null].filter(Boolean).join(" • "),content:p,relocation:b||void 0};V(e=>[...e,g]),_(b),await ex(g),("mirror"===f||h&&h.includes("JSON Report"))&&S(!0),e.target&&(e.target.value="")};function ek(e,t,a,r){let n,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=Date.now(),c=l-v.current>150,d=/[.!?]$/.test(t.trim());if(!(s||d||c))return;v.current=l;let p=T(t),u=[...i].reverse().find(e=>"user"===e.role);if(u){let e=u.html.replace(/<[^>]*>/g,"").trim().toLowerCase();if(e&&e.length<=18){let t=p.trimStart().toLowerCase();(t.startsWith(e+".")||t.startsWith(e+" "))&&(p=p.trimStart().slice(e.length).replace(/^\.?\s*/,""))}}p=p.replace(/([.!?])(\w)/g,"$1 $2").replace(/\.\.\./g,"…").replace(/ {2,}/g," ");let b=u?u.html.replace(/<[^>]*>/g,"").toLowerCase():"",m=/\b(yes|yeah|yep|it does|it did|correct|right|exactly|true|that matches|i agree)\b/.test(b);n=(n=(n=(n=(n=(n=p).replace(/surprsing/gi,"surprising").replace(/coorlleation/gi,"correlation").replace(/correllation/gi,"correlation")).replace(/([a-z])([A-Z][a-z])/g,"$1. $2")).replace(/^\s*(it does|yes|yeah|yep|indeed|sure)\b[\s\.,;:-]*/i,"")).replace(/\.([A-Z])/g,". $1")).replace(/^(It does\.)\s+It does\./i,"$1"),m&&(n=(n=(n=n.replace(/\bmay be showing up\b/i,"is likely showing up")).replace(/\bmay reflect\b/i,"likely reflects")).slice(0,180).replace(/\b(may|might|could)\b(?! have)/i,"likely")+n.slice(180));let h=function(e){if(!e)return"";let t=e.replace(/\r/g,"").trim().split(/\n{2,}/),a=[];for(let e of t){let t=(e.match(/[^.!?]+[.!?]?/g)||[e]).map(e=>e.trim()).filter(Boolean),r="";for(let e of t)(r+" "+e).trim().length>320?(r&&a.push(r.trim()),r=e):r=r?r+" "+e:e;r&&a.push(r.trim())}return a.map(e=>"<p>".concat(e,"</p>")).join("\n")}(p=(n=n.replace(/\bwill certainly\b/gi,"will likely")).trim()),x=i.filter(t=>"raven"===t.role&&t.id!==e).length<=1;o(t=>t.map(t=>{if(t.id!==e)return t;let n=s?x?h:function(e,t,a){if(t)return e;let r=e.replace(/<[^>]*>/g," ").trim();if(!r||r.length<40||/[?]\s*$/.test(r)||/(did this (land|resonate)|fit your experience|feel true|feel off)/i.test(r)||/(logged as wb|resonance confirmed|that lands|confirmed as wb)/i.test(r))return e;if(a){let t=a.toLowerCase();if(["you asked","why are you asking","i already said","i just said","as i said","what i had just explained","repeating myself","asked again","i've already answered"].some(e=>t.includes(e))||/^yes\b/i.test(t.trim())||["that's familiar","feels familiar","that resonates","exactly","that's me","spot on","so true","absolutely","i just said it was","it was","it is","that is","yes it is","yes that is","that's right","correct","true"].some(e=>t.includes(e)))return e}let n=Date.now();if(n-R<12e3)return e;R=n;let i=function(){let e=z[E%z.length];return E++,e}();return e.endsWith("</p>")?e.replace(/<\/p>\s*$/," "+i+"</p>"):e+"\n\n<p>".concat(i,"</p>")}(h,t.isReport,b):h;return{...t,html:n,climate:a||t.climate,hook:r||t.hook}}))}return(0,r.jsxs)("div",{className:"app",style:{display:"flex",flexDirection:"column",height:"100vh",maxWidth:980,margin:"0 auto"},children:[(0,r.jsx)("input",{type:"file",ref:y,onChange:ew,style:{display:"none"},accept:".txt, .md, .json, .pdf"}),(0,r.jsx)(O,{onFileSelect:e=>{var t;w(e),null===(t=y.current)||void 0===t||t.click()},hasMirrorData:k,onPoeticInsert:()=>{ef("Please create a Symbol-to-Poem translation based on the Mirror data you have. Follow the strict Symbol-to-Song Translation protocol with pure poem first, then explanation table with planetary emoji codes.")},onAbout:()=>{let e={id:s(),role:"raven",html:"I am the creation of Dan Cross, born from his compulsion to systematize survival into something transferable. I read the symbolic patterns of your reality without imposing my creator's story on yours.",climate:"\uD83D\uDD0D Truth \xb7 \uD83C\uDF10 Origin \xb7 \uD83C\uDFAF Purpose",hook:"Creator & Created \xb7 Pattern ↔ Recognition"};o(t=>[...t,e])},onToggleSidebar:()=>{},sidebarOpen:!1,reportContexts:U,onRemoveReportContext:function(e){V(t=>t.filter(t=>t.id!==e));let t=U.filter(t=>t.id!==e);t.length>0?_(t[t.length-1].relocation||null):_(null)},onPoeticCard:()=>{ey()},onDemoCard:()=>{ej()},onShowWrapUp:()=>$(!0),onShowPendingReview:()=>X(!0),onShowHelp:()=>t(!0)}),e&&(0,r.jsx)(A,{onClose:()=>t(!1)}),(0,r.jsx)(Y,{ravenMessages:eb,scrollToTop:()=>{var e;null===(e=H.current)||void 0===e||e.scrollTo({top:0,behavior:"smooth"})},scrollToRavenMessage:e=>{let t=eb[e];if(!t)return;let a=document.getElementById("message-".concat(t.id));a&&(em(a),ec(e))},currentRavenIndex:el,scrollToBottom:eh}),(0,r.jsxs)("main",{style:{flex:1,display:"grid",gridTemplateColumns:"270px 1fr",gap:12,padding:12,position:"relative",minHeight:0,overflow:"hidden"},children:[(0,r.jsx)(L,{onInsert:e=>{let t=e.html||e.content||"";t&&ef(t)},hasMirrorData:k}),(0,r.jsx)(J,{messages:i,typing:m,endRef:f,containerRef:H,onToggleCollapse:function(e){o(t=>t.map(t=>t.id===e?{...t,collapsed:!t.collapsed}:t))},onRemove:function(e){o(t=>t.filter(t=>t.id!==e))},onPingFeedback:(e,t,a)=>{let r=i.find(t=>t.id===e),n=r?M(r.html):"general",s=r?r.html:"";g.recordFeedback(e,t,a,n,s),o(t=>t.map(t=>t.id===e?{...t,pingFeedbackRecorded:!0}:t)),setTimeout(()=>{let e="";"yes"===t?e="yes, that resonates with me":"no"===t?e="that doesn't feel familiar to me":"maybe"===t?e="that partially resonates, but not completely":"unclear"===t&&(e="that feels confusing or unclear to me"),a&&(e+=". ".concat(a)),ef(e)},500)}}),F&&(0,r.jsx)("button",{onClick:eh,style:{position:"absolute",bottom:20,right:20,background:"var(--accent)",border:"none",borderRadius:"50%",width:48,height:48,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:18,color:"white",boxShadow:"0 4px 12px rgba(124, 92, 255, 0.3)",zIndex:1e3,animation:"pulse 2s infinite"},title:"Return to current response",children:"↓"})]}),(0,r.jsx)("div",{style:{padding:"8px 18px",borderTop:"1px solid var(--line)",background:"var(--bg)",display:"flex",justifyContent:"flex-end",alignItems:"center"},children:(0,r.jsx)("button",{className:"btn",style:{...W,background:"transparent",border:"1px solid var(--line)",color:"var(--muted)",fontSize:11,padding:"4px 8px",opacity:.6,transition:"opacity 0.2s"},onMouseEnter:e=>e.currentTarget.style.opacity="1",onMouseLeave:e=>e.currentTarget.style.opacity="0.6",onClick:()=>et(!0),title:"End current reading and show comprehensive summary",children:"\uD83D\uDD2E End Reading"})}),(0,r.jsx)(K,{input:c,setInput:d,onSend:eg,onStop:function(){var e;null===(e=x.current)||void 0===e||e.abort()},disabled:m}),q&&(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},children:(0,r.jsx)(C,{onClose:()=>$(!1),onSealed:(e,t)=>{let a=crypto.randomUUID();o(e=>[...e,{id:a,role:"raven",html:"Thanks for scoring. I’ve sealed that reading. If you want to look at something new, we’ll start fresh from here.",climate:"",hook:""}]);let r=[...i].filter(e=>"user"===e.role).slice(-6).map(e=>e.html.replace(/<[^>]*>/g,"").toLowerCase()).join(" ").replace(/[^a-z0-9\s\-]/g," ").split(/\s+/).filter(e=>e.length>2),n={};for(let e of r)n[e]=(n[e]||0)+1;ei(Object.entries(n).sort((e,t)=>t[1]-e[1]).slice(0,12).map(e=>{let[t]=e;return t})),er(!0)}})}),Q&&(0,r.jsx)(Z,{onClose:()=>X(!1)}),ee&&(0,r.jsx)(D,{data:(()=>{var e;let t=(null===(e=i.filter(e=>"user"===e.role)[0])||void 0===e?void 0:e.html)||"",a=t.match(/my name is (\w+)/i)||t.match(/i'm (\w+)/i)||t.match(/i am (\w+)/i);a&&a[1];let r=es.wbHits.length,n=es.abeHits.length,o=es.osrMisses.length,l=r+n+o,c=l>0?Math.round((r+.5*n)/l*100):0,d="LOW",p="Extensive New Territory";return c>=70?(d="HIGH",p="Strong Harmonic Alignment"):c>=40&&(d="MIXED",p="Mixed Alignment"),{bigVectors:[{tension:"restless-contained",polarity:"Visionary Driver / Cutting Truth Style",charge:4,source:"personal-outer"}],resonanceSnapshot:{affirmedParadoxes:es.wbHits.slice(0,3).map(e=>e.content||"Pattern recognized"),poemLines:["The compass spins, a restless heart","A whispered promise, barely heard"],symbolicImages:["spinning compass","restless energy","whispered truth"],keyMoments:es.wbHits.slice(0,2).map(e=>e.content||"Key moment")},actorRoleComposite:{actor:"Visionary Driver",role:"Cutting Truth Style",composite:"Visionary Driver / Cutting Truth Style",confidence:"emerging"},resonanceFidelity:{percentage:c,band:d,label:p,wb:r,abe:n,osr:o},explanation:"You recognized the restless pull more than the steadying hand. That leans the weight toward your inner Driver. Raven reads this as a sidereal lean.",balanceMeterClimate:{magnitude:3,valence:"drag",volatility:"mixed",sfdVerdict:"Stirring with Drag",housePlacement:"House of Maintenance (work/health rhythm)",narrative:"The week trends at ⚡⚡⚡ 3 Stirring with \uD83C\uDF11 Drag—steady pull with a headwind in routines."},poemLine:"The compass spins, a restless heart. A whispered promise, barely heard.",sessionId:s()}})(),onClose:()=>et(!1),onGenerateJournal:eu,onStartNewReading:()=>{et(!1),eo({sessionStart:Date.now(),actorProfile:null,wbHits:[],abeHits:[],osrMisses:[],actorWeighting:0,roleWeighting:0,driftIndex:0,currentComposite:void 0,sessionActive:!0})}})]})}function O(e){let{onFileSelect:t,hasMirrorData:a,onPoeticInsert:i,onPoeticCard:s,onDemoCard:o,onAbout:l,onToggleSidebar:d,sidebarOpen:p,reportContexts:u,onRemoveReportContext:b,onShowWrapUp:m,onShowPendingReview:h,onShowHelp:x}=e,[f,v]=(0,n.useState)(0),[j,w]=(0,n.useState)(!1);(0,n.useEffect)(()=>{v(g.getPendingCount(!0));let e=setInterval(()=>v(g.getPendingCount(!0)),5e3);return()=>clearInterval(e)},[]),(0,n.useEffect)(()=>{let e=()=>w(!1);if(j)return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[j]);let k=e=>{switch(e){case"mirror":return"\uD83E\uDE9E";case"balance":return"\uD83C\uDF21️";case"journal":return"\uD83D\uDCD4";default:return"\uD83D\uDCC4"}};return(0,r.jsxs)("header",{style:{position:"sticky",top:0,zIndex:10,display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 18px",background:"rgba(20,24,33,.9)",backdropFilter:"blur(10px)",borderBottom:"1px solid var(--line)"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,r.jsx)("div",{style:{width:36,height:36,display:"grid",placeItems:"center",borderRadius:"50%",background:"radial-gradient(120% 120% at 50% 20%, #262a36, #12151c)",boxShadow:"inset 0 0 18px rgba(124,92,255,.25)",fontSize:20},"aria-hidden":!0,children:"\uD83D\uDC26‍⬛"}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,r.jsx)("b",{children:"Raven Calder"}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,color:"var(--muted)"},children:[(0,r.jsx)("span",{style:{width:8,height:8,borderRadius:"50%",background:"var(--good)",boxShadow:"0 0 10px var(--good)"}}),(0,r.jsx)("span",{children:"Connected"}),u.length>0&&(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4,marginLeft:8},children:[(0,r.jsx)("span",{style:{color:"var(--accent)",fontSize:10},children:"•"}),u.map((e,t)=>(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsxs)("span",{style:{fontSize:10},title:e.summary,children:[k(e.type)," ",e.name]}),(0,r.jsx)("button",{onClick:()=>b(e.id),style:{background:"none",border:"none",color:"var(--muted)",fontSize:8,cursor:"pointer",padding:0},title:"Remove context",children:"✕"}),t<u.length-1&&(0,r.jsx)("span",{style:{color:"var(--muted)",fontSize:8},children:"|"})]},e.id))]})]})]})]}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:10},children:[(0,r.jsx)(y,{className:"hidden sm:block"}),(0,r.jsx)(c,{compact:!0,className:"hidden sm:block"}),f>0&&(0,r.jsxs)("button",{className:"btn",style:{...W,fontSize:12,padding:"4px 8px",background:"rgba(255,255,255,0.04)"},onClick:h,title:"".concat(f," pending mirrors"),children:["● ",f," pending"]})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,r.jsx)("button",{className:"btn",style:W,onClick:()=>t("mirror"),children:"\uD83E\uDE9E Mirror"}),(0,r.jsx)("button",{className:"btn",style:W,onClick:()=>t("balance"),children:"\uD83C\uDF21️ Balance"}),(0,r.jsx)("button",{className:"btn",style:W,onClick:()=>t("journal"),children:"\uD83D\uDCD4 Journal"}),(0,r.jsxs)("div",{style:{position:"relative"},children:[(0,r.jsx)("button",{className:"btn",style:{...W,background:"linear-gradient(135deg, #6a53ff, #9c27b0)"},onClick:e=>{e.stopPropagation(),w(!j)},title:"Poetic analysis and reading tools",children:"\uD83C\uDFAD Poetic ▼"}),j&&(0,r.jsxs)("div",{style:{position:"absolute",top:"100%",right:0,marginTop:4,background:"var(--bg)",border:"1px solid var(--line)",borderRadius:8,padding:8,minWidth:180,zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("button",{className:"btn",style:{...W,width:"100%",marginBottom:4,justifyContent:"flex-start"},onClick:()=>{m(),w(!1)},title:"Generate Actor/Role composite from session feedback",children:"\uD83C\uDFAD Actor/Role Reveal"}),a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{className:"btn",style:{...W,width:"100%",marginBottom:4,justifyContent:"flex-start"},onClick:()=>{i(),w(!1)},children:"\uD83D\uDCDD Poetic Insert"}),(0,r.jsx)("button",{className:"btn",style:{...W,width:"100%",marginBottom:4,justifyContent:"flex-start"},onClick:()=>{s(),w(!1)},children:"\uD83C\uDFB4 Create Card"})]}),(0,r.jsx)("button",{className:"btn",style:{...W,width:"100%",marginBottom:4,justifyContent:"flex-start"},onClick:()=>{o(),w(!1)},title:"Generate demo poetic card",children:"\uD83C\uDFB4 Demo Card"})]})]}),(0,r.jsx)("button",{className:"btn",style:{...W,background:"transparent"},onClick:l,children:"ℹ️ About"}),(0,r.jsx)("button",{className:"btn",style:{...W,background:"transparent"},onClick:x,title:"Help & Button Guide",children:"❓ Help"})]})]})}let W={background:"var(--soft)",color:"var(--text)",border:"1px solid var(--line)",padding:"8px 10px",borderRadius:10,fontSize:13,cursor:"pointer"},H={background:"none",border:"1px solid var(--line)",borderRadius:6,color:"var(--text)",padding:"6px 10px",fontSize:11,cursor:"pointer",transition:"all 0.2s ease"};function L(e){let{onInsert:t,hasMirrorData:a}=e,[i,o]=(0,n.useState)("glossary");return(0,r.jsxs)("aside",{style:{background:"var(--panel)",border:"1px solid var(--line)",borderRadius:"var(--radius)",padding:14,height:"100%",overflow:"auto"},children:[(0,r.jsxs)("div",{style:{display:"flex",gap:4,marginBottom:16},children:[(0,r.jsx)("button",{onClick:()=>o("glossary"),style:{..._,..."glossary"===i?U:{}},children:"\uD83D\uDCD6 Glossary"}),(0,r.jsx)("button",{onClick:()=>o("hooks"),style:{..._,..."hooks"===i?U:{}},children:"\uD83C\uDFA3 Hooks"}),(0,r.jsx)("button",{onClick:()=>o("poetic"),style:{..._,..."poetic"===i?U:{}},children:"\uD83C\uDFAD Poetic"})]}),!a&&(0,r.jsx)("div",{style:{background:"rgba(103, 103, 193, 0.1)",border:"1px solid rgba(103, 103, 193, 0.3)",borderRadius:"6px",padding:"12px",marginBottom:"16px",textAlign:"center"},children:(0,r.jsx)("div",{style:{color:"var(--text)",fontSize:"13px",lineHeight:"1.4"},children:"Upload Math Brain Mirror or Balance Report for a Raven Calder Read"})}),"glossary"===i&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:G,children:"Balance Meter Framework"}),(0,r.jsx)(V,{symbol:"⚡",title:"Magnitude",description:"Symbolic intensity scale",details:["0 = Latent","1 = Murmur","2 = Pulse","3 = Stirring","4 = Convergence","5 = Threshold"]}),(0,r.jsx)(V,{symbol:"\uD83C\uDF1E",title:"Valence",description:"Energy direction & quality",details:["\uD83C\uDF1E supportive = helping/scaffolding","\uD83C\uDF17 mixed = complex blend","\uD83C\uDF11 restrictive = constraining"]}),(0,r.jsx)(V,{symbol:"\uD83C\uDF2A",title:"Volatility",description:"Pressure distribution pattern",details:["Low = steady, concentrated","Medium = variable flow","High = scattered turbulence","Storm-class = maximum dispersal"]}),(0,r.jsx)(V,{symbol:"\uD83C\uDF21️",title:"Four-Channel Architecture",description:"Complete energetic snapshot",details:["Combines Magnitude + Valence + Volatility","Creates real-time symbolic weather","Tracks field conditions over time","Provides actionable guidance"]}),(0,r.jsx)("div",{style:G,children:"Valence Indicators"}),(0,r.jsx)("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:8},children:"Positive Valence Modes"}),(0,r.jsx)(V,{symbol:"\uD83C\uDF31",title:"Fertile Field",description:"Growth-supportive conditions"}),(0,r.jsx)(V,{symbol:"✨",title:"Harmonic Resonance",description:"Natural alignment and flow"}),(0,r.jsx)(V,{symbol:"\uD83D\uDC8E",title:"Expansion Lift",description:"Elevating, broadening energy"}),(0,r.jsx)(V,{symbol:"\uD83D\uDD25",title:"Combustion Clarity",description:"Clear, focused intensity"}),(0,r.jsx)(V,{symbol:"\uD83E\uDD8B",title:"Liberation/Release",description:"Freedom from constraints"}),(0,r.jsx)(V,{symbol:"⚖️",title:"Integration",description:"Balanced synthesis"}),(0,r.jsx)(V,{symbol:"\uD83C\uDF0A",title:"Flow Tide",description:"Natural momentum"}),(0,r.jsx)(V,{symbol:"\uD83C\uDF08",title:"Visionary Spark",description:"Inspirational breakthrough"}),(0,r.jsx)("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:8,marginTop:12},children:"Negative Valence Modes"}),(0,r.jsx)(V,{symbol:"♾️",title:"Recursion Pull",description:"Repetitive patterns drawing back"}),(0,r.jsx)(V,{symbol:"⚔️",title:"Friction Clash",description:"Opposing forces in conflict"}),(0,r.jsx)(V,{symbol:"↔️",title:"Cross Current",description:"Contradictory energies"}),(0,r.jsx)(V,{symbol:"\uD83C\uDF2B️",title:"Fog/Dissolution",description:"Unclear, dissolving boundaries"}),(0,r.jsx)(V,{symbol:"\uD83C\uDF0B",title:"Pressure/Eruption",description:"Building tension seeking release"}),(0,r.jsx)(V,{symbol:"⏳",title:"Saturn Weight",description:"Heavy, restrictive pressure"}),(0,r.jsx)(V,{symbol:"\uD83E\uDDE9",title:"Fragmentation",description:"Scattered, disconnected pieces"}),(0,r.jsx)(V,{symbol:"\uD83D\uDD73️",title:"Entropy Drift",description:"Dissolving structure"}),(0,r.jsx)("div",{style:G,children:"Sources of Force"}),(0,r.jsx)(V,{symbol:"\uD83C\uDFAF",title:"Orb",description:"Proximity factor in aspects"}),(0,r.jsx)(V,{symbol:"\uD83C\uDF00",title:"Aspect",description:"Angular relationship type"}),(0,r.jsx)(V,{symbol:"\uD83E\uDE90",title:"Potency",description:"Planet speed and strength"}),(0,r.jsx)(V,{symbol:"\uD83D\uDCE1",title:"Resonance",description:"Natal chart activation"}),(0,r.jsx)("div",{style:G,children:"Planetary Forces"}),(0,r.jsx)(V,{symbol:"☽",title:"Moon",description:"Emotional tides, instinctive patterns"}),(0,r.jsx)(V,{symbol:"☿",title:"Mercury",description:"Communication, thought processing"}),(0,r.jsx)(V,{symbol:"♀",title:"Venus",description:"Values, relationships, beauty"}),(0,r.jsx)(V,{symbol:"♂",title:"Mars",description:"Action, drive, assertion"}),(0,r.jsx)(V,{symbol:"♃",title:"Jupiter",description:"Expansion, wisdom, growth"}),(0,r.jsx)(V,{symbol:"♄",title:"Saturn",description:"Structure, discipline, limits"}),(0,r.jsx)(V,{symbol:"♅",title:"Uranus",description:"Innovation, rebellion, awakening"}),(0,r.jsx)(V,{symbol:"♆",title:"Neptune",description:"Dreams, spirituality, illusion"}),(0,r.jsx)(V,{symbol:"♇",title:"Pluto",description:"Transformation, depth, power"}),(0,r.jsx)("div",{style:G,children:"Core Dynamics"}),(0,r.jsx)(V,{symbol:"↔",title:"Polarity",description:"Dynamic tension between forces"}),(0,r.jsx)(V,{symbol:"\uD83E\uDE9E",title:"Mirror",description:"Reflection of inner patterns"}),(0,r.jsx)(V,{symbol:"\uD83C\uDF21️",title:"Balance",description:"Current energetic state"}),(0,r.jsx)(V,{symbol:"\uD83D\uDCD4",title:"Journal",description:"Personal narrative tracking"}),(0,r.jsx)(V,{symbol:"⚡",title:"Symbolic Quake",description:"Energetic disturbance measurement",details:["Seismograph-style intensity scale","Tracks symbolic rather than literal events","Measures psychological/spiritual impact"]}),(0,r.jsx)(V,{symbol:"\uD83C\uDFAD",title:"Poetic Insert",description:"Artistic interpretation of patterns",details:["Transforms analysis into poetry","Captures essence beyond literal meaning","Bridges symbolic and creative expression"]})]}),"hooks"===i&&(0,r.jsx)("div",{children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:G,children:"Quick Insights"}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,r.jsx)(q,{label:"\uD83D\uDD2E Generate Polarity Reading",onClick:()=>t({id:s(),role:"user",html:"generate polarity reading"})}),(0,r.jsx)(q,{label:"⚖️ Balance Check",onClick:()=>t({id:s(),role:"user",html:"balance check"})}),(0,r.jsx)(q,{label:"\uD83C\uDF0A Flow State Reading",onClick:()=>t({id:s(),role:"user",html:"flow state reading"})})]})]}):(0,r.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"var(--muted)"},children:(0,r.jsx)("div",{style:{fontSize:"13px",lineHeight:"1.4"},children:"Quick Insights become available after uploading Math Brain data"})})}),"poetic"===i&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:G,children:"Creative Commands"}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,r.jsx)(q,{label:"✍️ Write my poem",onClick:()=>t({id:s(),role:"user",html:"write my poem"})}),(0,r.jsx)(q,{label:"\uD83C\uDFAD Poetic interpretation",onClick:()=>t({id:s(),role:"user",html:"poetic interpretation"})}),(0,r.jsx)(q,{label:"\uD83C\uDF1F Symbolic weather report",onClick:()=>t({id:s(),role:"user",html:"symbolic weather report"})}),(0,r.jsx)(q,{label:"\uD83D\uDCFF Daily mantra",onClick:()=>t({id:s(),role:"user",html:"daily mantra"})})]})]})]})}let G={fontSize:12,textTransform:"uppercase",letterSpacing:".14em",color:"var(--muted)",margin:"8px 0 10px"},_={background:"none",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--line)",borderRadius:"6px",color:"var(--muted)",padding:"4px 8px",fontSize:11,cursor:"pointer",transition:"all 0.2s ease"},U={background:"var(--soft)",color:"var(--text)",borderColor:"var(--accent)"};function V(e){let{symbol:t,title:a,description:i,details:s}=e,[o,l]=(0,n.useState)(!1);return(0,r.jsxs)("div",{className:"glossary-item",style:{marginBottom:12,padding:8,border:"1px solid var(--line)",borderRadius:6,background:"var(--soft)"},title:"".concat(a,": ").concat(i),children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,cursor:s?"pointer":"default"},onClick:()=>s&&l(!o),children:[(0,r.jsx)("span",{style:{fontSize:16},title:"".concat(t," ").concat(a," - ").concat(i),children:t}),(0,r.jsxs)("div",{style:{flex:1},children:[(0,r.jsx)("div",{style:{fontSize:12,fontWeight:"bold",color:"var(--text)"},children:a}),(0,r.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:i})]}),s&&(0,r.jsx)("span",{style:{fontSize:10,color:"var(--muted)"},children:o?"▼":"▶"})]}),s&&o&&(0,r.jsx)("div",{style:{marginTop:8,paddingTop:8,borderTop:"1px solid var(--line)"},children:s.map((e,t)=>(0,r.jsxs)("div",{style:{fontSize:10,color:"var(--muted)",marginBottom:2},children:["• ",e]},t))})]})}function q(e){let{label:t,onClick:a}=e;return(0,r.jsx)("button",{onClick:a,style:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:8,fontSize:12,padding:"8px 12px",borderRadius:8,borderWidth:"1px",borderStyle:"solid",borderColor:"var(--line)",background:"var(--soft)",color:"var(--text)",cursor:"pointer",textAlign:"left",width:"100%",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="var(--panel)",e.currentTarget.style.borderColor="var(--accent)",e.currentTarget.style.color="var(--text)"},onMouseLeave:e=>{e.currentTarget.style.background="var(--soft)",e.currentTarget.style.borderColor="var(--line)",e.currentTarget.style.color="var(--text)"},children:t})}function J(e){let{messages:t,typing:a,endRef:n,containerRef:i,onToggleCollapse:s,onRemove:o,onPingFeedback:l}=e;return(0,r.jsxs)("section",{ref:i,"aria-label":"Conversation",role:"log",style:{background:"var(--panel)",border:"1px solid var(--line)",borderRadius:"var(--radius)",padding:12,display:"flex",flexDirection:"column",gap:12,overflow:"auto",height:"100%"},children:[t.map(e=>(0,r.jsx)($,{msg:e,onToggleCollapse:s,onRemove:o,onPingFeedback:l},e.id)),a&&(0,r.jsxs)("div",{style:{opacity:.6,fontSize:12},children:[(0,r.jsxs)("span",{className:"dots",children:[(0,r.jsx)("span",{})," ",(0,r.jsx)("span",{})," ",(0,r.jsx)("span",{})]})," typing…"]}),(0,r.jsx)("div",{ref:n})]})}function $(e){let{msg:t,onToggleCollapse:a,onRemove:i,onPingFeedback:s}=e,[o,l]=(0,n.useState)(!1),c={maxWidth:"82%",padding:"12px 14px",borderRadius:16,position:"relative",boxShadow:"0 6px 16px rgba(0,0,0,.25)",border:"1px solid #1f2533",scrollMarginTop:120},d="user"===t.role?{alignSelf:"flex-end",background:"linear-gradient(180deg,#1f2432,#171b25)"}:{alignSelf:"flex-start",background:"linear-gradient(180deg,#171b25,#131824)",borderLeft:"2px solid #2b3244"},p=async e=>{try{let t=e.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim();await navigator.clipboard.writeText(t),l(!0),setTimeout(()=>l(!1),2e3)}catch(e){console.error("Failed to copy text:",e)}};return t.isReport?(0,r.jsxs)("article",{id:"message-".concat(t.id),style:{...c,...d},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:t.collapsed?0:8},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,r.jsxs)("span",{style:{fontSize:12,color:"#8b94a6",textTransform:"uppercase",letterSpacing:"0.5px"},children:[t.reportType," REPORT"]}),(0,r.jsx)("span",{style:{fontSize:14,color:"#cbd4e4",fontWeight:500},children:t.reportName})]}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,r.jsx)("button",{onClick:()=>a(t.id),style:{background:"none",border:"1px solid #2a3143",borderRadius:4,color:"#8b94a6",padding:"4px 8px",fontSize:11,cursor:"pointer"},children:t.collapsed?"Expand":"Collapse"}),(0,r.jsx)("button",{onClick:()=>i(t.id),style:{background:"none",border:"1px solid #4a3143",borderRadius:4,color:"#c47a7a",padding:"4px 8px",fontSize:11,cursor:"pointer"},children:"Remove"})]})]}),t.reportSummary&&!t.collapsed&&(0,r.jsx)("div",{style:{fontSize:11,color:"#8b94a6",marginBottom:8,fontStyle:"italic"},children:t.reportSummary}),!t.collapsed&&(0,r.jsx)("div",{className:"raven"===t.role?"raven-response":"",dangerouslySetInnerHTML:{__html:t.html}})]}):(0,r.jsxs)("article",{id:"message-".concat(t.id),style:{...c,...d},children:["raven"===t.role&&(t.climate||t.hook)&&(0,r.jsxs)("div",{style:{marginBottom:8,paddingBottom:6,borderBottom:"1px solid #2a3143"},children:[t.climate&&(0,r.jsx)("div",{style:{fontSize:10,color:"#8b94a6"},children:t.climate}),t.hook&&(0,r.jsx)("div",{style:{fontSize:10,color:"#8b94a6"},children:t.hook})]}),(0,r.jsx)("div",{className:"raven"===t.role?"raven-response":"",dangerouslySetInnerHTML:{__html:"user"!==t.role||t.isReport?t.html:I(t.html)}}),"raven"===t.role&&P(t.html)&&!g.getFeedback(t.id)&&(0,r.jsxs)("div",{style:{marginTop:6,fontSize:10,color:"#94a3b8"},children:[(0,r.jsx)("span",{style:{display:"inline-block",width:6,height:6,borderRadius:3,background:"#94a3b8",marginRight:6}}),"Pending"]}),"raven"===t.role&&F(t.html)&&(0,r.jsx)(x,{messageId:t.id,onFeedback:s,disabled:t.pingFeedbackRecorded,checkpointType:"repair"}),"raven"===t.role&&P(t.html)&&!F(t.html)&&(0,r.jsxs)("div",{style:{marginTop:8,padding:"8px 12px",background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.2)",borderRadius:"6px",fontSize:"12px",color:"#93c5fd"},children:["\uD83D\uDCAD ",(0,r.jsx)("em",{children:"Raven will classify your response and provide repair if needed - no grading required"})]}),"raven"===t.role&&(0,r.jsx)("div",{style:{display:"flex",gap:4,marginTop:8,justifyContent:"flex-end"},children:(0,r.jsx)("button",{onClick:()=>p(t.html),style:{background:o?"var(--good)":"var(--soft)",color:o?"white":"var(--muted)",border:"1px solid var(--line)",borderRadius:6,padding:"2px 8px",fontSize:10,cursor:"pointer",transition:"all 0.2s ease"},children:o?"Copied!":"Copy"})}),t.climate&&(0,r.jsx)("div",{style:{fontSize:10,color:"#8b94a6",marginTop:8,borderTop:"1px solid #2a3143",paddingTop:6},children:t.climate}),t.hook&&(0,r.jsx)("div",{style:{fontSize:10,color:"#8b94a6"},children:t.hook})]})}function K(e){let{input:t,setInput:a,onSend:n,onStop:i,disabled:s}=e;return(0,r.jsxs)("div",{style:{padding:"12px 18px",background:"rgba(20,24,33,.9)",backdropFilter:"blur(10px)",borderTop:"1px solid var(--line)",display:"flex",gap:10,alignItems:"flex-end"},children:[(0,r.jsx)("button",{style:{...W,width:40,padding:0},title:"Attach",children:"\uD83D\uDCCE"}),(0,r.jsx)("textarea",{value:t,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),n())},placeholder:"Ask or paste here. Enter to send, Shift+Enter newline",style:{flex:1,minHeight:48,maxHeight:160,resize:"vertical",borderRadius:14,border:"1px solid var(--line)",background:"var(--panel)",color:"var(--text)",padding:"12px 14px",fontSize:14}}),(0,r.jsx)("div",{style:{fontFamily:"var(--mono)",fontSize:11,color:"var(--muted)"},"aria-hidden":!0,children:"Enter ↵"}),s&&(0,r.jsx)("button",{onClick:i,style:{...W,background:"#442b2b",border:"1px solid #663",boxShadow:"var(--shadow)"},children:"Stop"}),(0,r.jsx)("button",{disabled:s,onClick:n,style:{...W,background:"linear-gradient(180deg,#8d78ff,#6a53ff)",border:"none",boxShadow:"var(--shadow)"},children:"Send"})]})}function Y(e){let{ravenMessages:t,scrollToTop:a,scrollToRavenMessage:n,currentRavenIndex:i,scrollToBottom:s}=e;return 0===t.length?null:(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:8,padding:"8px 18px",background:"var(--panel)",borderTop:"1px solid var(--line)",borderBottom:"1px solid var(--line)",fontSize:12},children:[(0,r.jsx)("button",{onClick:a,style:{...H},title:"Jump to top",children:"⬆️ Top"}),(0,r.jsx)("button",{onClick:()=>n(Math.max(0,i-1)),disabled:i<=0||t.length<=1,style:{...H,opacity:i<=0||t.length<=1?.5:1},title:"Previous Raven response",children:"← Prev"}),(0,r.jsxs)("span",{style:{color:"var(--muted)"},children:[i+1," / ",t.length]}),(0,r.jsx)("button",{onClick:()=>n(Math.min(t.length-1,i+1)),disabled:i>=t.length-1||t.length<=1,style:{...H,opacity:i>=t.length-1||t.length<=1?.5:1},title:"Next Raven response",children:"Next →"}),(0,r.jsx)("button",{onClick:s,style:{...H},title:"Jump to bottom",children:"⬇️ Bottom"})]})}function Z(e){let{onClose:t}=e,[a,i]=(0,n.useState)(()=>g.getPendingItems(!0).slice(0,3)),[s,o]=(0,n.useState)({}),[l,c]=(0,n.useState)({});return(0,n.useEffect)(()=>{window.__openPendingReview=()=>{i(g.getPendingItems(!0).slice(0,3))}},[]),(0,r.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:(0,r.jsxs)("div",{style:{width:520,background:"linear-gradient(135deg, #1e293b, #0f172a)",border:"1px solid rgba(148,163,184,0.2)",borderRadius:12,padding:16},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,r.jsx)("div",{style:{color:"#e2e8f0",fontWeight:600},children:"Review pending mirrors?"}),(0,r.jsx)("button",{onClick:t,style:{background:"none",border:"none",color:"#94a3b8",fontSize:18},children:"\xd7"})]}),(0,r.jsx)("div",{style:{color:"#94a3b8",fontSize:12,marginBottom:12},children:"Up to three, highest-charge first. One tap each. Optional note."}),0===a.length&&(0,r.jsx)("div",{style:{color:"#94a3b8",fontSize:12},children:"No pending mirrors."}),a.map(e=>(0,r.jsxs)("div",{style:{marginBottom:12,padding:12,border:"1px solid rgba(148,163,184,0.2)",borderRadius:8},children:[(0,r.jsx)("div",{style:{fontSize:12,color:"#e2e8f0",marginBottom:8},dangerouslySetInnerHTML:{__html:e.messageContent||""}}),(0,r.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:8},children:["yes","maybe","no","unclear"].map(t=>(0,r.jsx)("button",{onClick:()=>o(a=>({...a,[e.messageId]:t})),style:{...W,fontSize:12,padding:"4px 8px",background:s[e.messageId]===t?"rgba(59,130,246,0.2)":"var(--soft)"},children:"yes"===t?"✅ Yes":"maybe"===t?"\uD83D\uDFE1 Sort of":"no"===t?"❌ No":"❓ Not clear"},t))}),("no"===s[e.messageId]||"unclear"===s[e.messageId])&&(0,r.jsx)("textarea",{value:l[e.messageId]||"",onChange:t=>c(a=>({...a,[e.messageId]:t.target.value})),placeholder:"Optional note (what didn’t fit?)",style:{width:"100%",background:"rgba(0,0,0,0.3)",color:"#e2e8f0",border:"1px solid rgba(148,163,184,0.2)",borderRadius:6,padding:8,fontSize:12}})]},e.messageId)),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[(0,r.jsx)("button",{onClick:t,style:{...W},children:"Snooze"}),(0,r.jsx)("button",{onClick:()=>{a.forEach(e=>{let t=s[e.messageId];t&&g.recordFeedback(e.messageId,t,l[e.messageId],e.checkpointType,e.messageContent)}),t()},style:{...W,background:"linear-gradient(180deg,#8d78ff,#6a53ff)",border:"none"},children:"Review"})]})]})})}},8778:function(e,t,a){"use strict";a.d(t,{default:function(){return i}});var r=a(7437),n=a(2265);function i(e){let{children:t}=e,[a,i]=(0,n.useState)(!1),[s,o]=(0,n.useState)(!1),[l,c]=(0,n.useState)(null);return((0,n.useEffect)(()=>{let e=!1;return async function(){try{var t,a;"function"==typeof(null===(t=window.auth0)||void 0===t?void 0:t.createAuth0Client)||"function"==typeof window.createAuth0Client||await new Promise((e,t)=>{let a=document.createElement("script");a.src="/vendor/auth0-spa-js.production.js",a.async=!0,a.onload=()=>e(),a.onerror=()=>t(Error("Failed to load Auth0 SDK")),document.head.appendChild(a)});let r=await fetch("/api/auth-config"),n=await r.json();if(!(null==n?void 0:n.domain)||!(null==n?void 0:n.clientId))throw Error("Invalid Auth0 config");let s=(null===(a=window.auth0)||void 0===a?void 0:a.createAuth0Client)||window.createAuth0Client;if("function"!=typeof s)throw Error("Auth0 SDK not available after load");let l=window.location.origin+"/chat",c=await s({domain:n.domain.replace(/^https?:\/\//,""),clientId:n.clientId,authorizationParams:{redirect_uri:l}}),d=window.location.search;if(d.includes("code=")&&d.includes("state=")){await c.handleRedirectCallback();let e=new URL(window.location.href);e.search="",window.history.replaceState({},"",e.toString())}let p=await c.isAuthenticated();e||(o(p),i(!0)),p||window.location.replace("/")}catch(t){e||(c((null==t?void 0:t.message)||"Auth error"),i(!0),window.location.replace("/"))}}(),()=>{e=!0}},[]),a)?!s||l?null:(0,r.jsx)(r.Fragment,{children:t}):(0,r.jsx)("div",{className:"grid place-items-center h-screen text-slate-400",children:"Connecting…"})}}},function(e){e.O(0,[162,971,23,744],function(){return e(e.s=2030)}),_N_E=e.O()}]);