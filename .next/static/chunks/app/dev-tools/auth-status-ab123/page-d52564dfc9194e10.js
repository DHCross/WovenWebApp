(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[302],{1071:function(e,t,s){Promise.resolve().then(s.bind(s,2292))},2292:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return r},dynamic:function(){return l}});var a=s(7437),n=s(2265),i=s(5216);let l="force-dynamic";function r(){let e="true"===String("true"),[t,s]=(0,n.useState)(!1),[l,r]=(0,n.useState)(null),[o,c]=(0,n.useState)({created:!1,authed:!1}),[d,u]=(0,n.useState)("unknown"),[m,h]=(0,n.useState)(!1),[x,p]=(0,n.useState)(""),[f,g]=(0,n.useState)(null),[j,v]=(0,n.useState)(null),b=(0,n.useRef)(null);return((0,n.useEffect)(()=>{if(!e)return;let t=!1;return(async()=>{try{var e,a;let n;"function"==typeof(null===(e=window.auth0)||void 0===e?void 0:e.createAuth0Client)||"function"==typeof window.createAuth0Client||await new Promise((e,t)=>{let s=document.createElement("script");s.src="/vendor/auth0-spa-js.production.js",s.async=!0,s.onload=()=>e(),s.onerror=()=>t(Error("Failed to load Auth0 SDK")),document.head.appendChild(s)}),u("vendor"),s(!0);let l=await fetch("/api/auth-config",{cache:"no-store"});if(!l.ok)throw Error("auth-config failed: ".concat(l.status));let o=await l.json();if(t||r(o),!(null==o?void 0:o.domain)||!(null==o?void 0:o.clientId)){t||(c(e=>({...e,error:"Auth config present but missing domain/clientId"})),h(!0));return}let d=(null===(a=window.auth0)||void 0===a?void 0:a.createAuth0Client)||window.createAuth0Client;if("function"!=typeof d)throw Error("Auth0 SDK not available");let m=await d({domain:String(o.domain).replace(/^https?:\/\//,""),clientId:o.clientId,authorizationParams:{redirect_uri:(0,i.g)()}});b.current=m,t||c(e=>({...e,created:!0}));let x=window.location.search;if(x.includes("code=")&&x.includes("state=")){try{await m.handleRedirectCallback()}catch(e){}let e=new URL(window.location.href);e.search="",window.history.replaceState({},"",e.toString())}let p=await m.isAuthenticated();if(p)try{n=await m.getUser()}catch(e){}t||c(e=>({...e,authed:p,user:n}))}catch(e){t||c(t=>({...t,error:(null==e?void 0:e.message)||"init failed"}))}finally{t||h(!0)}})(),()=>{t=!0}},[e]),e)?(0,a.jsxs)("main",{className:"mx-auto max-w-4xl px-6 py-10",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-slate-100",children:"Auth0 Diagnostics"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-slate-400",children:"Hidden page — surface SDK/config/auth state without exposing secrets."}),(0,a.jsxs)("section",{className:"mt-6 rounded-md border border-slate-700 bg-slate-800/60 p-4",children:[(0,a.jsx)("h2",{className:"text-sm font-medium text-slate-200",children:"SDK & Config"}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-1 gap-2 text-sm text-slate-300 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:["SDK Loaded: ",(0,a.jsx)("span",{className:"font-mono",children:String(t)})]}),(0,a.jsxs)("div",{children:["SDK Source: ",(0,a.jsx)("span",{className:"font-mono",children:d})]}),(0,a.jsxs)("div",{children:["Config success: ",(0,a.jsx)("span",{className:"font-mono",children:String(!!(l&&l.domain&&l.clientId))})]}),(0,a.jsxs)("div",{children:["Domain: ",(0,a.jsx)("span",{className:"font-mono",children:(null==l?void 0:l.domain)||"—"})]}),(0,a.jsxs)("div",{children:["ClientId: ",(0,a.jsx)("span",{className:"font-mono",children:(null==l?void 0:l.clientId)?String(l.clientId).slice(0,4)+"…":"—"})]}),(0,a.jsxs)("div",{children:["Audience: ",(0,a.jsx)("span",{className:"font-mono",children:(null==l?void 0:l.audience)||"—"})]}),(0,a.jsxs)("div",{children:["Ready: ",(0,a.jsx)("span",{className:"font-mono",children:String(m)})]})]})]}),(0,a.jsxs)("section",{className:"mt-4 rounded-md border border-slate-700 bg-slate-800/60 p-4",children:[(0,a.jsx)("h2",{className:"text-sm font-medium text-slate-200",children:"Client State"}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-1 gap-2 text-sm text-slate-300 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:["Client Created: ",(0,a.jsx)("span",{className:"font-mono",children:String(o.created)})]}),(0,a.jsxs)("div",{children:["Authenticated: ",(0,a.jsx)("span",{className:"font-mono",children:String(o.authed)})]}),(0,a.jsxs)("div",{children:["Error: ",(0,a.jsx)("span",{className:"font-mono",children:o.error||"—"})]})]}),o.user&&(0,a.jsx)("pre",{className:"mt-3 max-h-64 overflow-auto rounded bg-slate-950 p-3 text-xs text-slate-200",children:JSON.stringify(o.user,null,2)})]}),(0,a.jsxs)("section",{className:"mt-4 rounded-md border border-slate-700 bg-slate-800/60 p-4",children:[(0,a.jsx)("h2",{className:"text-sm font-medium text-slate-200",children:"Expected Dashboard URLs"}),(0,a.jsxs)("ul",{className:"mt-2 list-disc pl-6 text-sm text-slate-300 space-y-1",children:[(0,a.jsx)("li",{children:"Callback: http://localhost:4000/math-brain, http://localhost:8888/math-brain, https://<site>.netlify.app/math-brain, https://ravencalder.com/math-brain"}),(0,a.jsx)("li",{children:"Web Origins: http://localhost:4000, http://localhost:8888, https://<site>.netlify.app, https://ravencalder.com"}),(0,a.jsx)("li",{children:"Logout URLs: http://localhost:4000/, http://localhost:8888/, https://<site>.netlify.app/, https://ravencalder.com/"})]}),(0,a.jsx)("p",{className:"mt-2 text-xs text-slate-400",children:"Compare these with your Auth0 Application settings. Wildcards must cover full subdomains."})]}),(0,a.jsxs)("section",{className:"mt-4 rounded-md border border-slate-700 bg-slate-800/60 p-4",children:[(0,a.jsx)("h2",{className:"text-sm font-medium text-slate-200",children:"Computed redirect_uri (login)"}),(0,a.jsx)("div",{className:"mt-2 text-sm text-slate-300 font-mono",children:(0,i.g)()})]}),(0,a.jsxs)("section",{className:"mt-4 rounded-md border border-slate-700 bg-slate-800/60 p-4",children:[(0,a.jsx)("h2",{className:"text-sm font-medium text-slate-200",children:"Server env snapshot (secure)"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-slate-400",children:"Requires ENABLE_DEV_TOOLS on server and a valid secret key. Values are redacted."}),(0,a.jsxs)("div",{className:"mt-3 flex flex-col gap-2 sm:flex-row sm:items-center",children:[(0,a.jsx)("input",{type:"password",placeholder:"Dev tools secret key",className:"w-full sm:w-80 rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:x,onChange:e=>p(e.target.value)}),(0,a.jsx)("button",{onClick:async()=>{g(null),v(null);try{let e=await fetch("/api/debug-env",{headers:{"x-devtools-key":x||""},cache:"no-store"}),t=await e.json();if(!e.ok||(null==t?void 0:t.success)===!1)throw Error((null==t?void 0:t.error)||"Request failed: ".concat(e.status));g(t)}catch(e){v((null==e?void 0:e.message)||"Failed to fetch snapshot")}},className:"inline-flex items-center justify-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-500 disabled:opacity-50",disabled:!x,children:"Fetch snapshot"})]}),j&&(0,a.jsx)("p",{className:"mt-2 text-xs text-rose-400",children:j}),f&&(0,a.jsx)("pre",{className:"mt-3 max-h-64 overflow-auto rounded bg-slate-950 p-3 text-xs text-slate-200",children:JSON.stringify(f,null,2)})]})]}):(0,a.jsx)("main",{className:"mx-auto max-w-3xl px-6 py-10",children:(0,a.jsx)("div",{className:"rounded-md border border-slate-700 bg-slate-900/50 p-4 text-slate-300",children:"Diagnostics disabled. Set NEXT_PUBLIC_ENABLE_DEV_TOOLS=true to enable."})})}},5216:function(e,t,s){"use strict";function a(){return window.location.origin+"/math-brain"}s.d(t,{g:function(){return a}})}},function(e){e.O(0,[971,23,744],function(){return e(e.s=1071)}),_N_E=e.O()}]);