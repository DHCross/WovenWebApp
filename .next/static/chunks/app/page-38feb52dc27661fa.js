(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3942:(e,t,a)=>{Promise.resolve().then(a.bind(a,3975))},3975:(e,t,a)=>{"use strict";a.d(t,{default:()=>s});var n=a(5155),i=a(2115),l=a(8209);function s(){let[e,t]=(0,i.useState)(!1),[a,s]=(0,i.useState)(!1),[r,o]=(0,i.useState)(null),[c,d]=(0,i.useState)(null),[u,h]=(0,i.useState)(null),[m,x]=(0,i.useState)(!1),[g,p]=(0,i.useState)(!1),[f,w]=(0,i.useState)(!1),b="true"===String("true"),v=(0,i.useRef)(null);(0,i.useEffect)(()=>{0;let e=!1,a=setTimeout(()=>{e||(o(e=>e||"Auth init slow or unavailable"),t(!0))},5e3);async function n(){try{var a,n;let i;"function"!=typeof(null==(a=window.auth0)?void 0:a.createAuth0Client)&&"function"!=typeof window.createAuth0Client&&await new Promise((e,t)=>{let a=document.createElement("script");a.src="/vendor/auth0-spa-js.production.js",a.async=!0,a.onload=()=>e(),a.onerror=()=>t(Error("Failed to load Auth0 SDK")),document.head.appendChild(a)}),p(!0);try{let t=await fetch("/api/auth-config",{cache:"no-store"});if(!t.ok)throw Error("Auth config failed: ".concat(t.status," ").concat(t.statusText));i=await t.json(),console.log("Auth config received:",i),e||h({domain:null==i?void 0:i.domain,clientId:null==i?void 0:i.clientId})}catch(a){console.warn("Could not fetch auth config, using development fallback:",a),e||(o("Auth not available (functions not running)"),t(!0));return}if(!(null==i?void 0:i.domain)||!(null==i?void 0:i.clientId))throw Error("Invalid Auth0 config - missing domain or clientId");let r=(null==(n=window.auth0)?void 0:n.createAuth0Client)||window.createAuth0Client;if("function"!=typeof r)throw Error("Auth0 SDK not available after load");let c=await r({domain:String(i.domain).replace(/^https?:\/\//,""),clientId:i.clientId,authorizationParams:{redirect_uri:(0,l.F)()}});v.current=c,w(!0);let u=window.location.search;if(u.includes("code=")&&u.includes("state=")){await c.handleRedirectCallback();let e=new URL(window.location.href);e.search="",window.history.replaceState({},"",e.toString())}let m=await c.isAuthenticated(),x=null;if(m)try{let e=await c.getUser();x=(null==e?void 0:e.name)||(null==e?void 0:e.email)||null}catch(e){}e||(d(x),s(m),t(!0))}catch(a){e||(o((null==a?void 0:a.message)||"Auth init failed"),t(!0))}}return n(),()=>{e=!0,clearTimeout(a)}},[!1]);let j=async()=>{0;if(!v.current)return void o("Auth not ready yet. One moment, then try again. If this persists, open /debug-auth.");try{x(!0),await v.current.loginWithRedirect({authorizationParams:{redirect_uri:(0,l.F)(),connection:"google-oauth2"}})}catch(e){o((null==e?void 0:e.message)||"Login failed")}finally{x(!1)}};return(0,n.jsx)("section",{className:"mt-8",children:(0,n.jsxs)("div",{className:"rounded-xl border border-slate-800 bg-slate-900/40 p-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-semibold tracking-tight",children:"Start with Math Brain"}),(0,n.jsx)("p",{className:"mt-2 text-slate-400",children:"Run the geometry first. Then, once you’re signed in, jump into Chat to synthesize the narrative."}),(0,n.jsxs)("div",{className:"mt-6 flex flex-wrap gap-3",children:[(0,n.jsx)("a",{href:"/math-brain?report=balance",className:"rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-500",title:"Open Math Brain with Balance Meter",children:"Open Math Brain (Astro Reports)"}),e&&a?(0,n.jsx)("a",{href:"/chat",className:"rounded-md px-4 py-2 bg-emerald-600 text-white hover:bg-emerald-500",title:"Open Poetic Brain (Chat)",children:"Open Poetic Brain"}):(0,n.jsx)("button",{onClick:j,disabled:!e||!v.current||m,className:"rounded-md border border-slate-700 px-4 py-2 text-slate-100 ".concat(e&&v.current&&!m?"bg-slate-800 hover:bg-slate-700":"bg-slate-700/60 cursor-not-allowed"),title:"Sign in to enable Poetic Brain",children:m?"Redirecting…":"Continue with Google"}),!e&&(0,n.jsx)("span",{className:"rounded-md bg-slate-800 px-4 py-2 text-slate-400","aria-live":"polite",children:"Loading auth…"})]}),a&&(0,n.jsxs)("p",{className:"mt-3 text-xs text-slate-500",children:["Signed in",c?" as ".concat(c):"",". Chat is now enabled."]}),r&&(0,n.jsx)("p",{className:"mt-3 text-xs text-rose-400",children:r}),b&&(0,n.jsxs)("p",{className:"mt-2 text-[11px] text-slate-500",children:["Auth init • sdk: ",(0,n.jsx)("span",{className:"text-slate-300",children:String(g)})," • client: ",(0,n.jsx)("span",{className:"text-slate-300",children:String(f)}),u&&(0,n.jsxs)(n.Fragment,{children:[" • domain: ",(0,n.jsx)("span",{className:"text-slate-300",children:u.domain||"—"})," • client: ",(0,n.jsx)("span",{className:"text-slate-300",children:u.clientId?String(u.clientId).slice(0,4)+"…":"—"})]})," ","• ",(0,n.jsx)("a",{href:"/debug-auth",className:"underline hover:text-slate-300",children:"debug-auth"})]}),b&&u&&(0,n.jsxs)("p",{className:"mt-2 text-[11px] text-slate-500",children:["Auth config • domain: ",(0,n.jsx)("span",{className:"text-slate-300",children:u.domain||"—"})," • client: ",(0,n.jsx)("span",{className:"text-slate-300",children:u.clientId?String(u.clientId).slice(0,4)+"…":"—"})]})]})})}},8209:(e,t,a)=>{"use strict";function n(){return window.location.origin+"/math-brain"}a.d(t,{F:()=>n})}},e=>{e.O(0,[441,255,358],()=>e(e.s=3942)),_N_E=e.O()}]);