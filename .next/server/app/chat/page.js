(()=>{var a={};a.id=457,a.ids=[457],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},1212:(a,b,c)=>{"use strict";c.d(b,{A:()=>g});var d=c(21124),e=c(38301),f=c.n(e);class g extends f().Component{constructor(a){super(a),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(a){return{hasError:!0,error:a,errorInfo:null}}componentDidCatch(a,b){this.setState({error:a,errorInfo:b}),console.error("ErrorBoundary caught:",a,b)}render(){return this.state.hasError?(0,d.jsxs)("div",{className:"bg-red-100 text-red-800 p-4 rounded mt-4",children:[(0,d.jsx)("h2",{className:"font-bold",children:"Something went wrong."}),(0,d.jsx)("pre",{className:"text-xs overflow-x-auto",children:this.state.error?.toString()}),(0,d.jsxs)("details",{className:"text-xs mt-2",open:!0,children:[(0,d.jsx)("summary",{children:"Stack Trace"}),(0,d.jsx)("pre",{children:this.state.errorInfo?.componentStack})]})]}):this.props.children}}},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8595:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>e});var d=c(75338);function e(){return(0,d.jsx)("div",{className:"min-h-screen grid place-items-center p-6",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("h1",{className:"text-2xl font-semibold mb-2",children:"Page not found"}),(0,d.jsx)("p",{className:"text-slate-500",children:"The page you’re looking for doesn’t exist."})]})})}c(74515)},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},15202:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,54160,23))},15727:()=>{},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},23975:()=>{},26713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},28354:a=>{"use strict";a.exports=require("util")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},29308:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>D.a,__next_app__:()=>L,handler:()=>N,routeModule:()=>M});var d=c(49754),e=c(9117),f=c(46595),g=c(32324),h=c(39326),i=c(38928),j=c(20175),k=c(12),l=c(54290),m=c(12696),n=c(82802),o=c(77533),p=c(45229),q=c(32822),r=c(261),s=c(26453),t=c(52474),u=c(26713),v=c(51356),w=c(62685),x=c(36225),y=c(63446),z=c(2762),A=c(45742),B=c(86439),C=c(81170),D=c.n(C),E=c(62506),F=c(91203),G=c(70722),H=c(37422),I=c(43954),J={};for(let a in E)0>["default","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(J[a]=()=>E[a]);c.d(b,J);let K={children:["",{children:["chat",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,59123)),"/Users/dancross/Documents/GitHub/WovenWebApp/app/chat/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(c.bind(c,96600)),"/Users/dancross/Documents/GitHub/WovenWebApp/app/layout.tsx"],error:[()=>Promise.resolve().then(c.bind(c,41697)),"/Users/dancross/Documents/GitHub/WovenWebApp/app/error.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,81170,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.bind(c,8595)),"/Users/dancross/Documents/GitHub/WovenWebApp/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,90461,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,32768,23)),"next/dist/client/components/builtin/unauthorized.js"]}]}.children,L={require:c,loadChunk:()=>Promise.resolve()},M=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/chat/page",pathname:"/chat",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:K},distDir:".next",relativeProjectDir:""});async function N(a,b,d){var C;let J="/chat/page";"/index"===J&&(J="/");let O=(0,h.getRequestMeta)(a,"minimalMode"),P=await M.prepare(a,b,{srcPage:J,multiZoneDraftMode:!1});if(!P)return b.statusCode=400,b.end("Bad Request"),null==d.waitUntil||d.waitUntil.call(d,Promise.resolve()),null;let{buildId:Q,query:R,params:S,pageIsDynamic:T,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,serverActionsManifest:X,clientReferenceManifest:Y,subresourceIntegrityManifest:Z,prerenderManifest:$,isDraftMode:_,resolvedPathname:aa,revalidateOnlyGenerated:ab,routerServerContext:ac,nextConfig:ad,interceptionRoutePatterns:ae}=P,af=(0,r.normalizeAppPath)(J),{isOnDemandRevalidate:ag}=P,ah=ad.experimental.ppr&&!ad.experimental.cacheComponents&&(0,I.isInterceptionRouteAppPath)(aa)?null:M.match(aa,$),ai=!!$.routes[aa],aj=a.headers["user-agent"]||"",ak=(0,u.getBotType)(aj),al=(0,p.isHtmlBotRequest)(a),am=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??"1"===a.headers[t.NEXT_ROUTER_PREFETCH_HEADER],an=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[t.RSC_HEADER],ao=(0,s.getIsPossibleServerAction)(a),ap=(0,m.checkIsAppPPREnabled)(ad.experimental.ppr)&&(null==(C=$.routes[af]??$.dynamicRoutes[af])?void 0:C.renderingMode)==="PARTIALLY_STATIC",aq=!1,ar=!1,as=ap?(0,h.getRequestMeta)(a,"postponed"):void 0,at=ap&&an&&!am,au=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),av=(!al||!ap)&&(!aj||(0,p.shouldServeStreamingMetadata)(aj,ad.htmlLimitedBots)),aw=!!((ah||ai||$.routes[af])&&!(al&&ap)),ax=ap&&!0===ad.experimental.rdcForNavigations&&!0===ad.experimental.clientParamParsing,ay=!0===M.isDev||!aw||"string"==typeof as||(ax&&(0,h.getRequestMeta)(a,"onCacheEntryV2")?at&&!O:at),az=al&&ap,aA=null;_||!aw||ay||ao||as||at||(aA=aa);let aB=aA;!aB&&M.isDev&&(aB=aa),M.isDev||_||!aw||!an||at||(0,k.d)(a.headers);let aC={...E,tree:K,GlobalError:D(),handler:N,routeModule:M,__next_app__:L};X&&Y&&(0,o.setReferenceManifestsSingleton)({page:J,clientReferenceManifest:Y,serverActionsManifest:X,serverModuleMap:(0,q.createServerModuleMap)({serverActionsManifest:X})});let aD=a.method||"GET",aE=(0,g.getTracer)(),aF=aE.getActiveScopeSpan();try{let f=M.getVaryHeader(aa,ae);b.setHeader("Vary",f);let k=async(c,d)=>{let e=new l.NodeNextRequest(a),f=new l.NodeNextResponse(b);return M.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let a=aE.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let d=a.get("next.route");if(d){let a=`${aD} ${d}`;c.setAttributes({"next.route":d,"http.route":d,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aD} ${J}`)})},m=(0,h.getRequestMeta)(a,"incrementalCache"),o=async({span:e,postponed:f,fallbackRouteParams:g,forceStaticRender:i})=>{let l={query:R,params:S,page:af,sharedContext:{buildId:Q},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aC,Component:(0,j.T)(aC),params:S,routeModule:M,page:J,postponed:f,shouldWaitOnAllReady:az,serveStreamingMetadata:av,supportsDynamicResponse:"string"==typeof f||ay,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,subresourceIntegrityManifest:Z,serverActionsManifest:X,clientReferenceManifest:Y,setIsrStatus:null==ac?void 0:ac.setIsrStatus,setReactDebugChannel:null==ac?void 0:ac.setReactDebugChannel,dir:c(33873).join(process.cwd(),M.relativeProjectDir),isDraftMode:_,botType:ak,isOnDemandRevalidate:ag,isPossibleServerAction:ao,assetPrefix:ad.assetPrefix,nextConfigOutput:ad.output,crossOrigin:ad.crossOrigin,trailingSlash:ad.trailingSlash,previewProps:$.preview,deploymentId:ad.deploymentId,enableTainting:ad.experimental.taint,htmlLimitedBots:ad.htmlLimitedBots,reactMaxHeadersLength:ad.reactMaxHeadersLength,multiZoneDraftMode:!1,incrementalCache:m,cacheLifeProfiles:ad.experimental.cacheLife,basePath:ad.basePath,serverActions:ad.experimental.serverActions,...aq||ar?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isDebugDynamicAccesses:aq}:{},experimental:{isRoutePPREnabled:ap,expireTime:ad.expireTime,staleTimes:ad.experimental.staleTimes,cacheComponents:!!ad.experimental.cacheComponents,clientSegmentCache:!!ad.experimental.clientSegmentCache,clientParamParsing:!!ad.experimental.clientParamParsing,dynamicOnHover:!!ad.experimental.dynamicOnHover,inlineCss:!!ad.experimental.inlineCss,authInterrupts:!!ad.experimental.authInterrupts,clientTraceMetadata:ad.experimental.clientTraceMetadata||[],clientParamParsingOrigins:ad.experimental.clientParamParsingOrigins},waitUntil:d.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>M.onRequestError(a,b,d,ac),err:(0,h.getRequestMeta)(a,"invokeError"),dev:M.isDev}};aq&&(l.renderOpts.nextExport=!0,l.renderOpts.supportsDynamicResponse=!1,l.renderOpts.isDebugDynamicAccesses=aq),i&&(l.renderOpts.supportsDynamicResponse=!1);let n=await k(e,l),{metadata:o}=n,{cacheControl:p,headers:q={},fetchTags:r,fetchMetrics:s}=o;if(r&&(q[y.NEXT_CACHE_TAGS_HEADER]=r),a.fetchMetrics=s,aw&&(null==p?void 0:p.revalidate)===0&&!M.isDev&&!ap){let a=o.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${aa}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:v.CachedRouteKind.APP_PAGE,html:n,headers:q,rscData:o.flightData,postponed:o.postponed,status:o.statusCode,segmentData:o.segmentData},cacheControl:p}},p=async({hasResolved:c,previousCacheEntry:f,isRevalidating:g,span:i,forceStaticRender:j=!1})=>{let k,l=!1===M.isDev,q=c||b.writableEnded;if(ag&&ab&&!f&&!O)return(null==ac?void 0:ac.render404)?await ac.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ah&&(k=(0,w.parseFallbackField)(ah.fallback)),k===w.FallbackMode.PRERENDER&&(0,u.isBot)(aj)&&(!ap||al)&&(k=w.FallbackMode.BLOCKING_STATIC_RENDER),(null==f?void 0:f.isStale)===-1&&(ag=!0),ag&&(k!==w.FallbackMode.NOT_FOUND||f)&&(k=w.FallbackMode.BLOCKING_STATIC_RENDER),!O&&k!==w.FallbackMode.BLOCKING_STATIC_RENDER&&aB&&!q&&!_&&T&&(l||!ai)){if((l||ah)&&k===w.FallbackMode.NOT_FOUND)throw new B.NoFallbackError;if(ap&&(ad.experimental.clientParamParsing?!at:!an)){let b=l&&"string"==typeof(null==ah?void 0:ah.fallback)?ah.fallback:af,c=l&&(null==ah?void 0:ah.fallbackRouteParams)?(0,n.createOpaqueFallbackRouteParams)(ah.fallbackRouteParams):ar?(0,n.getFallbackRouteParams)(af,M):null,f=await M.handleResponse({cacheKey:b,req:a,nextConfig:ad,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:$,isRoutePPREnabled:ap,responseGenerator:async()=>o({span:i,postponed:void 0,fallbackRouteParams:c,forceStaticRender:!1}),waitUntil:d.waitUntil});if(null===f)return null;if(f)return delete f.cacheControl,f}}let r=ag||g||!as?void 0:as;if(ax&&!O&&m&&at&&!j){let b=await m.get(aa,{kind:v.IncrementalCacheKind.APP_PAGE,isRoutePPREnabled:!0,isFallback:!1,allowStale:!0});b&&b.value&&b.value.kind===v.CachedRouteKind.APP_PAGE&&(r=b.value.postponed,b&&(-1===b.isStale||!0===b.isStale)&&(0,H.scheduleOnNextTick)(async()=>{let b=M.getResponseCache(a);try{await b.revalidate(aa,m,ap,!1,a=>p({...a,forceStaticRender:!0}),null,c,d.waitUntil)}catch(a){console.error("Error revalidating the page in the background",a)}}))}if(aq&&void 0!==r)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:v.CachedRouteKind.PAGES,html:x.default.EMPTY,pageData:{},headers:void 0,status:void 0}};let s=l&&(null==ah?void 0:ah.fallbackRouteParams)&&(0,h.getRequestMeta)(a,"renderFallbackShell")?(0,n.createOpaqueFallbackRouteParams)(ah.fallbackRouteParams):ar?(0,n.getFallbackRouteParams)(af,M):null;return o({span:i,postponed:r,fallbackRouteParams:s,forceStaticRender:j})},q=async c=>{var f,g,i,j,k;let l,m=await M.handleResponse({cacheKey:aA,responseGenerator:a=>p({span:c,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:ag,isRoutePPREnabled:ap,req:a,nextConfig:ad,prerenderManifest:$,waitUntil:d.waitUntil});if(_&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),M.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!m){if(aA)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(f=m.value)?void 0:f.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(i=m.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let n="string"==typeof m.value.postponed;aw&&!at&&(!n||am)&&(O||b.setHeader("x-nextjs-cache",ag?"REVALIDATED":m.isMiss?"MISS":m.isStale?"STALE":"HIT"),b.setHeader(t.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=m;if(as)l={revalidate:0,expire:void 0};else if(at)l={revalidate:0,expire:void 0};else if(!M.isDev)if(_)l={revalidate:0,expire:void 0};else if(aw){if(m.cacheControl)if("number"==typeof m.cacheControl.revalidate){if(m.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${m.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});l={revalidate:m.cacheControl.revalidate,expire:(null==(j=m.cacheControl)?void 0:j.expire)??ad.expireTime}}else l={revalidate:y.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(l={revalidate:0,expire:void 0});if(m.cacheControl=l,"string"==typeof au&&(null==q?void 0:q.kind)===v.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(k=q.headers)?void 0:k[y.NEXT_CACHE_TAGS_HEADER];O&&aw&&c&&"string"==typeof c&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(au);return void 0!==d?(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(d,t.RSC_CONTENT_TYPE_HEADER),cacheControl:m.cacheControl}):(b.statusCode=204,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:m.cacheControl}))}let r=ax?(0,h.getRequestMeta)(a,"onCacheEntryV2")??(0,h.getRequestMeta)(a,"onCacheEntry"):(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r(m,{url:(0,h.getRequestMeta)(a,"initURL")??a.url}))return null;if(q.headers){let a={...q.headers};for(let[c,d]of(O&&aw||delete a[y.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let s=null==(g=q.headers)?void 0:g[y.NEXT_CACHE_TAGS_HEADER];if(O&&aw&&s&&"string"==typeof s&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,s),!q.status||an&&ap||(b.statusCode=q.status),!O&&q.status&&F.RedirectStatusCode[q.status]&&an&&(b.statusCode=200),n&&!at&&b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"1"),an&&!_){if(void 0===q.rscData){if(q.html.contentType!==t.RSC_CONTENT_TYPE_HEADER)if(ad.experimental.clientParamParsing)return b.statusCode=404,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:m.cacheControl});else throw Object.defineProperty(new G.InvariantError(`Expected RSC response, got ${q.html.contentType}`),"__NEXT_ERROR_CODE",{value:"E789",enumerable:!1,configurable:!0});return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:q.html,cacheControl:m.cacheControl})}return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(q.rscData,t.RSC_CONTENT_TYPE_HEADER),cacheControl:m.cacheControl})}let u=q.html;if(!n||O||an)return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:m.cacheControl});if(aq)return u.push(new ReadableStream({start(a){a.enqueue(z.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}});let w=new TransformStream;return u.push(w.readable),o({span:c,postponed:q.postponed,fallbackRouteParams:null,forceStaticRender:!1}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(w.writable)}).catch(a=>{w.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}})};if(!aF)return await aE.withPropagatedContext(a.headers,()=>aE.trace(i.BaseServerSpan.handleRequest,{spanName:`${aD} ${J}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aD,"http.target":a.url}},q));await q(aF)}catch(b){throw b instanceof B.NoFallbackError||await M.onRequestError(a,b,{routerKind:"App Router",routePath:J,routeType:"render",revalidateReason:(0,f.c)({isStaticGeneration:aw,isOnDemandRevalidate:ag})},ac),b}}},33873:a=>{"use strict";a.exports=require("path")},35123:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,54160,23)),Promise.resolve().then(c.t.bind(c,31603,23)),Promise.resolve().then(c.t.bind(c,68495,23)),Promise.resolve().then(c.t.bind(c,75170,23)),Promise.resolve().then(c.t.bind(c,77526,23)),Promise.resolve().then(c.t.bind(c,78922,23)),Promise.resolve().then(c.t.bind(c,29234,23)),Promise.resolve().then(c.t.bind(c,12263,23)),Promise.resolve().then(c.bind(c,82146))},41025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},41697:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/dancross/Documents/GitHub/WovenWebApp/app/error.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/dancross/Documents/GitHub/WovenWebApp/app/error.tsx","default")},43954:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/interception-routes")},45497:(a,b,c)=>{Promise.resolve().then(c.bind(c,41697))},47825:(a,b,c)=>{Promise.resolve().then(c.bind(c,95480))},50849:(a,b,c)=>{"use strict";function d(){return"/math-brain"}c.d(b,{F:()=>d})},55511:a=>{"use strict";a.exports=require("crypto")},57553:(a,b,c)=>{Promise.resolve().then(c.bind(c,59123))},58683:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,81170,23)),Promise.resolve().then(c.t.bind(c,23597,23)),Promise.resolve().then(c.t.bind(c,36893,23)),Promise.resolve().then(c.t.bind(c,89748,23)),Promise.resolve().then(c.t.bind(c,6060,23)),Promise.resolve().then(c.t.bind(c,7184,23)),Promise.resolve().then(c.t.bind(c,69576,23)),Promise.resolve().then(c.t.bind(c,73041,23)),Promise.resolve().then(c.t.bind(c,51384,23))},59123:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>f,dynamic:()=>e});var d=c(97954);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call dynamic() from the server but dynamic is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/dancross/Documents/GitHub/WovenWebApp/app/chat/page.tsx","dynamic"),f=(0,d.registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/dancross/Documents/GitHub/WovenWebApp/app/chat/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/dancross/Documents/GitHub/WovenWebApp/app/chat/page.tsx","default")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70722:a=>{"use strict";a.exports=require("next/dist/shared/lib/invariant-error")},72513:(a,b,c)=>{"use strict";function d(a,b,c){let d="balance"===a||"mirror"===a&&b,e=c?.latitude,f=c?.longitude,g="number"==typeof e||"string"==typeof e&&""!==e.trim()&&Number.isFinite(Number(e)),h="number"==typeof f||"string"==typeof f&&""!==f.trim()&&Number.isFinite(Number(f)),i=!!c?.timezone,j=!!c&&g&&h&&i,k="number"==typeof c?.hour||"string"==typeof c?.hour&&""!==c.hour,l="number"==typeof c?.minute||"string"==typeof c?.minute&&""!==c.minute;return{needsLoc:d,hasLoc:j,hasBirthTime:k&&l,canSubmit:!d||d&&j}}function e(a){let b=a.translocation;return b&&b.applies?{active:!0,lens:`${b.current_location}${b.house_system?" ("+b.house_system+")":""}`,disclosure:`Relocation ON – Houses remapped to ${b.current_location}`,invariants:"Planetary geometry identical; only arena (House channels) shifted"}:{active:!1,lens:b?.current_location||"Natal Base",disclosure:"Relocation OFF – natal House mapping in effect",invariants:"Planets, signs, aspects as computed from natal coordinates"}}function f(a){if(!a)return!0;let b="number"==typeof a.hour||"string"==typeof a.hour&&""!==a.hour,c="number"==typeof a.minute||"string"==typeof a.minute&&""!==a.minute;return!(b&&c)}c.d(b,{Et:()=>e,S5:()=>f,Vs:()=>d})},75034:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,81170,23))},77731:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>e});var d=c(21124);function e({error:a,reset:b}){return(0,d.jsx)("html",{children:(0,d.jsx)("body",{style:{fontFamily:"ui-sans-serif, system-ui",background:"#0f1115",color:"#e8ecf3",minHeight:"100vh",padding:"24px"},children:(0,d.jsxs)("div",{style:{maxWidth:860,margin:"0 auto"},children:[(0,d.jsx)("h1",{style:{fontSize:28,marginBottom:8},children:"Something went wrong"}),(0,d.jsx)("p",{style:{opacity:.9,marginBottom:16},children:"An error occurred while rendering this page."}),(0,d.jsx)("pre",{style:{whiteSpace:"pre-wrap",background:"#111827",padding:12,borderRadius:8,border:"1px solid #1f2937",overflow:"auto"},children:String(a?.message||"Unknown error")}),a?.digest?(0,d.jsxs)("p",{style:{opacity:.7,marginTop:8},children:["Digest: ",a.digest]}):null,(0,d.jsx)("button",{onClick:b,style:{marginTop:16,background:"#7c5cff",border:"none",padding:"10px 16px",borderRadius:8,color:"#fff",cursor:"pointer"},children:"Try again"})]})})})}},78335:()=>{},81945:(a,b,c)=>{Promise.resolve().then(c.bind(c,77731))},82704:()=>{},83796:(a,b,c)=>{"use strict";c(83946);var d=c(38301),e=function(a){return a&&"object"==typeof a&&"default"in a?a:{default:a}}(d),f="undefined"!=typeof process&&process.env&&!0,g=function(a){return"[object String]"===Object.prototype.toString.call(a)},h=function(){function a(a){var b=void 0===a?{}:a,c=b.name,d=void 0===c?"stylesheet":c,e=b.optimizeForSpeed,h=void 0===e?f:e;i(g(d),"`name` must be a string"),this._name=d,this._deletedRulePlaceholder="#"+d+"-deleted-rule____{}",i("boolean"==typeof h,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=h,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0,this._nonce=null}var b,c=a.prototype;return c.setOptimizeForSpeed=function(a){i("boolean"==typeof a,"`setOptimizeForSpeed` accepts a boolean"),i(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=a,this.inject()},c.isOptimizeForSpeed=function(){return this._optimizeForSpeed},c.inject=function(){var a=this;i(!this._injected,"sheet already injected"),this._injected=!0,this._serverSheet={cssRules:[],insertRule:function(b,c){return"number"==typeof c?a._serverSheet.cssRules[c]={cssText:b}:a._serverSheet.cssRules.push({cssText:b}),c},deleteRule:function(b){a._serverSheet.cssRules[b]=null}}},c.getSheetForTag=function(a){if(a.sheet)return a.sheet;for(var b=0;b<document.styleSheets.length;b++)if(document.styleSheets[b].ownerNode===a)return document.styleSheets[b]},c.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},c.insertRule=function(a,b){return i(g(a),"`insertRule` accepts only strings"),"number"!=typeof b&&(b=this._serverSheet.cssRules.length),this._serverSheet.insertRule(a,b),this._rulesCount++},c.replaceRule=function(a,b){this._optimizeForSpeed;var c=this._serverSheet;if(b.trim()||(b=this._deletedRulePlaceholder),!c.cssRules[a])return a;c.deleteRule(a);try{c.insertRule(b,a)}catch(d){f||console.warn("StyleSheet: illegal rule: \n\n"+b+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),c.insertRule(this._deletedRulePlaceholder,a)}return a},c.deleteRule=function(a){this._serverSheet.deleteRule(a)},c.flush=function(){this._injected=!1,this._rulesCount=0,this._serverSheet.cssRules=[]},c.cssRules=function(){return this._serverSheet.cssRules},c.makeStyleTag=function(a,b,c){b&&i(g(b),"makeStyleTag accepts only strings as second parameter");var d=document.createElement("style");this._nonce&&d.setAttribute("nonce",this._nonce),d.type="text/css",d.setAttribute("data-"+a,""),b&&d.appendChild(document.createTextNode(b));var e=document.head||document.getElementsByTagName("head")[0];return c?e.insertBefore(d,c):e.appendChild(d),d},b=[{key:"length",get:function(){return this._rulesCount}}],function(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}(a.prototype,b),a}();function i(a,b){if(!a)throw Error("StyleSheet: "+b+".")}var j=function(a){for(var b=5381,c=a.length;c;)b=33*b^a.charCodeAt(--c);return b>>>0},k={};function l(a,b){if(!b)return"jsx-"+a;var c=String(b),d=a+c;return k[d]||(k[d]="jsx-"+j(a+"-"+c)),k[d]}function m(a,b){var c=a+(b=b.replace(/\/style/gi,"\\/style"));return k[c]||(k[c]=b.replace(/__jsx-style-dynamic-selector/g,a)),k[c]}var n=function(){function a(a){var b=void 0===a?{}:a,c=b.styleSheet,d=void 0===c?null:c,e=b.optimizeForSpeed,f=void 0!==e&&e;this._sheet=d||new h({name:"styled-jsx",optimizeForSpeed:f}),this._sheet.inject(),d&&"boolean"==typeof f&&(this._sheet.setOptimizeForSpeed(f),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var b=a.prototype;return b.add=function(a){var b=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(a.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed());var c=this.getIdAndRules(a),d=c.styleId,e=c.rules;if(d in this._instancesCounts){this._instancesCounts[d]+=1;return}var f=e.map(function(a){return b._sheet.insertRule(a)}).filter(function(a){return -1!==a});this._indices[d]=f,this._instancesCounts[d]=1},b.remove=function(a){var b=this,c=this.getIdAndRules(a).styleId;if(function(a,b){if(!a)throw Error("StyleSheetRegistry: "+b+".")}(c in this._instancesCounts,"styleId: `"+c+"` not found"),this._instancesCounts[c]-=1,this._instancesCounts[c]<1){var d=this._fromServer&&this._fromServer[c];d?(d.parentNode.removeChild(d),delete this._fromServer[c]):(this._indices[c].forEach(function(a){return b._sheet.deleteRule(a)}),delete this._indices[c]),delete this._instancesCounts[c]}},b.update=function(a,b){this.add(b),this.remove(a)},b.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},b.cssRules=function(){var a=this,b=this._fromServer?Object.keys(this._fromServer).map(function(b){return[b,a._fromServer[b]]}):[],c=this._sheet.cssRules();return b.concat(Object.keys(this._indices).map(function(b){return[b,a._indices[b].map(function(a){return c[a].cssText}).join(a._optimizeForSpeed?"":"\n")]}).filter(function(a){return!!a[1]}))},b.styles=function(a){var b,c;return b=this.cssRules(),void 0===(c=a)&&(c={}),b.map(function(a){var b=a[0],d=a[1];return e.default.createElement("style",{id:"__"+b,key:"__"+b,nonce:c.nonce?c.nonce:void 0,dangerouslySetInnerHTML:{__html:d}})})},b.getIdAndRules=function(a){var b=a.children,c=a.dynamic,d=a.id;if(c){var e=l(d,c);return{styleId:e,rules:Array.isArray(b)?b.map(function(a){return m(e,a)}):[m(e,b)]}}return{styleId:l(d),rules:Array.isArray(b)?b:[b]}},b.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(a,b){return a[b.id.slice(2)]=b,a},{})},a}(),o=d.createContext(null);o.displayName="StyleSheetContext";e.default.useInsertionEffect||e.default.useLayoutEffect;var p=void 0;function q(a){var b=p||d.useContext(o);return b&&b.add(a),null}q.dynamic=function(a){return a.map(function(a){return l(a[0],a[1])}).join(" ")},b.style=q},83946:()=>{},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},95480:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>ah,dynamic:()=>ag});var d=c(21124),e=c(38301),f=c.n(e),g=c(55511),h=c.n(g);let i={randomUUID:h().randomUUID},j=new Uint8Array(256),k=j.length,l=[];for(let a=0;a<256;++a)l.push((a+256).toString(16).slice(1));let m=function(a,b,c){if(i.randomUUID&&!b&&!a)return i.randomUUID();let d=(a=a||{}).random||(a.rng||function(){return k>j.length-16&&(h().randomFillSync(j),k=0),j.slice(k,k+=16)})();if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,b){c=c||0;for(let a=0;a<16;++a)b[c+a]=d[a];return b}return function(a,b=0){return l[a[b+0]]+l[a[b+1]]+l[a[b+2]]+l[a[b+3]]+"-"+l[a[b+4]]+l[a[b+5]]+"-"+l[a[b+6]]+l[a[b+7]]+"-"+l[a[b+8]]+l[a[b+9]]+"-"+l[a[b+10]]+l[a[b+11]]+l[a[b+12]]+l[a[b+13]]+l[a[b+14]]+l[a[b+15]]}(d)};function n(){if("undefined"!=typeof crypto){try{if("function"==typeof crypto.randomUUID)return crypto.randomUUID()}catch{}try{if("function"==typeof crypto.getRandomValues){let a=new Uint8Array(16);crypto.getRandomValues(a),a[6]=15&a[6]|64,a[8]=63&a[8]|128;let b=[];for(let c=0;c<a.length;c++)b.push(a[c].toString(16).padStart(2,"0"));return`${b.slice(0,4).join("")}-${b.slice(4,6).join("")}-${b.slice(6,8).join("")}-${b.slice(8,10).join("")}-${b.slice(10,16).join("")}`}}catch{}}return m()}let o=[{level:-5,anchor:"Collapse",emojis:["\uD83C\uDF0B","\uD83E\uDDE9","⬇️"],description:"Maximum restrictive tilt; compression/failure points"},{level:-4,anchor:"Grind",emojis:["\uD83D\uDD70","⚔","\uD83C\uDF2A"],description:"Sustained resistance; heavy duty load"},{level:-3,anchor:"Friction",emojis:["⚔","\uD83C\uDF0A","\uD83C\uDF2B"],description:"Conflicts or cross-purposes slow motion"},{level:-2,anchor:"Contraction",emojis:["\uD83C\uDF2B","\uD83E\uDDE9","⬇️"],description:"Narrowing options; ambiguity or energy drain"},{level:-1,anchor:"Drag",emojis:["\uD83C\uDF2A","\uD83C\uDF2B"],description:"Subtle headwind; minor loops or haze"},{level:0,anchor:"Equilibrium",emojis:["⚖️"],description:"Net-neutral tilt; forces cancel or diffuse"},{level:1,anchor:"Lift",emojis:["\uD83C\uDF31","✨"],description:"Gentle tailwind; beginnings sprout"},{level:2,anchor:"Flow",emojis:["\uD83C\uDF0A","\uD83E\uDDD8"],description:"Smooth adaptability; things click"},{level:3,anchor:"Harmony",emojis:["\uD83E\uDDD8","✨","\uD83C\uDF0A"],description:"Coherent progress; both/and solutions"},{level:4,anchor:"Expansion",emojis:["\uD83D\uDC8E","\uD83D\uDD25","\uD83E\uDD8B"],description:"Widening opportunities; clear insight fuels growth"},{level:5,anchor:"Liberation",emojis:["\uD83E\uDD8B","\uD83C\uDF08","\uD83D\uDD25"],description:"Peak openness; breakthroughs/big-sky view"}],p={orb:1.2,resonance:1.1,potency:1,recursion:1.3,aspect:.9};function q(a){let b=Math.max(-5,Math.min(5,Math.round(a)));return o.find(a=>a.level===b)||o[5]}function r(a,b){let c=function(a,b){let c=function(a,b=p){let{magnitude:c,valence:d}=a,e=q(d);if(0===e.level)return[{emoji:"⚖️",label:e.anchor,score:1,type:"valence"}];let f=1;return c<=2?f=Math.min(2,e.emojis.length):c>=3&&(f=Math.min(3,e.emojis.length)),[...e.emojis].sort(()=>Math.random()-.5).slice(0,f).map(a=>({emoji:a,label:e.anchor,score:1,type:"valence"}))}(a,b),d=q(a.valence);if(0===c.length)return`⚡ ${a.magnitude} \xb7 ⚖️ Neutral`;let e=c.map(a=>a.emoji).join("");return`⚡ ${a.magnitude} \xb7 ${e} ${d.anchor}`}(a,b),d=["➿","\uD83D\uDD04","\uD83D\uDD00","\uD83E\uDDE9","\uD83C\uDF00"][Math.min(Math.floor(a.volatility),4)]||"➿";return`${c} \xb7 ${d} ${a.volatility}`}function s({compact:a=!1,className:b=""}){let[c,f]=(0,e.useState)(null),[g,h]=(0,e.useState)(!1);if(!c)return null;let i=a=>a>=90?"#f87171":a>=70?"#facc15":"var(--good)",j=a=>({background:i(a)}),k=a=>({color:i(a)});return a&&!g?(0,d.jsxs)("button",{onClick:()=>h(!0),className:`flex items-center gap-2 px-3 py-1 rounded-lg hover:bg-gray-700 transition-colors ${b}`,style:{background:"var(--soft)",border:"1px solid var(--line)"},children:[(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)("div",{className:"w-2 h-2 rounded-full",style:{background:"var(--good)"}}),(0,d.jsxs)("span",{className:"text-xs",style:{color:"var(--muted)"},children:[c.requestsToday,"/",c.limits.requestsPerDay]})]}),(0,d.jsx)("span",{className:"text-xs",style:{color:"var(--muted)"},children:"API"})]}):(0,d.jsxs)("div",{className:`rounded-lg p-4 ${b}`,style:{background:"var(--panel)",border:"1px solid var(--line)"},children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,d.jsx)("h3",{className:"text-sm font-medium",style:{color:"var(--text)"},children:"Gemini API Usage"}),a&&(0,d.jsx)("button",{onClick:()=>h(!1),className:"text-xs",style:{color:"var(--muted)"},children:"✕"})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsx)(t,{label:"Daily Requests",value:`${c.requestsToday}/${c.limits.requestsPerDay}`,pct:c.percentages.dailyRequests,txt:k,bar:j}),(0,d.jsx)(t,{label:"Daily Tokens",value:`${c.tokensToday.toLocaleString()}/${c.limits.tokensPerDay.toLocaleString()}`,pct:c.percentages.dailyTokens,txt:k,bar:j}),(0,d.jsx)(t,{label:"Requests/Minute",value:`${c.requestsThisMinute}/${c.limits.requestsPerMinute}`,pct:c.percentages.minuteRequests,txt:k,bar:j})]}),(0,d.jsx)("div",{className:"mt-3 pt-2",style:{borderTop:"1px solid var(--line)"},children:(0,d.jsxs)("div",{className:"flex items-center gap-2 text-xs",style:{color:"var(--muted)"},children:[(0,d.jsx)("div",{className:"w-1.5 h-1.5 rounded-full",style:{background:"var(--good)"}}),(0,d.jsx)("span",{children:"Free tier limits • Resets daily"})]})})]})}function t({label:a,value:b,pct:c,txt:e,bar:f}){return(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,d.jsx)("span",{className:"text-xs",style:{color:"var(--muted)"},children:a}),(0,d.jsxs)("span",{className:"text-xs",style:e(c),children:[b," (",c,"%)"]})]}),(0,d.jsx)("div",{className:"w-full h-1.5 rounded-full",style:{background:"var(--soft)"},children:(0,d.jsx)("div",{className:"h-1.5 rounded-full transition-all duration-300",style:{width:`${Math.min(c,100)}%`,...f(c)}})})]})}var u=c(72513);let v={mars:{background:"linear-gradient(135deg, #ff6b35 0%, #f7931e 100%)",textColor:"#ffffff",accentColor:"#ffed4e"},sun:{background:"linear-gradient(135deg, #ff8a00 0%, #e52e71 100%)",textColor:"#ffffff",accentColor:"#ffd700"},moon:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",textColor:"#ffffff",accentColor:"#e0e7ff"},neptune:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",textColor:"#ffffff",accentColor:"#b3e5fc"},saturn:{background:"linear-gradient(135deg, #6c7b7f 0%, #99a9b5 100%)",textColor:"#ffffff",accentColor:"#e8eaf6"},chiron:{background:"linear-gradient(135deg, #8360c3 0%, #2ebf91 100%)",textColor:"#ffffff",accentColor:"#f3e5f5"},jupiter:{background:"linear-gradient(135deg, #2c3e50 0%, #4a6741 100%)",textColor:"#ffffff",accentColor:"#81c784"},venus:{background:"linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)",textColor:"#2c3e50",accentColor:"#ff8a80"},mercury:{background:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)",textColor:"#2c3e50",accentColor:"#4fc3f7"},uranus:{background:"linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)",textColor:"#2c3e50",accentColor:"#ab47bc"},pluto:{background:"linear-gradient(135deg, #232526 0%, #414345 100%)",textColor:"#ffffff",accentColor:"#ff6b6b"}},w={mars:"♂",sun:"☉",moon:"☽",neptune:"♆",saturn:"♄",chiron:"⚷",jupiter:"♃",venus:"♀",mercury:"☿",uranus:"♅",pluto:"♇"};function x(a){return({mars:"♂",sun:"☉",moon:"☽",neptune:"♆",saturn:"♄",chiron:"⚷",jupiter:"♃",venus:"♀",mercury:"☿",uranus:"♅",pluto:"♇"})[a]||"✦"}var y=c(95627),z=c.n(y);let A=({messageId:a,onFeedback:b,disabled:c=!1,checkpointType:f="general"})=>{let[g,h]=(0,e.useState)(null),[i,j]=(0,e.useState)(""),[k,l]=(0,e.useState)(!1),m=c=>{h(c),b(a,c,i||void 0),("no"===c||"unclear"===c)&&l(!0)};return c?(0,d.jsx)("div",{className:"ping-feedback-disabled",children:(0,d.jsx)("span",{className:"feedback-label",children:"✓ Feedback recorded"})}):(0,d.jsxs)("div",{className:"jsx-bec06b549f34e812 ping-feedback",children:[(0,d.jsx)("div",{className:"jsx-bec06b549f34e812 feedback-header",children:(0,d.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-label",children:(a=>{switch(a){case"hook":return"Does this Hook Stack recognition resonate?";case"vector":return"Does this hidden push/counterweight feel accurate?";case"aspect":return"Does this high-voltage pattern ring true?";case"repair":return"Does this repair feel true to your experience?";default:return"Does any of this feel familiar?"}})(f)})}),(0,d.jsxs)("div",{className:"jsx-bec06b549f34e812 feedback-options",children:[(0,d.jsxs)("button",{onClick:()=>m("yes"),disabled:!!g,className:`jsx-bec06b549f34e812 feedback-btn yes ${"yes"===g?"selected":""}`,children:[(0,d.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-icon",children:"✓"}),(0,d.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-text",children:"Yes, resonates"})]}),(0,d.jsxs)("button",{onClick:()=>m("maybe"),disabled:!!g,className:`jsx-bec06b549f34e812 feedback-btn maybe ${"maybe"===g?"selected":""}`,children:[(0,d.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-icon",children:"~"}),(0,d.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-text",children:"Partly/Maybe"})]}),(0,d.jsxs)("button",{onClick:()=>m("no"),disabled:!!g,className:`jsx-bec06b549f34e812 feedback-btn no ${"no"===g?"selected":""}`,children:[(0,d.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-icon",children:"✗"}),(0,d.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-text",children:"No, doesn't fit"})]}),(0,d.jsxs)("button",{onClick:()=>m("unclear"),disabled:!!g,className:`jsx-bec06b549f34e812 feedback-btn unclear ${"unclear"===g?"selected":""}`,children:[(0,d.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-icon",children:"?"}),(0,d.jsx)("span",{className:"jsx-bec06b549f34e812 feedback-text",children:"Unclear/Confusing"})]})]}),k&&(0,d.jsxs)("div",{className:"jsx-bec06b549f34e812 feedback-note",children:[(0,d.jsx)("textarea",{value:i,onChange:a=>j(a.target.value),placeholder:"Optional: What specifically didn't resonate or was unclear?",rows:2,className:"jsx-bec06b549f34e812 note-input"}),(0,d.jsx)("button",{onClick:()=>{g&&(b(a,g,i||void 0),l(!1))},className:"jsx-bec06b549f34e812 note-submit",children:"Submit feedback"})]}),(0,d.jsx)(z(),{id:"bec06b549f34e812",children:'.ping-feedback.jsx-bec06b549f34e812{margin:16px 0;padding:16px;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.1);border-radius:8px;font-family:"Inter",sans-serif}.ping-feedback-disabled.jsx-bec06b549f34e812{margin:8px 0;padding:8px 12px;background:rgba(0,255,0,.1);border:1px solid rgba(0,255,0,.2);border-radius:6px;font-size:12px;color:#4ade80}.feedback-header.jsx-bec06b549f34e812{margin-bottom:12px}.feedback-label.jsx-bec06b549f34e812{font-size:14px;font-weight:500;color:#e5e7eb;font-style:italic}.feedback-options.jsx-bec06b549f34e812{display:flex;gap:8px;flex-wrap:wrap}.feedback-btn.jsx-bec06b549f34e812{display:flex;align-items:center;gap:6px;padding:8px 12px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:6px;color:#d1d5db;font-size:12px;cursor:pointer;transition:all.2s ease;min-width:100px}.feedback-btn.jsx-bec06b549f34e812:hover:not(:disabled){background:rgba(255,255,255,.1);border-color:rgba(255,255,255,.2)}.feedback-btn.jsx-bec06b549f34e812:disabled{opacity:.5;cursor:not-allowed}.feedback-btn.selected.jsx-bec06b549f34e812{background:rgba(59,130,246,.2);border-color:#3b82f6;color:#93c5fd}.feedback-btn.yes.selected.jsx-bec06b549f34e812{background:rgba(34,197,94,.2);border-color:#22c55e;color:#86efac}.feedback-btn.no.selected.jsx-bec06b549f34e812{background:rgba(239,68,68,.2);border-color:#ef4444;color:#fca5a5}.feedback-btn.maybe.selected.jsx-bec06b549f34e812{background:rgba(245,158,11,.2);border-color:#f59e0b;color:#fcd34d}.feedback-btn.unclear.selected.jsx-bec06b549f34e812{background:rgba(139,92,246,.2);border-color:#8b5cf6;color:#c4b5fd}.feedback-icon.jsx-bec06b549f34e812{font-weight:bold;font-size:14px}.feedback-text.jsx-bec06b549f34e812{font-weight:400}.feedback-note.jsx-bec06b549f34e812{margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,.1)}.note-input.jsx-bec06b549f34e812{width:100%;padding:8px 12px;background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.1);border-radius:6px;color:#e5e7eb;font-size:12px;font-family:"Inter",sans-serif;resize:vertical;margin-bottom:8px}.note-input.jsx-bec06b549f34e812:focus{outline:none;border-color:#3b82f6}.note-input.jsx-bec06b549f34e812::placeholder{color:#6b7280}.note-submit.jsx-bec06b549f34e812{padding:6px 12px;background:#3b82f6;border:none;border-radius:4px;color:white;font-size:11px;cursor:pointer;font-family:"Inter",sans-serif}.note-submit.jsx-bec06b549f34e812:hover{background:#2563eb}'})]})};class B{constructor(){this.feedbackData=[],this.sealedSessions=new Set,this.sessionId=this.generateSessionId(),this.loadFromStorage()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}loadFromStorage(){}saveToStorage(){}getCurrentSessionId(){return this.sessionId}sealSession(a){let b=a||this.sessionId;this.sealedSessions.add(b),a&&a!==this.sessionId||(this.sessionId=this.generateSessionId())}isSessionSealed(a){let b=a||this.sessionId;return this.sealedSessions.has(b)}registerPending(a,b,c){if(this.isSessionSealed(),this.feedbackData.find(b=>b.messageId===a))return;let d=new Date().toISOString(),e={messageId:a,response:"pending",timestamp:d,sessionId:this.sessionId,checkpointType:b,messageContent:c,createdAt:d,firstSessionId:this.sessionId};this.feedbackData.push(e),this.saveToStorage()}recordFeedback(a,b,c,d,e){let f={messageId:a,response:b,note:c,timestamp:new Date().toISOString(),sessionId:this.sessionId,checkpointType:d,messageContent:e,sstCategory:"yes"===b?"WB":"maybe"===b?"ABE":"no"===b||"unclear"===b?"OSR":void 0};this.feedbackData=this.feedbackData.filter(b=>b.messageId!==a),this.feedbackData.push(f),this.saveToStorage()}getFeedback(a){return this.feedbackData.find(b=>b.messageId===a)}getHitRateStats(a=!1){let b=a?this.feedbackData.filter(a=>a.sessionId===this.sessionId):this.feedbackData,c=Date.now(),d=b.filter(a=>!("pending"===a.response&&a.createdAt&&c-new Date(a.createdAt).getTime()>6048e5)),e=d.filter(a=>"pending"!==a.response),f=e.length,g=e.filter(a=>"yes"===a.response).length,h=e.filter(a=>"no"===a.response).length,i=e.filter(a=>"maybe"===a.response).length,j=e.filter(a=>"unclear"===a.response).length,k=d.filter(a=>"pending"===a.response).length,l={};return["hook","vector","aspect","general","repair"].forEach(a=>{let b=e.filter(b=>b.checkpointType===a),c=b.length;if(c>0){let d=b.filter(a=>"yes"===a.response).length,e=b.filter(a=>"maybe"===a.response).length,f=b.filter(a=>"unclear"===a.response).length;l[a]={total:c,accuracyRate:Math.round((d+.5*e)/c*1e3)/10,clarityRate:Math.round((c-f)/c*1e3)/10}}}),{total:f,accuracyRate:Math.round(10*(f>0?(g+.5*i)/f*100:0))/10,clarityRate:Math.round(10*(f>0?(f-j)/f*100:0))/10,breakdown:{yes:g,no:h,maybe:i,unclear:j,pending:k},byCheckpointType:l}}getAllFeedback(){return[...this.feedbackData]}clearData(){this.feedbackData=[],this.saveToStorage()}getSessionPatterns(a){let b=a||this.sessionId,c=this.feedbackData.filter(a=>a.sessionId===b).filter(a=>"pending"!==a.response),d=c.filter(a=>"WB"===a.sstCategory&&a.messageContent).map(a=>a.messageContent),e=c.filter(a=>"ABE"===a.sstCategory&&a.messageContent).map(a=>a.messageContent);return{wbPatterns:d,abePatterns:e,osrPatterns:c.filter(a=>"OSR"===a.sstCategory&&a.messageContent&&!a.probe).map(a=>({content:a.messageContent,response:a.response,note:a.note})),osrProbes:c.filter(a=>"OSR"===a.sstCategory&&a.probe).map(a=>({mirrorId:a.messageId,probe:a.probe.type,mappedTo:a.probe.mappedTo||"INCONCLUSIVE",area:a.probe.area,text:a.probe.userText}))}}getPendingItems(a=!1){let b=a?this.feedbackData.filter(a=>a.sessionId===this.sessionId):this.feedbackData,c=Date.now();return b.filter(a=>"pending"===a.response&&!("pending"===a.response&&a.createdAt&&c-new Date(a.createdAt).getTime()>6048e5)).map(a=>{let b=Math.floor((c-(a.createdAt?new Date(a.createdAt).getTime():new Date(a.timestamp).getTime()))/864e5),d="hook"===a.checkpointType?3:"aspect"===a.checkpointType?2:+("vector"===a.checkpointType);return{messageId:a.messageId,checkpointType:a.checkpointType,messageContent:a.messageContent,createdAt:a.createdAt,ageDays:b,priority:d}}).sort((a,b)=>b.priority-a.priority||b.ageDays-a.ageDays)}getPendingCount(a=!1){let b=a?this.feedbackData.filter(a=>a.sessionId===this.sessionId):this.feedbackData,c=Date.now();return b.filter(a=>"pending"===a.response&&!("pending"===a.response&&a.createdAt&&c-new Date(a.createdAt).getTime()>6048e5)).length}getOSRPatterns(a){return this.getSessionPatterns(a).osrPatterns}exportSessionDiagnostics(a){let b=a||this.sessionId;return{sessionId:b,patterns:this.getSessionPatterns(b),stats:this.getHitRateStats(!0)}}exportData(){return JSON.stringify({sessionId:this.sessionId,exportDate:new Date().toISOString(),feedbackData:this.feedbackData,stats:this.getHitRateStats()},null,2)}}let C=new B,D=({className:a=""})=>{let[b,c]=(0,e.useState)(null),[f,g]=(0,e.useState)(!1),[h,i]=(0,e.useState)(!0),j=()=>{c(C.getHitRateStats(h))};if((0,e.useEffect)(()=>{j();let a=()=>j();window.addEventListener("storage",a);let b=setInterval(j,2e3);return()=>{window.removeEventListener("storage",a),clearInterval(b)}},[h]),!b||0===b.total)return(0,d.jsxs)("div",{className:`jsx-18fb32cf3300aa84 hit-rate-display empty ${a}`,children:[(0,d.jsx)("span",{className:"jsx-18fb32cf3300aa84 hit-rate-label",children:"\uD83C\uDFAF Accuracy Tracking"}),(0,d.jsx)("span",{className:"jsx-18fb32cf3300aa84 hit-rate-value",children:"No feedback yet"}),(0,d.jsx)(z(),{id:"18fb32cf3300aa84",children:'.hit-rate-display.jsx-18fb32cf3300aa84{display:flex;align-items:center;gap:8px;padding:6px 10px;background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.1);border-radius:6px;font-size:11px;color:#9ca3af;font-family:"Inter",sans-serif}.hit-rate-label.jsx-18fb32cf3300aa84{font-weight:500}.hit-rate-value.jsx-18fb32cf3300aa84{font-weight:300;opacity:.7}'})]});let k=a=>a>=75?"#22c55e":a>=50?"#f59e0b":"#ef4444";return(0,d.jsxs)("div",{className:`jsx-dcda58115d68571d hit-rate-display ${a}`,children:[(0,d.jsxs)("div",{onClick:()=>g(!f),className:"jsx-dcda58115d68571d hit-rate-main",children:[(0,d.jsx)("span",{className:"jsx-dcda58115d68571d hit-rate-label",children:"\uD83C\uDFAF Accuracy"}),(0,d.jsxs)("span",{style:{color:k(b.accuracyRate)},className:"jsx-dcda58115d68571d hit-rate-value accuracy",children:[b.accuracyRate.toFixed(1),"%"]}),(0,d.jsxs)("span",{className:"jsx-dcda58115d68571d hit-rate-count",children:["(",b.total,")"]}),(0,d.jsx)("span",{className:"jsx-dcda58115d68571d toggle-icon",children:f?"▼":"▶"})]}),f&&(0,d.jsxs)("div",{className:"jsx-dcda58115d68571d hit-rate-details",children:[(0,d.jsx)("div",{className:"jsx-dcda58115d68571d stats-row",children:(0,d.jsxs)("div",{className:"jsx-dcda58115d68571d scope-toggle",children:[(0,d.jsx)("button",{onClick:()=>i(!0),className:"jsx-dcda58115d68571d "+((h?"active":"")||""),children:"This Session"}),(0,d.jsx)("button",{onClick:()=>i(!1),className:"jsx-dcda58115d68571d "+((h?"":"active")||""),children:"All Time"})]})}),(0,d.jsxs)("div",{className:"jsx-dcda58115d68571d stats-row",children:[(0,d.jsx)("span",{className:"jsx-dcda58115d68571d stat-label",children:"Clarity Rate:"}),(0,d.jsxs)("span",{style:{color:(a=>a>=80?"#22c55e":a>=60?"#f59e0b":"#ef4444")(b.clarityRate)},className:"jsx-dcda58115d68571d stat-value",children:[b.clarityRate.toFixed(1),"%"]})]}),(0,d.jsxs)("div",{className:"jsx-dcda58115d68571d stats-breakdown",children:[(0,d.jsxs)("div",{className:"jsx-dcda58115d68571d breakdown-item yes",children:[(0,d.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-icon",children:"✓"}),(0,d.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-label",children:"Yes"}),(0,d.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-count",children:b.breakdown.yes})]}),(0,d.jsxs)("div",{className:"jsx-dcda58115d68571d breakdown-item maybe",children:[(0,d.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-icon",children:"~"}),(0,d.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-label",children:"Maybe"}),(0,d.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-count",children:b.breakdown.maybe})]}),(0,d.jsxs)("div",{className:"jsx-dcda58115d68571d breakdown-item no",children:[(0,d.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-icon",children:"✗"}),(0,d.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-label",children:"No"}),(0,d.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-count",children:b.breakdown.no})]}),(0,d.jsxs)("div",{className:"jsx-dcda58115d68571d breakdown-item unclear",children:[(0,d.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-icon",children:"?"}),(0,d.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-label",children:"Unclear"}),(0,d.jsx)("span",{className:"jsx-dcda58115d68571d breakdown-count",children:b.breakdown.unclear})]})]}),Object.keys(b.byCheckpointType).length>0&&(0,d.jsxs)("div",{className:"jsx-dcda58115d68571d checkpoint-breakdown",children:[(0,d.jsx)("div",{className:"jsx-dcda58115d68571d breakdown-header",children:"By Checkpoint Type:"}),Object.entries(b.byCheckpointType).map(([a,b])=>(0,d.jsxs)("div",{className:"jsx-dcda58115d68571d checkpoint-item",children:[(0,d.jsxs)("span",{className:"jsx-dcda58115d68571d checkpoint-type",children:[a,":"]}),(0,d.jsxs)("span",{style:{color:k(b.accuracyRate)},className:"jsx-dcda58115d68571d checkpoint-accuracy",children:[b.accuracyRate.toFixed(1),"%"]}),(0,d.jsxs)("span",{className:"jsx-dcda58115d68571d checkpoint-count",children:["(",b.total,")"]})]},a))]})]}),(0,d.jsx)(z(),{id:"dcda58115d68571d",children:'.hit-rate-display.jsx-dcda58115d68571d{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.1);border-radius:8px;font-family:"Inter",sans-serif;overflow:hidden}.hit-rate-main.jsx-dcda58115d68571d{display:flex;align-items:center;gap:8px;padding:8px 12px;cursor:pointer;transition:background.2s ease}.hit-rate-main.jsx-dcda58115d68571d:hover{background:rgba(255,255,255,.05)}.hit-rate-label.jsx-dcda58115d68571d{font-size:11px;font-weight:500;color:#e5e7eb}.hit-rate-value.accuracy.jsx-dcda58115d68571d{font-size:12px;font-weight:600}.hit-rate-count.jsx-dcda58115d68571d{font-size:10px;color:#9ca3af;font-weight:300}.toggle-icon.jsx-dcda58115d68571d{margin-left:auto;font-size:10px;color:#6b7280}.hit-rate-details.jsx-dcda58115d68571d{padding:8px 12px;border-top:1px solid rgba(255,255,255,.1);background:rgba(0,0,0,.2)}.stats-row.jsx-dcda58115d68571d{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:10px}.stats-row.jsx-dcda58115d68571d:last-child{margin-bottom:0}.scope-toggle.jsx-dcda58115d68571d{display:flex;gap:4px}.scope-toggle.jsx-dcda58115d68571d button.jsx-dcda58115d68571d{padding:3px 6px;font-size:9px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.05);color:#9ca3af;border-radius:3px;cursor:pointer;transition:all.2s ease}.scope-toggle.jsx-dcda58115d68571d button.active.jsx-dcda58115d68571d{background:#3b82f6;border-color:#3b82f6;color:white}.stat-label.jsx-dcda58115d68571d{color:#d1d5db}.stat-value.jsx-dcda58115d68571d{font-weight:600}.stats-breakdown.jsx-dcda58115d68571d{display:grid;grid-template-columns:1fr 1fr;gap:4px;margin-top:8px}.breakdown-item.jsx-dcda58115d68571d{display:flex;align-items:center;gap:4px;padding:3px 6px;border-radius:4px;background:rgba(255,255,255,.03);font-size:9px}.breakdown-item.yes.jsx-dcda58115d68571d .breakdown-icon.jsx-dcda58115d68571d{color:#22c55e}.breakdown-item.maybe.jsx-dcda58115d68571d .breakdown-icon.jsx-dcda58115d68571d{color:#f59e0b}.breakdown-item.no.jsx-dcda58115d68571d .breakdown-icon.jsx-dcda58115d68571d{color:#ef4444}.breakdown-item.unclear.jsx-dcda58115d68571d .breakdown-icon.jsx-dcda58115d68571d{color:#8b5cf6}.breakdown-icon.jsx-dcda58115d68571d{font-weight:bold;font-size:10px}.breakdown-label.jsx-dcda58115d68571d{color:#d1d5db;flex:1}.breakdown-count.jsx-dcda58115d68571d{color:#9ca3af;font-weight:500}.checkpoint-breakdown.jsx-dcda58115d68571d{margin-top:12px;padding-top:8px;border-top:1px solid rgba(255,255,255,.1)}.breakdown-header.jsx-dcda58115d68571d{font-size:9px;color:#d1d5db;font-weight:500;margin-bottom:6px}.checkpoint-item.jsx-dcda58115d68571d{display:flex;align-items:center;gap:6px;padding:2px 0;font-size:9px}.checkpoint-type.jsx-dcda58115d68571d{color:#9ca3af;text-transform:capitalize;min-width:40px}.checkpoint-accuracy.jsx-dcda58115d68571d{font-weight:600;min-width:35px}.checkpoint-count.jsx-dcda58115d68571d{color:#6b7280;font-size:8px}'})]})},E={Initiator:{signs:["Aries"],keywords:["ignite","spark","drive","action","catalyst","start","begin"],tonality:["bold","urgent","direct","fast"],behaviors:["fears stagnation","needs action","initiates","leads"]},Stabilizer:{signs:["Taurus"],keywords:["anchor","endure","stable","steady","persist","build"],tonality:["calm","grounded","solid","reliable"],behaviors:["fears chaos","needs security","preserves","maintains"]},Connector:{signs:["Gemini"],keywords:["connect","share","communicate","link","exchange","network"],tonality:["quick","witty","verbal","fluid"],behaviors:["fears isolation","needs interaction","bridges","translates"]},Nurturer:{signs:["Cancer"],keywords:["care","protect","nurture","shield","support","tend"],tonality:["warm","caring","emotional","gentle"],behaviors:["fears neglect","needs connection","protects","provides"]},Validator:{signs:["Leo"],keywords:["shine","validate","recognize","celebrate","honor","appreciate"],tonality:["vibrant","confident","expressive","warm"],behaviors:["fears obscurity","needs recognition","affirms","celebrates"]},Optimizer:{signs:["Virgo"],keywords:["perfect","refine","fix","improve","analyze","correct"],tonality:["precise","analytical","detailed","careful"],behaviors:["fears error","needs accuracy","refines","perfects"]},Harmonizer:{signs:["Libra"],keywords:["balance","harmonize","mediate","fair","equalize","diplomatic"],tonality:["polished","fair","balanced","gracious"],behaviors:["fears conflict","needs harmony","mediates","balances"]},Investigator:{signs:["Scorpio"],keywords:["probe","uncover","investigate","penetrate","reveal","transform"],tonality:["intense","probing","deep","private"],behaviors:["fears deception","needs truth","investigates","transforms"]},Visionary:{signs:["Sagittarius"],keywords:["inspire","expand","explore","teach","guide","envision"],tonality:["expansive","candid","bold","open"],behaviors:["fears ignorance","needs meaning","explores","teaches"]},Architect:{signs:["Capricorn"],keywords:["build","structure","organize","plan","achieve","master"],tonality:["authoritative","structured","formal","disciplined"],behaviors:["fears failure","needs control","builds","achieves"]},Reformer:{signs:["Aquarius"],keywords:["reform","innovate","revolutionize","liberate","progress","change"],tonality:["innovative","detached","radical","abstract"],behaviors:["fears conformity","needs freedom","reforms","innovates"]},Empath:{signs:["Pisces"],keywords:["feel","empathize","flow","merge","dissolve","transcend"],tonality:["fluid","evasive","gentle","impressionistic"],behaviors:["fears disconnection","needs unity","flows","transcends"]}},F={"Direct & Fast":{signs:["Aries"],keywords:["direct","immediate","urgent","quick","decisive"],tonality:["bold","urgent","fast"],behaviors:["acts quickly","speaks directly","moves fast"]},"Deliberate & Grounded":{signs:["Taurus"],keywords:["deliberate","slow","steady","methodical","patient"],tonality:["calm","grounded","steady"],behaviors:["moves slowly","thinks carefully","stays stable"]},"Verbal & Multi-threaded":{signs:["Gemini"],keywords:["talkative","quick","multiple","varied","changeable"],tonality:["witty","rapid","verbal"],behaviors:["talks much","changes topics","multitasks"]},"Emotionally Coded":{signs:["Cancer"],keywords:["emotional","feeling","sensitive","moody","caring"],tonality:["emotional","warm","caring"],behaviors:["shows emotion","cares deeply","protective"]},"Expressive & Central":{signs:["Leo"],keywords:["expressive","dramatic","central","performative","vibrant"],tonality:["confident","vibrant","expressive"],behaviors:["performs","takes center","expresses boldly"]},"Precise & Critical":{signs:["Virgo"],keywords:["precise","critical","analytical","detailed","exact"],tonality:["precise","analytical","detailed"],behaviors:["analyzes","criticizes","perfects"]},"Diplomatic & Relational":{signs:["Libra"],keywords:["diplomatic","relational","social","balanced","harmonious"],tonality:["polished","fair","diplomatic"],behaviors:["mediates","socializes","seeks balance"]},"Penetrating & Private":{signs:["Scorpio"],keywords:["penetrating","private","intense","secretive","probing"],tonality:["intense","private","probing"],behaviors:["penetrates","keeps secrets","investigates"]},"Candid & Expansive":{signs:["Sagittarius"],keywords:["candid","expansive","open","honest","broad"],tonality:["candid","expansive","open"],behaviors:["speaks truth","expands","explores"]},"Formal & Structured":{signs:["Capricorn"],keywords:["formal","structured","organized","disciplined","authoritative"],tonality:["formal","structured","authoritative"],behaviors:["organizes","disciplines","structures"]},"Detached & Conceptual":{signs:["Aquarius"],keywords:["detached","conceptual","abstract","innovative","unique"],tonality:["detached","innovative","abstract"],behaviors:["detaches","conceptualizes","innovates"]},"Impressionistic & Evasive":{signs:["Pisces"],keywords:["impressionistic","evasive","fluid","vague","dreamy"],tonality:["fluid","evasive","impressionistic"],behaviors:["evades","flows","dreams"]}},G={Initiator:{"Direct & Fast":"Pure Catalyst","Deliberate & Grounded":"Slow Burn","Verbal & Multi-threaded":"Brainstormer","Emotionally Coded":"Impulsive Heart","Expressive & Central":"Star Player","Precise & Critical":"Pointed Spear","Diplomatic & Relational":"Charming Leader","Penetrating & Private":"Covert Operator","Candid & Expansive":"Adventurous Leader","Formal & Structured":"Disciplined Leader","Detached & Conceptual":"Rebel Leader","Impressionistic & Evasive":"Elusive Spark"},Stabilizer:{"Direct & Fast":"Unmovable Force","Deliberate & Grounded":"Bedrock","Verbal & Multi-threaded":"Resourceful Voice","Emotionally Coded":"Quiet Feeler","Expressive & Central":"Generous Host","Precise & Critical":"Practical Critic","Diplomatic & Relational":"Gracious Host","Penetrating & Private":"Silent Power","Candid & Expansive":"Honest Broker","Formal & Structured":"Master Builder","Detached & Conceptual":"Principled Investor","Impressionistic & Evasive":"Gentle Giant"},Connector:{"Direct & Fast":"Fast Talker","Deliberate & Grounded":"Patient Storyteller","Verbal & Multi-threaded":"Idea Machine","Emotionally Coded":"Sensitive Wit","Expressive & Central":"Magnetic Speaker","Precise & Critical":"Fact-Checker","Diplomatic & Relational":"Smooth Talker","Penetrating & Private":"Secret Keeper","Candid & Expansive":"Enthusiastic Debater","Formal & Structured":"Clear Communicator","Detached & Conceptual":"Genius Thinker","Impressionistic & Evasive":"Poetic Storyteller"},Investigator:{"Direct & Fast":"Cutting Truth","Deliberate & Grounded":"Deep Root","Verbal & Multi-threaded":"Information Broker","Emotionally Coded":"Hidden Current","Expressive & Central":"Charismatic Leader","Precise & Critical":"Forensic Analyst","Diplomatic & Relational":"Strategic Advisor","Penetrating & Private":"Silent Oracle","Candid & Expansive":"Truth-Teller","Formal & Structured":"Strategic Planner","Detached & Conceptual":"Strategic Futurist","Impressionistic & Evasive":"Psychic Investigator"},Visionary:{"Direct & Fast":"Blunt Prophet","Deliberate & Grounded":"Enduring Wisdom","Verbal & Multi-threaded":"Enthusiastic Teacher","Emotionally Coded":"Protective Guide","Expressive & Central":"Inspiring Preacher","Precise & Critical":"Moral Compass","Diplomatic & Relational":"Fair-Minded Guru","Penetrating & Private":"Truth Seeker","Candid & Expansive":"Pure Visionary","Formal & Structured":"Ambitious Teacher","Detached & Conceptual":"Radical Philosopher","Impressionistic & Evasive":"Spiritual Wanderer"},Nurturer:{"Direct & Fast":"Protective First Responder","Deliberate & Grounded":"Hearth Keeper","Verbal & Multi-threaded":"Story Weaver","Emotionally Coded":"Tidal Heart","Expressive & Central":"Radiant Caregiver","Precise & Critical":"Attentive Steward","Diplomatic & Relational":"Gentle Mediator","Penetrating & Private":"Hidden Well","Candid & Expansive":"Encouraging Guide","Formal & Structured":"Guardian of Boundaries","Detached & Conceptual":"Archetypal Care","Impressionistic & Evasive":"Moonlit Shelter"},Validator:{"Direct & Fast":"Spotlight Sprinter","Deliberate & Grounded":"Steady Beacon","Verbal & Multi-threaded":"Golden Voice","Emotionally Coded":"Warm Center","Expressive & Central":"Solar Heart","Precise & Critical":"Exacting Muse","Diplomatic & Relational":"Gracious Host","Penetrating & Private":"Hidden Flame","Candid & Expansive":"Generous Leader","Formal & Structured":"Regal Architect","Detached & Conceptual":"Iconoclast Star","Impressionistic & Evasive":"Dramatic Mirage"},Optimizer:{"Direct & Fast":"Surgical Fixer","Deliberate & Grounded":"Patient Refiner","Verbal & Multi-threaded":"Systems Analyst","Emotionally Coded":"Careful Helper","Expressive & Central":"Pointed Critic","Precise & Critical":"Pure Analyst","Diplomatic & Relational":"Tactful Editor","Penetrating & Private":"Forensic Healer","Candid & Expansive":"Ethical Improver","Formal & Structured":"Method Architect","Detached & Conceptual":"Abstract Optimizer","Impressionistic & Evasive":"Whispered Correction"},Harmonizer:{"Direct & Fast":"Grace Under Pressure","Deliberate & Grounded":"Elegant Anchor","Verbal & Multi-threaded":"Silver Mediator","Emotionally Coded":"Soft Balancer","Expressive & Central":"Charming Diplomat","Precise & Critical":"Fair Arbiter","Diplomatic & Relational":"Pure Harmonist","Penetrating & Private":"Subtle Broker","Candid & Expansive":"Open Negotiator","Formal & Structured":"Equity Architect","Detached & Conceptual":"Idealist Reconciler","Impressionistic & Evasive":"Velvet Balance"},Architect:{"Direct & Fast":"Command Builder","Deliberate & Grounded":"Stone Mason","Verbal & Multi-threaded":"Executive Communicator","Emotionally Coded":"Steeled Guardian","Expressive & Central":"Dignified Leader","Precise & Critical":"Master Planner","Diplomatic & Relational":"Statesman","Penetrating & Private":"Silent Strategist","Candid & Expansive":"Ambitious Captain","Formal & Structured":"Pure Architect","Detached & Conceptual":"Systemic Builder","Impressionistic & Evasive":"Sober Dreamer"},Reformer:{"Direct & Fast":"Shock Innovator","Deliberate & Grounded":"Principled Reformer","Verbal & Multi-threaded":"Signal Splitter","Emotionally Coded":"Detached Advocate","Expressive & Central":"Iconoclast Performer","Precise & Critical":"Analytical Maverick","Diplomatic & Relational":"Civic Futurist","Penetrating & Private":"Underground Radical","Candid & Expansive":"Visionary Reformer","Formal & Structured":"Policy Architect","Detached & Conceptual":"Pure Innovator","Impressionistic & Evasive":"Electric Phantom"},Empath:{"Direct & Fast":"Soft Surge","Deliberate & Grounded":"Kind Anchor","Verbal & Multi-threaded":"Dream Messenger","Emotionally Coded":"Oceanic Heart","Expressive & Central":"Mystic Performer","Precise & Critical":"Discerning Mystic","Diplomatic & Relational":"Porous Bridge","Penetrating & Private":"Psychic Diver","Candid & Expansive":"Pilgrim Poet","Formal & Structured":"Vessel Maker","Detached & Conceptual":"Neptunian Thinker","Impressionistic & Evasive":"Pure Dreamer"}};class H{static getInstance(){return H.instance||(H.instance=new H),H.instance}analyzeContent(a){let b=a.normalize("NFKD").replace(/[\u2010-\u2015\-]/g," ").replace(/[“”‘’]/g," ").toLowerCase().replace(/\p{M}+/gu,"").replace(/[^a-z\s]/g," ").split(/\s+/).filter(Boolean),c=new Set(["no","not","never","rarely","hardly","seldom","without"]),d=(a,d=2)=>{for(let e=1;e<=d;e++){let d=b[a-e];if(!d)break;if(c.has(d))return!0}return!1},e=new Set(["bold","urgent","direct","fast","expansive","precise"]),f=a=>{let c=0,f=new Set;for(let e=0;e<b.length;e++){let g=b[e];for(let b of a.keywords){let a=b.toLowerCase();g!==a||f.has(a)||(f.add(a),c+=d(e)?.5:1)}}let g=0,h=new Set;for(let f=0;f<b.length;f++){let i=b[f];for(let b of a.tonality){let a=b.toLowerCase();if(i===a&&!h.has(a)){h.add(a);let b=c>0||e.has(a)?1:.25;g+=d(f)?.5*b:b}}}let i=0;if(a.behaviors&&a.behaviors.length){let c=new Set;a.behaviors.forEach(a=>{let e=(a=>{let c=a.toLowerCase().split(/\s+/).filter(Boolean);if(0===c.length)return 0;if(1===c.length){let a=c[0];for(let c=0;c<b.length;c++)if(b[c]===a)return d(c)?.5:1;return 0}for(let a=0;a<b.length;a++){if(b[a]!==c[0])continue;let e=a,f=!0;for(let a=1;a<c.length;a++){let d=!1;for(let f=e+1;f<=e+4&&f<b.length;f++)if(b[f]===c[a]){d=!0,e=f;break}if(!d){f=!1;break}}if(f)return d(a)?.5:1}return 0})(a);e>0&&!c.has(a)&&(c.add(a),i+=e)})}return(2*c+ +g+.5*i)/(2*a.keywords.length+ +a.tonality.length+.5*a.behaviors.length||1)},g="Unknown",h=0;Object.entries(E).forEach(([a,b])=>{let c=f(b);c>h&&(h=c,g=a)});let i="Unknown",j=0;return Object.entries(F).forEach(([a,b])=>{let c=f(b);c>j&&(j=c,i=a)}),{actor:g,role:i,actorScore:h,roleScore:j}}computeDriftIndex(a){let b=a.filter(a=>"DRIVER"===a.mappedTo||"ROLE"===a.mappedTo),c=b.length,d=b.filter(a=>"DRIVER"===a.mappedTo).length,e=d+b.filter(a=>"ROLE"===a.mappedTo).length,f=e>0?d/e:0,g=new Set(["agency","boundaries","communication","energy","relationships","work","home","identity"]),h=new Set;a.forEach(a=>{if(!a.area)return;let b=(a.area||"").toLowerCase();g.has(b)&&h.add(b)});let i=Array.from(h),j="NONE";c>=4&&i.length>=2&&f>=.7?j="STRONG":c>=3&&f>=.5&&(j="POSSIBLE");let k=i.length<2&&"NONE"!==j;return{driftIndex:f,band:k?"NONE":j,evidenceN:c,areasSpanned:i,stateDependent:k}}generateComposite(a,b){let c,d,e,f,g,h={},i={},j={},k={},l=(a,b,c)=>{a[b]=(a[b]||0)+c},m=(a,b,c,d)=>{a[b]=a[b]||{wb:0,abe:0,osr:0},a[b][c]+=d},n=(a,b,c)=>{let d=this.analyzeContent(a);"Unknown"!==d.actor&&(l(h,d.actor,d.actorScore*b),m(j,d.actor,c,d.actorScore*b)),"Unknown"!==d.role&&(l(i,d.role,d.roleScore*b),m(k,d.role,c,d.roleScore*b))};a.wbPatterns.forEach(a=>n(a,1,"wb")),a.abePatterns.forEach(a=>n(a,.5,"abe")),a.osrProbes&&a.osrProbes.length&&a.osrProbes.forEach(a=>{if(a.text){let b=this.analyzeContent(a.text);"Unknown"!==b.actor&&(l(h,b.actor,.75*b.actorScore),m(j,b.actor,"osr",.75*b.actorScore))}}),b?.actorBonus&&Object.keys(h).forEach(a=>{h[a]+=b.actorBonus}),b?.roleBonus&&Object.keys(i).forEach(a=>{i[a]+=b.roleBonus}),b?.aspectNotes&&b.aspectNotes.length&&(Object.keys(h).forEach(a=>{h[a]+=.05}),Object.keys(i).forEach(a=>{i[a]+=.05}));let o=Object.entries(h).sort((a,b)=>b[1]-a[1]),p=Object.entries(i).sort((a,b)=>b[1]-a[1]),q=o[0]?{k:o[0][0],v:o[0][1]}:{k:"Unknown",v:0},r=p[0]?{k:p[0][0],v:p[0][1]}:{k:"Unknown",v:0};if(o.length>1&&.02>=Math.abs(o[0][1]-o[1][1])){let a=o[0][0],b=o[1][0],d=j[a]?.wb||0,e=j[b]?.wb||0,f=j[a]?.abe||0,g=j[b]?.abe||0,h=j[a]?.osr||0,i=j[b]?.osr||0;d!==e?(q.k=d>e?a:b,c="WB"):f!==g?(q.k=f>g?a:b,c=c||"ABE"):h!==i&&(q.k=h>i?a:b,c=c||"OSR")}if(p.length>1&&.02>=Math.abs(p[0][1]-p[1][1])){let a=p[0][0],b=p[1][0],d=k[a]?.wb||0,e=k[b]?.wb||0,f=k[a]?.abe||0,g=k[b]?.abe||0;d!==e?(r.k=d>e?a:b,c=c||"WB"):f!==g&&(r.k=f>g?a:b,c=c||"ABE")}let s=q.k,t=r.k,u=a.wbPatterns.length+a.abePatterns.length+(a.osrProbes?.length||0),v=0;u>0&&(v=Math.min((q.v+r.v)/Math.max(u,1),1),u<3?v=Math.min(v,.4):u<6&&(v=Math.min(v,.7)));let w=v>.65?"HIGH":v>=.35?"MODERATE":"LOW",x=!1;if(a.osrProbes&&a.osrProbes.length){let b=this.computeDriftIndex(a.osrProbes.map(a=>({mappedTo:a.mappedTo,area:a.area})));d=b.driftIndex,e=b.band,f=b.evidenceN,g=b.stateDependent,x="POSSIBLE"===b.band||"STRONG"===b.band}let y=q.v>=.15?s:"Unknown",z=r.v>=.15?t:"Unknown",A=G[y]?.[z]||`${y} / ${z}`,B=E[y]?.signs,C=F[z]?.signs;return{actor:y,role:z,composite:A,confidence:v,confidenceBand:w,sampleSize:u,siderealDrift:x,driftIndex:d,driftBand:e,evidenceN:f,actorSigns:B,roleSigns:C,stateDependent:g,tieBreak:c,aspectNotes:b?.aspectNotes||[]}}}let I=({sessionId:a,onClose:b,onSealed:c})=>{let[g,h]=(0,e.useState)(null),[i,j]=(0,e.useState)(null),[k,l]=(0,e.useState)(!1),[m,n]=(0,e.useState)(null),[o,p]=(0,e.useState)(null),[q,r]=(0,e.useState)(!1),[s,t]=(0,e.useState)({pressure:0,outlet:0,conflict:0,tone:0,surprise:0}),[u,v]=(0,e.useState)({pressure:!1,outlet:!1,conflict:!1,tone:!1,surprise:!1}),[w,x]=(0,e.useState)(null),[y,A]=(0,e.useState)(0),B=async()=>{l(!0);try{let b=C.exportSessionDiagnostics(a);j(b.stats);let c=H.getInstance().generateComposite(b.patterns);h(c)}catch(a){console.error("Error generating Actor/Role reveal:",a)}finally{l(!1)}};f().useEffect(()=>{B()},[a]);let D=s.pressure+s.outlet+s.conflict+s.tone+s.surprise,E=D>=13?"Strong signal":D>=10?"Some clear hits":D>=6?"Mild resonance":"Didn’t land";function F({label:a,helper:b,keyName:c}){let e=s[c],f=u[c];return(0,d.jsxs)("div",{className:"rubric-row",children:[(0,d.jsxs)("div",{className:"rubric-label",children:[(0,d.jsx)("div",{children:a}),b&&(0,d.jsx)("div",{className:"rubric-helper",children:b})]}),(0,d.jsx)("input",{type:"range",min:0,max:3,step:1,value:e,onChange:a=>t(b=>({...b,[c]:Number(a.target.value)})),disabled:!!w}),(0,d.jsx)("div",{className:"rubric-value",children:e}),(0,d.jsxs)("label",{className:"rubric-null",children:[(0,d.jsx)("input",{type:"checkbox",checked:!!f,onChange:a=>v(b=>({...b,[c]:a.target.checked})),disabled:!!w})," Mark as off-base (Null/Miss)"]})]})}function G(a,b){try{console.log(`[analytics] ${a}`,b)}catch{}}if(k)return(0,d.jsxs)("div",{className:"jsx-f141627c340aaa10 wrap-up-card generating",children:[(0,d.jsx)("div",{className:"jsx-f141627c340aaa10 card-header",children:(0,d.jsx)("h3",{className:"jsx-f141627c340aaa10",children:"\uD83C\uDFAD Generating Actor / Role Reveal..."})}),(0,d.jsxs)("div",{className:"jsx-f141627c340aaa10 generating-content",children:[(0,d.jsxs)("div",{className:"jsx-f141627c340aaa10 dots",children:[(0,d.jsx)("span",{className:"jsx-f141627c340aaa10"}),(0,d.jsx)("span",{className:"jsx-f141627c340aaa10"}),(0,d.jsx)("span",{className:"jsx-f141627c340aaa10"})]}),(0,d.jsx)("p",{className:"jsx-f141627c340aaa10",children:"Mapping your resonance pattern..."})]}),(0,d.jsx)(z(),{id:"f141627c340aaa10",children:".wrap-up-card.jsx-f141627c340aaa10{background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);border:1px solid rgba(148,163,184,.2);border-radius:12px;padding:24px;margin:16px 0;max-width:600px;box-shadow:0 8px 32px rgba(0,0,0,.3)}.card-header.jsx-f141627c340aaa10 h3.jsx-f141627c340aaa10{color:#f1f5f9;margin:0 0 16px 0;font-size:18px;font-weight:600}.generating-content.jsx-f141627c340aaa10{text-align:center;padding:20px 0}.dots.jsx-f141627c340aaa10{display:flex;justify-content:center;gap:8px;margin-bottom:16px}.dots.jsx-f141627c340aaa10 span.jsx-f141627c340aaa10{width:8px;height:8px;background:#3b82f6;border-radius:50%;animation:pulse 1.4s ease-in-out infinite both}.dots.jsx-f141627c340aaa10 span.jsx-f141627c340aaa10:nth-child(1){animation-delay:-.32s}.dots.jsx-f141627c340aaa10 span.jsx-f141627c340aaa10:nth-child(2){animation-delay:-.16s}@keyframes pulse{0%,80%,100%{transform:scale(0);opacity:.5}40%{transform:scale(1);opacity:1}}.generating-content.jsx-f141627c340aaa10 p.jsx-f141627c340aaa10{color:#94a3b8;margin:0}"})]});if(!g||!i)return(0,d.jsxs)("div",{className:"jsx-fdb1a8e49ca28ed8 wrap-up-card no-data",children:[(0,d.jsx)("div",{className:"jsx-fdb1a8e49ca28ed8 card-header",children:(0,d.jsx)("h3",{className:"jsx-fdb1a8e49ca28ed8",children:"\uD83C\uDFAD Actor / Role Reveal"})}),(0,d.jsx)("p",{className:"jsx-fdb1a8e49ca28ed8",children:"Not enough session data for diagnostic analysis."}),(0,d.jsx)("p",{className:"jsx-fdb1a8e49ca28ed8",children:"Try giving feedback on a few more of Raven's mirrors."}),(0,d.jsx)(z(),{id:"fdb1a8e49ca28ed8",children:".wrap-up-card.jsx-fdb1a8e49ca28ed8{background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);border:1px solid rgba(148,163,184,.2);border-radius:12px;padding:24px;margin:16px 0;max-width:600px;box-shadow:0 8px 32px rgba(0,0,0,.3)}.card-header.jsx-fdb1a8e49ca28ed8 h3.jsx-fdb1a8e49ca28ed8{color:#f1f5f9;margin:0 0 16px 0;font-size:18px;font-weight:600}p.jsx-fdb1a8e49ca28ed8{color:#94a3b8;margin:8px 0}"})]});let I=a=>({Aries:"♈",Taurus:"♉",Gemini:"♊",Cancer:"♋",Leo:"♌",Virgo:"♍",Libra:"♎",Scorpio:"♏",Sagittarius:"♐",Capricorn:"♑",Aquarius:"♒",Pisces:"♓"})[a]||"●";return(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 wrap-up-card",children:[b&&(0,d.jsx)("button",{onClick:b,className:"jsx-dc45d79f15c9b6a9 close-button",children:"\xd7"}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 card-header",children:[(0,d.jsx)("h3",{className:"jsx-dc45d79f15c9b6a9",children:"\uD83C\uDFAD Actor / Role Reveal"}),(0,d.jsx)("p",{className:"jsx-dc45d79f15c9b6a9 subtitle",children:"Raven's diagnostic guess, derived from your resonance pattern"})]}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 composite-reveal",children:[(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 composite-name",children:["Unknown"!==g.actor&&(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 actor",children:g.actor}),("Unknown"!==g.actor||"Unknown"!==g.role)&&(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 separator",children:"/"}),"Unknown"!==g.role&&(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 role",children:g.role})]}),("Unknown"!==g.actor||"Unknown"!==g.role)&&(g.sampleSize||0)>0?(0,d.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 composite-title",children:g.composite}):(0,d.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 composite-title muted",children:"Not enough data for a composite"}),(g.sampleSize||0)>0&&(0,d.jsx)("div",{style:{background:`linear-gradient(90deg, ${(a=>"HIGH"===a?"#22c55e":"MODERATE"===a?"#f59e0b":"#ef4444")(g.confidenceBand)} ${Math.round(100*(g.confidence||0))}%, rgba(255,255,255,0.1) ${Math.round(100*(g.confidence||0))}%)`},className:"jsx-dc45d79f15c9b6a9 confidence-bar",children:(0,d.jsxs)("span",{className:"jsx-dc45d79f15c9b6a9 confidence-text",children:[(g.confidenceBand||"LOW").toLowerCase()," confidence"]})})]}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 explanation",children:[(0,d.jsxs)("p",{className:"jsx-dc45d79f15c9b6a9",children:["This blend comes from what landed (✅) and how your clarifications shaped the misses (❌). Raven tests patterns; you’re the validator.",g.driftBand&&"NONE"!==g.driftBand&&(0,d.jsxs)(d.Fragment,{children:["POSSIBLE"===g.driftBand&&(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 sidereal-note",children:" Some ❌ clarifications leaned Driver-first (sidereal). Raven notes a sidereal lean; future mirrors will weight it lightly."}),"STRONG"===g.driftBand&&(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 sidereal-note",children:" Your clarifications strongly aligned with sidereal Drivers. Raven will prioritize Driver language while still showing Role for visibility."}),"number"==typeof g.driftIndex&&(0,d.jsxs)("span",{className:"jsx-dc45d79f15c9b6a9 di",children:[" (DI: ",Math.round(100*g.driftIndex),"% • n=",g.evidenceN,")"]})]})]}),(0,d.jsxs)("p",{style:{color:"#94a3b8",fontSize:12,marginTop:8},className:"jsx-dc45d79f15c9b6a9",children:["Method: weighted by what landed (WB) and probe clarifications on misses (OSR). Confidence: ",(g.confidenceBand||"LOW").toLowerCase(),".",g.tieBreak&&(0,d.jsxs)("span",{className:"jsx-dc45d79f15c9b6a9",children:[" Tie-break favored ",g.tieBreak," evidence."]})]})]}),!w&&(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-cta",children:[(0,d.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-cta-title",children:"Score this reflection?"}),(0,d.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-cta-body",children:"Optional. Your marks help Raven calibrate. These scores apply to this session only."}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-cta-actions",children:[(0,d.jsx)("button",{onClick:function(){r(!0),p(Date.now()),G("rubric_opened",{sessionId:C.getCurrentSessionId()})},className:"jsx-dc45d79f15c9b6a9 btn primary",children:"Open rubric"}),(0,d.jsx)("button",{onClick:function(){r(!1),p(null),G("rubric_skipped",{sessionId:C.getCurrentSessionId()})},className:"jsx-dc45d79f15c9b6a9 btn",children:"Skip"})]})]}),q&&(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric",children:[(0,d.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-title",children:"Reading Rubric"}),(0,d.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-micro",children:"Not sure on a slider? Leave it. Only what you mark counts."}),(0,d.jsx)(F,{label:"Pressure Mirror",helper:"How I respond under stress.",keyName:"pressure",className:"jsx-dc45d79f15c9b6a9"}),(0,d.jsx)(F,{label:"Outlet Type",helper:"What restores clarity or relief.",keyName:"outlet",className:"jsx-dc45d79f15c9b6a9"}),(0,d.jsx)(F,{label:"Internal Conflict",helper:"Recurring push–pull I recognize.",keyName:"conflict",className:"jsx-dc45d79f15c9b6a9"}),(0,d.jsx)(F,{label:"Emotional Tone",helper:"Feels personal, not generic.",keyName:"tone",className:"jsx-dc45d79f15c9b6a9"}),(0,d.jsx)(F,{label:"Surprise Signal",helper:"True angle I hadn’t named before.",keyName:"surprise",className:"jsx-dc45d79f15c9b6a9"}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-summary",children:[y>0&&(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-pending-note",children:[y," mirrors unscored. They don’t affect your result."]}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9",children:["Aggregate: ",(0,d.jsx)("b",{className:"jsx-dc45d79f15c9b6a9",children:D})," / 15 — ",E]}),(0,d.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-note",children:"These scores apply to this session only."}),Object.values(u).filter(Boolean).length>0&&(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-null-note",children:[Object.values(u).filter(Boolean).length," items marked off-base — these are important for calibration."]}),(0,d.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-footer-note",children:"Marking misses is useful. It tunes the map."})]}),!w&&(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-actions",children:[(0,d.jsx)("button",{onClick:function(){if(w){n("This reading is already sealed."),setTimeout(()=>n(null),2500);return}(function(){let a=Object.values(s).every(a=>0===a),b=Object.values(u).some(Boolean);a})();try{let a=C.getCurrentSessionId(),b=C.getPendingCount(!0);A(b);let d=o||Date.now(),e=Object.entries(u).filter(([,a])=>a).map(([a])=>a);C.sealSession(a);let f=C.getCurrentSessionId();x(a),n("Reading sealed. New messages start a fresh reading."),setTimeout(()=>n(null),2500),G("rubric_submitted",{sessionId:a,scores:s,nulls:e,aggregate:D,timeToCompleteMs:Date.now()-d}),G("session_sealed",{sealedSessionId:a,nextSessionId:f}),c?.(a,f)}catch(a){G("rubric_submit_failed",{sessionId:C.getCurrentSessionId(),error:String(a)}),n("Couldn't save scores. Your reading isn't sealed. Try again?")}},className:"jsx-dc45d79f15c9b6a9 btn primary",children:"Submit rubric & close reading"}),(0,d.jsx)("button",{onClick:function(){r(!1),n("No scores saved. You can open the rubric again before we close."),setTimeout(()=>n(null),2500)},className:"jsx-dc45d79f15c9b6a9 btn",children:"Cancel"})]})]}),w&&(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-results",children:[(0,d.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-results-title",children:"Your marks"}),(0,d.jsx)("ul",{className:"jsx-dc45d79f15c9b6a9 rubric-results-list",children:[["Pressure Mirror","pressure"],["Outlet Type","outlet"],["Internal Conflict","conflict"],["Emotional Tone","tone"],["Surprise Signal","surprise"]].map(([a,b])=>(0,d.jsxs)("li",{className:"jsx-dc45d79f15c9b6a9",children:[(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 label",children:a}),(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 value",children:s[b]}),u[b]&&(0,d.jsx)("span",{title:"Marked off-base",className:"jsx-dc45d79f15c9b6a9 flag",children:"⚑"})]},b))}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-results-agg",children:[D," / 15 — ",E]}),(0,d.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 rubric-note",children:"These scores apply to this session only."})]}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 glyph-trace",children:[(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 glyph-item",children:[(0,d.jsxs)("span",{className:"jsx-dc45d79f15c9b6a9 glyph",children:["☉",I(g.actorSigns?.[0]||"Sagittarius")]}),(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 glyph-label",children:"Actor (sidereal)"})]}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 glyph-item",children:[(0,d.jsxs)("span",{className:"jsx-dc45d79f15c9b6a9 glyph",children:["☿",I(g.roleSigns?.[0]||"Scorpio")]}),(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 glyph-label",children:"Role (tropical)"})]})]}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 resonance-scorecard",children:[(0,d.jsx)("div",{className:"jsx-dc45d79f15c9b6a9 scorecard-header",children:"Resonance Scorecard"}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 score-grid",children:[(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 score-item wb",children:[(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-icon",children:"✅"}),(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-label",children:"WB mirrors"}),(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-count",children:i.breakdown.yes})]}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 score-item abe",children:[(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-icon",children:"\uD83D\uDFE1"}),(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-label",children:"ABE mirrors"}),(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-count",children:i.breakdown.maybe})]}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 score-item osr",children:[(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-icon",children:"❌"}),(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-label",children:"OSR mirrors"}),(0,d.jsx)("span",{className:"jsx-dc45d79f15c9b6a9 score-count",children:i.breakdown.no+i.breakdown.unclear})]})]}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 scorecard-footer",children:["WB ",i.breakdown.yes," \xb7 ABE ",i.breakdown.maybe," \xb7 OSR ",i.breakdown.no+i.breakdown.unclear,"number"==typeof i.breakdown.pending&&(0,d.jsxs)("span",{className:"jsx-dc45d79f15c9b6a9",children:[" \xb7 PENDING ",i.breakdown.pending]})]})]}),(0,d.jsxs)("div",{className:"jsx-dc45d79f15c9b6a9 closing-note",children:[(0,d.jsx)("p",{className:"jsx-dc45d79f15c9b6a9",children:(0,d.jsx)("em",{className:"jsx-dc45d79f15c9b6a9",children:"This is a mirror, not a label. It may shift as future sessions add more data. You are the validator."})}),w&&(0,d.jsx)("p",{className:"jsx-dc45d79f15c9b6a9 session-note",children:"This reading is sealed. New messages start a fresh reading container."})]}),(0,d.jsx)(z(),{id:"dc45d79f15c9b6a9",children:'.wrap-up-card.jsx-dc45d79f15c9b6a9{background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);border:1px solid rgba(148,163,184,.2);border-radius:12px;padding:24px;margin:16px 0;max-width:600px;position:relative;box-shadow:0 8px 32px rgba(0,0,0,.3);font-family:"Inter",sans-serif}.close-button.jsx-dc45d79f15c9b6a9{position:absolute;top:12px;right:12px;background:none;border:none;color:#94a3b8;font-size:24px;cursor:pointer;padding:4px;line-height:1}.close-button.jsx-dc45d79f15c9b6a9:hover{color:#f1f5f9}.card-header.jsx-dc45d79f15c9b6a9 h3.jsx-dc45d79f15c9b6a9{color:#f1f5f9;margin:0 0 8px 0;font-size:20px;font-weight:600}.subtitle.jsx-dc45d79f15c9b6a9{color:#94a3b8;margin:0 0 20px 0;font-size:14px;font-style:italic}.composite-reveal.jsx-dc45d79f15c9b6a9{text-align:center;margin:24px 0;padding:20px;background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.2);border-radius:8px}.composite-name.jsx-dc45d79f15c9b6a9{font-size:24px;font-weight:700;margin-bottom:8px;color:#f1f5f9}.actor.jsx-dc45d79f15c9b6a9{color:#3b82f6}.separator.jsx-dc45d79f15c9b6a9{color:#64748b;margin:0 8px}.role.jsx-dc45d79f15c9b6a9{color:#10b981}.composite-title.jsx-dc45d79f15c9b6a9{font-size:18px;color:#e2e8f0;margin-bottom:16px;font-weight:500}.composite-title.muted.jsx-dc45d79f15c9b6a9{color:#94a3b8;font-style:italic}.confidence-bar.jsx-dc45d79f15c9b6a9{height:6px;border-radius:3px;position:relative;overflow:hidden}.confidence-text.jsx-dc45d79f15c9b6a9{position:absolute;top:-24px;right:0;font-size:12px;color:#94a3b8}.explanation.jsx-dc45d79f15c9b6a9{margin:24px 0;padding:16px;background:rgba(0,0,0,.3);border-radius:8px;border-left:4px solid#3b82f6}.explanation.jsx-dc45d79f15c9b6a9 p.jsx-dc45d79f15c9b6a9{color:#e2e8f0;line-height:1.6;margin:0;font-size:14px}.sidereal-note.jsx-dc45d79f15c9b6a9{color:#f59e0b;font-weight:500}.di.jsx-dc45d79f15c9b6a9{color:#94a3b8;margin-left:6px}.glyph-trace.jsx-dc45d79f15c9b6a9{display:flex;justify-content:center;gap:32px;margin:20px 0;padding:16px;background:rgba(0,0,0,.2);border-radius:8px}.glyph-item.jsx-dc45d79f15c9b6a9{text-align:center}.glyph.jsx-dc45d79f15c9b6a9{display:block;font-size:24px;color:#94a3b8;margin-bottom:4px}.glyph-label.jsx-dc45d79f15c9b6a9{font-size:11px;color:#64748b}.resonance-scorecard.jsx-dc45d79f15c9b6a9{margin:20px 0;padding:16px;background:rgba(0,0,0,.2);border-radius:8px}.scorecard-header.jsx-dc45d79f15c9b6a9{font-size:14px;font-weight:600;color:#f1f5f9;margin-bottom:12px;text-align:center}.score-grid.jsx-dc45d79f15c9b6a9{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:12px}.score-item.jsx-dc45d79f15c9b6a9{text-align:center;padding:8px;border-radius:6px;background:rgba(255,255,255,.03)}.score-item.wb.jsx-dc45d79f15c9b6a9{border:1px solid rgba(34,197,94,.3)}.score-item.abe.jsx-dc45d79f15c9b6a9{border:1px solid rgba(245,158,11,.3)}.score-item.osr.jsx-dc45d79f15c9b6a9{border:1px solid rgba(239,68,68,.3)}.score-icon.jsx-dc45d79f15c9b6a9{display:block;font-size:16px;margin-bottom:4px}.score-label.jsx-dc45d79f15c9b6a9{display:block;font-size:11px;color:#94a3b8;margin-bottom:2px}.score-count.jsx-dc45d79f15c9b6a9{display:block;font-size:14px;font-weight:600;color:#f1f5f9}.scorecard-footer.jsx-dc45d79f15c9b6a9{font-size:11px;color:#64748b;text-align:center;font-style:italic}.closing-note.jsx-dc45d79f15c9b6a9{margin-top:20px;padding-top:16px;border-top:1px solid rgba(148,163,184,.2)}.closing-note.jsx-dc45d79f15c9b6a9 p.jsx-dc45d79f15c9b6a9{color:#94a3b8;font-size:13px;text-align:center;margin:0}.rubric-cta.jsx-dc45d79f15c9b6a9{margin:18px 0;text-align:center}.rubric-cta-title.jsx-dc45d79f15c9b6a9{color:#f1f5f9;font-weight:600;margin-bottom:4px}.rubric-cta-body.jsx-dc45d79f15c9b6a9{color:#e2e8f0;margin:0 0 10px 0;font-size:13px}.rubric-cta-actions.jsx-dc45d79f15c9b6a9{display:flex;gap:8px;justify-content:center}.btn.jsx-dc45d79f15c9b6a9{background:rgba(255,255,255,.06);border:1px solid rgba(148,163,184,.3);color:#e2e8f0;padding:8px 12px;border-radius:8px;cursor:pointer}.btn.primary.jsx-dc45d79f15c9b6a9{background:#3b82f6;border-color:#2563eb}.rubric.jsx-dc45d79f15c9b6a9{margin:16px 0;padding:12px;background:rgba(0,0,0,.25);border:1px solid rgba(148,163,184,.2);border-radius:8px}.rubric-title.jsx-dc45d79f15c9b6a9{color:#f1f5f9;font-weight:600;text-align:center;margin-bottom:6px}.rubric-micro.jsx-dc45d79f15c9b6a9{color:#94a3b8;font-size:12px;text-align:center;margin-bottom:8px}.rubric-row.jsx-dc45d79f15c9b6a9{display:flex;align-items:center;gap:8px;margin:8px 0}.rubric-label.jsx-dc45d79f15c9b6a9{flex:1;color:#e2e8f0;font-size:13px}.rubric-helper.jsx-dc45d79f15c9b6a9{color:#94a3b8;font-size:11px}.rubric-value.jsx-dc45d79f15c9b6a9{width:24px;text-align:right;color:#e2e8f0}.rubric-null.jsx-dc45d79f15c9b6a9{font-size:12px;color:#94a3b8}.rubric-summary.jsx-dc45d79f15c9b6a9{margin-top:10px;color:#e2e8f0;font-size:13px}.rubric-note.jsx-dc45d79f15c9b6a9{color:#94a3b8;font-size:12px}.rubric-null-note.jsx-dc45d79f15c9b6a9{color:#f59e0b;font-size:12px;margin-top:4px}.rubric-pending-note.jsx-dc45d79f15c9b6a9{color:#94a3b8;font-size:12px;margin-bottom:6px;font-style:italic}.rubric-actions.jsx-dc45d79f15c9b6a9{margin-top:12px;text-align:center}.rubric-results.jsx-dc45d79f15c9b6a9{margin:14px 0;padding:12px;background:rgba(0,0,0,.2);border:1px solid rgba(148,163,184,.2);border-radius:8px}.rubric-results-title.jsx-dc45d79f15c9b6a9{color:#f1f5f9;font-weight:600;margin-bottom:8px;text-align:center}.rubric-results-list.jsx-dc45d79f15c9b6a9{list-style:none;padding:0;margin:0 0 8px 0}.rubric-results-list.jsx-dc45d79f15c9b6a9 li.jsx-dc45d79f15c9b6a9{display:flex;align-items:center;justify-content:space-between;padding:6px 8px;border-bottom:1px dashed rgba(148,163,184,.2)}.rubric-results-list.jsx-dc45d79f15c9b6a9 li.jsx-dc45d79f15c9b6a9:last-child{border-bottom:none}.rubric-results-list.jsx-dc45d79f15c9b6a9 .label.jsx-dc45d79f15c9b6a9{color:#e2e8f0;font-size:13px}.rubric-results-list.jsx-dc45d79f15c9b6a9 .value.jsx-dc45d79f15c9b6a9{color:#f1f5f9;font-weight:600}.rubric-results-list.jsx-dc45d79f15c9b6a9 .flag.jsx-dc45d79f15c9b6a9{margin-left:6px;color:#f59e0b}.rubric-results-agg.jsx-dc45d79f15c9b6a9{color:#e2e8f0;text-align:center;font-weight:600}.toast.jsx-dc45d79f15c9b6a9{position:absolute;top:8px;right:8px;background:#0b1220;border:1px solid rgba(148,163,184,.3);color:#e2e8f0;padding:8px 10px;border-radius:8px;font-size:13px;box-shadow:0 8px 24px rgba(0,0,0,.4)}'}),m&&(0,d.jsx)("div",{role:"status",className:"jsx-dc45d79f15c9b6a9 toast",children:m})]})};function J({data:a,onClose:b,onGenerateJournal:c,onStartNewReading:f}){let g,[h,i]=(0,e.useState)(!1),[j,k]=(0,e.useState)(null),[l,m]=(0,e.useState)(!1),n=async()=>{if(c){m(!0);try{let a=await c();k(a),i(!0)}catch(a){console.error("Failed to generate journal:",a)}finally{m(!1)}}};return(0,d.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:(0,d.jsxs)("div",{className:"bg-gradient-to-br from-white to-slate-50 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-[0_20px_70px_rgba(0,0,0,0.35)] border border-slate-200/70",children:[a.poemLine&&(0,d.jsxs)("div",{className:"relative bg-gradient-to-r from-indigo-600 via-violet-600 to-purple-600 text-white p-7 rounded-t-2xl",children:[(0,d.jsx)("div",{className:"absolute inset-0 opacity-30 bg-[radial-gradient(40%_60%_at_70%_0%,rgba(255,255,255,0.3),transparent)]"}),(0,d.jsxs)("div",{className:"relative text-center italic text-lg leading-relaxed",children:['"',a.poemLine,'"']})]}),(0,d.jsxs)("div",{className:"p-7 space-y-7",children:[a.bigVectors.length>0&&(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("h2",{className:"text-[11px] uppercase tracking-[0.2em] text-slate-500 mb-3",children:"ACTOR / ROLE COMPOSITE"}),(0,d.jsx)("div",{className:"text-[28px] font-serif font-bold text-slate-800 mb-1",children:a.bigVectors[0].polarity}),(0,d.jsxs)("div",{className:"flex justify-center gap-3 text-2xl opacity-70",children:[(0,d.jsx)("span",{title:"Sidereal emphasis",children:"☽"}),(0,d.jsx)("span",{title:"Tropical emphasis",children:"☿"})]})]}),(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("h3",{className:"text-[11px] uppercase tracking-[0.2em] text-slate-500 mb-3",children:"RESONANCE FIDELITY"}),(0,d.jsxs)("div",{className:"text-3xl font-bold text-slate-800 mb-1",children:[a.resonanceFidelity.percentage,"%—"]}),(0,d.jsx)("div",{className:"text-base text-slate-600 mb-4",children:a.resonanceFidelity.label}),(0,d.jsx)("div",{className:"flex justify-center gap-4 mb-4",children:(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("span",{className:"text-green-600 text-xl",children:"✅"}),(0,d.jsx)("span",{className:"text-green-600 text-xl",children:"✅"}),(0,d.jsx)("span",{className:"text-red-600 text-xl",children:"❌"})]})})]}),(0,d.jsx)("div",{className:"bg-white rounded-xl p-5 border border-slate-200 shadow-sm",children:(0,d.jsx)("p",{className:"text-slate-700 leading-relaxed text-center",children:a.explanation})}),(0,d.jsxs)("div",{className:"border-t border-slate-200 pt-5",children:[(0,d.jsx)("h4",{className:"text-[11px] uppercase tracking-[0.2em] text-slate-500 mb-3 text-center",children:"BALANCE METER"}),(0,d.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-slate-200 shadow-sm",children:[(0,d.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-2",children:[(0,d.jsx)("span",{title:`Magnitude ${a.balanceMeterClimate.magnitude}`,children:(g=a.balanceMeterClimate.magnitude,"⚡".repeat(Math.min(g,5)))}),(0,d.jsx)("span",{title:`Valence: ${a.balanceMeterClimate.valence}`,children:(a=>{switch(a){case"bright":return"\uD83C\uDF1E";case"drag":return"\uD83C\uDF11";default:return"\uD83C\uDF24️"}})(a.balanceMeterClimate.valence)}),(0,d.jsx)("span",{title:`Volatility: ${a.balanceMeterClimate.volatility}`,children:(a=>{switch(a){case"chaotic":return"\uD83C\uDF00";case"mixed":return"\uD83D\uDD00";default:return"➡️"}})(a.balanceMeterClimate.volatility)})]}),(0,d.jsx)("p",{className:"text-slate-700 text-center text-[13px] leading-relaxed",children:a.balanceMeterClimate.narrative}),a.balanceMeterClimate.housePlacement&&(0,d.jsxs)("p",{className:"text-slate-500 text-center text-[11px] mt-2",children:["...felt in the ",a.balanceMeterClimate.housePlacement]})]})]}),(0,d.jsx)("div",{className:"text-center text-[11px] text-slate-500 border-t border-slate-200 pt-4 italic",children:"\"Here's what resonated, here's what didn't, here's what pattern Raven is tentatively guessing — but you remain the validator.\""}),(0,d.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,d.jsx)("button",{onClick:f,className:"flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-4 rounded-xl transition-colors shadow-sm",children:"Start New Reading"}),(0,d.jsx)("button",{onClick:n,disabled:l,className:"flex-1 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-300 text-white font-medium py-3 px-4 rounded-xl transition-colors flex items-center justify-center gap-2 shadow-sm",children:l?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}),"Generating..."]}):(0,d.jsx)(d.Fragment,{children:"\uD83D\uDCD6 Generate Journal"})}),(0,d.jsx)("button",{onClick:b,className:"px-4 py-3 border border-slate-300 text-slate-600 hover:text-slate-800 hover:border-slate-400 rounded-xl transition-colors",children:"Continue Session"})]})]}),h&&j&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-60",children:(0,d.jsxs)("div",{className:"bg-white rounded-2xl max-w-3xl w-full max-h-[80vh] overflow-hidden flex flex-col shadow-xl",children:[(0,d.jsx)("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6",children:(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-2xl font-serif font-bold",children:j.title}),(0,d.jsx)("p",{className:"text-purple-100 text-sm mt-1",children:j.metadata.sessionDate})]}),(0,d.jsx)("button",{onClick:()=>i(!1),className:"text-white hover:text-purple-200 text-2xl font-bold",children:"\xd7"})]})}),(0,d.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,d.jsx)("div",{className:"prose prose-slate max-w-none",children:(0,d.jsx)("div",{className:"whitespace-pre-wrap text-slate-700 leading-relaxed",children:j.narrative})}),(0,d.jsxs)("div",{className:"mt-6 p-4 bg-slate-50 rounded-lg border",children:[(0,d.jsx)("h3",{className:"font-semibold text-slate-800 mb-3",children:"Session Details"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-slate-600",children:"Total Interactions:"}),(0,d.jsx)("span",{className:"ml-2 font-medium",children:j.metadata.totalInteractions})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-slate-600",children:"Resonance Fidelity:"}),(0,d.jsxs)("span",{className:"ml-2 font-medium",children:[j.metadata.resonanceFidelity,"%"]})]})]}),j.metadata.primaryPatterns.length>0&&(0,d.jsxs)("div",{className:"mt-3",children:[(0,d.jsx)("span",{className:"text-slate-600 text-sm",children:"Primary Patterns:"}),(0,d.jsx)("div",{className:"mt-1",children:j.metadata.primaryPatterns.map((a,b)=>(0,d.jsx)("span",{className:"inline-block bg-white px-2 py-1 rounded text-xs text-slate-700 mr-2 mb-1 border",children:a},b))})]})]})]}),(0,d.jsxs)("div",{className:"bg-slate-50 px-6 py-4 border-t flex justify-end gap-3",children:[(0,d.jsx)("button",{onClick:()=>i(!1),className:"px-4 py-2 text-slate-600 hover:text-slate-800 transition-colors",children:"Close"}),(0,d.jsx)("button",{onClick:()=>{if(!j)return;let a=`${j.title}

${j.narrative}

---
Session Details:
Date: ${j.metadata.sessionDate}
Total Interactions: ${j.metadata.totalInteractions}
Resonance Fidelity: ${j.metadata.resonanceFidelity}%
Primary Patterns: ${j.metadata.primaryPatterns.join(", ")}`;navigator.clipboard.writeText(a).then(()=>{alert("Journal entry copied to clipboard!")})},className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-xl transition-colors",children:"\uD83D\uDCCB Copy to Clipboard"})]})]})})]})})}class K{generateFollowUp(a,b){switch(a.type){case"AFFIRM":return this.generateZoomIn(a,b);case"OSR":return this.generateOSRProbe(a,b);case"UNCLEAR":return this.generateClarification(a,b);default:return this.generateGenericFollowUp()}}generateZoomIn(a,b){let c=["Which line carried the weight for you — and how does it show up in your day?","What part of that landed — and how do you feel it when it's live in your field?","Which piece resonated — and how do you act when that pattern is active?","What line hit — and where do you notice that pressure in your daily life?","Which part felt true — and how does it move through you when it's present?"];return{stage:"ZOOM_IN",question:c[Math.floor(Math.random()*c.length)],purpose:"Isolate specific pressure and gather behavioral context",expectedResponse:"WB"}}generateOSRProbe(a,b){let c=["That one missed. Was it more the opposite, the wrong flavor, or just not in your field at all?","Didn't land. Was it backwards, off-tone, or simply not you?","That felt off. More like the inverse, wrong style, or completely outside your range?","Missed the mark. Was it flipped around, wrong energy, or not in your territory?","That didn't fit. Was it contrary, mismatched tone, or just not your pattern?"];return{stage:"OSR_PROBE",question:c[Math.floor(Math.random()*c.length)],purpose:"Convert OSR miss into diagnostic data for Actor/Role weighting",expectedResponse:"CLARIFICATION"}}generateClarification(a,b){let c=["Help me understand — what felt unclear about that reflection?","What part felt muddy or hard to pin down?","Where did that lose you — the description or how it applies?","What made that feel uncertain for you?"];return{stage:"CLASSIFICATION",question:c[Math.floor(Math.random()*c.length)],purpose:"Gather more context to properly classify the response",expectedResponse:"WB"}}generateGenericFollowUp(){return{stage:"CLASSIFICATION",question:"How does that land with you?",purpose:"General resonance check",expectedResponse:"WB"}}classifyResponse(a,b){let c=a.toLowerCase();if("OSR_PROBE"===b){let a="not-in-field";return c.includes("opposite")||c.includes("backwards")||c.includes("flipped")||c.includes("inverse")?a="opposite":(c.includes("flavor")||c.includes("tone")||c.includes("style")||c.includes("energy"))&&(a="wrong-flavor"),{classification:"OSR",weight:0,targetWeighting:"actor",probeType:a}}if("ZOOM_IN"===b){let b=["when i","i tend to","i usually","i feel","i notice","shows up as","happens when","looks like","feels like"].some(a=>c.includes(a));return b&&a.length>50?{classification:"WB",weight:1,targetWeighting:"both"}:b?{classification:"ABE",weight:.5,targetWeighting:"role"}:{classification:"OSR",weight:0,targetWeighting:"actor"}}return c.includes("yes")||c.includes("exactly")||c.includes("that's me")?{classification:"WB",weight:1,targetWeighting:"both"}:c.includes("somewhat")||c.includes("partially")||c.includes("kind of")?{classification:"ABE",weight:.5,targetWeighting:"role"}:{classification:"OSR",weight:0,targetWeighting:"actor"}}updateSessionContext(a,b,c){let d={...a};switch(c.classification){case"WB":d.wbHits.push({content:b});break;case"ABE":d.abeHits.push({content:b,tone:"off-tone"});break;case"OSR":d.osrMisses.push({content:b,probeType:c.probeType})}switch(c.targetWeighting){case"actor":d.actorWeighting+=c.weight;break;case"role":d.roleWeighting+=c.weight;break;case"both":d.actorWeighting+=.6*c.weight,d.roleWeighting+=.4*c.weight}let e=d.actorWeighting+d.roleWeighting;return d.driftIndex=e>0?d.actorWeighting/e:0,d}generateWrapUpCard(a){let b=this.calculateResonanceFidelity(a);return{hookStack:[],resonantLines:a.wbHits.map(a=>a.content),scoreStrip:{wb:a.wbHits.length,abe:a.abeHits.length,osr:a.osrMisses.length},resonanceFidelity:b,actorRoleComposite:a.currentComposite,driftFlag:a.driftIndex>.6,climateRibbon:void 0}}calculateResonanceFidelity(a){let b,c,d=a.wbHits.length,e=a.abeHits.length,f=d+e+a.osrMisses.length;if(0===f)return{percentage:0,band:"LOW",label:"No Responses Yet"};let g=Math.round((d+.5*e)/f*100);return g>70?(b="HIGH",c="High Alignment"):g>=40?(b="MIXED",c="Mixed Resonance"):(b="LOW",c="Low Alignment"),{percentage:g,band:b,label:c}}generateSessionClosure(){return{resetPrompt:"Are you going to upload a new report or are we to speak of something else in your pattern?",continuationOptions:["Upload new report","Explore another area","Generate poetic card","Review session patterns"]}}generatePoeticCard(a){let b=a.wbHits[0]?.content||"No clear resonance yet";return{title:"Resonance Pattern Card",resonantLine:b,scoreIndicator:`✅ ${a.wbHits.length} WB / 🟡 ${a.abeHits.length} ABE / ❌ ${a.osrMisses.length} OSR`,resonanceFidelity:this.calculateResonanceFidelity(a),compositeGuess:a.currentComposite||"Pattern emerging...",driftFlag:a.driftIndex>.6?"\uD83C\uDF00 Sidereal drift detected":void 0}}generateJournalSummary(a,b="the user"){let c=this.calculateResonanceFidelity(a),d=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),e=a.wbHits.slice(0,3).map(a=>this.extractKeyPhrase(a.content)).filter(a=>a.length>0),f=this.generateNarrativeSummary(a,b,c);return{title:`Raven Reading Session - ${b}`,narrative:f,metadata:{sessionDate:d,totalInteractions:a.wbHits.length+a.abeHits.length+a.osrMisses.length,resonanceFidelity:c.percentage,primaryPatterns:e}}}extractKeyPhrase(a){let b=a.split(/[.!?]+/).filter(a=>a.trim().length>0),c=["when i","i tend to","i usually","i feel","shows up as"];for(let a of b){let b=a.toLowerCase().trim();if(c.some(a=>b.includes(a))&&a.length<100)return a.trim()}return b[0]?.trim()||a.substring(0,50)+"..."}generateNarrativeSummary(a,b,c){let d=a.wbHits.length+a.abeHits.length+a.osrMisses.length;if(0===d)return`${b} began a session with Raven but had not yet explored any patterns deeply enough for resonance tracking.`;let e=`On this session, ${b} sat with Raven to explore the patterns written in their chart. `;if("HIGH"===c.band?e+=`The conversation flowed with remarkable alignment—Raven's mirrors consistently landed true, with ${b} recognizing themselves clearly in ${c.percentage}% of the reflections offered. `:"MIXED"===c.band?e+=`The dialogue wove between recognition and clarification, with ${b} finding ${c.percentage}% resonance as they and Raven navigated the more complex territories of their pattern. `:e+=`This session required careful excavation, with only ${c.percentage}% initial resonance as ${b} and Raven worked together to find the precise language for their inner architecture. `,a.wbHits.length>0){e+="What rang most true were insights around ";let b=a.wbHits.slice(0,2).map(a=>this.extractKeyPhrase(a.content));1===b.length?e+=`${b[0].toLowerCase()}. `:e+=`${b.slice(0,-1).join(", ").toLowerCase()}, and ${b[b.length-1].toLowerCase()}. `}return a.driftIndex>.6&&(e+=`Throughout the exchange, Raven detected signs that ${b}'s core drives might operate from a different seasonal rhythm than their outward presentation suggests—a pattern sometimes called sidereal drift. `),a.osrMisses.length>0&&a.osrMisses.length/d>.3&&(e+=`Several of Raven's initial offerings missed the mark entirely, requiring gentle probing to understand whether the patterns were inverted, off-tone, or simply outside ${b}'s field altogether. `),a.currentComposite?e+=`By session's end, the tentative pattern emerging was "${a.currentComposite}"—though ${b}, as always, remained the final validator of what felt true.`:e+=`The session concluded with patterns still crystallizing, leaving space for ${b} to continue the exploration when ready.`,e}}let L=new K,M=a=>a.replace(/[&<>]/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;"})[a]||a),N=[{key:"picture",label:"Picture"},{key:"feeling",label:"Feeling"},{key:"container",label:"Container"},{key:"option",label:"Option"},{key:"next_step",label:"Next Step"}];function O(a,b){if(!a)return"<i>No mirror draft returned.</i>";let c=N.map(({key:b,label:c})=>{let d=a[b];return d?`
      <div class="mirror-row" style="display:flex; flex-direction:column; gap:4px; padding:8px 10px; background:rgba(15,23,42,0.65); border:1px solid rgba(148,163,184,0.18); border-radius:10px;">
        <span class="mirror-label" style="font-size:11px; text-transform:uppercase; letter-spacing:0.05em; color:#94a3b8;">${c}</span>
        <span class="mirror-value" style="font-size:14px; line-height:1.45; color:#e2e8f0;">${M(String(d))}</span>
      </div>
    `:null}).filter(Boolean).join(""),d=a.appendix&&"object"==typeof a.appendix?Object.entries(a.appendix).filter(([a,b])=>null!=b&&""!==String(b).trim()).map(([a,b])=>`<li><strong>${M(a.replace(/_/g," "))}:</strong> ${M(String(b))}</li>`):[],e=d.length?`<div class="mirror-appendix" style="margin-top:10px; padding:10px; border:1px solid rgba(148,163,184,0.18); border-radius:10px; background:rgba(15,23,42,0.5);">
        <div class="mirror-appendix-title" style="font-size:11px; text-transform:uppercase; letter-spacing:0.05em; color:#94a3b8; margin-bottom:6px;">Appendix</div>
        <ul style="margin:0; padding-left:16px; color:#cbd5f5; font-size:12px; line-height:1.4;">${d.join("")}</ul>
      </div>`:"",f=b?.source?`<div class="mirror-provenance" style="margin-top:12px; font-size:11px; color:#94a3b8;">Source \xb7 ${M(String(b.source))}</div>`:"";return`
    <section class="mirror-draft" style="display:flex; flex-direction:column; gap:10px;">
      ${c||"<p><em>No primary mirror lanes provided.</em></p>"}
      ${e}
      ${f}
    </section>
  `}let P={geometry:"Chart detected — parsing as geometry",report:"Report request detected — running Math Brain handoff",conversation:"Conversation lane active"};function Q(a){if(!a)return"";let b=a;if(b=(b=(b=(b=(b=(b=(b=(b=b.replace(/\{I've received.*?\}[\s\S]*?(?=\n\n|$)/gi,"")).replace(/The Balance Meter shows.*?(?=\n|$)/gi,"")).replace(/.*magnitude.*?valence.*?volatility.*?(?=\n|$)/gi,"")).replace(/.*glyphs are.*?(?=\n|$)/gi,"")).replace(/.*report already contains.*?(?=\n|$)/gi,"")).replace(/^\s*\*\*Symbolic Weather Header:\*\*.*?(?=\n|$)/gmi,"")).replace(/(##\s*SST[_\s-]*Clause[\s\S]*?$)|(^.*SST[_\s-]*Prompt.*$)|(^.*Resonance[_\s-]*Rule.*$)|(^.*Conditional[_\s-]*Language.*$)/gim,"")).replace(/\bSST\b/g,"").replace(/\bWB\s*\/\s*ABE\s*\/\s*OSR\b/gi,"").replace(/\b(magnitude|valence)\s*[-:]?\s*\d+\.?\d*/gi,"").replace(/\[[^\]]*operator[^\]]*\]/gi,"").replace(/\[Operator.*?\]/gi,"").replace(/[\u260d\u2642\u263d\u26a1\ud83c\udf11\ud83c\udf1e]\s*and\s*[\u260d\u2642\u263d\u26a1\ud83c\udf11\ud83c\udf1e]/g,"").replace(/The glyphs are [^.]*\./gi,""),/Outside\s+Symbolic\s+Range\b/i.test(a)||/\bOSR\b/.test(a)){let a="If none of this felt familiar, treat it as valid null data—your experience sets the boundary.";b.trim().endsWith(a)||(b=b.trim()+(/[.!?]$/.test(b.trim())?" ":". ")+a),b=b.replace(/\bOSR\b/g,"null data")}return(b=(b=b.replace(/Did this land\?\s*Mark\.?/gi,"Does any of this feel familiar?")).replace(/Mark\s*(WB|ABE|OSR)\.?/gi,"")).replace(/\s{2,}/g," ").replace(/^\s*[-*]\s*$/gm,"").trim()}function R(a){return!S(a)&&[/does any of this feel familiar/i,/did this land/i,/does this fit your experience/i,/feel true to you/i,/resonate with you/i,/ring true/i,/sound right/i,/feel accurate/i].some(b=>b.test(a))}function S(a){return[/does this repair feel true/i,/is this a more accurate description/i,/is that a more accurate description/i,/does this feel more accurate/i,/is this closer to your experience/i,/does this better capture/i,/probe missed.*describing/i,/that missed.*you're actually/i,/i'm logging that probe as osr/i].some(b=>b.test(a))}function T({onClose:a}){return(0,d.jsx)("div",{className:"fixed inset-0 bg-[rgba(0,0,0,0.7)] flex items-center justify-center z-[1000]",children:(0,d.jsxs)("div",{className:"relative w-full max-w-[420px] rounded-[12px] bg-[#181c24] p-8 text-[#e0e6f0] shadow-[0_8px_32px_#0008]",children:[(0,d.jsx)("button",{onClick:a,className:"absolute right-3 top-3 cursor-pointer border-0 bg-transparent text-[24px] text-[#94a3b8]",children:"\xd7"}),(0,d.jsx)("h2",{className:"mt-0 text-[20px] text-slate-100",children:"Help & Button Guide"}),(0,d.jsxs)("ul",{className:"list-none pl-0 text-[15px] leading-7",children:[(0,d.jsxs)("li",{children:[(0,d.jsx)("b",{children:"\uD83E\uDE9E Mirror"}),": Upload a Mirror report (personal reflection data) for analysis."]}),(0,d.jsxs)("li",{children:[(0,d.jsx)("b",{children:"\uD83C\uDF21️ Balance"}),": Upload a Balance Meter report (energetic state snapshot)."]}),(0,d.jsxs)("li",{children:[(0,d.jsx)("b",{children:"\uD83D\uDCD4 Journal"}),": Upload a Journal entry (narrative or notes for context)."]}),(0,d.jsxs)("li",{children:[(0,d.jsx)("b",{children:"\uD83C\uDFAD Poetic"}),": Generate a poetic interpretation of your Mirror data (unlocked after uploading a Mirror)."]}),(0,d.jsxs)("li",{children:[(0,d.jsx)("b",{children:"\uD83C\uDFB4 Card"}),": Create a visual Poetic Index Card from your Mirror data (unlocked after uploading a Mirror)."]}),(0,d.jsxs)("li",{children:[(0,d.jsx)("b",{children:"\uD83C\uDFB4 Demo"}),": Preview a sample Poetic Index Card (no data required)."]}),(0,d.jsxs)("li",{children:[(0,d.jsx)("b",{children:"\uD83C\uDFAD Reveal"}),": Generate your Actor/Role composite from session feedback (shows after enough pings)."]}),(0,d.jsxs)("li",{children:[(0,d.jsx)("b",{children:"ℹ️ About"}),": Learn about Raven Calder and the project’s philosophy."]}),(0,d.jsxs)("li",{children:[(0,d.jsx)("b",{children:"❓ Help"}),": Show this help dialog."]})]}),(0,d.jsxs)("div",{className:"mt-4 text-[13px] text-[#94a3b8]",children:[(0,d.jsx)("b",{children:"Tip:"})," Hover on any button for a tooltip. For best results, give feedback on several mirrors before using ",(0,d.jsx)("b",{children:"Reveal"}),"."]})]})})}function U(){let[a,b]=(0,e.useState)(!1),[f,g]=(0,e.useState)([{id:"init",role:"raven",html:`I’m a clean mirror. I put what you share next to the pattern I see and speak it back in plain language. No fate talk, no certainty—just useful reflections you can test.`,climate:function(a){let b=0,c=1,d=0;if(a){let e=a.toLowerCase();/(crisis|break|fail|crash|end|stuck|impossible|collapse|destroy|catastrophe)/i.test(e)?b=-5:/(difficult|struggle|resist|fight|hard|burden|exhaust|grind|strain|wear)/i.test(e)?b=-4:/(conflict|disagree|argue|oppose|clash|tension|friction|dispute|against)/i.test(e)?b=-3:/(narrow|limit|reduce|shrink|constrain|block|contract|restrict|close)/i.test(e)?b=-2:/(slow|delay|hesitate|doubt|unclear|minor|slight|drag|hinder|small)/i.test(e)?b=-1:/(breakthrough|freedom|achieve|transform|unlimited|liberate|soar|transcend)/i.test(e)?b=5:/(growth|opportunity|develop|advance|expand|progress|flourish|thrive)/i.test(e)?b=4:/(balance|align|connect|unite|coherent|synergy|harmony|integrate|blend)/i.test(e)?b=3:/(smooth|adapt|flexible|easy|natural|fluid|flow|graceful|effortless)/i.test(e)?b=2:/(begin|start|improve|hope|gentle|positive|lift|rise|encourage)/i.test(e)&&(b=1),/(major|significant|huge|massive|complete|total|full)/i.test(e)?c=5:/(strong|important|serious|considerable|notable)/i.test(e)?c=4:/(moderate|medium|some|partial|decent)/i.test(e)?c=3:/(small|minor|little|slight|modest)/i.test(e)&&(c=2),/(chaos|random|wild|unpredictable|turbulent|erratic)/i.test(e)?d=5:/(changing|shifting|variable|dynamic|fluctuating)/i.test(e)?d=3:/(stable|steady|consistent|predictable|calm)/i.test(e)&&(d=0),c=Math.max(0,Math.min(5,c)),d=Math.max(0,Math.min(5,d)),b=Math.max(-5,Math.min(5,b))}return r({magnitude:c,valence:b,volatility:d})}("supportive clear mirror"),hook:"Atmosphere \xb7 Creator ∠ Mirror"}]),[h,i]=(0,e.useState)(""),[j,k]=(0,e.useState)(!1),l=(0,e.useRef)(null),m=(0,e.useRef)(null),o=(0,e.useRef)(null),[p,q]=(0,e.useState)(null),[s,t]=(0,e.useState)(!1),[y,z]=(0,e.useState)(!1),A=(0,e.useRef)(null),[B,D]=(0,e.useState)(null),[E,F]=(0,e.useState)(null),G=(0,e.useRef)(null),[H,K]=(0,e.useState)(null),[N,R]=(0,e.useState)([]),[U,X]=(0,e.useState)(!1),[Y,Z]=(0,e.useState)(!1),[$,_]=(0,e.useState)(!1),[ab,af]=(0,e.useState)(!1),[ag,ah]=(0,e.useState)([]),[ai,aj]=(0,e.useState)(null),[ak,al]=(0,e.useState)(!1),[am,an]=(0,e.useState)(!1),[ao,ap]=(0,e.useState)(()=>({sessionStart:Date.now(),actorProfile:null,wbHits:[],abeHits:[],osrMisses:[],actorWeighting:0,roleWeighting:0,driftIndex:0,currentComposite:void 0,sessionActive:!0})),[aq,ar]=(0,e.useState)(0),as=a=>a.replace(/<[^>]*>/g," ").replace(/\s{2,}/g," ").trim(),at=a=>(a.match(/[^.!?]+[.!?]?/)?.[0]||a).trim(),au=async()=>{let a=f.filter(a=>"user"===a.role&&!a.isReport),b=a[0]?.html||"",c=b.match(/my name is (\w+)/i)||b.match(/i'm (\w+)/i)||b.match(/i am (\w+)/i),d=c?c[1]:"the user",e=await L.generateJournalSummary(ao,d),g=f.slice(-12),h=g.filter(a=>"user"===a.role&&!a.isReport).map(a=>as(a.html)).filter(Boolean),i=g.filter(a=>"raven"===a.role).map(a=>as(a.html)).filter(Boolean),j=i[0]?at(i[0]):"",k=h.length>0?`They brought ${1===h.length?"one note":h.length+" notes"} of focus, including: "${at(h[0])}"`:"",l=[j&&`Opening read: ${j}`,k,i.length>1?`Raven mirrored with lines like: "${at(i[1])}"`:"",i[i.length-1]?`We closed on: "${at(i[i.length-1])}"`:""].filter(Boolean).join(" \n\n"),m=l?`Conversation Thread (Paraphrase)

${l}`:"";return m&&(e.narrative=`${e.narrative}

---
${m}`.trim()),e},av=f.filter(a=>"raven"===a.role),aw=()=>{m.current?.scrollIntoView({behavior:"smooth"}),z(!1)};async function ax(a){if(j)return;k(!0);let b=new AbortController;l.current=b;let c=n();g(a=>[...a,{id:c,role:"raven",html:"",climate:"",hook:"",intent:void 0,probe:null,draft:null,prov:null}]);try{let d={input:a.content,sessionId:B??void 0,options:{reportType:a.type,reportId:a.id,reportName:a.name,reportSummary:a.summary,relocation:a.relocation,reportContexts:N.map(a=>({id:a.id,type:a.type,name:a.name,summary:a.summary,content:a.content}))}},e=await fetch("/api/raven",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),signal:b.signal}),f=await e.json().catch(()=>({}));if(!e.ok||!f?.ok){let a="string"==typeof f?.error?f.error:e.ok?"Raven could not analyze that report.":`Request failed (${e.status})`;aE(c,a);return}aD(c,f,"No mirror returned for this report.")}catch(a){a?.name==="AbortError"?aE(c,"Report analysis cancelled."):(console.error("Report analysis failed:",a),aE(c,"Analysis error. Try again."))}finally{k(!1),l.current=null}}async function ay(a){if(!a.trim())return;if(l.current)try{l.current.abort()}catch{}let b={id:n(),role:"user",html:M(a)};g(a=>[...a,b]),k(!0);let c=new AbortController;l.current=c;let d=n();g(a=>[...a,{id:d,role:"raven",html:"",climate:"",hook:"",intent:void 0,probe:null,draft:null,prov:null}]);try{let b={input:a,sessionId:B??void 0,options:{reportContexts:N.map(a=>({id:a.id,type:a.type,name:a.name,summary:a.summary,content:a.content})),relocation:H}},e=await fetch("/api/raven",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b),signal:c.signal}),f=await e.json().catch(()=>({}));if(!e.ok||!f?.ok){let a="string"==typeof f?.error?f.error:e.ok?"Raven could not complete that request.":`Request failed (${e.status})`;aE(d,a);return}aD(d,f,"No mirror returned for this lane.")}catch(a){a?.name==="AbortError"?aE(d,"Request cancelled."):(console.error("Raven request failed:",a),aE(d,"Error: Failed to reach Raven API."))}finally{k(!1),l.current=null}}async function az(){let a=h.trim();if(!a)return;if(ab){let b=a.toLowerCase().replace(/<[^>]*>/g,""),c=(()=>{let c=b.split(/\s+/).filter(Boolean),d=0,e=new Set(ag);for(let a of c)if(e.has(a)&&++d>=2)break;return d>=2||/(same|continue|resume|again|back to|still on|pick up|that topic|previous)/i.test(a)})()?"We can open a fresh reading on the same thread—say the word and I’ll start a new mirror.":"Got it—starting a new reading for this.",d=n();g(a=>[...a,{id:d,role:"raven",html:c,climate:"",hook:""}]),af(!1)}if(l.current)try{l.current.abort()}catch{}let b={id:n(),role:"user",html:M(a)};g(a=>[...a,b]),i(""),k(!0);let c=new AbortController;l.current=c;let d=n();g(a=>[...a,{id:d,role:"raven",html:"",climate:"",hook:"",intent:void 0,probe:null,draft:null,prov:null}]);try{let b={input:a,sessionId:B??void 0,options:{reportContexts:N.map(a=>({id:a.id,type:a.type,name:a.name,summary:a.summary,content:a.content})),relocation:H}},e=await fetch("/api/raven",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b),signal:c.signal}),f=await e.json().catch(()=>({}));if(!e.ok||!f?.ok){let a="string"==typeof f?.error?f.error:e.ok?"Raven could not complete that request.":`Request failed (${e.status})`;aE(d,a);return}aD(d,f,"No mirror returned for this lane.")}catch(a){a?.name==="AbortError"?aE(d,"Request cancelled."):(console.error("Raven request failed:",a),aE(d,"Error: Failed to reach Raven API."))}finally{k(!1),l.current=null}}let aA=a=>{let b=a;if(!b){let a=f.filter(a=>"raven"===a.role).pop();if(a){let c=function(a){try{let b=a.split("\n"),c=[],d="Untitled",e="",f="moon";for(let a=0;a<b.length;a++){let g=b[a].trim();if((g.includes("Title:")||g.startsWith("# "))&&(d=g.replace(/^(Title:|#)\s*/,"").trim()),g.includes("**1. Poem")||g.includes("### Poem"))for(let d=a+1;d<b.length;d++){let a=b[d].trim();if(""===a||a.includes("**2.")||a.includes("###"))break;!(a.length>0)||a.includes("*")||a.includes("#")||c.push(a)}g.includes("?")&&g.length>20&&g.length<150&&(e=g);let h=g.match(/(mars|venus|mercury|moon|neptune|saturn|chiron|jupiter|uranus|pluto|sun)/i);h&&(f=h[1].toLowerCase())}if(0===c.length)return null;return{title:d,poeticPhrase:"A reflection in symbolic weather",poem:c.slice(0,6),mirrorPrompt:e||"What does this reveal about your current path?",blockTimeNote:"echoes may land past, present, or future",dominantPlanet:f,colorTheme:f,talismancGlyph:x(f),date:new Date().toISOString().slice(0,10),astroGlyphs:[x(f)],talismancSketch:"*",symbolDrivers:["\uD83D\uDFE2"]}}catch(a){return console.error("Error parsing card data:",a),null}}(as(a.html));c&&(b=c)}}b||(b={title:"The Current Beneath Still Waters",poeticPhrase:"where depth moves unseen",poem:["You carry the ocean in small gestures,","a tide that others feel but cannot name.","What looks like stillness","is actually patience,","the kind that reshapes shores","one grain at a time."],mirrorPrompt:"Where does your quiet power move most freely?",blockTimeNote:"echoes may land past, present, or future",dominantPlanet:"moon",colorTheme:"moon",talismancGlyph:"☽",astroGlyphs:["☽","♆","♀"],transitKey:"MOON-NEPTUNE CONJUNCTION: Intuitive flow through emotional depths",talismancSketch:"~",symbolDrivers:["\uD83D\uDD35","⚪","\uD83D\uDFE2"],date:new Date().toISOString().slice(0,10)});let c=function(a){let b=v[a.dominantPlanet]||v.moon,c=w[a.dominantPlanet]||"✦";return`
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poetic Index Card - ${a.title}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #f0f0f0;
            padding: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }
        
        .card {
            width: 400px;
            height: 600px;
            background: ${b.background};
            border-radius: 12px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            color: ${b.textColor};
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .corner-glyph {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 18px;
            opacity: 0.4;
            font-family: serif;
            z-index: 3;
        }
        
        .side-glyphs {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 12px;
            opacity: 0.3;
            font-family: serif;
            z-index: 2;
        }
        
        .talisman-watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            opacity: 0.08;
            font-family: serif;
            z-index: 1;
            pointer-events: none;
        }
        
        .top-zone {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            z-index: 4;
        }
        
        .title {
            font-family: 'Crimson Text', serif;
            font-size: 22px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 12px;
            line-height: 1.2;
        }
        
        .poetic-phrase {
            font-family: 'Crimson Text', serif;
            font-size: 16px;
            font-style: italic;
            opacity: 0.9;
            letter-spacing: 0.5px;
        }
        
        .middle-zone {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            z-index: 4;
        }
        
        .poem {
            font-family: 'Crimson Text', serif;
            font-size: 18px;
            line-height: 1.8;
            letter-spacing: 0.3px;
        }
        
        .poem-line {
            margin-bottom: 8px;
        }
        
        .bottom-zone {
            text-align: center;
            margin-top: 30px;
            position: relative;
            z-index: 4;
        }
        
        .mirror-prompt {
            font-family: 'Crimson Text', serif;
            font-size: 15px;
            font-style: italic;
            margin-bottom: 12px;
            color: ${b.accentColor};
            line-height: 1.4;
        }
        
        .block-time-note {
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            font-weight: 300;
            opacity: 0.7;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }
        
        .transit-key {
            font-family: 'Inter', sans-serif;
            font-size: 10px;
            opacity: 0.6;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }
        
        .archive-identity {
            font-family: 'Inter', sans-serif;
            font-size: 10px;
            font-weight: 300;
            opacity: 0.6;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        .grain-texture {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255,255,255,0.05) 0%, transparent 50%);
            border-radius: 12px;
            pointer-events: none;
            z-index: 1;
        }

        .download-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0,0,0,0.8);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
        }

        .control-btn:hover {
            background: rgba(0,0,0,0.9);
        }

        @media print {
            body { background: white; padding: 0; }
            .download-controls { display: none; }
        }
    </style>
</head>
<body>
    <div class="download-controls">
        <button class="control-btn" onclick="downloadAsImage()">📥 Download as Image</button>
        <button class="control-btn" onclick="copyToClipboard()">📋 Copy to Clipboard</button>
    </div>

    <div class="card" id="poeticCard">
        <div class="grain-texture"></div>
        <div class="corner-glyph">${c}</div>
        
        <div class="side-glyphs">
            ${a.astroGlyphs.map(a=>`<div>${a}</div>`).join("")}
        </div>
        
        <div class="talisman-watermark">${a.talismancSketch}</div>
        
        <div class="top-zone">
            <div class="title">${a.title}</div>
            <div class="poetic-phrase">${a.poeticPhrase}</div>
        </div>
        
        <div class="middle-zone">
            <div class="poem">
                ${a.poem.map(a=>`<div class="poem-line">${a}</div>`).join("")}
            </div>
        </div>
        
        <div class="bottom-zone">
            <div class="mirror-prompt">${a.mirrorPrompt}</div>
            <div class="block-time-note">${a.blockTimeNote}</div>
            ${a.transitKey?`<div class="transit-key">${a.transitKey}</div>`:""}
            <div class="archive-identity">Poetic Index \xb7 Raven Calder \xb7 ${a.date}</div>
        </div>
    </div>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        async function downloadAsImage() {
            const card = document.getElementById('poeticCard');
            const canvas = await html2canvas(card, {
                backgroundColor: null,
                scale: 2,
                useCORS: true
            });
            
            const link = document.createElement('a');
            link.download = 'poetic-index-card-${a.title.toLowerCase().replace(/[^a-z0-9]/g,"_")}-${a.date}.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        async function copyToClipboard() {
            const card = document.getElementById('poeticCard');
            const canvas = await html2canvas(card, {
                backgroundColor: null,
                scale: 2,
                useCORS: true
            });
            
            canvas.toBlob(async (blob) => {
                try {
                    await navigator.clipboard.write([
                        new ClipboardItem({ 'image/png': blob })
                    ]);
                    alert('Card copied to clipboard!');
                } catch (err) {
                    console.error('Failed to copy: ', err);
                    alert('Copy failed. Try the download option instead.');
                }
            });
        }
    </script>
</body>
</html>`}(b),d=window.open("","_blank");d?(d.document.write(c),d.document.close()):aB(c)},aB=a=>{let b=document.createElement("div");b.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    `;let c=document.createElement("div");c.style.cssText=`
      max-width: 90%;
      max-height: 90%;
      overflow: auto;
      background: white;
      border-radius: 12px;
      position: relative;
    `;let d=document.createElement("button");d.innerHTML="✕",d.style.cssText=`
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.8);
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      z-index: 10001;
      font-size: 16px;
    `;let e=document.createElement("iframe");e.style.cssText=`
      width: 480px;
      height: 680px;
      border: none;
      border-radius: 12px;
    `,e.srcdoc=a,c.appendChild(d),c.appendChild(e),b.appendChild(c),document.body.appendChild(b);let f=()=>document.body.removeChild(b);d.onclick=f,b.onclick=a=>{a.target===b&&f()}},aC=async a=>{let b,d=a.target.files?.[0];if(!d)return;let e=null;if("application/pdf"===d.type||d.name.toLowerCase().endsWith(".pdf"))try{let a=await c.e(853).then(c.bind(c,50853));a.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";let e=await d.arrayBuffer(),f=await a.getDocument(e).promise,g="";for(let a=1;a<=f.numPages;a++){let b=await f.getPage(a),c=(await b.getTextContent()).items.filter(a=>"str"in a).map(a=>a.str).join(" ");g+=c+"\n\n"}b=g.trim()}catch(a){console.error("Error extracting PDF text:",a),alert("Failed to extract text from PDF. Please try a different file.");return}else b=await new Promise((a,b)=>{let c=new FileReader;c.onload=b=>a(b.target?.result),c.onerror=b,c.readAsText(d)});let f=b,g="",h=null;try{let a=JSON.parse(b);if(a.context&&a.balance_meter){let{context:c,balance_meter:d}=a;try{c?.translocation?(e=(0,u.Et)({type:a.type||"balance",natal:c.natal||{name:"",birth_date:"",birth_time:"",birth_place:""},translocation:{applies:!!c.translocation.applies,current_location:c.translocation.current_location||"Natal Base",house_system:c.translocation.house_system,tz:c.translocation.tz}}),K(e)):K(null)}catch{K(null)}g=`JSON Report for ${c.natal?.name||"Unknown"} | Magnitude: ${d.magnitude?.value} (${d.magnitude?.term}) | Valence: ${d.valence?.emoji} ${d.valence?.term}`,f=JSON.stringify(a,null,2),h=a.reports?.templates?.solo_mirror||/solo mirror/i.test(b)?"mirror":"balance"}}catch{K(null)}f.trim().startsWith("{")&&f.trim().endsWith("}")||Q(f);let i=p||h||"balance",j={id:n(),type:i,name:g?g.split("|")[0].trim():`${p||"Balance"} Report`,summary:[g,e?.disclosure||null].filter(Boolean).join(" • "),content:b,relocation:e||void 0};R(a=>[...a,j]),K(e),await ax(j),("mirror"===i||g&&g.includes("JSON Report"))&&t(!0),a.target&&(a.target.value="")};function aD(a,b,c){b.sessionId&&D(b.sessionId);var d=b.intent;let e=d?P[d]:null;e&&(F(e),G.current&&window.clearTimeout(G.current),G.current=window.setTimeout(()=>F(null),3200));let f=b?.draft?O(b.draft,b.prov??null):c?`<p>${M(c)}</p>`:"<i>No mirror returned.</i>",h=function(a){if(a){if("string"==typeof a)return a;try{return r(a)}catch{return}}}(b?.climate??void 0),i=function(a,b){if(!a)return b?.source?`Source \xb7 ${b.source}`:void 0;let c=b?.source?` \xb7 ${b.source}`:"";return`Lane \xb7 ${"geometry"===a?"Geometry":"report"===a?"Report":"Conversation"}${c}`}(b?.intent,b?.prov??null);g(c=>c.map(c=>c.id!==a?c:{...c,html:f,climate:h??c.climate,hook:i??c.hook,intent:b.intent??c.intent,probe:b.probe??null,draft:b.draft??null,prov:b.prov??null}))}function aE(a,b){let c=`<i>${M(b)}</i>`;g(b=>b.map(b=>b.id===a?{...b,html:c,climate:void 0,hook:void 0}:b))}return(0,d.jsxs)("div",{className:"app",style:{display:"flex",flexDirection:"column",height:"100vh",maxWidth:980,margin:"0 auto"},children:[(0,d.jsx)("input",{type:"file",ref:o,onChange:aC,style:{display:"none"},accept:".txt, .md, .json, .pdf"}),(0,d.jsx)(V,{onFileSelect:a=>{q(a),o.current?.click()},hasMirrorData:s,onPoeticInsert:()=>{ay("Please create a Symbol-to-Poem translation based on the Mirror data you have. Follow the strict Symbol-to-Song Translation protocol with pure poem first, then explanation table with planetary emoji codes.")},onAbout:()=>{let a={id:n(),role:"raven",html:"I am the creation of Dan Cross, born from his compulsion to systematize survival into something transferable. I read the symbolic patterns of your reality without imposing my creator's story on yours.",climate:"\uD83D\uDD0D Truth \xb7 \uD83C\uDF10 Origin \xb7 \uD83C\uDFAF Purpose",hook:"Creator & Created \xb7 Pattern ↔ Recognition"};g(b=>[...b,a])},onToggleSidebar:()=>{},sidebarOpen:!1,reportContexts:N,onRemoveReportContext:function(a){R(b=>b.filter(b=>b.id!==a));let b=N.filter(b=>b.id!==a);b.length>0?K(b[b.length-1].relocation||null):K(null)},onPoeticCard:()=>{aA()},onDemoCard:()=>{aA({title:"Threshold Keeper",poeticPhrase:"where endings birth beginnings",poem:["At the edge of known territory","symbols scatter like leaves,","each one a door","that opens only once.","","What calls you forward","is already waiting inside—","the question dissolves","as you become the answer."],mirrorPrompt:"What threshold are you crossing that requires you to become someone new?",blockTimeNote:"SYMBOLIC WEATHER: Transition patterns indicating boundary dissolution",date:new Date().toLocaleDateString(),dominantPlanet:"pluto",colorTheme:"pluto",talismancGlyph:"♇",astroGlyphs:["♇","♄","♆"],transitKey:"PLUTO-SATURN TRINE: Structured transformation through symbolic dissolution",talismancSketch:"⚡",symbolDrivers:["\uD83D\uDFE3","⚫","\uD83D\uDD34"]})},onShowWrapUp:()=>X(!0),onShowPendingReview:()=>Z(!0),onShowHelp:()=>b(!0)}),E&&(0,d.jsx)("div",{style:{position:"fixed",top:76,left:"50%",transform:"translateX(-50%)",background:"rgba(30, 41, 59, 0.92)",color:"#e2e8f0",padding:"10px 16px",borderRadius:12,border:"1px solid rgba(148, 163, 184, 0.28)",boxShadow:"0 12px 32px rgba(15, 23, 42, 0.35)",fontSize:13,zIndex:1200,letterSpacing:"0.02em"},children:E}),am&&ai&&(0,d.jsx)("div",{className:"flex items-center justify-center gap-3 px-3 py-2 bg-[var(--panel)] border-b border-[var(--line)] text-[13px]",children:(()=>{let a=ai.summary||{},b=ai.inputs?.startDate,c=ai.inputs?.endDate,e=b&&c?`${b} → ${c}`:b||c||"recent",f="number"==typeof a.magnitude?a.magnitude:void 0,g=a.magnitudeLabel||(void 0!==f?`M${f}`:"M\xb7"),h=a.valenceLabel||"Valence",i=a.volatilityLabel||"Volatility";return(0,d.jsxs)("div",{className:"flex items-center gap-2 text-[var(--muted)]",children:[(0,d.jsx)("span",{className:"text-[var(--text)]",children:"Balance Meter hand‑off"}),(0,d.jsx)("span",{children:"•"}),(0,d.jsx)("span",{className:"text-[var(--text)]",children:g}),(0,d.jsx)("span",{children:"\xb7"}),(0,d.jsx)("span",{children:h}),(0,d.jsx)("span",{children:"\xb7"}),(0,d.jsx)("span",{children:i}),(0,d.jsx)("span",{children:"•"}),(0,d.jsx)("span",{children:e}),(0,d.jsx)("span",{children:"•"}),(0,d.jsx)("span",{children:"Clear Mirror — OSR valid if it doesn’t land"}),(0,d.jsx)("button",{onClick:()=>an(!1),className:"ml-2 rounded px-2 py-0.5 text-[12px] border border-[var(--line)] text-[var(--muted)] hover:text-[var(--text)]","aria-label":"Dismiss hand-off banner",children:"\xd7"})]})})()}),a&&(0,d.jsx)(T,{onClose:()=>b(!1)}),ak&&ai?.summary&&(0,d.jsx)("div",{className:"flex justify-center px-3 py-2 bg-[var(--panel)] border-b border-[var(--line)]",children:(()=>{let a=Number(ai.summary?.magnitude||0),b=r({magnitude:a,valence:Number(ai.summary?.valence||0),volatility:Number(ai.summary?.volatility||0)}),c=ai.inputs?.startDate,e=ai.inputs?.endDate,f=ai.inputs?.personA?.name||"Person A",h=ai.inputs?.includePersonB&&ai.inputs?.personB?.name?` \xb7 with ${ai.inputs?.personB?.name}`:"",j=c&&e?`${c} → ${e}`:c||e||"recent";return(0,d.jsxs)("div",{className:"flex items-center gap-2 border border-[var(--line)] bg-[var(--soft)] rounded-lg px-3 py-2 max-w-[900px] w-full",children:[(0,d.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,d.jsx)("div",{className:"text-[11px] text-[var(--muted)]",children:"Resume from Math Brain"}),(0,d.jsxs)("div",{className:"text-[13px] text-[var(--text)] truncate",children:[b," \xb7 ",j]})]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("button",{onClick:()=>{i(`Resume from Math Brain (${j}). Climate: ${b}. Continue with a concise mirror in Raven Calder style for ${f}${h}.`);let a={id:n(),role:"raven",html:`<i>Loaded Math Brain context • ${b} • ${j}</i>`,climate:b,hook:"Math Brain → Poetic Brain"};g(b=>[...b,a]),al(!1)},className:"btn text-[12px] px-2 py-1",children:"Load context"}),(0,d.jsx)("button",{onClick:()=>al(!1),className:"btn text-[12px] px-2 py-1 bg-transparent",children:"Dismiss"})]})]})})()}),(0,d.jsx)(ad,{ravenMessages:av,scrollToTop:()=>{A.current?.scrollTo({top:0,behavior:"smooth"})},scrollToRavenMessage:a=>{let b=av[a];if(!b)return;let c=document.getElementById(`message-${b.id}`);if(c){let b=A.current;if(b){let a=c.offsetTop-120;b.scrollTo({top:a<0?0:a,behavior:"smooth"})}else c.scrollIntoView({behavior:"smooth",block:"start"});ar(a)}},currentRavenIndex:aq,scrollToBottom:aw}),(0,d.jsxs)("main",{className:"relative grid flex-1 grid-cols-[270px_1fr] gap-3 overflow-hidden p-3 min-h-0",children:[(0,d.jsx)(W,{onInsert:a=>{let b=a.html||a.content||"";b&&ay(b)},hasMirrorData:s}),(0,d.jsx)(aa,{messages:f,typing:j,endRef:m,containerRef:A,onToggleCollapse:function(a){g(b=>b.map(b=>b.id===a?{...b,collapsed:!b.collapsed}:b))},onRemove:function(a){g(b=>b.filter(b=>b.id!==a))},onPingFeedback:(a,b,c)=>{var d;let e=f.find(b=>b.id===a),h=e?S(d=e.html)?"repair":/hook stack|paradox.*tags|rock.*spark/i.test(d)?"hook":/hidden push|counterweight|vector signature/i.test(d)?"vector":/mars.*saturn|personal.*outer|hard aspect/i.test(d)?"aspect":"general":"general",i=e?e.html:"";C.recordFeedback(a,b,c,h,i),g(b=>b.map(b=>b.id===a?{...b,pingFeedbackRecorded:!0}:b)),setTimeout(()=>{let a="";"yes"===b?a="yes, that resonates with me":"no"===b?a="that doesn't feel familiar to me":"maybe"===b?a="that partially resonates, but not completely":"unclear"===b&&(a="that feels confusing or unclear to me"),c&&(a+=`. ${c}`),ay(a)},500)}}),y&&(0,d.jsx)("button",{onClick:aw,className:"absolute bottom-5 right-5 z-[1000] flex h-12 w-12 items-center justify-center rounded-full bg-[var(--accent)] text-white shadow-[0_4px_12px_rgba(124,92,255,0.3)]",title:"Return to current response",children:"↓"})]}),(0,d.jsx)("div",{className:"flex items-center justify-end border-t border-[var(--line)] bg-[var(--bg)] px-[18px] py-2",children:(0,d.jsx)("button",{className:"btn cursor-pointer rounded-[10px] border border-[var(--line)] bg-transparent px-2 py-1 text-[11px] text-[var(--muted)] opacity-60 transition-opacity hover:opacity-100",onClick:()=>_(!0),title:"End current reading and show comprehensive summary",children:"\uD83D\uDD2E End Reading"})}),(0,d.jsx)(ac,{input:h,setInput:i,onSend:az,onStop:function(){l.current?.abort()},disabled:j}),U&&(0,d.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:20},children:(0,d.jsx)(I,{onClose:()=>X(!1),onSealed:(a,b)=>{let c=crypto.randomUUID();g(a=>[...a,{id:c,role:"raven",html:`Thanks for scoring. I’ve sealed that reading. If you want to look at something new, we’ll start fresh from here.`,climate:"",hook:""}]);let d=[...f].filter(a=>"user"===a.role).slice(-6).map(a=>a.html.replace(/<[^>]*>/g,"").toLowerCase()).join(" ").replace(/[^a-z0-9\s\-]/g," ").split(/\s+/).filter(a=>a.length>2),e={};for(let a of d)e[a]=(e[a]||0)+1;ah(Object.entries(e).sort((a,b)=>b[1]-a[1]).slice(0,12).map(([a])=>a)),af(!0)}})}),Y&&(0,d.jsx)(ae,{onClose:()=>Z(!1)}),$&&(0,d.jsx)(J,{data:(()=>{let a=f.filter(a=>"user"===a.role),b=a[0]?.html||"",c=b.match(/my name is (\w+)/i)||b.match(/i'm (\w+)/i)||b.match(/i am (\w+)/i);c&&c[1];let d=ao.wbHits.length,e=ao.abeHits.length,g=ao.osrMisses.length,h=d+e+g,i=h>0?Math.round((d+.5*e)/h*100):0,j="LOW",k="Extensive New Territory";return i>=70?(j="HIGH",k="Strong Harmonic Alignment"):i>=40&&(j="MIXED",k="Mixed Alignment"),{bigVectors:[{tension:"restless-contained",polarity:"Visionary Driver / Cutting Truth Style",charge:4,source:"personal-outer"}],resonanceSnapshot:{affirmedParadoxes:ao.wbHits.slice(0,3).map(a=>a.content||"Pattern recognized"),poemLines:["The compass spins, a restless heart","A whispered promise, barely heard"],symbolicImages:["spinning compass","restless energy","whispered truth"],keyMoments:ao.wbHits.slice(0,2).map(a=>a.content||"Key moment")},actorRoleComposite:{actor:"Visionary Driver",role:"Cutting Truth Style",composite:"Visionary Driver / Cutting Truth Style",confidence:"emerging"},resonanceFidelity:{percentage:i,band:j,label:k,wb:d,abe:e,osr:g},explanation:"You recognized the restless pull more than the steadying hand. That leans the weight toward your inner Driver. Raven reads this as a sidereal lean.",balanceMeterClimate:{magnitude:3,valence:"drag",volatility:"mixed",sfdVerdict:"Stirring with Drag",housePlacement:"House of Maintenance (work/health rhythm)",narrative:"The week trends at ⚡⚡⚡ 3 Stirring with \uD83C\uDF11 Drag—steady pull with a headwind in routines."},poemLine:"The compass spins, a restless heart. A whispered promise, barely heard.",sessionId:n()}})(),onClose:()=>_(!1),onGenerateJournal:au,onStartNewReading:()=>{_(!1),ap({sessionStart:Date.now(),actorProfile:null,wbHits:[],abeHits:[],osrMisses:[],actorWeighting:0,roleWeighting:0,driftIndex:0,currentComposite:void 0,sessionActive:!0})}})]})}function V({onFileSelect:a,hasMirrorData:b,onPoeticInsert:c,onPoeticCard:f,onDemoCard:g,onAbout:h,onToggleSidebar:i,sidebarOpen:j,reportContexts:k,onRemoveReportContext:l,onShowWrapUp:m,onShowPendingReview:n,onShowHelp:o}){let[p,q]=(0,e.useState)(0),[r,t]=(0,e.useState)(!1);return(0,d.jsxs)("header",{className:"sticky top-0 z-10 flex items-center justify-between px-[18px] py-3 bg-[rgba(20,24,33,.9)] backdrop-blur border-b border-[var(--line)]",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("div",{className:"grid h-9 w-9 place-items-center rounded-full [background-image:radial-gradient(120%_120%_at_50%_20%,#262a36,#12151c)] shadow-[inset_0_0_18px_rgba(124,92,255,.25)] text-[20px]","aria-hidden":!0,children:"\uD83D\uDC26‍⬛"}),(0,d.jsxs)("div",{className:"flex flex-col",children:[(0,d.jsx)("span",{className:"font-bold",children:"Raven Calder"}),(0,d.jsxs)("div",{className:"flex items-center gap-2 text-[12px] text-[var(--muted)]",children:[(0,d.jsx)("span",{className:"w-2 h-2 rounded-full bg-[var(--good)] shadow-[0_0_10px_var(--good)]"}),(0,d.jsx)("span",{children:"Connected"}),k.length>0&&(0,d.jsxs)("div",{className:"ml-2 flex items-center gap-1",children:[(0,d.jsx)("span",{className:"text-[10px] text-[var(--accent)]",children:"•"}),k.map((a,b)=>(0,d.jsxs)("div",{className:"flex items-center gap-[2px]",children:[(0,d.jsxs)("span",{className:"text-[10px]",title:a.summary,children:[(a=>{switch(a){case"mirror":return"\uD83E\uDE9E";case"balance":return"\uD83C\uDF21️";case"journal":return"\uD83D\uDCD4";default:return"\uD83D\uDCC4"}})(a.type)," ",a.name]}),(0,d.jsx)("button",{onClick:()=>l(a.id),className:"cursor-pointer border-0 bg-transparent p-0 text-[8px] text-[var(--muted)]",title:"Remove context",children:"✕"}),b<k.length-1&&(0,d.jsx)("span",{className:"text-[8px] text-[var(--muted)]",children:"|"})]},a.id))]})]})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,d.jsx)(D,{className:"hidden sm:block"}),(0,d.jsx)(s,{compact:!0,className:"hidden sm:block"}),p>0&&(0,d.jsxs)("button",{className:"btn rounded-[10px] border border-[var(--line)] bg-[rgba(255,255,255,0.04)] px-2 py-1 text-[12px]",onClick:n,title:`${p} pending mirrors`,children:["● ",p," pending"]})]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("button",{className:"btn rounded-[10px] border border-[var(--line)] bg-[var(--soft)] px-[10px] py-2 text-[13px] text-[var(--text)]",onClick:()=>a("mirror"),children:"\uD83E\uDE9E Mirror"}),(0,d.jsx)("button",{className:"btn rounded-[10px] border border-[var(--line)] bg-[var(--soft)] px-[10px] py-2 text-[13px] text-[var(--text)]",onClick:()=>a("balance"),children:"\uD83C\uDF21️ Balance"}),(0,d.jsx)("button",{className:"btn rounded-[10px] border border-[var(--line)] bg-[var(--soft)] px-[10px] py-2 text-[13px] text-[var(--text)]",onClick:()=>a("journal"),children:"\uD83D\uDCD4 Journal"}),(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("button",{className:"btn rounded-[10px] bg-gradient-to-br from-[#6a53ff] to-[#9c27b0] px-[10px] py-2 text-[13px] text-white",onClick:a=>{a.stopPropagation(),t(!r)},title:"Poetic analysis and reading tools",children:"\uD83C\uDFAD Poetic ▼"}),r&&(0,d.jsxs)("div",{className:"absolute right-0 top-full mt-1 min-w-[180px] rounded-[8px] border border-[var(--line)] bg-[var(--bg)] p-2 shadow-[0_4px_12px_rgba(0,0,0,0.15)] z-[1000]",onClick:a=>a.stopPropagation(),children:[(0,d.jsx)("button",{className:"btn mb-1 w-full justify-start rounded-[10px] border border-[var(--line)] bg-[var(--soft)] px-[10px] py-2 text-[13px] text-[var(--text)]",onClick:()=>{m(),t(!1)},title:"Generate Actor/Role composite from session feedback",children:"\uD83C\uDFAD Actor/Role Reveal"}),b&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{className:"btn mb-1 w-full justify-start rounded-[10px] border border-[var(--line)] bg-[var(--soft)] px-[10px] py-2 text-[13px] text-[var(--text)]",onClick:()=>{c(),t(!1)},children:"\uD83D\uDCDD Poetic Insert"}),(0,d.jsx)("button",{className:"btn mb-1 w-full justify-start rounded-[10px] border border-[var(--line)] bg-[var(--soft)] px-[10px] py-2 text-[13px] text-[var(--text)]",onClick:()=>{f(),t(!1)},children:"\uD83C\uDFB4 Create Card"})]}),(0,d.jsx)("button",{className:"btn mb-1 w-full justify-start rounded-[10px] border border-[var(--line)] bg-[var(--soft)] px-[10px] py-2 text-[13px] text-[var(--text)]",onClick:()=>{g(),t(!1)},title:"Generate demo poetic card",children:"\uD83C\uDFB4 Demo Card"})]})]}),(0,d.jsx)("button",{className:"btn rounded-[10px] border border-[var(--line)] bg-transparent px-[10px] py-2 text-[13px] text-[var(--text)]",onClick:h,children:"ℹ️ About"}),(0,d.jsx)("button",{className:"btn rounded-[10px] border border-[var(--line)] bg-transparent px-[10px] py-2 text-[13px] text-[var(--text)]",onClick:o,title:"Help & Button Guide",children:"❓ Help"})]})]})}function W({onInsert:a,hasMirrorData:b}){let[c,f]=(0,e.useState)("glossary");return(0,d.jsxs)("aside",{style:{background:"var(--panel)",border:"1px solid var(--line)",borderRadius:"var(--radius)",padding:14,height:"100%",overflow:"auto"},children:[(0,d.jsxs)("div",{style:{display:"flex",gap:4,marginBottom:16},children:[(0,d.jsx)("button",{onClick:()=>f("glossary"),style:{...Y,..."glossary"===c?Z:{}},children:"\uD83D\uDCD6 Glossary"}),(0,d.jsx)("button",{onClick:()=>f("hooks"),style:{...Y,..."hooks"===c?Z:{}},children:"\uD83C\uDFA3 Hooks"}),(0,d.jsx)("button",{onClick:()=>f("poetic"),style:{...Y,..."poetic"===c?Z:{}},children:"\uD83C\uDFAD Poetic"})]}),!b&&(0,d.jsx)("div",{style:{background:"rgba(103, 103, 193, 0.1)",border:"1px solid rgba(103, 103, 193, 0.3)",borderRadius:"6px",padding:"12px",marginBottom:"16px",textAlign:"center"},children:(0,d.jsx)("div",{style:{color:"var(--text)",fontSize:"13px",lineHeight:"1.4"},children:"Upload Math Brain Mirror or Balance Report for a Raven Calder Read"})}),"glossary"===c&&(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{style:X,children:"Balance Meter Framework"}),(0,d.jsx)($,{symbol:"⚡",title:"Magnitude",description:"Symbolic intensity scale",details:["0 = Latent","1 = Murmur","2 = Pulse","3 = Stirring","4 = Convergence","5 = Threshold"]}),(0,d.jsx)($,{symbol:"\uD83C\uDF1E",title:"Valence",description:"Energy direction & quality",details:["\uD83C\uDF1E supportive = helping/scaffolding","\uD83C\uDF17 mixed = complex blend","\uD83C\uDF11 restrictive = constraining"]}),(0,d.jsx)($,{symbol:"\uD83C\uDF2A",title:"Volatility",description:"Pressure distribution pattern",details:["Low = steady, concentrated","Medium = variable flow","High = scattered turbulence","Storm-class = maximum dispersal"]}),(0,d.jsx)($,{symbol:"\uD83C\uDF21️",title:"Four-Channel Architecture",description:"Complete energetic snapshot",details:["Combines Magnitude + Valence + Volatility","Creates real-time symbolic weather","Tracks field conditions over time","Provides actionable guidance"]}),(0,d.jsx)("div",{style:X,children:"Valence Indicators"}),(0,d.jsx)("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:8},children:"Positive Valence Modes"}),(0,d.jsx)($,{symbol:"\uD83C\uDF31",title:"Fertile Field",description:"Growth-supportive conditions"}),(0,d.jsx)($,{symbol:"✨",title:"Harmonic Resonance",description:"Natural alignment and flow"}),(0,d.jsx)($,{symbol:"\uD83D\uDC8E",title:"Expansion Lift",description:"Elevating, broadening energy"}),(0,d.jsx)($,{symbol:"\uD83D\uDD25",title:"Combustion Clarity",description:"Clear, focused intensity"}),(0,d.jsx)($,{symbol:"\uD83E\uDD8B",title:"Liberation/Release",description:"Freedom from constraints"}),(0,d.jsx)($,{symbol:"⚖️",title:"Integration",description:"Balanced synthesis"}),(0,d.jsx)($,{symbol:"\uD83C\uDF0A",title:"Flow Tide",description:"Natural momentum"}),(0,d.jsx)($,{symbol:"\uD83C\uDF08",title:"Visionary Spark",description:"Inspirational breakthrough"}),(0,d.jsx)("div",{style:{fontSize:11,color:"var(--muted)",marginBottom:8,marginTop:12},children:"Negative Valence Modes"}),(0,d.jsx)($,{symbol:"♾️",title:"Recursion Pull",description:"Repetitive patterns drawing back"}),(0,d.jsx)($,{symbol:"⚔️",title:"Friction Clash",description:"Opposing forces in conflict"}),(0,d.jsx)($,{symbol:"↔️",title:"Cross Current",description:"Contradictory energies"}),(0,d.jsx)($,{symbol:"\uD83C\uDF2B️",title:"Fog/Dissolution",description:"Unclear, dissolving boundaries"}),(0,d.jsx)($,{symbol:"\uD83C\uDF0B",title:"Pressure/Eruption",description:"Building tension seeking release"}),(0,d.jsx)($,{symbol:"⏳",title:"Saturn Weight",description:"Heavy, restrictive pressure"}),(0,d.jsx)($,{symbol:"\uD83E\uDDE9",title:"Fragmentation",description:"Scattered, disconnected pieces"}),(0,d.jsx)($,{symbol:"\uD83D\uDD73️",title:"Entropy Drift",description:"Dissolving structure"}),(0,d.jsx)("div",{style:X,children:"Sources of Force"}),(0,d.jsx)($,{symbol:"\uD83C\uDFAF",title:"Orb",description:"Proximity factor in aspects"}),(0,d.jsx)($,{symbol:"\uD83C\uDF00",title:"Aspect",description:"Angular relationship type"}),(0,d.jsx)($,{symbol:"\uD83E\uDE90",title:"Potency",description:"Planet speed and strength"}),(0,d.jsx)($,{symbol:"\uD83D\uDCE1",title:"Resonance",description:"Natal chart activation"}),(0,d.jsx)("div",{style:X,children:"Planetary Forces"}),(0,d.jsx)($,{symbol:"☽",title:"Moon",description:"Emotional tides, instinctive patterns"}),(0,d.jsx)($,{symbol:"☿",title:"Mercury",description:"Communication, thought processing"}),(0,d.jsx)($,{symbol:"♀",title:"Venus",description:"Values, relationships, beauty"}),(0,d.jsx)($,{symbol:"♂",title:"Mars",description:"Action, drive, assertion"}),(0,d.jsx)($,{symbol:"♃",title:"Jupiter",description:"Expansion, wisdom, growth"}),(0,d.jsx)($,{symbol:"♄",title:"Saturn",description:"Structure, discipline, limits"}),(0,d.jsx)($,{symbol:"♅",title:"Uranus",description:"Innovation, rebellion, awakening"}),(0,d.jsx)($,{symbol:"♆",title:"Neptune",description:"Dreams, spirituality, illusion"}),(0,d.jsx)($,{symbol:"♇",title:"Pluto",description:"Transformation, depth, power"}),(0,d.jsx)("div",{style:X,children:"Core Dynamics"}),(0,d.jsx)($,{symbol:"↔",title:"Polarity",description:"Dynamic tension between forces"}),(0,d.jsx)($,{symbol:"\uD83E\uDE9E",title:"Mirror",description:"Reflection of inner patterns"}),(0,d.jsx)($,{symbol:"\uD83C\uDF21️",title:"Balance",description:"Current energetic state"}),(0,d.jsx)($,{symbol:"\uD83D\uDCD4",title:"Journal",description:"Personal narrative tracking"}),(0,d.jsx)($,{symbol:"⚡",title:"Symbolic Quake",description:"Energetic disturbance measurement",details:["Seismograph-style intensity scale","Tracks symbolic rather than literal events","Measures psychological/spiritual impact"]}),(0,d.jsx)($,{symbol:"\uD83C\uDFAD",title:"Poetic Insert",description:"Artistic interpretation of patterns",details:["Transforms analysis into poetry","Captures essence beyond literal meaning","Bridges symbolic and creative expression"]})]}),"hooks"===c&&(0,d.jsx)("div",{children:b?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{style:X,children:"Quick Insights"}),(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,d.jsx)(_,{label:"\uD83D\uDD2E Generate Polarity Reading",onClick:()=>a({id:n(),role:"user",html:"generate polarity reading"})}),(0,d.jsx)(_,{label:"⚖️ Balance Check",onClick:()=>a({id:n(),role:"user",html:"balance check"})}),(0,d.jsx)(_,{label:"\uD83C\uDF0A Flow State Reading",onClick:()=>a({id:n(),role:"user",html:"flow state reading"})})]})]}):(0,d.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"var(--muted)"},children:(0,d.jsx)("div",{style:{fontSize:"13px",lineHeight:"1.4"},children:"Quick Insights become available after uploading Math Brain data"})})}),"poetic"===c&&(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{style:X,children:"Creative Commands"}),(0,d.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,d.jsx)(_,{label:"✍️ Write my poem",onClick:()=>a({id:n(),role:"user",html:"write my poem"})}),(0,d.jsx)(_,{label:"\uD83C\uDFAD Poetic interpretation",onClick:()=>a({id:n(),role:"user",html:"poetic interpretation"})}),(0,d.jsx)(_,{label:"\uD83C\uDF1F Symbolic weather report",onClick:()=>a({id:n(),role:"user",html:"symbolic weather report"})}),(0,d.jsx)(_,{label:"\uD83D\uDCFF Daily mantra",onClick:()=>a({id:n(),role:"user",html:"daily mantra"})})]})]})]})}let X={fontSize:12,textTransform:"uppercase",letterSpacing:".14em",color:"var(--muted)",margin:"8px 0 10px"},Y={background:"none",borderWidth:"1px",borderStyle:"solid",borderColor:"var(--line)",borderRadius:"6px",color:"var(--muted)",padding:"4px 8px",fontSize:11,cursor:"pointer",transition:"all 0.2s ease"},Z={background:"var(--soft)",color:"var(--text)",borderColor:"var(--accent)"};function $({symbol:a,title:b,description:c,details:f}){let[g,h]=(0,e.useState)(!1);return(0,d.jsxs)("div",{className:"glossary-item",style:{marginBottom:12,padding:8,border:"1px solid var(--line)",borderRadius:6,background:"var(--soft)"},title:`${b}: ${c}`,children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,cursor:f?"pointer":"default"},onClick:()=>f&&h(!g),children:[(0,d.jsx)("span",{style:{fontSize:16},title:`${a} ${b} - ${c}`,children:a}),(0,d.jsxs)("div",{style:{flex:1},children:[(0,d.jsx)("div",{style:{fontSize:12,fontWeight:"bold",color:"var(--text)"},children:b}),(0,d.jsx)("div",{style:{fontSize:11,color:"var(--muted)"},children:c})]}),f&&(0,d.jsx)("span",{style:{fontSize:10,color:"var(--muted)"},children:g?"▼":"▶"})]}),f&&g&&(0,d.jsx)("div",{style:{marginTop:8,paddingTop:8,borderTop:"1px solid var(--line)"},children:f.map((a,b)=>(0,d.jsxs)("div",{style:{fontSize:10,color:"var(--muted)",marginBottom:2},children:["• ",a]},b))})]})}function _({label:a,onClick:b}){return(0,d.jsx)("button",{onClick:b,style:{display:"flex",alignItems:"center",justifyContent:"flex-start",gap:8,fontSize:12,padding:"8px 12px",borderRadius:8,borderWidth:"1px",borderStyle:"solid",borderColor:"var(--line)",background:"var(--soft)",color:"var(--text)",cursor:"pointer",textAlign:"left",width:"100%",transition:"all 0.2s ease"},onMouseEnter:a=>{a.currentTarget.style.background="var(--panel)",a.currentTarget.style.borderColor="var(--accent)",a.currentTarget.style.color="var(--text)"},onMouseLeave:a=>{a.currentTarget.style.background="var(--soft)",a.currentTarget.style.borderColor="var(--line)",a.currentTarget.style.color="var(--text)"},children:a})}function aa({messages:a,typing:b,endRef:c,containerRef:e,onToggleCollapse:f,onRemove:g,onPingFeedback:h}){return(0,d.jsxs)("section",{ref:e,"aria-label":"Conversation",role:"log",style:{background:"var(--panel)",border:"1px solid var(--line)",borderRadius:"var(--radius)",padding:12,display:"flex",flexDirection:"column",gap:12,overflow:"auto",height:"100%"},children:[a.map(a=>(0,d.jsx)(ab,{msg:a,onToggleCollapse:f,onRemove:g,onPingFeedback:h},a.id)),b&&(0,d.jsxs)("div",{style:{opacity:.6,fontSize:12},children:[(0,d.jsxs)("span",{className:"dots",children:[(0,d.jsx)("span",{})," ",(0,d.jsx)("span",{})," ",(0,d.jsx)("span",{})]})," typing…"]}),(0,d.jsx)("div",{ref:c})]})}function ab({msg:a,onToggleCollapse:b,onRemove:c,onPingFeedback:f}){let[g,h]=(0,e.useState)(!1),[i,j]=(0,e.useState)(!1),k="user"===a.role?{alignSelf:"flex-end",background:"linear-gradient(180deg,#1f2432,#171b25)"}:{alignSelf:"flex-start",background:"linear-gradient(180deg,#171b25,#131824)",borderLeft:"2px solid #2b3244"},l=async a=>{try{let b=a.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim();await navigator.clipboard.writeText(b),h(!0),setTimeout(()=>h(!1),2e3)}catch(a){console.error("Failed to copy text:",a)}};if(a.isReport)return(0,d.jsxs)("article",{id:`message-${a.id}`,style:{maxWidth:"82%",padding:"12px 14px",borderRadius:16,position:"relative",boxShadow:"0 6px 16px rgba(0,0,0,.25)",border:"1px solid #1f2533",scrollMarginTop:120,...k},children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8*!a.collapsed},children:[(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,d.jsxs)("span",{style:{fontSize:12,color:"#8b94a6",textTransform:"uppercase",letterSpacing:"0.5px"},children:[a.reportType," REPORT"]}),(0,d.jsx)("span",{style:{fontSize:14,color:"#cbd4e4",fontWeight:500},children:a.reportName})]}),(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,d.jsx)("button",{onClick:()=>b(a.id),style:{background:"none",border:"1px solid #2a3143",borderRadius:4,color:"#8b94a6",padding:"4px 8px",fontSize:11,cursor:"pointer"},children:a.collapsed?"Expand":"Collapse"}),(0,d.jsx)("button",{onClick:()=>c(a.id),style:{background:"none",border:"1px solid #4a3143",borderRadius:4,color:"#c47a7a",padding:"4px 8px",fontSize:11,cursor:"pointer"},children:"Remove"})]})]}),a.reportSummary&&!a.collapsed&&(0,d.jsx)("div",{style:{fontSize:11,color:"#8b94a6",marginBottom:8,fontStyle:"italic"},children:a.reportSummary}),!a.collapsed&&(0,d.jsx)("div",{className:"raven"===a.role?"raven-response":"",dangerouslySetInnerHTML:{__html:a.html}})]});let m="";if("raven"===a.role)if(a.draft&&"string"==typeof a.draft.raw&&a.draft.raw.trim()){let b=Q(String(a.draft.raw||""));m=`<div class="raven-raw">${M(b).replace(/\n/g,"<br/>")}</div>`}else m=a.html||"";else m="user"!==a.role||a.isReport?a.html:M(a.html);return(0,d.jsxs)("article",{id:`message-${a.id}`,className:`max-w-[82%] px-4 py-3 rounded-[16px] relative shadow-[0_6px_16px_rgba(0,0,0,0.25)] border border-[#1f2533] scroll-mt-[120px] ${"user"===a.role?"self-end bg-gradient-to-b from-[#1f2432] to-[#171b25]":"self-start bg-gradient-to-b from-[#171b25] to-[#131824] border-l-2 border-l-[#2b3244]"}`,children:["raven"===a.role&&(a.climate||a.hook)&&(0,d.jsxs)("div",{className:"mb-2 pb-1 border-b border-[#2a3143]",children:[a.climate&&(0,d.jsx)("div",{className:"text-[10px] text-[#8b94a6]",children:a.climate}),a.hook&&(0,d.jsx)("div",{className:"text-[10px] text-[#8b94a6]",children:a.hook})]}),(0,d.jsx)("div",{className:"raven"===a.role?"raven-response":"",dangerouslySetInnerHTML:{__html:m}}),a.draft&&(0,d.jsxs)("div",{className:"mt-2",children:[(0,d.jsx)("button",{onClick:()=>j(a=>!a),className:"bg-none border border-[#2a3143] rounded-[6px] text-[#8b94a6] px-2 py-1 text-[12px] mb-2",children:i?"Hide Mirror":"Show Mirror"}),i&&(0,d.jsx)("div",{dangerouslySetInnerHTML:{__html:O(a.draft,a.prov)}})]}),"raven"===a.role&&R(a.html)&&!C.getFeedback(a.id)&&(0,d.jsxs)("div",{className:"mt-1 text-[10px] text-[#94a3b8]",children:[(0,d.jsx)("span",{className:"inline-block w-[6px] h-[6px] rounded-[3px] bg-[#94a3b8] mr-2"}),"Pending"]}),"raven"===a.role&&S(a.html)&&(0,d.jsx)(A,{messageId:a.id,onFeedback:f,disabled:a.pingFeedbackRecorded,checkpointType:"repair"}),"raven"===a.role&&R(a.html)&&!S(a.html)&&(0,d.jsxs)("div",{className:"mt-2 px-3 py-2 bg-[rgba(59,130,246,0.1)] border border-[rgba(59,130,246,0.2)] rounded-[6px] text-[12px] text-[#93c5fd]",children:["\uD83D\uDCAD ",(0,d.jsx)("em",{children:"Raven will classify your response and provide repair if needed - no grading required"})]}),"raven"===a.role&&(0,d.jsx)("div",{className:"flex gap-1 mt-2 justify-end",children:(0,d.jsx)("button",{onClick:()=>l(a.html),className:`${g?"bg-[var(--good)] text-white":"bg-[var(--soft)] text-[var(--muted)]"} px-2 py-1 border border-[var(--line)] rounded-[6px] text-[10px]`,children:g?"Copied!":"Copy"})}),a.climate&&(0,d.jsx)("div",{className:"text-[10px] text-[#8b94a6] mt-2 border-t border-[#2a3143] pt-1",children:a.climate}),a.hook&&(0,d.jsx)("div",{className:"text-[10px] text-[#8b94a6]",children:a.hook})]})}function ac({input:a,setInput:b,onSend:c,onStop:e,disabled:f}){return(0,d.jsxs)("div",{className:"px-[18px] py-3 bg-[rgba(20,24,33,.9)] backdrop-blur border-t border-[var(--line)] flex gap-[10px] items-end",children:[(0,d.jsx)("button",{className:"inline-flex items-center justify-center w-10 h-10 bg-[var(--soft)] text-[var(--text)] border border-[var(--line)] rounded-[10px] text-[13px] cursor-pointer",title:"Attach",children:"\uD83D\uDCCE"}),(0,d.jsx)("textarea",{value:a,onChange:a=>b(a.target.value),onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),c())},placeholder:"Ask or paste here",className:"flex-1 min-h-[48px] max-h-40 resize-y rounded-[14px] border border-[var(--line)] bg-[var(--panel)] text-[var(--text)] px-[14px] py-3 text-[14px]"}),(0,d.jsx)("div",{className:"font-mono text-[11px] text-[var(--muted)]","aria-hidden":!0,children:"Enter ↵"}),f&&(0,d.jsx)("button",{onClick:e,className:"px-[10px] py-2 bg-[#442b2b] text-[var(--text)] border border-[#663] rounded-[10px] text-[13px] cursor-pointer shadow-[var(--shadow)]",children:"Stop"}),(0,d.jsx)("button",{disabled:f,onClick:c,className:"px-[10px] py-2 bg-[linear-gradient(180deg,#8d78ff,#6a53ff)] text-[var(--text)] border-0 rounded-[10px] text-[13px] cursor-pointer shadow-[var(--shadow)] disabled:opacity-50",children:"Send"})]})}function ad({ravenMessages:a,scrollToTop:b,scrollToRavenMessage:c,currentRavenIndex:e,scrollToBottom:f}){return 0===a.length?null:(0,d.jsxs)("div",{className:"flex items-center justify-center gap-2 px-[18px] py-2 bg-[var(--panel)] border-t border-b border-[var(--line)] text-[12px]",children:[(0,d.jsx)("button",{onClick:b,className:"bg-transparent border border-[var(--line)] rounded-[6px] text-[var(--text)] px-[10px] py-[6px] text-[11px] cursor-pointer transition-all",title:"Jump to top",children:"⬆️ Top"}),(0,d.jsx)("button",{onClick:()=>c(Math.max(0,e-1)),disabled:e<=0||a.length<=1,className:"bg-transparent border border-[var(--line)] rounded-[6px] text-[var(--text)] px-[10px] py-[6px] text-[11px] cursor-pointer transition-all disabled:opacity-50",title:"Previous Raven response",children:"← Prev"}),(0,d.jsxs)("span",{className:"text-[var(--muted)]",children:[e+1," / ",a.length]}),(0,d.jsx)("button",{onClick:()=>c(Math.min(a.length-1,e+1)),disabled:e>=a.length-1||a.length<=1,className:"bg-transparent border border-[var(--line)] rounded-[6px] text-[var(--text)] px-[10px] py-[6px] text-[11px] cursor-pointer transition-all disabled:opacity-50",title:"Next Raven response",children:"Next →"}),(0,d.jsx)("button",{onClick:f,className:"bg-transparent border border-[var(--line)] rounded-[6px] text-[var(--text)] px-[10px] py-[6px] text-[11px] cursor-pointer transition-all",title:"Jump to bottom",children:"⬇️ Bottom"})]})}function ae({onClose:a}){let[b,c]=(0,e.useState)(()=>C.getPendingItems(!0).slice(0,3)),[f,g]=(0,e.useState)({}),[h,i]=(0,e.useState)({});return(0,d.jsx)("div",{className:"fixed inset-0 bg-[rgba(0,0,0,0.7)] flex items-center justify-center z-[1000]",children:(0,d.jsxs)("div",{className:"w-[520px] bg-[linear-gradient(135deg,#1e293b,#0f172a)] border border-[rgba(148,163,184,0.2)] rounded-[12px] p-4",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,d.jsx)("div",{className:"text-[#e2e8f0] font-semibold",children:"Review pending mirrors?"}),(0,d.jsx)("button",{onClick:a,className:"bg-transparent border-0 text-[#94a3b8] text-[18px]",children:"\xd7"})]}),(0,d.jsx)("div",{className:"text-[#94a3b8] text-[12px] mb-3",children:"Up to three, highest-charge first. One tap each. Optional note."}),0===b.length&&(0,d.jsx)("div",{className:"text-[#94a3b8] text-[12px]",children:"No pending mirrors."}),b.map(a=>(0,d.jsxs)("div",{className:"mb-3 p-3 border border-[rgba(148,163,184,0.2)] rounded-[8px]",children:[(0,d.jsx)("div",{className:"text-[12px] text-[#e2e8f0] mb-2",dangerouslySetInnerHTML:{__html:a.messageContent||""}}),(0,d.jsx)("div",{className:"flex gap-2 flex-wrap mb-2",children:["yes","maybe","no","unclear"].map(b=>{let c=f[a.messageId]===b;return(0,d.jsx)("button",{onClick:()=>g(c=>({...c,[a.messageId]:b})),className:`px-2 py-1 text-[12px] rounded-[10px] border border-[var(--line)] ${c?"bg-[rgba(59,130,246,0.2)]":"bg-[var(--soft)]"}`,children:"yes"===b?"✅ Yes":"maybe"===b?"\uD83D\uDFE1 Sort of":"no"===b?"❌ No":"❓ Not clear"},b)})}),("no"===f[a.messageId]||"unclear"===f[a.messageId])&&(0,d.jsx)("textarea",{value:h[a.messageId]||"",onChange:b=>i(c=>({...c,[a.messageId]:b.target.value})),placeholder:"Optional note (what didn’t fit?)",className:"w-full bg-[rgba(0,0,0,0.3)] text-[#e2e8f0] border border-[rgba(148,163,184,0.2)] rounded-[6px] p-2 text-[12px]"})]},a.messageId)),(0,d.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,d.jsx)("button",{onClick:a,className:"px-[10px] py-2 bg-[var(--soft)] text-[var(--text)] border border-[var(--line)] rounded-[10px] text-[13px] cursor-pointer",children:"Snooze"}),(0,d.jsx)("button",{onClick:()=>{b.forEach(a=>{let b=f[a.messageId];b&&C.recordFeedback(a.messageId,b,h[a.messageId],a.checkpointType,a.messageContent)}),a()},className:"px-[10px] py-2 bg-[linear-gradient(180deg,#8d78ff,#6a53ff)] text-[var(--text)] border-0 rounded-[10px] text-[13px] cursor-pointer",children:"Review"})]})]})})}function af({children:a}){let[b,c]=(0,e.useState)(!1),[f,g]=(0,e.useState)(!1),[h,i]=(0,e.useState)(null);return b?!f||h?null:(0,d.jsx)(d.Fragment,{children:a}):(0,d.jsx)("div",{className:"grid place-items-center h-screen text-slate-400",children:"Connecting…"})}c(50849);let ag="force-dynamic";function ah(){let a=c(1212).A;return(0,d.jsx)(a,{children:(0,d.jsx)(af,{children:(0,d.jsx)(U,{})})})}},95627:(a,b,c)=>{"use strict";a.exports=c(83796).style},96487:()=>{},96600:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>g,metadata:()=>f});var d=c(75338);c(74515),c(82704);let e="Raven Calder",f={title:`${e} \xb7 Chat`,description:`${e} diagnostic chat`};function g({children:a}){return(0,d.jsxs)("html",{lang:"en",suppressHydrationWarning:!0,children:[(0,d.jsx)("head",{children:(0,d.jsx)("link",{rel:"stylesheet",href:"/dist/output.css"})}),(0,d.jsx)("body",{suppressHydrationWarning:!0,className:"app antialiased",children:a})]})}}};var b=require("../../webpack-runtime.js");b.C(a);var c=b.X(0,[828,428,711],()=>b(b.s=29308));module.exports=c})();