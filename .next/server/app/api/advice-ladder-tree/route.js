"use strict";(()=>{var e={};e.id=993,e.ids=[993],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8387:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>p,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>d,staticGenerationAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{POST:()=>c});var i=r(9303),o=r(8716),s=r(670),a=r(6029);async function c(e){try{let{hookStack:t,sessionContext:r,userNeed:n}=await e.json();if(!t||!r)return Response.json({success:!1,error:"Missing required data for Advice Ladder Tree processing"},{status:400});let i=new a.AdviceLadderTree,o=await i.processHookStack(t,r,n);return Response.json(o)}catch(e){return console.error("Error in Advice Ladder Tree API:",e),Response.json({success:!1,error:"Internal server error processing therapeutic integration",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let u=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/advice-ladder-tree/route",pathname:"/api/advice-ladder-tree",filename:"route",bundlePath:"app/api/advice-ladder-tree/route"},resolvedPagePath:"/Users/dancross/Documents/GitHub/WovenWebApp/app/api/advice-ladder-tree/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:l,staticGenerationAsyncStorage:h,serverHooks:d}=u,g="/api/advice-ladder-tree/route";function p(){return(0,s.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:h})}},9303:(e,t,r)=>{e.exports=r(517)},6029:(e,t,r)=>{let n=r(3809);class i{constructor(){this.rungs={mirror:new o,container:new s,choicePair:new a,ifThenTrack:new c,crisisContainer:new u}}async processHookStack(e,t,r="general"){try{if(n.info("Processing Hook Stack through Advice Ladder Tree",{hookStackCount:e.titles?.length||0,userNeed:r,sessionId:t.sessionId}),this.isCrisisSignal(r,e,t))return await this.rungs.crisisContainer.engage(e,t);let i=await this.buildProgression(e,t,r);return{success:!0,ladderTree:i,entryPoint:this.determineEntryPoint(r,t),pacing:this.calculatePacing(t),metadata:{hookStackIntegrated:e.titles?.length||0,therapeuticMode:r,progressionDepth:i.length,sessionContext:t.sessionId}}}catch(r){return n.error("Error in Advice Ladder Tree processing",{error:r.message,hookStack:e,sessionContext:t}),{success:!1,error:"Unable to process therapeutic integration",fallback:await this.generateFallbackSupport(e)}}}async buildProgression(e,t,r){let n=[],i=await this.rungs.mirror.reflect(e,t);for(let o of(n.push({rung:"mirror",content:i,purpose:"Recognition & Validation"}),this.determineRungSequence(r,t,i))){let r=await this.rungs[o].process(e,t,n);n.push({rung:o,content:r,purpose:this.getRungPurpose(o)})}return n}isCrisisSignal(e,t,r){return["crisis","emergency","urgent","overwhelmed","can't cope"].some(t=>e.includes(t))||t.volatilityIndex>8||r.driftIndex>.7||r.sstLogs?.some(e=>"OSR"===e.category&&e.clarification?.includes("overwhelming"))}determineEntryPoint(e,t){return e.includes("decision")||e.includes("choice")?"choicePair":e.includes("boundary")||e.includes("safety")?"container":e.includes("action")||e.includes("plan")?"ifThenTrack":"mirror"}calculatePacing(e){let t=((e.sessionScores?.accuracy||.7)+(e.sessionScores?.edgeCapture||.5)+(e.sessionScores?.clarity||.8))/3;return t>.8?"normal":t>.6?"gentle":"extra-gentle"}determineRungSequence(e,t,r){let n=["container","choicePair","ifThenTrack"];return r.confidenceLevel<.6?n=["container"]:e.includes("action")||e.includes("decision")?n=["choicePair","ifThenTrack"]:t.driftIndex>.5&&(n=["container","choicePair"]),n}getRungPurpose(e){return({mirror:"Recognition & Validation",container:"Boundaries & Safety",choicePair:"Agency & Decision Support",ifThenTrack:"Implementation & Monitoring",crisisContainer:"Emergency Support & Stabilization"})[e]||"Integration Support"}async generateFallbackSupport(e){return{type:"fallback",message:"Your astrological climate shows active energy patterns.",suggestion:"Consider taking time to notice what resonates most strongly.",hookReference:e.titles?.[0]||"Current planetary configuration",resources:["Take three deep breaths","Notice what feels most present right now","Consider what support you might need"]}}}class o{async reflect(e,t){let r=e.titles?.[0],n=e.titles?.[1],i=[`The ${r?.title} pattern suggests you're navigating some complex energy right now.`,`Your chart shows ${r?.title} as a primary theme - this makes sense of what you might be experiencing.`,`The astrological climate reveals ${r?.title} energy, which often feels exactly like what you're describing.`];return{recognition:this.selectTemplate(i),validation:this.buildValidation(r,n),confidenceLevel:this.calculateMirrorConfidence(e,t),resonanceCheck:"Does this feel like it captures something true about your current experience?"}}buildValidation(e,t){if(!e)return"Your current astrological climate shows active patterns worth exploring.";let r=`The ${e.title} theme reflects real patterns in your current environment.`;return t&&(r+=` The interplay with ${t.title} adds another layer that might explain the complexity you're feeling.`),r}calculateMirrorConfidence(e,t){return((e.titles?.[0]?.intensity||.5)+(t.sessionScores?.accuracy||.7))/2}selectTemplate(e){return e[Math.floor(Math.random()*e.length)]}}class s{async process(e,t,r){r.find(e=>"mirror"===e.rung)?.content;let n=e.titles?.[0];return{boundaries:this.suggestBoundaries(n,t),safetyCheck:this.createSafetyCheck(e),resources:this.gatherResources(n),pacing:"You can move through this at whatever pace feels right for you."}}suggestBoundaries(e,t){if(!e)return"Consider what boundaries might support you right now.";let r={high_intensity:"With this much energy active, it might help to create some buffer space in your schedule.",interpersonal:"Notice if you need more space in relationships or more connection - both are valid.",internal:"Consider what internal boundaries might help you feel more centered.",default:"What boundaries would help you feel more supported right now?"};return r[this.classifyHookType(e)]||r.default}createSafetyCheck(e){let t=e.volatilityIndex||0;return t>7?"Given the high-energy patterns, check in: Do you feel grounded and safe right now?":t>4?"With moderate energy patterns active, notice what helps you feel most stable.":"Check in with yourself: What do you need to feel safe and supported?"}gatherResources(e){return["Take breaks when you need them","Notice what environments feel most supportive","Trust your instincts about what you need","Remember that boundaries are self-care, not selfishness"]}classifyHookType(e){if(!e||!e.title)return"default";let t=e.title.toLowerCase();return t.includes("relationship")||t.includes("other")||t.includes("partnership")?"interpersonal":e.intensity>.8?"high_intensity":t.includes("inner")||t.includes("self")||t.includes("identity")?"internal":"default"}}class a{async process(e,t,r){let n=e.titles?.[0];return{choicePair:this.generateChoicePair(n,t),agencyReminder:"You have agency in how you respond to these patterns.",decisionSupport:this.offerDecisionSupport(n),noWrongChoice:"There's no wrong choice here - trust what feels most aligned for you."}}generateChoicePair(e,t){return e?(e.intensity||.5)>.7?{optionA:"Channel this energy into creative or productive outlets",optionB:"Create space to process and integrate this energy slowly",context:`The ${e.title} pattern offers strong energy that can be worked with in different ways.`}:{optionA:"Explore what this pattern is inviting you to notice",optionB:"Take time to simply be present with what's emerging",context:`The ${e.title} theme suggests subtle shifts that can be approached gently.`}:{optionA:"Focus on grounding and stability",optionB:"Focus on gentle forward movement",context:"Both approaches can be valuable depending on what you need most."}}offerDecisionSupport(e){return["Notice which option feels more energizing or calming","Consider what you have capacity for right now","Trust your body's wisdom about what feels right","Remember you can adjust your approach as you go"]}}class c{async process(e,t,r){let n=r.find(e=>"choicePair"===e.rung)?.content,i=e.titles?.[0];return{implementation:this.createImplementationPlan(i,n),tracking:this.suggestTracking(i),adjustment:this.buildAdjustmentFramework(),gentleAccountability:"Check in with yourself in a few days to see how this feels."}}createImplementationPlan(e,t){return{ifCondition:this.buildIfCondition(e),thenAction:this.buildThenAction(e),elseOption:this.buildElseOption(e)}}buildIfCondition(e){return e?(e.intensity||.5)>.7?`If you feel the ${e.title} energy building`:`If you notice the ${e.title} pattern emerging`:"If you notice you need support"}buildThenAction(e){if(!e)return"then pause and choose your response consciously";let t=["then take three conscious breaths and choose your response","then pause to ask what you need in this moment","then remember you have choices in how to engage"];return t[Math.floor(Math.random()*t.length)]}buildElseOption(e){return"Otherwise, trust that you're navigating this well and adjust as needed."}suggestTracking(e){return{question:"What would be helpful to notice?",suggestions:["How does your energy feel?","What patterns are you noticing?","What's working well?","What might need adjustment?"],frequency:"Check in with yourself when it feels natural to do so."}}buildAdjustmentFramework(){return{permission:"You can adjust this approach at any time.",signals:"If something doesn't feel right, trust that and modify.",flexibility:"What works today might be different tomorrow, and that's completely normal."}}}class u{async engage(e,t){n.info("Crisis Container engaged",{sessionId:t.sessionId});let r=this.assessCrisisPacing(t);return{type:"crisis-support",immediate:this.immediateStabilization(r),grounding:this.groundingProtocol(r),boundaries:this.crisisBoundaries(),followUp:this.crisisFollowUp(),balanceMeter:this.balanceMeterGuidance(r),resources:this.crisisResources()}}assessCrisisPacing(e){let t=e.volatilityIndex||0,r=e.driftIndex||0;return t>8||r>.8?"extra-slow":t>6||r>.6?"slow":"gentle"}immediateStabilization(e){let t={"extra-slow":{step1:"Right now, just focus on breathing.",step2:"Feel your feet on the ground.",step3:"You are safe in this moment."},slow:{step1:"Take a deep breath and feel your body.",step2:"Notice that you are physically safe right now.",step3:"You don't have to solve everything at once."},gentle:{step1:"Pause and breathe consciously.",step2:"Ground yourself in the present moment.",step3:"Remember that this intensity will shift."}};return t[e]||t.gentle}groundingProtocol(e){return{breathing:"Breathe in for 4, hold for 4, out for 6",sensing:"Notice 5 things you can see, 4 you can touch, 3 you can hear",affirmation:"I am safe right now. I can handle this one moment at a time.",pacing:`Taking this at ${e} pace is exactly right.`}}crisisBoundaries(){return{permission:"It's okay to not be okay right now.",limits:"You don't owe anyone explanations about what you need.",protection:"Your primary job is to take care of yourself.",timeline:"You don't have to figure everything out today."}}crisisFollowUp(){return{checkIn:"Check in with yourself in 2-4 hours.",professional:"If this continues to feel overwhelming, consider reaching out to a counselor or therapist.",support:"Consider who in your life you could reach out to for support.",selfCompassion:"Be as kind to yourself as you would be to a good friend going through this."}}balanceMeterGuidance(e){return{currentSetting:e,adjustment:"You can slow down even more if you need to.",calibration:"Trust your body about what pace feels sustainable.",permission:"There's no rush. Healing happens at its own pace."}}crisisResources(){return["Crisis Text Line: Text HOME to 741741","National Suicide Prevention Lifeline: 988","Remember: This is temporary, even when it doesn't feel like it","Your feelings are valid and you deserve support"]}}e.exports={AdviceLadderTree:i}},3809:e=>{let t=process.env.LOG_LEVEL||"info",r={error:0,warn:1,info:2,debug:3};function n(e){return r[e]<=r[t]}function i(e,t,r={}){let n=new Date().toISOString(),i=Object.keys(r).length>0?JSON.stringify(r):"";return`[${n}] ${e.toUpperCase()}: ${t} ${i}`}e.exports={error:(e,t={})=>{n("error")&&console.error(i("error",e,t))},warn:(e,t={})=>{n("warn")&&console.warn(i("warn",e,t))},info:(e,t={})=>{n("info")&&console.log(i("info",e,t))},debug:(e,t={})=>{n("debug")&&console.log(i("debug",e,t))}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948],()=>r(8387));module.exports=n})();