(()=>{var a={};a.id=176,a.ids=[176],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8086:a=>{"use strict";a.exports=require("module")},8595:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>e});var d=c(75338);function e(){return(0,d.jsx)("div",{className:"min-h-screen grid place-items-center p-6",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("h1",{className:"text-2xl font-semibold mb-2",children:"Page not found"}),(0,d.jsx)("p",{className:"text-slate-500",children:"The page you’re looking for doesn’t exist."})]})})}c(74515)},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},15202:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,54160,23))},15727:()=>{},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},23975:()=>{},26713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},28354:a=>{"use strict";a.exports=require("util")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33512:(a,b,c)=>{Promise.resolve().then(c.bind(c,71718))},33873:a=>{"use strict";a.exports=require("path")},35123:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,54160,23)),Promise.resolve().then(c.t.bind(c,31603,23)),Promise.resolve().then(c.t.bind(c,68495,23)),Promise.resolve().then(c.t.bind(c,75170,23)),Promise.resolve().then(c.t.bind(c,77526,23)),Promise.resolve().then(c.t.bind(c,78922,23)),Promise.resolve().then(c.t.bind(c,29234,23)),Promise.resolve().then(c.t.bind(c,12263,23)),Promise.resolve().then(c.bind(c,82146))},41025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},41697:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/dancross/Documents/GitHub/WovenWebApp/app/error.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/dancross/Documents/GitHub/WovenWebApp/app/error.tsx","default")},43954:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/interception-routes")},45497:(a,b,c)=>{Promise.resolve().then(c.bind(c,41697))},58683:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,81170,23)),Promise.resolve().then(c.t.bind(c,23597,23)),Promise.resolve().then(c.t.bind(c,36893,23)),Promise.resolve().then(c.t.bind(c,89748,23)),Promise.resolve().then(c.t.bind(c,6060,23)),Promise.resolve().then(c.t.bind(c,7184,23)),Promise.resolve().then(c.t.bind(c,69576,23)),Promise.resolve().then(c.t.bind(c,73041,23)),Promise.resolve().then(c.t.bind(c,51384,23))},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70722:a=>{"use strict";a.exports=require("next/dist/shared/lib/invariant-error")},71718:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>f,dynamic:()=>e});var d=c(97954);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call dynamic() from the server but dynamic is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/dancross/Documents/GitHub/WovenWebApp/app/math-brain/page.tsx","dynamic"),f=(0,d.registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/dancross/Documents/GitHub/WovenWebApp/app/math-brain/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/dancross/Documents/GitHub/WovenWebApp/app/math-brain/page.tsx","default")},72472:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>l,dynamic:()=>j});var d=c(21124),e=c(38301);function f(a,b={}){if(!a)return null;let c=a.trim(),d=c.match(/^\s*(-?\d+(?:\.\d+)?)\s*[,\s]+\s*(-?\d+(?:\.\d+)?)\s*$/);if(d){let a=Number(d[1]),c=Number(d[2]);return!Number.isFinite(a)||!Number.isFinite(c)||Math.abs(a)>90||Math.abs(c)>180||b.rejectZeroZero&&0===a&&0===c?null:{lat:a,lon:c}}let e=c.replace(/[°º]/g,"\xb0").replace(/'/g,"′").replace(/"/g,"″").replace(/\s+/g," ").trim(),h=e.split(",").map(a=>a.trim()).filter(Boolean);if(2!==h.length){let a=e.split(" "),b=a.findIndex(a=>/[NS]$/i.test(a));if(b>-1&&b<a.length-1&&(h=[a.slice(0,b+1).join(" "),a.slice(b+1).join(" ")]),2!==h.length)return null}let i=g(h[0],["N","S"]),j=g(h[1],["E","W"]);return null==i||null==j||Math.abs(i)>90||Math.abs(j)>180||b.rejectZeroZero&&0===i&&0===j?null:{lat:i,lon:j}}function g(a,b){let c=a.toUpperCase().replace(/[°º]/g,"\xb0").replace(/'/g,"′").replace(/"/g,"″").replace(/[^0-9NSEW°′″\s\.\-]/g," ").replace(/\s+/g," ").trim(),d=c.match(/([NSEW])$/),e=d?d[1]:void 0,f=c.replace(/[NSEW]$/,"").trim().split(/[°′″\s]+/).filter(Boolean).map(Number);if(!f.length)return null;let g=f[0],h=f[1]||0,i=f[2]||0;if([g,h,i].some(a=>Number.isNaN(a))||h<0||h>=60||i<0||i>=60)return null;let j=Math.abs(g)+Math.abs(h)/60+Math.abs(i)/3600;return e?("S"===e||"W"===e)&&(j=-j):g<0&&(j=-j),j}function h(a,b){return Number.isFinite(a)&&Number.isFinite(b)?`${a.toFixed(6)}, ${b.toFixed(6)}`:""}var i=c(72513);let j="force-dynamic";function k({title:a,children:b,className:c=""}){return(0,d.jsxs)("section",{className:`rounded-lg border border-slate-700 bg-slate-800/60 p-4 ${c}`,children:[(0,d.jsx)("h2",{className:"text-lg font-medium text-slate-100",children:a}),(0,d.jsx)("div",{className:"mt-3",children:b})]})}function l(){let a="true"===process.env.NEXT_PUBLIC_ENABLE_LEGACY_LINK,b=(0,e.useMemo)(()=>new Date,[]),g=a=>a.toISOString().slice(0,10),j=g(b),l=g(new Date(b.getTime()+5184e5)),[m,n]=(0,e.useState)({name:"Dan",year:1973,month:7,day:24,hour:14,minute:30,city:"Bryn Mawr",state:"PA",latitude:40.0167,longitude:-75.3,timezone:"America/New_York",zodiac_type:"Tropic"}),[o,p]=(0,e.useState)("40\xb01'N, 75\xb018'W"),[q,r]=(0,e.useState)(null),[s,t]=(0,e.useState)(!0),[u,v]=(0,e.useState)(j),[w,x]=(0,e.useState)(l),[y,z]=(0,e.useState)("NATAL_ONLY"),[A,B]=(0,e.useState)("daily"),[C,D]=(0,e.useState)(!1),[E,F]=(0,e.useState)(null),[G,H]=(0,e.useState)(null),[I,J]=(0,e.useState)(!1),[K,L]=(0,e.useState)({name:"",year:"",month:"",day:"",hour:"",minute:"",city:"",state:"",latitude:"",longitude:"",timezone:"",zodiac_type:"Tropic"}),[M,N]=(0,e.useState)(""),[O,P]=(0,e.useState)(null),[Q,R]=(0,e.useState)(!0),[S,T]=(0,e.useState)("PARTNER"),[U,V]=(0,e.useState)(""),[W,X]=(0,e.useState)(""),[Y,Z]=(0,e.useState)(!1),[$,_]=(0,e.useState)(""),aa=(0,e.useMemo)(()=>(0,i.S5)(m),[m]),[ab,ac]=(0,e.useState)(()=>(0,i.S5)(m)?"planetary_only":"user_provided"),ad=(0,e.useMemo)(()=>(0,i.S5)(K),[K]),ae=(0,e.useMemo)(()=>aa&&"user_provided"!==ab,[aa,ab]);(0,e.useMemo)(()=>ad&&"user_provided"!==ab,[ad,ab]);let af=(0,e.useMemo)(()=>["GMT","UTC","US/Eastern","US/Central","US/Mountain","US/Pacific","US/Alaska","US/Hawaii","America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Phoenix","America/Anchorage"],[]),ag=(a,b)=>a.replace(/\D+/g,"").slice(0,b),ah=a=>{let b=String(a??"");if(!b)return"";let c=ag(b,2);return c?1===c.length?"0"+c:c:""},ai=(a,b,c)=>{let d=Number(a);return Number.isNaN(d)?NaN:Math.min(c,Math.max(b,d))},[aj,ak]=(0,e.useState)("A_LOCAL"),[al,am]=(0,e.useState)("30\xb010'N, 85\xb040'W"),[an,ao]=(0,e.useState)(null),[ap,aq]=(0,e.useState)(()=>f("30\xb010'N, 85\xb040'W")),[ar,as]=(0,e.useState)("Panama City, FL"),[at,au]=(0,e.useState)("US/Central");(0,e.useRef)(null);let av=(0,e.useRef)(null),aw=(0,e.useRef)(null),ax=(0,e.useRef)(0),[ay,az]=(0,e.useState)(null),[aA,aB]=(0,e.useState)(()=>"mirror"),[aC,aD]=(0,e.useState)(!1),[aE,aF]=(0,e.useState)(!0),[aG,aH]=(0,e.useState)(null),aI=(0,e.useRef)(null),[aJ,aK]=(0,e.useState)(()=>"mean");async function aL(){try{let a=av.current||document.body,b=(await c.e(865).then(c.t.bind(c,12865,23))).default,d=new Date().toISOString().slice(0,10),e={margin:.5,filename:`math-brain-report-${d}.pdf`,image:{type:"jpeg",quality:.95},html2canvas:{scale:2,useCORS:!0,backgroundColor:"#0f1115"},jsPDF:{unit:"in",format:"letter",orientation:"portrait"}};await b().from(a).set(e).save()}catch(a){az("Could not generate PDF"),setTimeout(()=>az(null),2e3)}}function aM(a="AUTO"){try{let b={schema:"mb-1",mode:y,step:A,startDate:u,endDate:w,includePersonB:I,translocation:aj,personA:m,personB:K,relationshipType:S,relationshipTier:U,relationshipRole:W,exEstranged:Y,relationshipNotes:$},c=!!(I&&K&&(K.name?.toString().trim()||null!=K.latitude||null!=K.longitude||K.timezone||K.year||K.month||K.day||K.hour||K.minute)),d="A_B"===a?I:c;"A_ONLY"!==a&&d||(delete b.personB,b.includePersonB=!1);let e=JSON.stringify(b,null,2),f=new Blob([e],{type:"application/json"}),g=new Date().toISOString().replace(/[-:]/g,"").replace(/\..+$/,""),h="A_ONLY"===a?`math_brain_setup_A_${g}.json`:`math_brain_setup_${g}.json`,i=window;if("function"==typeof i.showSaveFilePicker)return void(async()=>{try{let a=await i.showSaveFilePicker({suggestedName:h,types:[{description:"JSON files",accept:{"application/json":[".json"]}}]}),b=await a.createWritable();await b.write(f),await b.close();try{az("Saved setup JSON"),setTimeout(()=>az(null),1800)}catch{}}catch(c){let a=URL.createObjectURL(f),b=document.createElement("a");b.href=a,b.download=h,document.body.appendChild(b),b.click(),setTimeout(()=>{document.body.removeChild(b),URL.revokeObjectURL(a);try{az("Saved setup JSON"),setTimeout(()=>az(null),1800)}catch{}},150)}})();let j=URL.createObjectURL(f),k=document.createElement("a");k.href=j,k.download=h,document.body.appendChild(k),"download"in HTMLAnchorElement.prototype?k.click():window.open(j,"_blank","noopener"),setTimeout(()=>{try{document.body.removeChild(k)}catch{}try{URL.revokeObjectURL(j)}catch{}try{az("Saved setup JSON"),setTimeout(()=>az(null),1800)}catch{}},300)}catch(a){console.error("Save setup failed:",a);try{navigator?.clipboard?.writeText?.(JSON.stringify({mode:y,step:A,startDate:u,endDate:w,includePersonB:I,translocation:aj,personA:m,personB:K},null,2)).then(()=>{az("Saved to clipboard (download blocked)"),setTimeout(()=>az(null),2200)}).catch(()=>{az("Save setup failed"),setTimeout(()=>az(null),2200)})}catch{}}}async function aN(a){let b=a.target.files?.[0];if(b){try{let a=await b.text(),c=JSON.parse(a);aH(null);let d="object"==typeof c&&!!c&&(c.personA||c.period||c.relocation),e="object"==typeof c&&!!c&&c.personA&&(null!=c.personA.latitude||c.personA.coords),g="string"==typeof c?.schema;if(!d&&!e&&!g)throw Error("Invalid setup shape: expected .math_brain.json minimal schema or internal export.");if((d||g)&&!e){let a=c.personA||{},b=a.coords||"",d=b?f(String(b),{rejectZeroZero:!0}):null,[e,g,i]=String(a.date||"").split("-").map(a=>Number(a)),[j,k]=String(a.time||"").split(":").map(a=>Number(a));if(b&&!d)throw Error("Invalid personA.coords");let l={...m};if(a.name&&(l.name=String(a.name)),Number.isFinite(e)&&(l.year=e),Number.isFinite(g)&&(l.month=g),Number.isFinite(i)&&(l.day=i),Number.isFinite(j)&&(l.hour=j),Number.isFinite(k)&&(l.minute=k),a.timezone&&(l.timezone=String(a.timezone)),d&&(l.latitude=d.lat,l.longitude=d.lon,p(h(d.lat,d.lon)),r(null),t(!0)),c.zodiacType&&(l.zodiac_type=String(c.zodiacType)),n(l),c.personB){let a=c.personB,b=a.coords?f(String(a.coords),{rejectZeroZero:!0}):null,d={...K};a.name&&(d.name=String(a.name)),b&&(d.latitude=String(b.lat),d.longitude=String(b.lon),N(h(b.lat,b.lon)),P(null),R(!0)),a.timezone&&(d.timezone=String(a.timezone)),L(d),J(!0)}if(c.relationship_context){let a=c.relationship_context;a.type&&T(String(a.type).toUpperCase()),a.intimacy_tier&&V(String(a.intimacy_tier))}if(c.period){let a=c.period;a.start&&v(String(a.start)),a.end&&x(String(a.end)),a.step&&B(String(a.step).toLowerCase())}if(c.relocation){let a=c.relocation;if(a.mode&&ak(String(a.mode)),a.coords){let b=f(String(a.coords),{rejectZeroZero:!0});b&&(aq(b),am(String(a.coords)))}}}else c.personA&&n(c.personA),c.personB&&L(c.personB),"boolean"==typeof c.includePersonB&&J(c.includePersonB),c.mode&&z(c.mode),c.step&&B(c.step),c.startDate&&v(c.startDate),c.endDate&&x(c.endDate),"boolean"==typeof c.exEstranged&&Z(c.exEstranged),"string"==typeof c.relationshipNotes&&_(c.relationshipNotes),"string"==typeof c.relationshipTier&&V(c.relationshipTier),"string"==typeof c.relationshipRole&&X(c.relationshipRole),c.translocation&&ak(c.translocation),c.personA?.latitude!=null&&c.personA?.longitude!=null&&(p(h(Number(c.personA.latitude),Number(c.personA.longitude))),r(null),t(!0)),c.personB?.latitude!=null&&c.personB?.longitude!=null&&(N(h(Number(c.personB.latitude),Number(c.personB.longitude))),P(null),R(!0))}catch{}a.currentTarget&&(a.currentTarget.value="")}}(0,e.useMemo)(()=>["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"],[]);let aO=(0,e.useMemo)(()=>{let a=[m.name,m.city,m.state,m.timezone,m.zodiac_type],b=aa&&"user_provided"!==ab,c="balance"===aA,d=[Number(m.year),Number(m.month),Number(m.day),...b?[]:[Number(m.hour),Number(m.minute)],...c?[Number(m.latitude),Number(m.longitude)]:[]],e=a.every(Boolean)&&d.every(a=>!Number.isNaN(a))&&s;if(!["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"].includes(y))return"mirror"===aA?e:e&&!!u&&!!w;if(!I)return!1;let f=[K.name,K.city,K.state,K.timezone,K.zodiac_type],g=ad&&"user_provided"!==ab,h=[Number(K.year),Number(K.month),Number(K.day),...g?[]:[Number(K.hour),Number(K.minute)],Number(K.latitude),Number(K.longitude)],i=f.every(Boolean)&&h.every(a=>!Number.isNaN(a))&&Q,j=!0;return"PARTNER"===S&&(j=!!U),"FAMILY"===S&&(j=!!W),e&&i&&j&&!!u&&!!w},[m,K,I,S,U,W,y,u,w,s,Q,aa,ad,ab]),aP=(0,e.useMemo)(()=>{let a=(0,i.Vs)(aA,!1,m);return"balance"===aA&&!a.hasLoc||!aO||!!C},[aO,C,m,aA]),aQ=(0,e.useMemo)(()=>{try{return!1}catch{return!1}},[]),aR=(0,e.useMemo)(()=>({reportType:aA,needsLocation:(0,i.Vs)(aA,!1,m),canSubmit:aO,submitDisabled:aP,aCoordsValid:s,bCoordsValid:Q,includePersonB:I,timeUnknown:aa,timeUnknownB:ad,timePolicy:ab,personA_lat_type:typeof m.latitude,personA_lon_type:typeof m.longitude}),[aA,aO,aP,s,Q,I,aa,ad,ab,m]);async function aS(a){a.preventDefault();let b=(0,i.Vs)(aA,!1,m);if("balance"===aA&&!b.hasLoc){az("Transits need current location to place houses correctly. Add a location or switch to Mirror (no transits)."),setTimeout(()=>az(null),2500);return}if(!aO)return;let c=Date.now();if(!(c-ax.current<800)){ax.current=c,"undefined"!=typeof performance&&performance.now(),D(!0),F(null),H(null);try{let a={mode:y,personA:{...m,nation:"US",year:Number(m.year),month:Number(m.month),day:Number(m.day),hour:Number(m.hour),minute:Number(m.minute),latitude:Number(m.latitude),longitude:Number(m.longitude)},time_policy:aa?ab:"user_provided",transitStartDate:u,transitEndDate:w,transitStep:A,context:{mode:"balance"===aA?"balance_meter":"mirror"},translocation:"A_LOCAL"===aj||"B_LOCAL"===aj||"MIDPOINT"===aj?{applies:!0,method:"A_LOCAL"===aj?"A_local":"B_LOCAL"===aj?"B_local":"Midpoint",coords:ap?{latitude:ap.lat,longitude:ap.lon}:void 0,current_location:ar||void 0,tz:at||void 0}:{applies:!1,method:"Natal"}};try{aE&&(window.localStorage.setItem("mb.lastInputs",JSON.stringify({mode:y,step:A,startDate:u,endDate:w,includePersonB:I,translocation:aj,relationshipType:S,relationshipTier:U,relationshipRole:W,exEstranged:Y,relationshipNotes:$,personA:m,personB:K})),aD(!0))}catch{}["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"].includes(y)&&I&&(a.personB={...K,nation:"US",year:Number(K.year),month:Number(K.month),day:Number(K.day),hour:Number(K.hour),minute:Number(K.minute),latitude:Number(K.latitude),longitude:Number(K.longitude)},a.relationship_context={type:S,intimacy_tier:"PARTNER"===S?U:void 0,role:"PARTNER"!==S?W:void 0,ex_estranged:"FRIEND"===S?void 0:Y,notes:$||void 0});let b=await fetch("/api/astrology-mathbrain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),c=await b.json();if(!b.ok||c?.success===!1){let a=c?.error||`Request failed (${b.status})`;throw"mirror"===aA&&(az("Mirror preparation failed"),setTimeout(()=>az(null),2500)),Error(a)}H(c);try{c?.person_a?.meta||c?.provenance?.time_meta_a}catch{}}catch(a){"mirror"===aA&&(az("Mirror preparation failed"),setTimeout(()=>az(null),2500)),F(a?.message||"Unexpected error")}finally{D(!1)}}}return(0,d.jsxs)("main",{className:"mx-auto max-w-6xl px-6 py-12",children:[(0,d.jsxs)("header",{className:"text-center print:hidden",children:[(0,d.jsx)("h1",{className:"text-4xl md:text-5xl font-bold tracking-tight text-slate-100",children:"Math Brain"}),(0,d.jsx)("p",{className:"mt-4 text-base md:text-lg text-slate-300",children:"Run the geometry first. Then jump into Chat to synthesize the narrative."}),(0,d.jsxs)("div",{className:"mt-6 flex items-center justify-center gap-4 text-sm text-slate-400",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("span",{className:"rounded bg-amber-600 px-2 py-1 text-xs font-medium text-slate-100",children:"FIELD"}),(0,d.jsx)("span",{className:"text-xs",children:"Geometric calculation engine"})]}),(0,d.jsx)("span",{className:"text-slate-600",children:"→"}),(0,d.jsxs)("div",{className:"flex items-center gap-2 opacity-50",children:[(0,d.jsx)("span",{className:"rounded bg-slate-700 px-2 py-1 text-xs font-medium text-slate-400",children:"MAP"}),(0,d.jsx)("span",{className:"text-xs",children:"Raven handles"})]}),(0,d.jsx)("span",{className:"text-slate-600",children:"→"}),(0,d.jsxs)("div",{className:"flex items-center gap-2 opacity-50",children:[(0,d.jsx)("span",{className:"rounded bg-slate-700 px-2 py-1 text-xs font-medium text-slate-400",children:"VOICE"}),(0,d.jsx)("span",{className:"text-xs",children:"Raven handles"})]})]})]}),(0,d.jsxs)("div",{className:"mt-8 flex flex-wrap gap-3 justify-center print:hidden",children:[(0,d.jsx)("a",{href:"/",className:"rounded-md border border-slate-700 bg-slate-800 px-4 py-2 text-slate-100 hover:bg-slate-700",children:"Back Home"}),a&&(0,d.jsx)("a",{href:"/index.html",className:"rounded-md bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-500",target:"_blank",rel:"noopener noreferrer",children:"Open Legacy Math Brain"}),(0,d.jsx)("a",{href:"/chat",className:"rounded-md bg-emerald-600 px-4 py-2 text-white hover:bg-emerald-500",children:"Go to Poetic Brain"})]}),aC&&(0,d.jsxs)("div",{className:"mt-6 flex items-center justify-center gap-3 print:hidden",children:[(0,d.jsx)("div",{className:"rounded-md border border-slate-700 bg-slate-800/60 px-3 py-2 text-slate-200 text-sm",children:"A previous session was found."}),(0,d.jsx)("button",{type:"button",onClick:function(){try{let a=window.localStorage.getItem("mb.lastInputs");if(!a)return;let b=JSON.parse(a);b.personA&&n(b.personA),b.personB&&L(b.personB),"boolean"==typeof b.includePersonB&&J(b.includePersonB),b.mode&&z(b.mode),b.step&&B(b.step),b.startDate&&v(b.startDate),b.endDate&&x(b.endDate),b.relationshipType&&T(b.relationshipType),"boolean"==typeof b.exEstranged&&Z(b.exEstranged),"string"==typeof b.relationshipNotes&&_(b.relationshipNotes),"string"==typeof b.relationshipTier&&V(b.relationshipTier),"string"==typeof b.relationshipRole&&X(b.relationshipRole),b.translocation&&ak(b.translocation)}catch{}},className:"rounded-md bg-indigo-600 px-3 py-2 text-white hover:bg-indigo-500 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",children:"Resume inputs"}),(0,d.jsx)("button",{type:"button",onClick:function(){try{window.localStorage.removeItem("mb.lastInputs"),aD(!1),aF(!0)}catch{}},className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-2 text-slate-100 hover:bg-slate-700 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400",children:"Reset"})]}),(0,d.jsxs)("form",{onSubmit:aS,className:"mt-10 print:hidden",children:[aQ&&(0,d.jsxs)("div",{className:"mb-4 rounded-md border border-slate-600 bg-slate-900/60 p-3 text-xs text-slate-200",children:[(0,d.jsx)("div",{className:"font-medium mb-2",children:"Debug — gating state"}),(0,d.jsx)("pre",{className:"whitespace-pre-wrap break-words text-[12px]",children:JSON.stringify(aR,null,2)})]}),(0,d.jsxs)("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-3 rounded-md border border-slate-700 bg-slate-900/50 p-3",children:[(0,d.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm text-slate-200",children:[(0,d.jsx)("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-600 bg-slate-900 text-indigo-600 focus:ring-indigo-500",checked:aE,onChange:a=>aF(a.target.checked)}),"Save for next session"]}),(0,d.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,d.jsxs)("div",{className:"inline-flex overflow-hidden rounded-md border border-slate-700 bg-slate-800",children:[(0,d.jsx)("button",{type:"button",onClick:()=>aM("A_ONLY"),className:"px-3 py-1.5 text-slate-100 hover:bg-slate-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400",title:"Save only Person A’s setup to JSON","aria-label":"Save only Person A setup",children:"Save A"}),(0,d.jsx)("div",{className:"h-6 w-px bg-slate-700 my-1"}),(0,d.jsx)("button",{type:"button",onClick:()=>aM("A_B"),className:"px-3 py-1.5 text-slate-100 hover:bg-slate-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400",title:"Save Person A + B (if included)","aria-label":"Save Person A and B setup",children:"Save A+B"})]}),(0,d.jsx)("button",{type:"button",onClick:()=>aI.current?.click(),className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-1.5 text-slate-100 hover:bg-slate-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400","aria-label":"Load a setup from a JSON file",children:"Load setup…"}),(0,d.jsx)("input",{ref:aI,type:"file",accept:"application/json",onChange:aN,className:"hidden","aria-label":"Upload setup JSON file"})]}),aG&&(0,d.jsx)("div",{className:"mt-2 text-xs text-red-400",children:aG})]}),(0,d.jsxs)("section",{"aria-labelledby":"report-type-heading",className:"mb-6 rounded-lg border border-slate-700 bg-slate-800/60 p-4",children:[(0,d.jsx)("h3",{id:"report-type-heading",className:"text-sm font-medium text-slate-200",children:"Report Type"}),(0,d.jsxs)("div",{className:"mt-3 flex items-center justify-between gap-3",children:[(0,d.jsxs)("fieldset",{className:"inline-flex overflow-hidden rounded-md border border-slate-700 bg-slate-800 px-0 py-0",children:[(0,d.jsx)("legend",{className:"sr-only",children:"Choose report type"}),(0,d.jsxs)("label",{className:`px-3 py-1.5 text-sm cursor-pointer ${"mirror"===aA?"bg-indigo-600 text-white":"text-slate-200 hover:bg-slate-700"}`,title:"Send to Poetic Brain",onClick:()=>aB("mirror"),children:[(0,d.jsx)("input",{type:"radio",name:"reportType",value:"mirror",className:"sr-only",checked:"mirror"===aA,onChange:()=>aB("mirror")}),"Mirror",(0,d.jsx)("span",{className:"ml-1 text-[11px] text-slate-300/80",children:"(send to Poetic Brain)"})]}),(0,d.jsxs)("label",{className:`px-3 py-1.5 text-sm cursor-pointer ${"balance"===aA?"bg-indigo-600 text-white":"text-slate-200 hover:bg-slate-700"}`,title:"Show gauges on screen",onClick:()=>aB("balance"),children:[(0,d.jsx)("input",{type:"radio",name:"reportType",value:"balance",className:"sr-only",checked:"balance"===aA,onChange:()=>aB("balance")}),"Balance Meter",(0,d.jsx)("span",{className:"ml-1 text-[11px] text-slate-300/80",children:"(gauges on screen)"})]})]}),"mirror"===aA&&(0,d.jsx)("div",{className:"text-xs text-slate-400",children:"Handoff only — no on-screen gauges"})]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2 items-start",children:[(0,d.jsx)(k,{title:"Person A (required)",children:(0,d.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"a-name",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Name"}),(0,d.jsx)("input",{id:"a-name",placeholder:"Your Name",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-center text-slate-100 placeholder:text-slate-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:m.name,onChange:a=>n({...m,name:a.target.value}),required:!0})]}),(0,d.jsxs)("div",{className:"grid grid-cols-5 gap-2",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"a-year",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Year"}),(0,d.jsx)("input",{id:"a-year",type:"text",inputMode:"numeric",className:"mt-1 w-full min-w-[80px] h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:String(m.year),onChange:a=>n({...m,year:ag(a.target.value,4)}),placeholder:"YYYY",required:!0})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"a-month",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Month"}),(0,d.jsx)("input",{id:"a-month",type:"text",inputMode:"numeric",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-center text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:String(m.month),onChange:a=>{let b=ai(ag(a.target.value,2),1,12);n({...m,month:Number.isNaN(b)?"":String(b)})},placeholder:"MM",required:!0})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"a-day",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Day"}),(0,d.jsx)("input",{id:"a-day",type:"text",inputMode:"numeric",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-center text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ah(m.day),onChange:a=>{let b=ai(ah(a.target.value),1,31);n({...m,day:Number.isNaN(b)?"":String(b).padStart(2,"0")})},placeholder:"DD",required:!0})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"a-hour",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Hour"}),(0,d.jsx)("input",{id:"a-hour",type:"text",inputMode:"numeric",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ah(m.hour),onChange:a=>{let b=ai(ah(a.target.value),0,23);n({...m,hour:Number.isNaN(b)?"":String(b).padStart(2,"0")})},placeholder:"HH",required:!ae})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"a-minute",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Minute"}),(0,d.jsx)("input",{id:"a-minute",type:"text",inputMode:"numeric",className:"mt-1 w-full min-w-[60px] h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ah(m.minute),onChange:a=>{let b=ai(ah(a.target.value),0,59);n({...m,minute:Number.isNaN(b)?"":String(b).padStart(2,"0")})},placeholder:"MM",required:!ae})]})]}),"            ",(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"a-city",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"City"}),(0,d.jsx)("input",{id:"a-city",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:m.city,onChange:a=>n({...m,city:a.target.value}),required:!0})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"a-state",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"State / Province"}),(0,d.jsx)("input",{id:"a-state",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:m.state,onChange:a=>n({...m,state:a.target.value}),required:!0}),(0,d.jsx)("p",{className:"mt-1 text-[11px] text-slate-500",children:"Nation assumed “US” for API compatibility."})]}),(0,d.jsxs)("div",{className:"sm:col-span-2",children:[(0,d.jsx)("label",{htmlFor:"a-coords",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Birth Coordinates"}),(0,d.jsx)("input",{id:"a-coords",type:"text",className:`mt-1 w-full rounded-md border bg-slate-900 px-3 py-2 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 ${q?"border-red-600":"border-slate-600"}`,value:o,onChange:a=>{let b=a.target.value;p(b);let c=f(b,{rejectZeroZero:!0});c?(n({...m,latitude:c.lat,longitude:c.lon}),r(null),t(!0)):(r('Invalid coordinates. Try "40\xb042′N, 74\xb00′W" or "40.7128, -74.006".'),t(!1))},"aria-describedby":"a-coords-help",placeholder:"e.g., 40\xb042′N, 74\xb00′W or 40.7128, -74.006",required:!0}),(0,d.jsx)("p",{id:"a-coords-help",className:"mt-1 text-xs text-slate-400",children:"Examples: 40\xb042′N, 74\xb00′W \xb7 34\xb03′S, 18\xb025′E \xb7 40.7128, -74.006"}),q?(0,d.jsx)("p",{className:"mt-1 text-xs text-red-400",children:q}):(0,d.jsxs)("p",{className:"mt-1 text-xs text-slate-400",children:["Normalized: ",h(Number(m.latitude),Number(m.longitude))]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"a-tz",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Timezone"}),(0,d.jsx)("select",{id:"a-tz",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:m.timezone,onChange:a=>n({...m,timezone:a.target.value}),required:!0,children:af.map(a=>(0,d.jsx)("option",{value:a,children:a},a))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"a-zodiac",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Zodiac Type"}),(0,d.jsxs)("select",{id:"a-zodiac",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100",value:m.zodiac_type,onChange:a=>n({...m,zodiac_type:a.target.value}),children:[(0,d.jsx)("option",{value:"Tropic",children:"Tropic"}),(0,d.jsx)("option",{value:"Sidereal",children:"Sidereal"})]})]}),aa&&(0,d.jsx)("div",{className:"sm:col-span-2",children:(0,d.jsxs)("fieldset",{className:"rounded-md border border-slate-700 bg-slate-900/50 p-3",children:[(0,d.jsx)("legend",{className:"px-1 text-xs font-medium text-slate-200",children:"Birth time policy"}),(0,d.jsxs)("div",{className:"mt-2 grid grid-cols-1 gap-2 sm:grid-cols-3",children:[(0,d.jsxs)("label",{className:`flex cursor-pointer items-start gap-2 rounded-md border px-3 py-2 text-xs ${"planetary_only"===ab?"border-indigo-600 bg-indigo-900/20 text-slate-100":"border-slate-700 bg-slate-800/50 text-slate-300 hover:bg-slate-800"}`,children:[(0,d.jsx)("input",{type:"radio",name:"time-policy",className:"mt-0.5",checked:"planetary_only"===ab,onChange:()=>ac("planetary_only")}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"font-medium",children:"Planetary-only"}),(0,d.jsx)("div",{className:"text-slate-400",children:"No houses/angles; tightest, falsifiable geometry"})]})]}),(0,d.jsxs)("label",{className:`flex cursor-pointer items-start gap-2 rounded-md border px-3 py-2 text-xs ${"whole_sign"===ab?"border-indigo-600 bg-indigo-900/20 text-slate-100":"border-slate-700 bg-slate-800/50 text-slate-300 hover:bg-slate-800"}`,children:[(0,d.jsx)("input",{type:"radio",name:"time-policy",className:"mt-0.5",checked:"whole_sign"===ab,onChange:()=>ac("whole_sign")}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"font-medium",children:"Whole-sign houses"}),(0,d.jsx)("div",{className:"text-slate-400",children:"House semantics without exact time; angles still suppressed"})]})]}),(0,d.jsxs)("label",{className:`flex cursor-pointer items-start gap-2 rounded-md border px-3 py-2 text-xs ${"sensitivity_scan"===ab?"border-indigo-600 bg-indigo-900/20 text-slate-100":"border-slate-700 bg-slate-800/50 text-slate-300 hover:bg-slate-800"}`,children:[(0,d.jsx)("input",{type:"radio",name:"time-policy",className:"mt-0.5",checked:"sensitivity_scan"===ab,onChange:()=>ac("sensitivity_scan")}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"font-medium",children:"Sensitivity scan"}),(0,d.jsx)("div",{className:"text-slate-400",children:"Test a window of possible times; house-dependent insights flagged"})]})]})]})]})})]})}),(0,d.jsxs)(k,{title:"Person B (optional for relational)",children:[(0,d.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,d.jsx)("p",{className:"text-xs text-slate-400",children:"Add a second person for synastry/composite modes."}),(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsxs)("div",{className:"inline-flex rounded-md border border-slate-700 bg-slate-800 p-1",children:[(0,d.jsx)("button",{type:"button",onClick:function(){I&&L(a=>({...a,year:String(m.year),month:String(m.month),day:String(m.day),hour:String(m.hour),minute:String(m.minute),city:m.city,state:m.state,latitude:String(m.latitude),longitude:String(m.longitude),timezone:m.timezone,zodiac_type:m.zodiac_type}))},disabled:!I,className:"px-2 py-1 text-xs text-slate-100 hover:bg-slate-700 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",title:"Copy Person A details to Person B (keeps B name)",children:"Copy A→B"}),(0,d.jsx)("div",{className:"mx-1 h-5 w-px bg-slate-700"}),(0,d.jsx)("button",{type:"button",onClick:function(){I&&(n(a=>({...a,name:K.name||a.name,year:K.year??a.year,month:K.month??a.month,day:K.day??a.day,hour:K.hour??a.hour,minute:K.minute??a.minute,city:K.city||a.city,state:K.state||a.state,latitude:K.latitude??a.latitude,longitude:K.longitude??a.longitude,timezone:K.timezone||a.timezone,zodiac_type:K.zodiac_type||a.zodiac_type})),L(a=>({...a,year:String(m.year),month:String(m.month),day:String(m.day),hour:String(m.hour),minute:String(m.minute),city:m.city,state:m.state,latitude:String(m.latitude),longitude:String(m.longitude),timezone:m.timezone,zodiac_type:m.zodiac_type})))},disabled:!I,className:"px-2 py-1 text-xs text-slate-100 hover:bg-slate-700 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",title:"Swap A/B (relationship settings unchanged)",children:"Swap A/B"}),(0,d.jsx)("div",{className:"mx-1 h-5 w-px bg-slate-700"}),(0,d.jsx)("button",{type:"button",onClick:function(){I&&L({name:"",year:"",month:"",day:"",hour:"",minute:"",city:"",state:"",latitude:"",longitude:"",timezone:"",zodiac_type:"Tropic"})},disabled:!I,className:"px-2 py-1 text-xs text-slate-100 hover:bg-slate-700 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",title:"Clear all Person B fields",children:"Clear B"}),(0,d.jsx)("div",{className:"mx-1 h-5 w-px bg-slate-700"}),(0,d.jsx)("button",{type:"button",onClick:function(){if(!I)return;let a=new Date;L(b=>({...b,year:String(a.getUTCFullYear()),month:String(a.getUTCMonth()+1),day:String(a.getUTCDate()),hour:String(a.getUTCHours()),minute:String(a.getUTCMinutes()),timezone:"UTC",city:b.city||"",state:b.state||"",latitude:b.latitude||"",longitude:b.longitude||""}))},disabled:!I,className:"px-2 py-1 text-xs text-slate-100 hover:bg-slate-700 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",title:"Set Person B date/time to now (UTC)",children:"Set B = Now (UTC)"})]}),(0,d.jsxs)("label",{htmlFor:"toggle-include-b-a",className:"inline-flex items-center gap-2 text-sm text-slate-200 cursor-pointer",children:[(0,d.jsx)("input",{id:"toggle-include-b-a",type:"checkbox",className:"h-4 w-4 rounded border-slate-600 bg-slate-900 text-indigo-600 focus:ring-indigo-500",checked:I,onChange:a=>J(a.target.checked)}),"Include Person B"]})]})]}),(0,d.jsx)("div",{className:`mt-4 ${!I?"opacity-50":""}`,children:(0,d.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"b-name",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Name"}),(0,d.jsx)("input",{id:"b-name",ref:aw,placeholder:"Their Name",disabled:!I,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-center text-slate-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 disabled:opacity-50",value:K.name,onChange:a=>L({...K,name:a.target.value})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-5 gap-2",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"b-year",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Year"}),(0,d.jsx)("input",{id:"b-year",type:"text",inputMode:"numeric",disabled:!I,className:"mt-1 w-full min-w-[80px] h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:String(K.year),onChange:a=>L({...K,year:ag(a.target.value,4)}),placeholder:"YYYY"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"b-month",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Month"}),(0,d.jsx)("input",{id:"b-month",type:"text",inputMode:"numeric",disabled:!I,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-center text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:String(K.month),onChange:a=>{let b=ai(ag(a.target.value,2),1,12);L({...K,month:Number.isNaN(b)?"":String(b)})},placeholder:"MM"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"b-day",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Day"}),(0,d.jsx)("input",{id:"b-day",type:"text",inputMode:"numeric",disabled:!I,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ah(K.day),onChange:a=>{let b=ai(ah(a.target.value),1,31);L({...K,day:Number.isNaN(b)?"":String(b).padStart(2,"0")})},placeholder:"DD"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"b-hour",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Hour"}),(0,d.jsx)("input",{id:"b-hour",type:"text",inputMode:"numeric",disabled:!I,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ah(K.hour),onChange:a=>{let b=ai(ah(a.target.value),0,23);L({...K,hour:Number.isNaN(b)?"":String(b).padStart(2,"0")})},placeholder:"HH"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"b-minute",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Minute"}),(0,d.jsx)("input",{id:"b-minute",type:"text",inputMode:"numeric",disabled:!I,className:"mt-1 w-full min-w-[60px] h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ah(K.minute),onChange:a=>{let b=ai(ah(a.target.value),0,59);L({...K,minute:Number.isNaN(b)?"":String(b).padStart(2,"0")})},placeholder:"MM"})]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"b-city",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"City"}),(0,d.jsx)("input",{id:"b-city",disabled:!I,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:K.city,onChange:a=>L({...K,city:a.target.value})})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"b-state",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"State / Province"}),(0,d.jsx)("input",{id:"b-state",disabled:!I,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:K.state,onChange:a=>L({...K,state:a.target.value})}),(0,d.jsx)("p",{className:"mt-1 text-[11px] text-slate-500",children:"Nation assumed “US” for API compatibility."})]}),(0,d.jsxs)("div",{className:"sm:col-span-2",children:[(0,d.jsx)("label",{htmlFor:"b-coords",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Birth Coordinates (B)"}),(0,d.jsx)("input",{id:"b-coords",type:"text",disabled:!I,className:`mt-1 w-full rounded-md border bg-slate-900 px-3 py-2 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 ${O?"border-red-600":"border-slate-600"}`,value:M,onChange:a=>{let b=a.target.value;if(N(b),!I)return;let c=f(b,{rejectZeroZero:!0});c?(L({...K,latitude:c.lat,longitude:c.lon}),P(null),R(!0)):(P("Invalid coordinates"),R(!1))},placeholder:"e.g., 34\xb003′S, 18\xb025′E or -34.0500, 18.4167"}),(0,d.jsx)("p",{className:"mt-1 text-xs text-slate-400",children:"Examples: 40\xb042′N, 74\xb00′W \xb7 34\xb03′S, 18\xb025′E \xb7 40.7128, -74.006"}),(0,d.jsxs)("p",{className:"mt-1 text-xs text-slate-400",children:["Normalized: ",Number(K.latitude)||Number(K.longitude)?h(Number(K.latitude),Number(K.longitude)):"—"]}),O&&(0,d.jsx)("p",{className:"mt-1 text-xs text-red-400",children:O})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"b-tz",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Timezone"}),(0,d.jsx)("select",{id:"b-tz",disabled:!I,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:K.timezone,onChange:a=>L({...K,timezone:a.target.value}),children:af.map(a=>(0,d.jsx)("option",{value:a,children:a},a))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"b-zodiac",className:"block text-[11px] uppercase tracking-wide text-slate-300",children:"Zodiac Type"}),(0,d.jsxs)("select",{id:"b-zodiac",disabled:!I,className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 disabled:opacity-50",value:K.zodiac_type,onChange:a=>L({...K,zodiac_type:a.target.value}),children:[(0,d.jsx)("option",{value:"Tropic",children:"Tropic"}),(0,d.jsx)("option",{value:"Sidereal",children:"Sidereal"})]})]})]})})]}),(0,d.jsxs)(k,{title:"Relationship Context",children:[(0,d.jsx)("div",{className:"mb-2 flex items-center justify-between",children:(0,d.jsx)("p",{className:"text-xs text-slate-400",children:"These fields unlock when Person B is included."})}),(0,d.jsxs)("div",{className:`grid grid-cols-1 gap-4 sm:grid-cols-2 ${!I?"opacity-50":""}`,children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"rel-type",className:"block text-sm text-slate-300",children:"Type"}),(0,d.jsxs)("select",{id:"rel-type",disabled:!I,className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100",value:S,onChange:a=>{T(a.target.value),V(""),X("")},children:[(0,d.jsx)("option",{value:"PARTNER",children:"Partner"}),(0,d.jsx)("option",{value:"FRIEND",children:"Friend / Colleague"}),(0,d.jsx)("option",{value:"FAMILY",children:"Family"})]}),(0,d.jsxs)("div",{className:"mt-2 text-[11px] text-slate-400",children:[(0,d.jsx)("div",{className:"font-medium text-slate-300",children:"Primary Relational Tiers (scope):"}),(0,d.jsx)("div",{children:"• Partner — full map access, including intimacy arcs & legacy patterns."}),(0,d.jsx)("div",{children:"• Friend / Colleague — emotional, behavioral, social dynamics; intimacy overlays de-emphasized."}),(0,d.jsx)("div",{children:"• Family — legacy patterns and behavioral overlays; sexual resonance suppressed."}),(0,d.jsx)("div",{children:"• Acquaintance — light pattern echoes only; intimacy dynamics locked."})]})]}),"PARTNER"===S&&(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"rel-tier",className:"block text-sm text-slate-300",children:"Intimacy Tier"}),(0,d.jsxs)("select",{id:"rel-tier",disabled:!I,className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100",value:U,onChange:a=>V(a.target.value),children:[(0,d.jsx)("option",{value:"",children:"Select…"}),(0,d.jsx)("option",{value:"P1",children:"P1 — Platonic partners"}),(0,d.jsx)("option",{value:"P2",children:"P2 — Friends-with-benefits"}),(0,d.jsx)("option",{value:"P3",children:"P3 — Situationship (unclear/unstable)"}),(0,d.jsx)("option",{value:"P4",children:"P4 — Low-commitment romantic or sexual"}),(0,d.jsx)("option",{value:"P5a",children:"P5a — Committed romantic + sexual"}),(0,d.jsx)("option",{value:"P5b",children:"P5b — Committed romantic, non-sexual"})]}),I&&["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"].includes(y)&&!U&&(0,d.jsx)("p",{className:"mt-1 text-xs text-amber-400",children:"Partner relationships require an intimacy tier."})]}),"FAMILY"===S&&(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"rel-role",className:"block text-sm text-slate-300",children:"Role"}),(0,d.jsxs)("select",{id:"rel-role",disabled:!I,className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100",value:W,onChange:a=>X(a.target.value),children:[(0,d.jsx)("option",{value:"",children:"Select…"}),(0,d.jsx)("option",{value:"Parent",children:"Parent"}),(0,d.jsx)("option",{value:"Offspring",children:"Offspring"}),(0,d.jsx)("option",{value:"Sibling",children:"Sibling"}),(0,d.jsx)("option",{value:"Cousin",children:"Cousin"}),(0,d.jsx)("option",{value:"Extended",children:"Extended"}),(0,d.jsx)("option",{value:"Guardian",children:"Guardian"}),(0,d.jsx)("option",{value:"Mentor",children:"Mentor"}),(0,d.jsx)("option",{value:"Other",children:"Other"}),(0,d.jsx)("option",{value:"Custom",children:"Custom"})]}),I&&["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"].includes(y)&&!U&&(0,d.jsx)("p",{className:"mt-1 text-xs text-amber-400",children:"Partner relationships require an intimacy tier."})]}),"FRIEND"===S&&(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"rel-role-f",className:"block text-sm text-slate-300",children:"Role (optional)"}),(0,d.jsxs)("select",{id:"rel-role-f",className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100",value:W,onChange:a=>X(a.target.value),children:[(0,d.jsx)("option",{value:"",children:"—"}),(0,d.jsx)("option",{value:"Acquaintance",children:"Acquaintance"}),(0,d.jsx)("option",{value:"Mentor",children:"Mentor"}),(0,d.jsx)("option",{value:"Other",children:"Other"}),(0,d.jsx)("option",{value:"Custom",children:"Custom"})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{id:"rel-ex",type:"checkbox",className:"h-4 w-4 rounded border-slate-600 bg-slate-900 text-indigo-600 focus:ring-indigo-500",checked:Y,onChange:a=>Z(a.target.checked),disabled:!I||"FRIEND"===S}),(0,d.jsx)("label",{htmlFor:"rel-ex",className:"text-sm text-slate-300",children:"Ex / Estranged"})]}),(0,d.jsxs)("div",{className:"sm:col-span-2",children:[(0,d.jsx)("label",{htmlFor:"rel-notes",className:"block text-sm text-slate-300",children:"Notes"}),(0,d.jsx)("textarea",{id:"rel-notes",disabled:!I,className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 disabled:opacity-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",rows:3,placeholder:"Optional context (max 500 chars)",value:$,onChange:a=>_(a.target.value.slice(0,500))})]})]})]}),(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)(k,{title:"Transits",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"t-start",className:"block text-sm text-slate-300",children:"Start Date"}),(0,d.jsx)("input",{id:"t-start",type:"date",className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:u,onChange:a=>v(a.target.value)})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"t-end",className:"block text-sm text-slate-300",children:"End Date"}),(0,d.jsx)("input",{id:"t-end",type:"date",className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:w,onChange:a=>x(a.target.value)})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"t-step",className:"block text-sm text-slate-300",children:"Step"}),(0,d.jsxs)("select",{id:"t-step",className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:A,onChange:a=>B(a.target.value),children:[(0,d.jsx)("option",{value:"daily",children:"Daily"}),(0,d.jsx)("option",{value:"weekly",children:"Weekly"}),(0,d.jsx)("option",{value:"monthly",children:"Monthly"})]})]})]}),(0,d.jsxs)("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"t-mode",className:"block text-sm text-slate-300",children:"Mode"}),(0,d.jsxs)("select",{id:"t-mode",className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:y,onChange:a=>{let b=a.target.value;z(b),["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"].includes(b)&&J(!0)},children:[(0,d.jsx)("option",{value:"NATAL_ONLY",children:"Natal only"}),(0,d.jsx)("option",{value:"NATAL_TRANSITS",children:"Natal + Transits"}),(0,d.jsx)("option",{value:"DUAL_NATAL_TRANSITS",children:"Dual Natal + Transits (A & B, no synastry)"}),(0,d.jsx)("option",{value:"SYNASTRY",children:"Synastry (A ↔ B)"}),(0,d.jsx)("option",{value:"SYNASTRY_TRANSITS",children:"Synastry + Transits"}),(0,d.jsx)("option",{value:"COMPOSITE",children:"Composite (midpoint) + Relational Mirror"})]}),!I&&(0,d.jsx)("p",{className:"mt-1 text-xs text-amber-400",children:"Selecting a relational mode will enable “Include Person B”."})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"t-reloc",className:"block text-sm text-slate-300",children:"Relocation (angles/houses)"}),(0,d.jsxs)("select",{id:"t-reloc",className:"mt-1 w-full rounded-md border border-slate-600 bg-slate-900 px-3 py-2 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:aj,onChange:a=>ak(a.target.value),children:[(0,d.jsx)("option",{value:"NONE",children:"None (Natal Base)"}),(0,d.jsx)("option",{value:"A_LOCAL",children:"Person A"}),(0,d.jsx)("option",{value:"B_LOCAL",disabled:!I,children:"Person B"}),(0,d.jsx)("option",{value:"MIDPOINT",disabled:!I,children:"Midpoint (A + B)"})]}),(0,d.jsx)("p",{className:"mt-1 text-xs text-slate-400",children:"Clinical toggle only; no narrative. If not applied, angles/houses remain natal."}),(0,d.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:"Note: Midpoint here relocates houses to the geographic midpoint; Composite mode above creates the midpoint chart."}),"NONE"===aj?null:(0,d.jsxs)("div",{className:"mt-4 inline-flex items-center gap-2 rounded-full border border-emerald-700 bg-emerald-900/30 px-3 py-1 text-xs text-emerald-200",children:[(0,d.jsx)("span",{className:"inline-block h-1.5 w-1.5 rounded-full bg-emerald-400","aria-hidden":!0}),(0,d.jsx)("span",{className:"font-medium",children:"Relocated to:"}),(0,d.jsx)("span",{className:"text-emerald-100",children:ar||"Custom"}),(0,d.jsxs)("span",{className:"text-emerald-300",children:["(",at||m.timezone||"—",")"]})]})]})]}),"NONE"!==aj&&(0,d.jsxs)("div",{className:"mt-4",children:[(0,d.jsx)("label",{htmlFor:"t-reloc-coords",className:"block text-sm text-slate-300",children:"Relocation Coordinates"}),(0,d.jsx)("input",{id:"t-reloc-coords",type:"text",className:`mt-1 w-full h-10 rounded-md border bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 ${an?"border-red-600":"border-slate-600"}`,value:al,onChange:a=>{let b=a.target.value;am(b);let c=f(b,{rejectZeroZero:!0});c?(aq(c),ao(null)):(aq(null),ao("Invalid coordinates"))},placeholder:"e.g., 30\xb010′N, 85\xb040′W"}),(0,d.jsxs)("p",{className:"mt-1 text-xs text-slate-400",children:["Default: 30\xb010′N, 85\xb040′W \xb7 Normalized: ",ap?h(ap.lat,ap.lon):"—"]}),an&&(0,d.jsx)("p",{className:"mt-1 text-xs text-red-400",children:an}),(0,d.jsxs)("div",{className:"mt-3 grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"t-reloc-label",className:"block text-sm text-slate-300",children:"Relocation Label"}),(0,d.jsx)("input",{id:"t-reloc-label",type:"text",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:ar,onChange:a=>as(a.target.value),placeholder:"e.g., Panama City, FL"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"t-reloc-tz",className:"block text-sm text-slate-300",children:"Relocation Timezone"}),(0,d.jsx)("select",{id:"t-reloc-tz",className:"mt-1 w-full h-10 rounded-md border border-slate-600 bg-slate-900 px-3 text-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",value:at,onChange:a=>au(a.target.value),children:af.map(a=>(0,d.jsx)("option",{value:a,children:a},a))})]})]})]}),"weekly"===A&&(0,d.jsxs)("div",{className:"mt-2 flex items-center gap-3",children:[(0,d.jsx)("span",{className:"text-xs text-slate-400",children:"Weekly aggregation"}),(0,d.jsx)("button",{type:"button",className:"h-5 w-5 rounded-full border border-slate-600 text-[11px] text-slate-300 hover:bg-slate-700/60 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500",title:"Mean = average of daily values per week; Max = highest daily value per week","aria-label":"Help: Weekly aggregation semantics",children:"?"}),(0,d.jsxs)("div",{role:"group","aria-label":"Weekly aggregation",className:"inline-flex overflow-hidden rounded-md border border-slate-700 bg-slate-800",children:[(0,d.jsx)("button",{type:"button",onClick:()=>aK("mean"),className:`px-3 py-1 text-xs ${"mean"===aJ?"bg-indigo-600 text-white":"text-slate-200 hover:bg-slate-700"} focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500`,children:"Mean"}),(0,d.jsx)("button",{type:"button",onClick:()=>aK("max"),className:`px-3 py-1 text-xs ${"max"===aJ?"bg-indigo-600 text-white":"text-slate-200 hover:bg-slate-700"} focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500`,children:"Max"})]})]}),"NONE"!==aj&&(0,d.jsxs)("div",{className:"mt-3 inline-flex items-center gap-2 rounded-full border border-emerald-700 bg-emerald-900/30 px-3 py-1 text-xs text-emerald-200",children:[(0,d.jsx)("span",{className:"inline-block h-1.5 w-1.5 rounded-full bg-emerald-400","aria-hidden":!0}),(0,d.jsx)("span",{className:"font-medium",children:"Relocated to:"}),(0,d.jsx)("span",{className:"text-emerald-100",children:ar||"—"}),(0,d.jsx)("span",{className:"text-emerald-300",children:at||m.timezone||"—"})]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("p",{className:"text-xs text-slate-500",children:"All processing is geometry-first and non-deterministic. Your data isn’t stored."}),(0,d.jsxs)("div",{className:"mr-2 hidden sm:flex items-center gap-2 text-[11px] text-slate-400",children:[(0,d.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-800 px-2 py-0.5",children:[(0,d.jsx)("span",{className:"text-slate-300",children:"Mode:"}),(0,d.jsx)("span",{className:"text-slate-100",children:y.replace(/_/g," ")})]}),(0,d.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-800 px-2 py-0.5",children:[(0,d.jsx)("span",{className:"text-slate-300",children:"Report:"}),(0,d.jsx)("span",{className:"text-slate-100 capitalize",children:aA})]})]}),(0,d.jsx)("button",{type:"submit",disabled:aP,className:"inline-flex items-center rounded-md px-4 py-2 text-white disabled:opacity-50 bg-indigo-600 hover:bg-indigo-500",children:C?"Mapping geometry…":"balance"===aA?"Generate Report":"Prepare Mirror"})]}),["SYNASTRY","SYNASTRY_TRANSITS","COMPOSITE","DUAL_NATAL_TRANSITS"].includes(y)&&!I&&(0,d.jsx)("p",{className:"mt-2 text-xs text-amber-400",children:"Hint: Toggle “Include Person B” and fill in required fields to enable relational modes."})]})]})]}),E&&(0,d.jsxs)("div",{className:"mt-6 rounded-md border border-red-700 bg-red-900/30 p-4 text-red-200",children:[(0,d.jsx)("p",{className:"font-medium",children:"Error"}),(0,d.jsx)("p",{className:"mt-1 text-sm",children:E})]}),C&&(0,d.jsxs)("div",{className:"mt-8 grid grid-cols-1 gap-6 print:hidden",children:[(0,d.jsxs)("section",{className:"rounded-lg border border-slate-700 bg-slate-800/60 p-4",children:[(0,d.jsx)("div",{className:"h-5 w-40 rounded bg-slate-700 animate-pulse"}),(0,d.jsxs)("div",{className:"mt-4 grid grid-cols-3 gap-3",children:[(0,d.jsx)("div",{className:"h-16 rounded bg-slate-700/70 animate-pulse"}),(0,d.jsx)("div",{className:"h-16 rounded bg-slate-700/70 animate-pulse"}),(0,d.jsx)("div",{className:"h-16 rounded bg-slate-700/70 animate-pulse"})]})]}),(0,d.jsxs)("section",{className:"rounded-lg border border-slate-700 bg-slate-800/60 p-4",children:[(0,d.jsx)("div",{className:"h-5 w-56 rounded bg-slate-700 animate-pulse"}),(0,d.jsx)("div",{className:"mt-4 h-24 rounded bg-slate-700/60 animate-pulse"})]})]}),G&&(0,d.jsxs)("div",{className:"mt-8 grid grid-cols-1 gap-6",children:[(()=>{let a=G?.person_a?.meta||G?.provenance?.time_meta_a;if(!a)return null;let b=!!a.houses_suppressed,c=String(a.time_precision||""),e=a.effective_time_used;return(0,d.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[b&&(0,d.jsx)("div",{className:"rounded-md border border-slate-700 bg-slate-800/70 px-3 py-1 text-xs text-slate-200",children:"Angles unavailable without birth time; houses suppressed."}),e&&(0,d.jsxs)("div",{className:"inline-flex items-center gap-2 rounded-full border border-emerald-700 bg-emerald-900/30 px-3 py-1 text-xs text-emerald-200",children:[(0,d.jsx)("span",{className:"inline-block h-1.5 w-1.5 rounded-full bg-emerald-400","aria-hidden":!0}),(0,d.jsx)("span",{className:"font-medium",children:"Effective time"}),(0,d.jsx)("span",{className:"text-emerald-100",children:e})]}),"unknown"===c&&"planetary_only"===ab&&(0,d.jsx)("div",{className:"rounded-md border border-amber-700 bg-amber-900/30 px-3 py-1 text-xs text-amber-200",children:"Using planetary-only mode. You can run a sensitivity scan for house-dependent work."})]})})(),(0,d.jsxs)("div",{className:"flex items-center justify-between gap-4 print:hidden",children:[(0,d.jsx)("div",{className:"text-sm text-slate-400",children:(0,d.jsxs)("span",{children:["Download your report, then visit ",(0,d.jsx)("a",{href:"/chat",className:"text-emerald-400 hover:text-emerald-300 underline",children:"Poetic Brain"})," to upload it for interpretation."]})}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("button",{type:"button",onClick:function(){if(G)try{let a=new Blob([JSON.stringify(G,null,2)],{type:"application/json"}),b=URL.createObjectURL(a),c=document.createElement("a"),d=new Date().toISOString().slice(0,10).replace(/-/g,"");c.href=b,c.download=`math-brain-result-${d}.json`,document.body.appendChild(c),c.click(),c.remove(),URL.revokeObjectURL(b);try{az("Downloading result JSON"),setTimeout(()=>az(null),1400)}catch{}}catch{}},className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-1.5 text-slate-100 hover:bg-slate-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400","aria-label":"Download result JSON",children:"Download JSON"}),(0,d.jsx)("button",{type:"button",onClick:aL,className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-1.5 text-slate-100 hover:bg-slate-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400","aria-label":"Download PDF",children:"Download PDF"})]})]}),"balance"===aA&&(0,d.jsxs)(d.Fragment,{children:[Object.keys(G?.person_a?.chart?.transitsByDate||{}).length>0?null:(0,d.jsx)("div",{className:"rounded-md border border-amber-700 bg-amber-900/30 p-3 text-amber-200",children:(0,d.jsx)("p",{className:"text-sm",children:"No daily series data returned. Double-check your dates, step, and inputs, then try again. If this persists, view the Raw Result (debug) below."})}),(()=>{let a=G?.woven_map;if(!a?.hook_stack?.hooks?.length)return null;let b=a.hook_stack.hooks||[];return(0,d.jsxs)(k,{title:"Hook Stack — Recognition Gateway",children:[(0,d.jsxs)("div",{className:"mb-3 text-sm text-slate-400",children:["Front-door UX: ",b.length," high-charge patterns from tightest aspects",a.hook_stack.tier_1_orbs>0&&` \xb7 ${a.hook_stack.tier_1_orbs} Tier-1 (≤1\xb0)`,"\xb7 Coverage: ",a.hook_stack.coverage]}),(0,d.jsx)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:b.map((a,b)=>(0,d.jsxs)("div",{className:"rounded-md border border-amber-600/30 bg-amber-900/20 p-4",children:[(0,d.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,d.jsx)("div",{className:"text-amber-100 font-medium leading-tight",children:a.title}),a.is_tier_1&&(0,d.jsx)("span",{className:"ml-2 inline-flex items-center rounded bg-amber-600 px-1.5 py-0.5 text-xs font-medium text-amber-100",children:"T1"})]}),(0,d.jsxs)("div",{className:"text-xs text-amber-200/70 space-y-1",children:[(0,d.jsxs)("div",{children:["Orb: ",a.orb?.toFixed(1),"\xb0 \xb7 Intensity: ",Math.round(a.intensity)]}),(0,d.jsxs)("div",{children:[a.planets?.join(" ")||""," ",a.aspect_type]})]})]},b))}),(0,d.jsx)("div",{className:"mt-3 text-xs text-slate-400",children:'Purpose: Bypass analysis → trigger "that\'s me" recognition → open depth work'})]})})(),(()=>{let a=G?.woven_map;if(!a)return null;let b=a.integration_factors||{},c=Array.isArray(a.time_series)?a.time_series:[],e=c[0]?.date,f=c[c.length-1]?.date;return(0,d.jsxs)(k,{title:"Woven Map (data-only)",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-slate-300",children:"Integration Factors"}),(0,d.jsx)("div",{className:"mt-2 space-y-2",children:[{key:"fertile_field",label:"Fertile Field"},{key:"harmonic_resonance",label:"Harmonic Resonance"},{key:"expansion_lift",label:"Expansion Lift"},{key:"combustion_clarity",label:"Combustion Clarity"},{key:"liberation_release",label:"Liberation / Release"},{key:"integration",label:"Integration"}].map(({key:a,label:c})=>{let e=Math.max(0,Math.min(100,Number(b[a]??0)));return(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-400",children:[(0,d.jsx)("span",{children:c}),(0,d.jsxs)("span",{children:[e,"%"]})]}),(0,d.jsxs)("svg",{viewBox:"0 0 100 6",className:"h-1.5 w-full",children:[(0,d.jsx)("rect",{x:"0",y:"0",width:"100",height:"6",className:"fill-slate-700"}),(0,d.jsx)("rect",{x:"0",y:"0",width:e,height:"6",className:"fill-emerald-500"})]})]},String(a))})})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-slate-300",children:"Time Series"}),(0,d.jsxs)("div",{className:"mt-2 text-xs text-slate-400",children:["Entries: ",c.length||0,e&&f?` \xb7 ${e} → ${f}`:""]}),(0,d.jsx)("div",{className:"mt-2 max-h-40 overflow-auto rounded border border-slate-700 bg-slate-900/40 p-2",children:(0,d.jsxs)("table",{className:"w-full text-xs text-slate-300",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"text-slate-400",children:[(0,d.jsx)("th",{className:"text-left font-medium",children:"Date"}),(0,d.jsx)("th",{className:"text-right font-medium",children:"Mag"}),(0,d.jsx)("th",{className:"text-right font-medium",children:"Val"}),(0,d.jsx)("th",{className:"text-right font-medium",children:"Vol"})]})}),(0,d.jsx)("tbody",{children:c.slice(-10).map((a,b)=>(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"py-0.5 pr-2",children:a.date}),(0,d.jsx)("td",{className:"py-0.5 text-right",children:Number(a.magnitude??0).toFixed(2)}),(0,d.jsx)("td",{className:"py-0.5 text-right",children:Number(a.valence??0).toFixed(2)}),(0,d.jsx)("td",{className:"py-0.5 text-right",children:Number(a.volatility??0).toFixed(2)})]},b))})]})})]})]}),(0,d.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-3 sm:grid-cols-4",children:[(0,d.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,d.jsx)("div",{className:"text-xs text-slate-400",children:"Natal aspects (A)"}),(0,d.jsx)("div",{className:"text-lg text-slate-100",children:a.natal_summary?.major_aspects?.length??0})]}),(0,d.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,d.jsx)("div",{className:"text-xs text-slate-400",children:"Polarity cards (hooks)"}),(0,d.jsx)("div",{className:"text-lg text-slate-100",children:Array.isArray(a.polarity_cards)?a.polarity_cards.length:0})]}),(0,d.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,d.jsx)("div",{className:"text-xs text-slate-400",children:"Report type"}),(0,d.jsx)("div",{className:"text-lg text-slate-100 capitalize",children:a.type||"solo"})]}),(0,d.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,d.jsx)("div",{className:"text-xs text-slate-400",children:"Schema"}),(0,d.jsx)("div",{className:"text-xs text-slate-100",children:a.schema})]})]})]})})(),(()=>{let a=G?.context;if(!a?.translocation)return null;let b=a.translocation;return(0,d.jsx)(k,{title:"Translocation Context",className:"print:hidden",children:(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4 text-sm text-slate-300",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-xs text-slate-400",children:"Applies"}),(0,d.jsx)("div",{className:"text-slate-100",children:b.applies?"Yes":"No"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-xs text-slate-400",children:"Method"}),(0,d.jsx)("div",{className:"text-slate-100",children:(()=>{let a=String(b.method||"Natal");return/^A[_ ]?local$/i.test(a)||"A_local"===a?"Person A":/^B[_ ]?local$/i.test(a)||"B_local"===a?"Person B":/^midpoint$/i.test(a)?"Person A + B":/^natal$/i.test(a)?"None (Natal Base)":a})()})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-xs text-slate-400",children:"House System"}),(0,d.jsx)("div",{className:"text-slate-100",children:b.house_system||"Placidus"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-xs text-slate-400",children:"TZ"}),(0,d.jsx)("div",{className:"text-slate-100",children:b.tz||m?.timezone||"—"})]})]})})})(),(()=>{let a=G?.person_a?.derived?.seismograph_summary;if(!a)return null;let b=Number(a.magnitude??0),c=Number(a.valence??0),e=Number(a.volatility??0),f=b>=3?"Surge":b>=1?"Active":"Calm",g=c>.5?"Supportive":c<-.5?"Challenging":"Mixed",h=e>=3?"Scattered":e>=1?"Variable":"Stable";return(0,d.jsxs)(k,{title:"Balance Meter",children:[(0,d.jsxs)("div",{className:"flex flex-wrap items-center gap-3 text-sm",children:[(0,d.jsxs)("span",{className:"inline-flex items-center gap-2 rounded bg-slate-700/60 px-3 py-1 text-slate-100",children:[(0,d.jsx)("span",{children:"⚡"}),(0,d.jsx)("span",{children:"Magnitude"}),(0,d.jsxs)("span",{className:"text-slate-300",children:["\xb7 ",f]})]}),(0,d.jsxs)("span",{className:"inline-flex items-center gap-2 rounded bg-slate-700/60 px-3 py-1 text-slate-100",children:[(0,d.jsx)("span",{children:"\uD83C\uDF13"}),(0,d.jsx)("span",{children:"Valence"}),(0,d.jsxs)("span",{className:"text-slate-300",children:["\xb7 ",g]})]}),(0,d.jsxs)("span",{className:"inline-flex items-center gap-2 rounded bg-slate-700/60 px-3 py-1 text-slate-100",children:[(0,d.jsx)("span",{children:"\uD83D\uDD37"}),(0,d.jsx)("span",{children:"Volatility"}),(0,d.jsxs)("span",{className:"text-slate-300",children:["\xb7 ",h]})]})]}),(()=>{let a=G?.person_a?.chart?.transitsByDate||{},b=Object.keys(a).sort();if(!b.length)return null;let c=b.map(b=>({date:b,magnitude:Number(a[b]?.seismograph?.magnitude??0),valence:Number(a[b]?.seismograph?.valence??0),volatility:Number(a[b]?.seismograph?.volatility??0)})),e="weekly"===A?(()=>{let a=[];for(let b=0;b<c.length;b+=7){let d=c.slice(b,b+7);if(!d.length)continue;let e=a=>a.reduce((a,b)=>a+b,0)/a.length,f=a=>a.reduce((a,b)=>Math.max(a,b),-1/0),g="max"===aJ?f:e;a.push([{date:d[0].date,magnitude:Number(g(d.map(a=>a.magnitude)).toFixed(2)),valence:Number(g(d.map(a=>a.valence)).toFixed(2)),volatility:Number(g(d.map(a=>a.volatility)).toFixed(2))}])}return a.map(a=>a[0])})():c,f=Math.min(28,e.length),g=e.slice(-f);return(0,d.jsxs)("div",{className:"mt-4",children:[(0,d.jsx)("div",{className:"mb-1 text-[11px] text-slate-400",children:"Legend: ⚡ Magnitude \xb7 \uD83C\uDF13 Valence \xb7 \uD83D\uDD37 Volatility"}),(0,d.jsxs)("div",{className:"mb-1 flex justify-between text-[10px] text-slate-500",children:[(0,d.jsx)("span",{children:"Top ≈ 5"}),(0,d.jsx)("span",{children:"Date labels show MM-DD"})]}),(()=>{let a=g[0]?.date,b=g[g.length-1]?.date;return a&&b?(0,d.jsxs)("div",{className:"mb-1 text-[10px] text-slate-500",children:[a," | ",b]}):null})(),(0,d.jsx)("div",{className:"flex items-end gap-2 overflow-x-auto rounded border border-slate-700 bg-slate-900/40 p-2",children:g.map((a,b)=>{let c=Math.max(0,Math.min(96,Math.round(a.magnitude/5*96))),e=Math.max(0,Math.min(96,Math.round(Math.min(5,Math.abs(a.valence))/5*96))),f=Math.max(0,Math.min(96,Math.round(a.volatility/5*96)));return(0,d.jsxs)("div",{className:"flex w-6 flex-col items-center justify-end gap-0.5",children:[(0,d.jsxs)("svg",{width:"16",height:"96",viewBox:"0 0 16 96",className:"block",children:[(0,d.jsx)("rect",{x:"0",y:96-c,width:"5",height:c,className:"fill-indigo-500 opacity-80"}),(0,d.jsx)("rect",{x:"6",y:96-e,width:"4",height:e,className:"fill-emerald-500 opacity-70"}),(0,d.jsx)("rect",{x:"11",y:96-f,width:"5",height:f,className:"fill-sky-500 opacity-70"})]}),(0,d.jsx)("div",{className:"text-[10px] text-center text-slate-400 truncate w-full",title:a.date,children:a.date.slice(5)})]},b)})})]})})(),(0,d.jsx)("div",{className:"mt-4 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-3",children:(()=>{let a=Math.min(1,Math.max(0,b/5)),f=Math.min(1,Math.max(0,e/5)),g=(Math.max(-2,Math.min(2,c))+2)/4;return[{name:"Fertile Field",hint:"Growth-friendly openings",score:.7*g+(1-f)*.3},{name:"Harmonic Resonance",hint:"Easier flow and alignment",score:.6*g+(1-f)*.4},{name:"Expansion Lift",hint:"Momentum and reach",score:.6*a+.4*g},{name:"Combustion Clarity",hint:"Honest frictions surface",score:.5*a+.5*f},{name:"Liberation / Release",hint:"Letting go, reset",score:.7*f+(1-g)*.3},{name:"Integration",hint:"Synthesis and grounding",score:(1-f)*.6+.4*g}].map((a,b)=>{let c=Math.round(100*a.score);return(0,d.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-800/50 p-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("div",{className:"text-slate-100 font-medium",children:a.name}),(0,d.jsxs)("div",{className:"text-xs text-slate-400",children:[c,"%"]})]}),(0,d.jsxs)("svg",{viewBox:"0 0 100 8",className:"mt-2 h-2 w-full",children:[(0,d.jsx)("rect",{x:"0",y:"0",width:"100",height:"8",className:"fill-slate-700"}),(0,d.jsx)("rect",{x:"0",y:"0",width:c,height:"8",className:"fill-emerald-500"})]}),(0,d.jsx)("p",{className:"mt-2 text-xs text-slate-400",children:a.hint})]},b)})})()}),(0,d.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-3 sm:grid-cols-4",children:[(0,d.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,d.jsx)("div",{className:"text-xs text-slate-400",children:"Magnitude"}),(0,d.jsx)("div",{className:"text-lg text-slate-100",children:b.toFixed(2)})]}),(0,d.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,d.jsx)("div",{className:"text-xs text-slate-400",children:"Valence"}),(0,d.jsx)("div",{className:"text-lg text-slate-100",children:c.toFixed(2)})]}),(0,d.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,d.jsx)("div",{className:"text-xs text-slate-400",children:"Volatility"}),(0,d.jsx)("div",{className:"text-lg text-slate-100",children:e.toFixed(2)})]}),(0,d.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900/40 p-3 text-center",children:[(0,d.jsx)("div",{className:"text-xs text-slate-400",children:"SFD"}),(0,d.jsx)("div",{className:"text-lg text-slate-100",children:G?.person_a?.sfd?.sfd??"—"})]})]})]})})()]})]})]})}},72513:(a,b,c)=>{"use strict";function d(a,b,c){let d="balance"===a||"mirror"===a&&b,e=c?.latitude,f=c?.longitude,g="number"==typeof e||"string"==typeof e&&""!==e.trim()&&Number.isFinite(Number(e)),h="number"==typeof f||"string"==typeof f&&""!==f.trim()&&Number.isFinite(Number(f)),i=!!c?.timezone,j=!!c&&g&&h&&i,k="number"==typeof c?.hour||"string"==typeof c?.hour&&""!==c.hour,l="number"==typeof c?.minute||"string"==typeof c?.minute&&""!==c.minute;return{needsLoc:d,hasLoc:j,hasBirthTime:k&&l,canSubmit:!d||d&&j}}function e(a){let b=a.translocation;return b&&b.applies?{active:!0,lens:`${b.current_location}${b.house_system?" ("+b.house_system+")":""}`,disclosure:`Relocation ON – Houses remapped to ${b.current_location}`,invariants:"Planetary geometry identical; only arena (House channels) shifted"}:{active:!1,lens:b?.current_location||"Natal Base",disclosure:"Relocation OFF – natal House mapping in effect",invariants:"Planets, signs, aspects as computed from natal coordinates"}}function f(a){if(!a)return!0;let b="number"==typeof a.hour||"string"==typeof a.hour&&""!==a.hour,c="number"==typeof a.minute||"string"==typeof a.minute&&""!==a.minute;return!(b&&c)}c.d(b,{Et:()=>e,S5:()=>f,Vs:()=>d})},75034:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,81170,23))},77731:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>e});var d=c(21124);function e({error:a,reset:b}){return(0,d.jsx)("html",{children:(0,d.jsx)("body",{style:{fontFamily:"ui-sans-serif, system-ui",background:"#0f1115",color:"#e8ecf3",minHeight:"100vh",padding:"24px"},children:(0,d.jsxs)("div",{style:{maxWidth:860,margin:"0 auto"},children:[(0,d.jsx)("h1",{style:{fontSize:28,marginBottom:8},children:"Something went wrong"}),(0,d.jsx)("p",{style:{opacity:.9,marginBottom:16},children:"An error occurred while rendering this page."}),(0,d.jsx)("pre",{style:{whiteSpace:"pre-wrap",background:"#111827",padding:12,borderRadius:8,border:"1px solid #1f2937",overflow:"auto"},children:String(a?.message||"Unknown error")}),a?.digest?(0,d.jsxs)("p",{style:{opacity:.7,marginTop:8},children:["Digest: ",a.digest]}):null,(0,d.jsx)("button",{onClick:b,style:{marginTop:16,background:"#7c5cff",border:"none",padding:"10px 16px",borderRadius:8,color:"#fff",cursor:"pointer"},children:"Try again"})]})})})}},78335:()=>{},81945:(a,b,c)=>{Promise.resolve().then(c.bind(c,77731))},82704:()=>{},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},96487:()=>{},96600:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>g,metadata:()=>f});var d=c(75338);c(74515),c(82704);let e="Raven Calder",f={title:`${e} \xb7 Chat`,description:`${e} diagnostic chat`};function g({children:a}){return(0,d.jsxs)("html",{lang:"en",suppressHydrationWarning:!0,children:[(0,d.jsx)("head",{children:(0,d.jsx)("link",{rel:"stylesheet",href:"/dist/output.css"})}),(0,d.jsx)("body",{suppressHydrationWarning:!0,className:"app antialiased",children:a})]})}},97064:(a,b,c)=>{Promise.resolve().then(c.bind(c,72472))},97666:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>D.a,__next_app__:()=>L,handler:()=>N,routeModule:()=>M});var d=c(49754),e=c(9117),f=c(46595),g=c(32324),h=c(39326),i=c(38928),j=c(20175),k=c(12),l=c(54290),m=c(12696),n=c(82802),o=c(77533),p=c(45229),q=c(32822),r=c(261),s=c(26453),t=c(52474),u=c(26713),v=c(51356),w=c(62685),x=c(36225),y=c(63446),z=c(2762),A=c(45742),B=c(86439),C=c(81170),D=c.n(C),E=c(62506),F=c(91203),G=c(70722),H=c(37422),I=c(43954),J={};for(let a in E)0>["default","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(J[a]=()=>E[a]);c.d(b,J);let K={children:["",{children:["math-brain",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,71718)),"/Users/dancross/Documents/GitHub/WovenWebApp/app/math-brain/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(c.bind(c,96600)),"/Users/dancross/Documents/GitHub/WovenWebApp/app/layout.tsx"],error:[()=>Promise.resolve().then(c.bind(c,41697)),"/Users/dancross/Documents/GitHub/WovenWebApp/app/error.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,81170,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.bind(c,8595)),"/Users/dancross/Documents/GitHub/WovenWebApp/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,90461,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,32768,23)),"next/dist/client/components/builtin/unauthorized.js"]}]}.children,L={require:c,loadChunk:()=>Promise.resolve()},M=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/math-brain/page",pathname:"/math-brain",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:K},distDir:".next",relativeProjectDir:""});async function N(a,b,d){var C;let J="/math-brain/page";"/index"===J&&(J="/");let O=(0,h.getRequestMeta)(a,"minimalMode"),P=await M.prepare(a,b,{srcPage:J,multiZoneDraftMode:!1});if(!P)return b.statusCode=400,b.end("Bad Request"),null==d.waitUntil||d.waitUntil.call(d,Promise.resolve()),null;let{buildId:Q,query:R,params:S,pageIsDynamic:T,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,serverActionsManifest:X,clientReferenceManifest:Y,subresourceIntegrityManifest:Z,prerenderManifest:$,isDraftMode:_,resolvedPathname:aa,revalidateOnlyGenerated:ab,routerServerContext:ac,nextConfig:ad,interceptionRoutePatterns:ae}=P,af=(0,r.normalizeAppPath)(J),{isOnDemandRevalidate:ag}=P,ah=ad.experimental.ppr&&!ad.experimental.cacheComponents&&(0,I.isInterceptionRouteAppPath)(aa)?null:M.match(aa,$),ai=!!$.routes[aa],aj=a.headers["user-agent"]||"",ak=(0,u.getBotType)(aj),al=(0,p.isHtmlBotRequest)(a),am=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??"1"===a.headers[t.NEXT_ROUTER_PREFETCH_HEADER],an=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[t.RSC_HEADER],ao=(0,s.getIsPossibleServerAction)(a),ap=(0,m.checkIsAppPPREnabled)(ad.experimental.ppr)&&(null==(C=$.routes[af]??$.dynamicRoutes[af])?void 0:C.renderingMode)==="PARTIALLY_STATIC",aq=!1,ar=!1,as=ap?(0,h.getRequestMeta)(a,"postponed"):void 0,at=ap&&an&&!am,au=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),av=(!al||!ap)&&(!aj||(0,p.shouldServeStreamingMetadata)(aj,ad.htmlLimitedBots)),aw=!!((ah||ai||$.routes[af])&&!(al&&ap)),ax=ap&&!0===ad.experimental.rdcForNavigations&&!0===ad.experimental.clientParamParsing,ay=!0===M.isDev||!aw||"string"==typeof as||(ax&&(0,h.getRequestMeta)(a,"onCacheEntryV2")?at&&!O:at),az=al&&ap,aA=null;_||!aw||ay||ao||as||at||(aA=aa);let aB=aA;!aB&&M.isDev&&(aB=aa),M.isDev||_||!aw||!an||at||(0,k.d)(a.headers);let aC={...E,tree:K,GlobalError:D(),handler:N,routeModule:M,__next_app__:L};X&&Y&&(0,o.setReferenceManifestsSingleton)({page:J,clientReferenceManifest:Y,serverActionsManifest:X,serverModuleMap:(0,q.createServerModuleMap)({serverActionsManifest:X})});let aD=a.method||"GET",aE=(0,g.getTracer)(),aF=aE.getActiveScopeSpan();try{let f=M.getVaryHeader(aa,ae);b.setHeader("Vary",f);let k=async(c,d)=>{let e=new l.NodeNextRequest(a),f=new l.NodeNextResponse(b);return M.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let a=aE.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let d=a.get("next.route");if(d){let a=`${aD} ${d}`;c.setAttributes({"next.route":d,"http.route":d,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aD} ${J}`)})},m=(0,h.getRequestMeta)(a,"incrementalCache"),o=async({span:e,postponed:f,fallbackRouteParams:g,forceStaticRender:i})=>{let l={query:R,params:S,page:af,sharedContext:{buildId:Q},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aC,Component:(0,j.T)(aC),params:S,routeModule:M,page:J,postponed:f,shouldWaitOnAllReady:az,serveStreamingMetadata:av,supportsDynamicResponse:"string"==typeof f||ay,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,subresourceIntegrityManifest:Z,serverActionsManifest:X,clientReferenceManifest:Y,setIsrStatus:null==ac?void 0:ac.setIsrStatus,setReactDebugChannel:null==ac?void 0:ac.setReactDebugChannel,dir:c(33873).join(process.cwd(),M.relativeProjectDir),isDraftMode:_,botType:ak,isOnDemandRevalidate:ag,isPossibleServerAction:ao,assetPrefix:ad.assetPrefix,nextConfigOutput:ad.output,crossOrigin:ad.crossOrigin,trailingSlash:ad.trailingSlash,previewProps:$.preview,deploymentId:ad.deploymentId,enableTainting:ad.experimental.taint,htmlLimitedBots:ad.htmlLimitedBots,reactMaxHeadersLength:ad.reactMaxHeadersLength,multiZoneDraftMode:!1,incrementalCache:m,cacheLifeProfiles:ad.experimental.cacheLife,basePath:ad.basePath,serverActions:ad.experimental.serverActions,...aq||ar?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isDebugDynamicAccesses:aq}:{},experimental:{isRoutePPREnabled:ap,expireTime:ad.expireTime,staleTimes:ad.experimental.staleTimes,cacheComponents:!!ad.experimental.cacheComponents,clientSegmentCache:!!ad.experimental.clientSegmentCache,clientParamParsing:!!ad.experimental.clientParamParsing,dynamicOnHover:!!ad.experimental.dynamicOnHover,inlineCss:!!ad.experimental.inlineCss,authInterrupts:!!ad.experimental.authInterrupts,clientTraceMetadata:ad.experimental.clientTraceMetadata||[],clientParamParsingOrigins:ad.experimental.clientParamParsingOrigins},waitUntil:d.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>M.onRequestError(a,b,d,ac),err:(0,h.getRequestMeta)(a,"invokeError"),dev:M.isDev}};aq&&(l.renderOpts.nextExport=!0,l.renderOpts.supportsDynamicResponse=!1,l.renderOpts.isDebugDynamicAccesses=aq),i&&(l.renderOpts.supportsDynamicResponse=!1);let n=await k(e,l),{metadata:o}=n,{cacheControl:p,headers:q={},fetchTags:r,fetchMetrics:s}=o;if(r&&(q[y.NEXT_CACHE_TAGS_HEADER]=r),a.fetchMetrics=s,aw&&(null==p?void 0:p.revalidate)===0&&!M.isDev&&!ap){let a=o.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${aa}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:v.CachedRouteKind.APP_PAGE,html:n,headers:q,rscData:o.flightData,postponed:o.postponed,status:o.statusCode,segmentData:o.segmentData},cacheControl:p}},p=async({hasResolved:c,previousCacheEntry:f,isRevalidating:g,span:i,forceStaticRender:j=!1})=>{let k,l=!1===M.isDev,q=c||b.writableEnded;if(ag&&ab&&!f&&!O)return(null==ac?void 0:ac.render404)?await ac.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ah&&(k=(0,w.parseFallbackField)(ah.fallback)),k===w.FallbackMode.PRERENDER&&(0,u.isBot)(aj)&&(!ap||al)&&(k=w.FallbackMode.BLOCKING_STATIC_RENDER),(null==f?void 0:f.isStale)===-1&&(ag=!0),ag&&(k!==w.FallbackMode.NOT_FOUND||f)&&(k=w.FallbackMode.BLOCKING_STATIC_RENDER),!O&&k!==w.FallbackMode.BLOCKING_STATIC_RENDER&&aB&&!q&&!_&&T&&(l||!ai)){if((l||ah)&&k===w.FallbackMode.NOT_FOUND)throw new B.NoFallbackError;if(ap&&(ad.experimental.clientParamParsing?!at:!an)){let b=l&&"string"==typeof(null==ah?void 0:ah.fallback)?ah.fallback:af,c=l&&(null==ah?void 0:ah.fallbackRouteParams)?(0,n.createOpaqueFallbackRouteParams)(ah.fallbackRouteParams):ar?(0,n.getFallbackRouteParams)(af,M):null,f=await M.handleResponse({cacheKey:b,req:a,nextConfig:ad,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:$,isRoutePPREnabled:ap,responseGenerator:async()=>o({span:i,postponed:void 0,fallbackRouteParams:c,forceStaticRender:!1}),waitUntil:d.waitUntil});if(null===f)return null;if(f)return delete f.cacheControl,f}}let r=ag||g||!as?void 0:as;if(ax&&!O&&m&&at&&!j){let b=await m.get(aa,{kind:v.IncrementalCacheKind.APP_PAGE,isRoutePPREnabled:!0,isFallback:!1,allowStale:!0});b&&b.value&&b.value.kind===v.CachedRouteKind.APP_PAGE&&(r=b.value.postponed,b&&(-1===b.isStale||!0===b.isStale)&&(0,H.scheduleOnNextTick)(async()=>{let b=M.getResponseCache(a);try{await b.revalidate(aa,m,ap,!1,a=>p({...a,forceStaticRender:!0}),null,c,d.waitUntil)}catch(a){console.error("Error revalidating the page in the background",a)}}))}if(aq&&void 0!==r)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:v.CachedRouteKind.PAGES,html:x.default.EMPTY,pageData:{},headers:void 0,status:void 0}};let s=l&&(null==ah?void 0:ah.fallbackRouteParams)&&(0,h.getRequestMeta)(a,"renderFallbackShell")?(0,n.createOpaqueFallbackRouteParams)(ah.fallbackRouteParams):ar?(0,n.getFallbackRouteParams)(af,M):null;return o({span:i,postponed:r,fallbackRouteParams:s,forceStaticRender:j})},q=async c=>{var f,g,i,j,k;let l,m=await M.handleResponse({cacheKey:aA,responseGenerator:a=>p({span:c,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:ag,isRoutePPREnabled:ap,req:a,nextConfig:ad,prerenderManifest:$,waitUntil:d.waitUntil});if(_&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),M.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!m){if(aA)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(f=m.value)?void 0:f.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(i=m.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let n="string"==typeof m.value.postponed;aw&&!at&&(!n||am)&&(O||b.setHeader("x-nextjs-cache",ag?"REVALIDATED":m.isMiss?"MISS":m.isStale?"STALE":"HIT"),b.setHeader(t.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=m;if(as)l={revalidate:0,expire:void 0};else if(at)l={revalidate:0,expire:void 0};else if(!M.isDev)if(_)l={revalidate:0,expire:void 0};else if(aw){if(m.cacheControl)if("number"==typeof m.cacheControl.revalidate){if(m.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${m.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});l={revalidate:m.cacheControl.revalidate,expire:(null==(j=m.cacheControl)?void 0:j.expire)??ad.expireTime}}else l={revalidate:y.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(l={revalidate:0,expire:void 0});if(m.cacheControl=l,"string"==typeof au&&(null==q?void 0:q.kind)===v.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(k=q.headers)?void 0:k[y.NEXT_CACHE_TAGS_HEADER];O&&aw&&c&&"string"==typeof c&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(au);return void 0!==d?(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(d,t.RSC_CONTENT_TYPE_HEADER),cacheControl:m.cacheControl}):(b.statusCode=204,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:m.cacheControl}))}let r=ax?(0,h.getRequestMeta)(a,"onCacheEntryV2")??(0,h.getRequestMeta)(a,"onCacheEntry"):(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r(m,{url:(0,h.getRequestMeta)(a,"initURL")??a.url}))return null;if(q.headers){let a={...q.headers};for(let[c,d]of(O&&aw||delete a[y.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let s=null==(g=q.headers)?void 0:g[y.NEXT_CACHE_TAGS_HEADER];if(O&&aw&&s&&"string"==typeof s&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,s),!q.status||an&&ap||(b.statusCode=q.status),!O&&q.status&&F.RedirectStatusCode[q.status]&&an&&(b.statusCode=200),n&&!at&&b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"1"),an&&!_){if(void 0===q.rscData){if(q.html.contentType!==t.RSC_CONTENT_TYPE_HEADER)if(ad.experimental.clientParamParsing)return b.statusCode=404,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:m.cacheControl});else throw Object.defineProperty(new G.InvariantError(`Expected RSC response, got ${q.html.contentType}`),"__NEXT_ERROR_CODE",{value:"E789",enumerable:!1,configurable:!0});return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:q.html,cacheControl:m.cacheControl})}return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(q.rscData,t.RSC_CONTENT_TYPE_HEADER),cacheControl:m.cacheControl})}let u=q.html;if(!n||O||an)return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:m.cacheControl});if(aq)return u.push(new ReadableStream({start(a){a.enqueue(z.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}});let w=new TransformStream;return u.push(w.readable),o({span:c,postponed:q.postponed,fallbackRouteParams:null,forceStaticRender:!1}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(w.writable)}).catch(a=>{w.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}})};if(!aF)return await aE.withPropagatedContext(a.headers,()=>aE.trace(i.BaseServerSpan.handleRequest,{spanName:`${aD} ${J}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aD,"http.target":a.url}},q));await q(aF)}catch(b){throw b instanceof B.NoFallbackError||await M.onRequestError(a,b,{routerKind:"App Router",routePath:J,routeType:"render",revalidateReason:(0,f.c)({isStaticGeneration:aw,isOnDemandRevalidate:ag})},ac),b}}}};var b=require("../../webpack-runtime.js");b.C(a);var c=b.X(0,[828,428,711],()=>b(b.s=97666));module.exports=c})();