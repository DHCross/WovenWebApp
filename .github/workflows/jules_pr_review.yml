name: JULES PR Reviewer

# This action triggers whenever a pull request is opened
# Disabled - change to manual trigger only
on:
  workflow_dispatch:
    inputs:
      pr_number:
        description: 'Pull request number to review'
        required: true
        type: number
      branch:
        description: 'Branch name to review'
        required: true
        type: string
# Automatic trigger disabled:
#  pull_request:
#    types: [opened]

jobs:
  evaluate-pull-request:
    runs-on: ubuntu-latest
    steps:
      - name: Call JULES API for PR Evaluation
        run: |
          curl -X POST 'https://jules.googleapis.com/v1alpha/sessions' \
          -H "Content-Type: application/json" \
          -H "X-Goog-Api-Key: ${{ secrets.JULES_API }}" \
          -d '{
            "prompt": "Please review the code changes in this pull request. Look for potential bugs, style issues, or areas for improvement. Provide a summary of your findings.",
            "sourceContext": {
              "source": "sources/github/${{ github.repository }}",
              "githubRepoContext": {
                "startingBranch": "${{ inputs.branch }}"
              }
            },
            "automationMode": "AUTO_CREATE_PR",
            "title": "JULES Review for PR #${{ inputs.pr_number }}"
          }'
