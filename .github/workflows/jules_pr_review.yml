name: JULES PR Reviewer

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch name to review'
        required: true
        type: string
        
jobs:
  evaluate-pull-request:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Get PR number from branch
        id: pr
        run: |
          PR_NUMBER=$(gh pr list --head "${{ inputs.branch }}" --json number --jq '.[0].number')
          if [ -z "$PR_NUMBER" ]; then
            echo "No PR found for branch ${{ inputs.branch }}"
            exit 1
          fi
          echo "pr_number=$PR_NUMBER" >> $GITHUB_OUTPUT
        env:
          GH_TOKEN: ${{ github.token }}
          
      - name: Call JULES API for PR Evaluation
        run: |
          curl -X POST 'https://jules.googleapis.com/v1alpha/sessions' \
            -H "Content-Type: application/json" \
            -H "X-Goog-Api-Key: ${{ secrets.JULES_API }}" \
            -d '{
              "pr_number": "${{ steps.pr.outputs.pr_number }}",
              "branch": "${{ inputs.branch }}"
            }'
