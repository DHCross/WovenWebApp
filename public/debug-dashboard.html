<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WovenWebApp Debug Dashboard</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #1e293b, #334155);
            border-radius: 12px;
            border: 1px solid #475569;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #60a5fa, #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header p {
            color: #cbd5e1;
            font-size: 1.1rem;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            border-color: #60a5fa;
            box-shadow: 0 10px 25px rgba(96, 165, 250, 0.1);
        }
        
        .card h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card .icon {
            font-size: 1.5rem;
        }
        
        .button {
            display: inline-block;
            padding: 12px 20px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 5px 5px 5px 0;
            text-align: center;
            width: 100%;
            max-width: 200px;
        }
        
        .button:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }
        
        .button.secondary {
            background: linear-gradient(135deg, #64748b, #475569);
        }
        
        .button.secondary:hover {
            background: linear-gradient(135deg, #475569, #334155);
        }
        
        .button.danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .button.danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-item {
            background: #334155;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #475569;
        }
        
        .status-item.loading {
            border-color: #fbbf24;
        }
        
        .status-item.success {
            border-color: #10b981;
        }
        
        .status-item.error {
            border-color: #ef4444;
        }
        
        .console {
            background: #111827;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .console .log-entry {
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #374151;
        }
        
        .console .log-entry:last-child {
            border-bottom: none;
        }
        
        .console .timestamp {
            color: #6b7280;
            font-size: 0.8rem;
        }
        
        .console .error {
            color: #ef4444;
        }
        
        .console .success {
            color: #10b981;
        }
        
        .console .warning {
            color: #f59e0b;
        }
        
        .quick-actions {
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }
        
        .quick-actions h3 {
            margin-bottom: 20px;
            font-size: 1.4rem;
        }
        
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .button {
                max-width: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß WovenWebApp Debug Dashboard</h1>
            <p>Comprehensive system health monitoring and debugging utilities</p>
        </div>
        
        <div class="grid">
            <!-- Environment Status -->
            <div class="card">
                <h3><span class="icon">üåç</span>Environment Status</h3>
                <div class="status-grid">
                    <div class="status-item" id="env-status">
                        <div>Environment</div>
                        <div id="env-value">Checking...</div>
                    </div>
                    <div class="status-item" id="api-key-status">
                        <div>API Key</div>
                        <div id="api-key-value">Checking...</div>
                    </div>
                </div>
                <button class="button" onclick="checkEnvironment()">Check Environment</button>
                <button class="button secondary" onclick="checkAuth0Config()">Check Auth0</button>
            </div>
            
            <!-- Endpoint Health -->
            <div class="card">
                <h3><span class="icon">üè•</span>Endpoint Health</h3>
                <div class="status-grid">
                    <div class="status-item" id="math-brain-status">
                        <div>Math Brain</div>
                        <div id="math-brain-value">Not tested</div>
                    </div>
                    <div class="status-item" id="auth-config-status">
                        <div>Auth Config</div>
                        <div id="auth-config-value">Not tested</div>
                    </div>
                </div>
                <button class="button" onclick="testEndpoints()">Test All Endpoints</button>
                <button class="button secondary" onclick="testMathBrain()">Test Math Brain</button>
            </div>
            
            <!-- Build Status -->
            <div class="card">
                <h3><span class="icon">üèóÔ∏è</span>Build Status</h3>
                <div class="status-grid">
                    <div class="status-item" id="css-status">
                        <div>CSS Build</div>
                        <div id="css-value">Not checked</div>
                    </div>
                    <div class="status-item" id="functions-status">
                        <div>Functions</div>
                        <div id="functions-value">Not checked</div>
                    </div>
                </div>
                <button class="button" onclick="checkBuildStatus()">Check Build</button>
                <button class="button secondary" onclick="runCSS Build()">Build CSS</button>
            </div>
            
            <!-- Network Diagnostics -->
            <div class="card">
                <h3><span class="icon">üåê</span>Network Diagnostics</h3>
                <div class="status-grid">
                    <div class="status-item" id="connectivity-status">
                        <div>Connectivity</div>
                        <div id="connectivity-value">Not tested</div>
                    </div>
                    <div class="status-item" id="rapidapi-status">
                        <div>RapidAPI</div>
                        <div id="rapidapi-value">Not tested</div>
                    </div>
                </div>
                <button class="button" onclick="testConnectivity()">Test Connectivity</button>
                <button class="button secondary" onclick="testRapidAPI()">Test RapidAPI</button>
            </div>
        </div>
        
        <!-- Console Output -->
        <div class="card">
            <h3><span class="icon">üìã</span>Debug Console</h3>
            <div class="console" id="debug-console">
                <div class="log-entry">
                    <span class="timestamp">[Ready]</span> Debug dashboard initialized. Click buttons above to run diagnostics.
                </div>
            </div>
            <button class="button secondary" onclick="clearConsole()">Clear Console</button>
            <button class="button secondary" onclick="downloadLogs()">Download Logs</button>
        </div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
            <h3>üöÄ Quick Actions</h3>
            <div class="action-buttons">
                <button class="button" onclick="runFullDiagnostics()">Run Full Diagnostics</button>
                <button class="button" onclick="testDeploymentReadiness()">Test Deployment Readiness</button>
                <button class="button secondary" onclick="openNetlifyDashboard()">Open Netlify Dashboard</button>
                <button class="button secondary" onclick="openAuth0Dashboard()">Open Auth0 Dashboard</button>
                <button class="button secondary" onclick="viewDocumentation()">View Documentation</button>
                <button class="button danger" onclick="resetEnvironment()">Reset Environment</button>
            </div>
        </div>
    </div>
    
    <script>
        const console_el = document.getElementById('debug-console');
        const logs = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = { timestamp, message, type };
            logs.push(entry);
            
            const logDiv = document.createElement('div');
            logDiv.className = `log-entry ${type}`;
            logDiv.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            
            console_el.appendChild(logDiv);
            console_el.scrollTop = console_el.scrollHeight;
            
            // Keep only last 100 entries
            if (console_el.children.length > 100) {
                console_el.removeChild(console_el.firstChild);
            }
        }
        
        function updateStatus(elementId, status, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `status-item ${status}`;
                const valueElement = element.querySelector('div:last-child');
                if (valueElement) {
                    valueElement.textContent = value;
                }
            }
        }
        
        async function checkEnvironment() {
            log('üåç Checking environment configuration...', 'info');
            updateStatus('env-status', 'loading', 'Checking...');
            
            try {
                // Check if we're in development vs production
                const isDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                const env = isDev ? 'Development' : 'Production';
                
                updateStatus('env-status', 'success', env);
                log(`‚úÖ Environment: ${env}`, 'success');
                
                // Check API configuration
                const response = await fetch('/api/api-health');
                if (response.ok) {
                    const config = await response.json();
                    if (config.error) {
                        updateStatus('api-key-status', 'error', 'Not configured');
                        log('‚ö†Ô∏è Auth0 not configured (OK for Math Brain only)', 'warning');
                    } else {
                        updateStatus('api-key-status', 'success', 'Configured');
                        log('‚úÖ Auth0 configuration found', 'success');
                    }
                } else {
                    updateStatus('api-key-status', 'error', 'Error');
                    log(`‚ùå Config endpoint error: ${response.status}`, 'error');
                }
                
            } catch (error) {
                updateStatus('env-status', 'error', 'Error');
                log(`‚ùå Environment check failed: ${error.message}`, 'error');
            }
        }
        
        async function checkAuth0Config() {
            log('üîê Checking Auth0 configuration...', 'info');
            
            try {
                const response = await fetch('/api/api-health');
                const data = await response.json();
                
                if (response.ok && !data.error) {
                    log(`‚úÖ Auth0 Domain: ${data.domain}`, 'success');
                    log(`‚úÖ Client ID: ${data.clientId ? data.clientId.substring(0, 8) + '...' : 'Missing'}`, 'success');
                    log(`‚úÖ Audience: ${data.audience || 'Not configured'}`, data.audience ? 'success' : 'warning');
                } else {
                    log('‚ö†Ô∏è Auth0 not configured - Auth features disabled', 'warning');
                    log('üí° This is normal for Math Brain only usage', 'info');
                }
            } catch (error) {
                log(`‚ùå Auth0 check failed: ${error.message}`, 'error');
            }
        }
        
        async function testEndpoints() {
            log('üè• Testing all endpoints...', 'info');
            
            await testMathBrain();
            await checkAuth0Config();
            
            log('üìã Endpoint testing completed', 'info');
        }
        
        async function testMathBrain() {
            log('üß† Testing Math Brain endpoint...', 'info');
            updateStatus('math-brain-status', 'loading', 'Testing...');
            
            try {
                // Test GET request (should return 405)
                const getResponse = await fetch('/api/astrology-mathbrain');
                
                if (getResponse.status === 405) {
                    updateStatus('math-brain-status', 'success', 'Accessible');
                    log('‚úÖ Math Brain endpoint accessible', 'success');
                    
                    // Test POST with minimal data
                    const testData = {
                        personA: {
                            name: 'Test',
                            year: 1990, month: 1, day: 1,
                            hour: 12, minute: 0,
                            city: 'New York', nation: 'US',
                            latitude: 40.7128, longitude: -74.0060,
                            timezone: 'America/New_York', zodiac_type: 'Tropic'
                        }
                    };
                    
                    const postResponse = await fetch('/api/astrology-mathbrain', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(testData)
                    });
                    
                    if (postResponse.status === 200) {
                        log('‚úÖ Math Brain working with valid API key', 'success');
                    } else if (postResponse.status === 500) {
                        const errorData = await postResponse.json();
                        if (errorData.error?.includes('Authentication failed')) {
                            log('‚ö†Ô∏è Math Brain accessible but needs API key configuration', 'warning');
                        } else {
                            log(`‚ö†Ô∏è Math Brain error: ${errorData.error}`, 'warning');
                        }
                    } else {
                        log(`‚ÑπÔ∏è Math Brain response: ${postResponse.status}`, 'info');
                    }
                } else {
                    updateStatus('math-brain-status', 'error', 'Error');
                    log(`‚ùå Math Brain endpoint error: ${getResponse.status}`, 'error');
                }
            } catch (error) {
                updateStatus('math-brain-status', 'error', 'Error');
                log(`‚ùå Math Brain test failed: ${error.message}`, 'error');
            }
        }
        
        async function checkBuildStatus() {
            log('üèóÔ∏è Checking build status...', 'info');
            updateStatus('css-status', 'loading', 'Checking...');
            updateStatus('functions-status', 'loading', 'Checking...');
            
            try {
                // Check CSS
                const cssResponse = await fetch('/dist/output.css');
                if (cssResponse.ok) {
                    const cssSize = Math.round(parseInt(cssResponse.headers.get('content-length') || '0') / 1024);
                    updateStatus('css-status', 'success', `${cssSize}KB`);
                    log(`‚úÖ CSS compiled successfully (${cssSize}KB)`, 'success');
                } else {
                    updateStatus('css-status', 'error', 'Missing');
                    log('‚ùå CSS not found - run npm run build:css', 'error');
                }
                
                // Check functions (by testing endpoints)
                const funcResponse = await fetch('/api/astrology-mathbrain');
                if (funcResponse.status === 405) {
                    updateStatus('functions-status', 'success', 'Working');
                    log('‚úÖ Netlify functions deployed', 'success');
                } else {
                    updateStatus('functions-status', 'error', 'Error');
                    log(`‚ùå Function deployment issue: ${funcResponse.status}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå Build status check failed: ${error.message}`, 'error');
            }
        }
        
        async function testConnectivity() {
            log('üåê Testing network connectivity...', 'info');
            updateStatus('connectivity-status', 'loading', 'Testing...');
            
            try {
                const startTime = Date.now();
                const response = await fetch('/');
                const loadTime = Date.now() - startTime;
                
                if (response.ok) {
                    updateStatus('connectivity-status', 'success', `${loadTime}ms`);
                    log(`‚úÖ Local connectivity good (${loadTime}ms)`, 'success');
                } else {
                    updateStatus('connectivity-status', 'error', 'Error');
                    log(`‚ùå Connectivity issue: ${response.status}`, 'error');
                }
            } catch (error) {
                updateStatus('connectivity-status', 'error', 'Error');
                log(`‚ùå Connectivity test failed: ${error.message}`, 'error');
            }
        }
        
        async function testRapidAPI() {
            log('‚ö° Testing RapidAPI connection...', 'info');
            updateStatus('rapidapi-status', 'loading', 'Testing...');
            
            try {
                // This will test through our function
                const testData = {
                    personA: {
                        name: 'API Test',
                        year: 1990, month: 1, day: 1, hour: 12, minute: 0,
                        city: 'New York', nation: 'US',
                        latitude: 40.7128, longitude: -74.0060,
                        timezone: 'America/New_York', zodiac_type: 'Tropic'
                    }
                };
                
                const response = await fetch('/api/astrology-mathbrain', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                
                if (response.status === 200) {
                    updateStatus('rapidapi-status', 'success', 'Working');
                    log('‚úÖ RapidAPI connection working', 'success');
                } else if (response.status === 500) {
                    const data = await response.json();
                    if (data.error?.includes('Authentication failed')) {
                        updateStatus('rapidapi-status', 'error', 'Auth Failed');
                        log('‚ùå RapidAPI authentication failed - check API key', 'error');
                    } else {
                        updateStatus('rapidapi-status', 'error', 'Error');
                        log(`‚ùå RapidAPI error: ${data.error}`, 'error');
                    }
                } else {
                    updateStatus('rapidapi-status', 'error', 'Error');
                    log(`‚ùå RapidAPI test failed: ${response.status}`, 'error');
                }
            } catch (error) {
                updateStatus('rapidapi-status', 'error', 'Error');
                log(`‚ùå RapidAPI test failed: ${error.message}`, 'error');
            }
        }
        
        async function runFullDiagnostics() {
            log('üöÄ Starting full diagnostic suite...', 'info');
            
            await checkEnvironment();
            await checkBuildStatus();
            await testConnectivity();
            await testEndpoints();
            await testRapidAPI();
            
            log('üéâ Full diagnostics completed!', 'success');
        }
        
        async function testDeploymentReadiness() {
            log('üöÄ Testing deployment readiness...', 'info');
            
            // This would run the deployment verification tests
            log('üí° For complete deployment verification, run: npm run test:deployment', 'info');
            
            await runFullDiagnostics();
            
            log('üìã Basic readiness check completed - see console output', 'info');
        }
        
        function clearConsole() {
            console_el.innerHTML = '<div class="log-entry"><span class="timestamp">[Cleared]</span> Console cleared.</div>';
            logs.length = 0;
        }
        
        function downloadLogs() {
            const logText = logs.map(log => `[${log.timestamp}] ${log.type.toUpperCase()}: ${log.message}`).join('\\n');
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `woven-debug-logs-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('üì• Debug logs downloaded', 'info');
        }
        
        function openNetlifyDashboard() {
            window.open('https://app.netlify.com/', '_blank');
            log('üîó Opened Netlify dashboard', 'info');
        }
        
        function openAuth0Dashboard() {
            window.open('https://manage.auth0.com/', '_blank');
            log('üîó Opened Auth0 dashboard', 'info');
        }
        
        function viewDocumentation() {
            window.open('README.md', '_blank');
            log('üìñ Opened documentation', 'info');
        }
        
        function resetEnvironment() {
            if (confirm('This will clear all cached data and reset the debug dashboard. Continue?')) {
                localStorage.clear();
                sessionStorage.clear();
                clearConsole();
                location.reload();
            }
        }
        
        // Auto-run basic checks on load
        document.addEventListener('DOMContentLoaded', function() {
            log('üîß WovenWebApp Debug Dashboard loaded', 'success');
            log('üí° Click buttons above to run diagnostics', 'info');
            
            // Auto-check environment
            setTimeout(checkEnvironment, 1000);
        });
    </script>
</body>
</html>
