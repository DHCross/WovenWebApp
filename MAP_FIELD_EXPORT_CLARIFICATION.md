# MAP/FIELD Export Clarification - Oct 19, 2025

## Raven Calder's Clarification

**The Issue:** File naming is inconsistent with the MAP/FIELD protocol, creating confusion about which file serves which purpose.

---

## The Two Core Report Types

### 1. **Mirror Flow Report** (Qualitative, Constitutional)
- **Source:** MAP file (permanent natal geometry)
- **Purpose:** Constitutional blueprint for self-understanding
- **Sensitivity:** Low location sensitivity
- **Data:** Natal chart only, no transits

### 2. **Balance Meter Report** (Quantitative, Transit-Sensitive)
- **Source:** FIELD file (temporal symbolic weather)
- **Purpose:** Accelerometer for current activations
- **Sensitivity:** High location sensitivity
- **Data:** Transits + reference to MAP

**Note:** Each report type can be applied Solo or Relational, creating four effective outputs.

---

## The Three-File Architecture

### **File 1: MAP** (`wm-map-v1_*.json`)
**Schema:** `wm-map-v1`  
**Purpose:** The permanent constitutional geometry  
**Status:** ✅ Generated by backend, needs export UI

**Contains:**
- Natal planetary positions (centidegrees)
- House cusps (centidegrees)
- Natal aspects (compact format)
- Birth data (date, time, location)
- Provenance metadata
- **NO transits, NO weather data**

**Who Uses It:**
- **Mirror Flow Reports** (Solo Mirror, Relational Mirror, Polarity Cards)
- **Poetic Brain** for constitutional analysis

---

### **File 2: FIELD** (`wm-field-v1_*.json`)
**Schema:** `wm-field-v1`  
**Purpose:** Temporal symbolic weather activations  
**Status:** ✅ Generated by backend, needs export UI

**Contains:**
- Daily transit positions (centidegrees)
- Transit house positions
- Daily transit-to-natal aspects (compact format)
- Balance Meter readings (magnitude, directional bias as ×10 integers)
- Reference to parent MAP file (`_natal_ref`)
- Period markers (start/end dates)

**Who Uses It:**
- **Balance Meter Reports** (quantitative weather tracking)
- **Poetic Brain** for symbolic weather overlay

---

### **File 3: Mirror Directive** (OPTIONAL - Renamed)
**Current Name:** `mirror-directive-*.json`  
**New Name:** `mirror-instruction-*.json` or deprecate  
**Purpose:** Template/instructions for Poetic Brain final report generation  
**Status:** ⚠️ May not be necessary if MAP + FIELD are sufficient

**Contains:**
- Person A/B natal data (duplicate of MAP)
- Mirror contract (report kind, intimacy tier)
- Provenance
- Empty narrative section placeholders

**Problem:** This duplicates MAP data and creates confusion. Users think this is the "Mirror data file" when it's actually just an instruction template.

**Recommendation:** Either:
1. **Rename** to `mirror-instruction-*.json` to clarify it's not the MAP
2. **Deprecate** and have Poetic Brain work directly from MAP + FIELD files
3. **Merge** with MAP file as a variant (`wm-map-v1-directive_*.json`)

---

## Current Backend Implementation

**Location:** `src/math_brain/main.js` (lines 78-101)

```javascript
// Backend generates proper MAP and FIELD files
const mapFile = generateMapFile(transitData, personA, personB, config);
const fieldFile = generateFieldFile(dailyEntries, startDate, endDate, config, mapFile._meta.map_id);

// Includes them in unified output
finalOutput = {
  // ... legacy unified data ...
  _map_file: mapFile,
  _field_file: fieldFile,
};
```

**Status:** ✅ Backend correctly generates MAP and FIELD per spec

---

## Current Frontend Export Problem

**Location:** `app/math-brain/hooks/useChartExport.ts`

**Current Exports:**
1. `downloadResultPDF()` - PDF dashboard
2. `downloadResultMarkdown()` - Markdown report
3. `downloadResultJSON()` - Full unified JSON (legacy)
4. `downloadBackstageJSON()` - Engine config
5. `downloadSymbolicWeatherJSON()` - Weather_Log (confused naming)
6. `downloadMirrorDirectiveJSON()` - Mirror Directive (confusing)

**Problems:**
- No explicit MAP file export button
- No explicit FIELD file export button
- `downloadSymbolicWeatherJSON()` creates "Weather_Log" not "FIELD"
- `downloadMirrorDirectiveJSON()` creates "mirror-directive" not "MAP"
- Users don't know which file to use for which purpose

---

## Proposed Solution

### **Phase 1: Add Proper MAP/FIELD Exports**

```typescript
interface UseChartExportResult {
  // ... existing exports ...
  downloadMapFile: () => void;           // NEW: Export wm-map-v1_*.json
  downloadFieldFile: () => void;         // NEW: Export wm-field-v1_*.json
  // Deprecate or rename:
  downloadMirrorDirectiveJSON: () => void; // RENAME or REMOVE
  downloadSymbolicWeatherJSON: () => void; // KEEP as alias for FIELD
}
```

### **Phase 2: Update Export UI**

**For Transit Reports (Math Brain v2):**
```
Primary Exports:
  ⬇ Download MAP (wm-map-v1) - Constitutional Geometry
  ⬇ Download FIELD (wm-field-v1) - Symbolic Weather

Alternative Formats:
  ⬇ Download PDF Dashboard
  ⬇ Download Markdown Report
```

**For Natal-Only Reports:**
```
Primary Exports:
  ⬇ Download MAP (wm-map-v1) - Constitutional Geometry

Alternative Formats:
  ⬇ Download PDF Dashboard
  ⬇ Download Markdown Report
```

### **Phase 3: Update User Guidance**

**In Poetic Brain Upload Instructions:**
```
For Mirror Flow Reports:
  → Upload MAP file (wm-map-v1_*.json)

For Balance Meter Reports:
  → Upload FIELD file (wm-field-v1_*.json)
  → Optional: Also upload MAP file for full context

For Complete Analysis:
  → Upload both MAP + FIELD files
```

---

## Implementation Checklist

### Backend (Already Done ✅)
- [x] `generateMapFile()` - Creates proper MAP structure
- [x] `generateFieldFile()` - Creates proper FIELD structure
- [x] Includes MAP and FIELD in unified output (`_map_file`, `_field_file`)

### Frontend Export Hooks (To Do)
- [ ] Add `downloadMapFile()` function
- [ ] Add `downloadFieldFile()` function
- [ ] Update `downloadSymbolicWeatherJSON()` to use FIELD naming
- [ ] Deprecate or rename `downloadMirrorDirectiveJSON()`
- [ ] Update export UI buttons to match protocol
- [ ] Add tooltips explaining MAP vs FIELD

### Poetic Brain Integration (To Do)
- [ ] Update upload detection to recognize `wm-map-v1` schema
- [ ] Update upload detection to recognize `wm-field-v1` schema
- [ ] Add guidance for MAP-only vs MAP+FIELD uploads
- [ ] Update documentation to reference MAP/FIELD not "mirror-directive"

### Documentation (To Do)
- [ ] Update USER_FACING_MARKDOWN_DESIGN.md references
- [ ] Update COMPREHENSIVE_STATUS_CHECK references
- [ ] Add MAP/FIELD architecture diagram
- [ ] Update Four Report Types documentation
- [ ] Create user-friendly MAP/FIELD explainer

---

## File Naming Conventions

### **MAP File:**
```
wm-map-v1_[person-a-name]_[generated-timestamp].json
wm-map-v1_dan_20251019T183045.json
```

### **FIELD File:**
```
wm-field-v1_[person-a-name]_[date-range]_[timestamp].json
wm-field-v1_dan_2025-10-19-to-2025-10-25_20251019T183045.json
```

### **Legacy Files (Deprecating):**
```
mirror-directive_[names]_[timestamp].json  → Deprecate or rename to mirror-instruction
symbolic-weather_[names]_[dates].json      → Alias for FIELD file
weather-log_[names]_[dates].json           → Alias for FIELD file
```

---

## User Communication

**Clear Messaging:**
- **MAP = Your Chart** (the permanent blueprint)
- **FIELD = The Weather** (what's happening now)
- **Mirror Flow Report** needs MAP only
- **Balance Meter Report** needs FIELD (which references MAP)

**Avoid:**
- Technical jargon ("schema", "v1", "centidegrees")
- Confusing names ("directive", "symbolic weather log")
- Multiple file types for same purpose

**Use:**
- Plain language ("Your Chart", "The Weather")
- Clear purpose statements
- One primary file per purpose

---

## Status

**Current State:** ⚠️ Backend correct, frontend naming confusing  
**Target State:** ✅ MAP and FIELD files clearly named and exported  
**Next Step:** Implement frontend export functions for MAP and FIELD

---

## References

- **Backend Implementation:** `src/math_brain/main.js` (lines 78-101, 441-562)
- **Frontend Exports:** `app/math-brain/hooks/useChartExport.ts`
- **Protocol Spec:** "Four Report Types_Integrated 10.1.25.md" (lines 281-420)
- **Raven's Clarification:** This document (user message Oct 19, 2025)
